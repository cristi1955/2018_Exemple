define(["require","exports","tslib","modules/clean/comments/store","modules/clean/file_activity/api","modules/constants/comments_panel"],function(e,t,o,n,s,a){"use strict";function i(e){n.state.actorId?s.setCommentingPaneVisibility({actorId:n.state.actorId,shouldShow:e}):s.setSessionCommentingPaneVisibility({shouldShow:e})}function c(e,n){return t.INITIAL_STATE.open=!0,y.setStickyOpen(!0),o.__assign({},e,{open:!0,openReason:n})}function m(e){return t.INITIAL_STATE.open=!1,y.setStickyOpen(!1),o.__assign({},e,{open:!1,openReason:void 0})}function r(e,n){switch(n.type){case"SIDEBAR|RESET":return o.__assign({},t.INITIAL_STATE,{open:e.open});case"SIDEBAR|OPEN":return c(e,n.payload.reason);case"SIDEBAR|CLOSE":return m(e);case"SIDEBAR|SELECT_TAB":return o.__assign({},e,{activeTab:n.payload.tabName});case"SIDEBAR|OPEN_FILE":var s=n.payload,a=s.file,i=s.isVersionHistoryMode,r=s.user;return o.__assign({},e,{openReason:void 0,context:{file:a,isVersionHistoryMode:i,user:r},tabs:{activity:{ready:!r,show:i===!1&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}}}});case"FILE_ACTIVITY|LOADING_END":return o.__assign({},e,{tabs:o.__assign({},e.tabs,{activity:{ready:!0,show:e.context.isVersionHistoryMode===!1&&n.state.enabled,count:0}})});case"SIDEBAR|SET_COMMENTING_STATE":var d=n.payload,u=d.enabled,y=d.canEnable,T=d.commentCount,_=d.initialized,b=d.ready,p=d.unreadCommentCount,v=e.tabs.comments.ready,I=e.tabs.comments.show,E=v||_&&b,h=!E||!v&&E&&(u||y)||I;return o.__assign({},e,{tabs:o.__assign({},e.tabs,{comments:{ready:E,show:h,count:p,extra:{commentCount:T}}})})}return e}function d(e,o){void 0===e&&(e=t.INITIAL_STATE);var n=r(e,o);return n.ready=e.ready||n.tabs.activity.ready&&n.tabs.comments.ready,!e.ready&&n.ready&&(n.tabs.comments.show&&!n.tabs.activity.show?n.activeTab="comments":!n.tabs.comments.show&&n.tabs.activity.show&&(n.activeTab="activity"),n.tabs.comments.show&&n.tabs.comments.count>0&&(n.open=!0,n.openReason=n.openReason||"unread_comments",n.activeTab="comments"),"comments"===n.activeTab?y.showComments():y.hideComments()),n.ready&&n.open&&!n.openReason&&(n.openReason="sticky_state"),!n.open||"comments"!==n.activeTab||e.open&&"comments"===e.activeTab?!e.open||"comments"!==e.activeTab||n.open&&"comments"===n.activeTab||y.hideComments():y.showComments(),n}Object.defineProperty(t,"__esModule",{value:!0});var u=a.SHOW_COMMENTS_PANEL||!1;t.INITIAL_STATE={activeTab:"comments",open:u,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}}}};var y={showComments:function(){setTimeout(function(){n.onShowComments()})},hideComments:function(){setTimeout(function(){n.onHideComments()})},setStickyOpen:function(e){i(e)}};t.reducer=d});
//# sourceMappingURL=reducer.min.js-vflJWSUwC.map