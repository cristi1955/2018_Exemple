define("modules/clean/accounts/api",["require","exports","tslib","modules/clean/ajax_util","modules/clean/api_v2/client"],function(e,t,n,i,o){"use strict";function r(e){return{accounts:e.map(s)}}function s(e){return{accountId:e.account_id,name:{givenName:e.name.given_name,surname:e.name.surname,displayName:e.name.display_name,familiarName:e.name.familiar_name,abbreviatedName:e.name.abbreviated_name},email:e.email,isEmailVerified:e.email_verified,profilePhotoUrl:e.profile_photo_url,isDisabled:e.disabled,isTeammate:e.is_teammate,teamMemberId:e.team_member_id}}function a(e,t){return n.__awaiter(this,void 0,void 0,function(){var s,a,l;return n.__generator(this,function(n){switch(n.label){case 0:return s=new o.ApiV2Client,a=e.id,[4,i.requestWithRetry(function(){return s.rpc(a,"users/get_account_batch",{account_ids:t})})];case 1:return l=n.sent(),[2,r(l)]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAccountsByIds=a}),define("modules/clean/accounts/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccountsAction={FetchAccountsSuccess:"FetchAccountsSuccess"}}),define("modules/clean/accounts/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accountsDispatcher=n}),define("modules/clean/accounts/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/accounts/constants","modules/clean/accounts/dispatcher"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.accountsById={},n}return n.__extends(t,e),t.prototype.get=function(e){return this.accountsById[e]},t.prototype.handleFetchAccountsSuccess=function(e){var t=this;e.accounts.forEach(function(e){t.accountsById[e.accountId]=e}),this.__emitChange()},t.prototype.__onDispatch=function(e){e.action.type===o.AccountsAction.FetchAccountsSuccess&&this.handleFetchAccountsSuccess(e.action.data)},t})(i);t.accountsStore=new s(r.accountsDispatcher)}),define("modules/clean/activity/activity_user",["require","exports","tslib","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,o=void 0===n?null:n,r=t.fname,s=void 0===r?null:r,a=t.lname,l=void 0===a?null:a,c=t.display_name,u=void 0===c?null:c,p=t.email,d=void 0===p?null:p,m=t.photo_url,h=void 0===m?null:m,f=t.photo_circle_url,_=void 0===f?null:f,v=t.initials,g=void 0===v?null:v,y=t.is_email_verified,E=void 0!==y&&y,w=t.is_signed_in,b=void 0!==w&&w;this.id=o,this.fname=s,this.lname=l,this.display_name=u,this.email=d,this.photo_url=h,this.photo_circle_url=_,this.initials=g,this.is_email_verified=E,this.is_signed_in=b,i(this)}return e.fromDict=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?c.em_snippet(this.display_name,22):null!=this.email?c.em_snippet(this.email,22):a._("Anonymous user")},e.__anonymous=new e,n.__decorate([o.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:s.Maybe(String),photo_circle_url:s.Maybe(String)})],e,"fromDict",null),e})();t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/ajax_util",["require","exports","modules/clean/window_util"],function(e,t,n){"use strict";function i(e){return new Promise(function(t,i){function o(){return e().then(t)}var r=!1;n.onBeforeUnload(function(){r=!0}),o().catch(function(e){r?n.onPageRestore(function(){o().catch(i)}):i(e)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.requestWithRetry=i}),function(){define("modules/clean/annotations/annotation",["external/underscore"],function(e){var t,n,i;return i={MARKER:0,HIGHLIGHT:1,REGION:2},n={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}},t=(function(){function e(e,t,n){null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n,i;return n=new e,n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=(i=t.viewportCoordinates)?i:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e;return e={type:this.type,subtype:this.subtype},this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===i.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){var e;switch(this.type){case i.MARKER:return e=this.getFirstViewportCoordinates(),{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case i.HIGHLIGHT:return this._getViewportBoundingRectangle();case i.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,i){var o;return null==n&&(n=0),null==i&&(i=0),o=this.getBoundingBox(),o.left=o.left-n,o.right=o.right-n,o.top=o.top-i,o.bottom=o.bottom-i,o.top=Math.min(Math.max(o.top,0),t-1),o.right=Math.min(Math.max(o.right,0),e-1),o.bottom=Math.min(Math.max(o.bottom,0),t-1),o.left=Math.min(Math.max(o.left,0),e-1),o},e.prototype._getViewportBoundingRectangle=function(){var e,t,n,i,o,r,s,a,l,c,u;for(l=s=this.getFirstViewportCoordinates().x,c=a=this.getFirstViewportCoordinates().y,u=this.viewportCoordinates,n=0,o=u.length;n<o;n++)for(e=u[n],i=0,r=e.length;i<r;i++)t=e[i],l=Math.min(l,t.x),s=Math.max(s,t.x),c=Math.min(c,t.y),a=Math.max(a,t.y);return{top:c,right:s,bottom:a,left:l}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){var e,t;return null!=(e=this.image_coordinates)&&null!=(t=e[0].coordinates)?t[0]:void 0},e.prototype.getFirstPdfCoordinates=function(){var e;return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=(e=this.pdf_coordinates[0].coordinates)?e[0]:void 0},e.prototype.getFirstPdfPage=function(){var e;return this.isOldCoordinatesFormat()?null!=(e=this.pdf_coordinates)?e.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===i.MARKER?this.annotationSize:null},e})(),{Annotation:t,AnnotationTypes:i,AnnotationSubtypes:n}})}.call(this),function(){define("modules/clean/annotations/annotation_controller",["external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_region","jquery"],function(e,t,n,i,o,r,s){var a,l,c;return n.Annotation,a=n.AnnotationTypes,n.AnnotationSubtypes,c=e.DOM,l="ephemeral-annotation-container",e.createClass({displayName:"AnnotationController",propTypes:{controllerEventHandlers:e.PropTypes.object,onAnnotationPlacedCallback:e.PropTypes.func,onAnnotationHiddenCallback:e.PropTypes.func,onAnnotationStartDragCallback:e.PropTypes.func,onAnnotationEndDragCallback:e.PropTypes.func,onAnnotationScrollCallback:e.PropTypes.func,onAnnotationScaleChangeCallback:e.PropTypes.func,onAnnotationEnterCallback:e.PropTypes.func,onAnnotationLeaveCallback:e.PropTypes.func,isAnnotationMarkerEnabled:e.PropTypes.bool,isAnnotationHighlightEnabled:e.PropTypes.bool,isAnnotationRegionEnabled:e.PropTypes.bool,isAnnotationCreationEnabled:e.PropTypes.bool,parentContainerOffset:e.PropTypes.object,draftAnnotationVersion:e.PropTypes.number},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){var e,t,n,i,o,r;return null!=(e=this.props.controllerEventHandlers)&&(e.onHideAnnotation=this.onHideAnnotation),null!=(t=this.props.controllerEventHandlers)&&(t.onMouseMoveCallback=this.onMouseMoveCallback),null!=(n=this.props.controllerEventHandlers)&&(n.onMouseDownCallback=this.onMouseDownCallback),null!=(i=this.props.controllerEventHandlers)&&(i.onMouseUpCallback=this.onMouseUpCallback),null!=(o=this.props.controllerEventHandlers)&&(o.onScrollCallback=this.onScrollCallback),null!=(r=this.props.controllerEventHandlers)?r.onScaleChangeCallback=this.onScaleChangeCallback:void 0},componentDidUpdate:function(e,t){if(this.props.draftAnnotationVersion>e.draftAnnotationVersion)return this._allowAnnotationTypeSwitch(),this.setState(this.getInitialState())},_getViewerX:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageX:void 0)||0},_getViewerY:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},(function(e){return function(){return"function"==typeof t?t():void 0}})(this)),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var n;return n=t.findDOMNode(this.refs.activeAnnotation),null!=n&&(e.target===n||s.contains(n,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case a.MARKER:return this.props.isAnnotationMarkerEnabled;case a.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case a.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n,i,o,r,a,l,c;if(i=s(e.target),t=i.contents(),n=(null!=(c=i.css("cursor"))?c:"").split(","),n=n[n.length-1].trim(),"text"===n||"vertical-text"===n||i.is("a")&&0===t.length)return!0;if("auto"!==n)return!1;for(r=!1,a=0,l=t.length;a<l;a++)o=t[a],o.nodeType===Node.TEXT_NODE&&(r=!0);return r},_deselectAllText:function(){var e,t;return null!=(t=document.selection)&&"function"==typeof t.empty&&t.empty(),"function"==typeof window.getSelection&&"function"==typeof(e=window.getSelection()).removeAllRanges?e.removeAllRanges():void 0},onHideAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotation)?e.hideAnnotation():void 0},onMouseDownCallback:function(e){var t,n;if(!this.isMouseDown)return this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,!this._isOnRegion(e)&&this._isOnText(e)?(t=a.HIGHLIGHT,this._trySetActiveAnnotationType(t,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0}})(this))):void 0):null!=(n=this.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0},onMouseMoveCallback:function(e){var t,n;if(this.isMouseDown)return null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,this.isMouseDown&&null===t&&(t=a.REGION),this._trySetActiveAnnotationType(t,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0}})(this))):null!=(n=this.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0},onMouseUpCallback:function(e){var t,n,i,o,r,s;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){if(r=this.state.activeAnnotationType,null===r){if(this._isAnnotationTypeCreationEnabled(a.MARKER))r=a.MARKER;else if(this._isAnnotationTypeCreationEnabled(a.REGION))return void this._trySetActiveAnnotationType(a.REGION,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)&&"function"==typeof n.createDefaultRegion?n.createDefaultRegion(e):void 0}})(this))}else r===a.REGION&&this._isAnnotationTypeCreationEnabled(a.MARKER)&&(t={x:e.pageX,y:e.pageY},n=t.x-this.positionAtLastMouseDown.x,i=t.y-this.positionAtLastMouseDown.y,o=Math.sqrt(n*n+i*i),o<=34&&(r=a.MARKER));return this._trySetActiveAnnotationType(r,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseUpCallback(e):void 0}})(this))}return null!=(s=this.refs.activeAnnotation)?s.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){var e;return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){var t;return this._disallowAnnotationTypeSwitch(),"function"==typeof(t=this.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScrollCallback?t.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScaleChangeCallback?t.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case a.MARKER:return e.createElement(i,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case a.HIGHLIGHT:return e.createElement(o,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case a.REGION:return e.createElement(r,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return c.div({className:""+l},this._renderActiveAnnotation())}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i){var o,r,s,a;return o=i.Annotation,s=i.AnnotationTypes,r=i.AnnotationSubtypes,a=t.DOM,t.createClass({displayName:"AnnotationHighlight",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return{isShown:!1}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return this.type=s.HIGHLIGHT,this.subtype=r.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},hideAnnotation:function(){return this._hideAnnotation()},_updateViewportBoundaries:function(){var e,t,n;if(e=window.getSelection(),e.rangeCount>0)return t=this._isBrowserIE()?this._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):this._extractViewportClientRectangles(e.getRangeAt(0)),n=this._consolidateClientRectangles(t),this._setViewportCoordinatesFromRectangles(n)},_extractViewportClientRectangles:function(e){var t,n,i,o;for(t=[],n=e.endContainer,i=e.endOffset,o=e.cloneRange();n!==e.commonAncestorContainer;)o.setStart(n,0),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),i=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return o=e.cloneRange(),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),t},_extractViewportClientRectanglesIEHack:function(e){var t,n,i;if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();for(t=[],i=e.cloneRange(),i.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,i.getClientRects()),n=e.startContainer.parentNode.nextSibling;n!==e.endContainer.parentNode;)Array.prototype.push.apply(t,n.getClientRects()),n=n.nextSibling;return i.setStart(e.endContainer,0),i.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,i.getClientRects()),t},_isBrowserIE:function(){var e,t,n;return n=window.navigator.userAgent,t=n.indexOf("Trident/"),e=n.indexOf("Edge/"),t>0||e>0},_consolidateClientRectangles:function(e){var t,n,i,o,r,s;for(n=[],i=0,o=e.length;i<o;i++)s=e[i],0!==s.width&&0!==s.height&&(n.length>0&&(r=n[n.length-1],this._isWithinConsolidationVerticalBuffer(r,s)&&this._isWithinConsolidationHorizontalBuffer(r,s))?(t=this._calculateBoundingBox(r,s),r.top=t.top,r.right=t.right,r.bottom=t.bottom,r.left=t.left):n.push({top:s.top,right:s.right,bottom:s.bottom,left:s.left}));return n},_isWithinConsolidationVerticalBuffer:function(e,t){return Math.abs(e.top-t.top)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-t.bottom)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},_isWithinConsolidationHorizontalBuffer:function(e,t){var n,i,o;return n=this._calculateBoundingBox(e,t),i=n.right-n.left,o=t.width+(e.right-e.left),i-o<this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},_calculateBoundingBox:function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},_setViewportCoordinatesFromRectangles:function(e){var t,n,i,o,r,s,a;for(r=[],s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,n=0,i=e.length;n<i;n++)o=e[n],t=[],t.push({x:o.left+s,y:o.top+a}),t.push({x:o.right+s,y:o.bottom+a}),r.push(t);return this.annotation.viewportCoordinates=r},_getPositionRelativeToParentContainer:function(e){return{x:e.x-this.props.parentContainerOffset.left,y:e.y-this.props.parentContainerOffset.top}},_updateHighlightedText:function(){return this.annotation.text_highlight={snippet_before:this._getTextBeforeHighlight(),text:this._getHighlightedText(),snippet_after:this._getTextAfterHighlight()}},_generateAnnotation:function(){return this.annotation=new o(this.type,this.subtype),this._updateViewportBoundaries(),this._updateHighlightedText()},_hideAnnotation:function(){return this._isBrowserIE()&&this.state.isShown&&this.setState({isShown:!1,viewportCoordinates:null}),this.annotation=null,this.props.onAnnotationHiddenCallback()},_updateViewportCoordinatesFromUI:function(){var t,n,i,o,r,s,a,l;if(this.state.isShown){for(r=[],l=e(".annotation-highlight"),i=0,o=l.length;i<o;i++)s=l[i],n=[],t=e(s),a=t.offset(),n.push({x:a.left,y:a.top}),n.push({x:a.left+t.width(),y:a.top+t.height()}),r.push(n);return this.annotation.viewportCoordinates=r}},_getHighlightedText:function(){var e;return e=window.getSelection().toString().trim(),e=e.replace(/\s+/g," ")},_getTextBeforeHighlight:function(){return""},_getTextAfterHighlight:function(){return""},_isTextSelected:function(){return""!==this._getHighlightedText()},onMouseDownCallback:function(e){return{}},onMouseMoveCallback:function(e){return{}},onMouseUpCallback:function(e){return setTimeout((function(e){return function(){var t,n,i,o,r,s,a,l;if(!e._isTextSelected())return e._hideAnnotation();if(e._generateAnnotation(),e.props.onAnnotationPlacedCallback(e.annotation),e._isBrowserIE()){for(l=[],s=e.annotation.viewportCoordinates,i=0,r=s.length;i<r;i++)t=s[i],n=[],o=e._getPositionRelativeToParentContainer(t[0]),a=e._getPositionRelativeToParentContainer(t[1]),n.push({x:o.x,y:o.y}),n.push({x:a.x,y:a.y}),l.push(n);return e.setState({isShown:!0,viewportCoordinates:l})}}})(this),0)},onScrollCallback:function(){var e;if(null!=this.annotation)return this._isBrowserIE()?this._updateViewportCoordinatesFromUI():this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;if(null!=this.annotation)return this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseUp:function(e){return{}},render:function(){var e,t,n,i,o,r,s;return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},function(){var l,c,u;if(this.state.isShown){for(t=[],u=this.state.viewportCoordinates,l=0,c=u.length;l<c;l++)i=u[l],n=i[0].x,s=i[0].y,o=i[1].x,e=i[1].y,r={left:n,top:s,width:o-n,height:e-s},t.push(a.div({className:"annotation-highlight",style:r}));return t}}.call(this))}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight_ui",["jquery","external/classnames","external/react","external/react-dom","modules/clean/annotations/annotation"],function(e,t,n,i,o){var r,s,a;return r=o.Annotation,o.AnnotationTypes,o.AnnotationSubtypes,a=n.DOM,s=18,n.createClass({displayName:"AnnotationHighlightUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,scaleFactor:n.PropTypes.number,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getDefaultProps:function(){return{scaleFactor:1}},getInitialState:function(){return{isHover:!1}},componentWillMount:function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=r.createAnnotationFromDict(this.props.annotation)},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onHighlightClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseEnter:function(e){var t;return this.setState({isHover:!0}),clearTimeout(this.mouseLeaveTimeout),this._updateViewportCoordinates(),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseOver:function(e){return{}},_onHighlightMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback&&t.onAnnotationLeaveCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}),this.mouseLeaveTimeout=setTimeout((function(e){return function(){return e.setState({isHover:!1})}})(this),100)},_updateViewportCoordinates:function(){var t,n,o,r,s,a,l,c;for(t=e(i.findDOMNode(this.refs.highlightContainer)),l=[],r=t.children(),s=0,a=r.length;s<a;s++)o=r[s],n=[],c=e(o).offset(),n.push({x:c.left,y:c.top}),n.push({x:c.left+e(o).width(),y:c.top+e(o).height()}),l.push(n);return this.annotation.viewportCoordinates=l},render:function(){var e,n,i,o,r,l,c,u,p,d,m,h,f,_,v,g,y,E;for(c=[],p=null!=(f=this.props.commentActivity)&&null!=(_=f.comment)?_.resolved:void 0,e=t({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":p,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),r=-1,v=this.initialViewport,u=0,m=v.length;u<m;u++)h=v[u],d=h[0].x,E=h[0].y,g=h[1].x,l=h[1].y,(r===-1||E<r)&&(i=d,r=E),y={left:d*this.props.scaleFactor,top:E*this.props.scaleFactor,width:g-d,height:l-E,transform:"scale("+this.props.scaleFactor+")",transformOrigin:"top left"},c.push(a.div({className:e,style:y,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}));return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},c,this.props.options.isAnnotationNumberingEnabled?(o={left:i*this.props.scaleFactor-s/2,top:r*this.props.scaleFactor-s/2},n=t({"annotation-number":!0,"annotation-number--resolved":p,"annotation-number--hover":this.state.isHover}),a.div({className:n,style:o},this.props.options.annotationNumber)):void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker",["jquery","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i,o){var r,s,a,l;return r=o.Annotation,a=o.AnnotationTypes,s=o.AnnotationSubtypes,l=t.DOM,t.createClass({displayName:"AnnotationMarker",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return this.type=a.MARKER,this.subtype=s.MARKER.CIRCLE,this.size=28,this.isInDragMode=!1,this._resetPositionDelta(),{isToolVisible:!1,viewerX:0,viewerY:0}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return{}},hideAnnotation:function(){return this._hideAnnotation()},_getSelectionText:function(){var e;return e="",window.getSelection&&(e=window.getSelection().toString()),e},_hasSelectedText:function(){return""!==this._getSelectionText()},_resetPositionDelta:function(){return this.positionDelta={x:0,y:0}},_getOffsetPosition:function(e){var t,n,i,o,r,s,a,l;return t=e.offsetX||(null!=(i=e.nativeEvent)?i.offsetX:void 0)||(null!=(o=e.nativeEvent)&&null!=(r=o.originalEvent)?r.layerX:void 0),n=e.offsetY||(null!=(s=e.nativeEvent)?s.offsetY:void 0)||(null!=(a=e.nativeEvent)&&null!=(l=a.originalEvent)?l.layerY:void 0),{x:t-this.annotation.getSize()/2,y:n-this.annotation.getSize()/2}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_calculateMarkerPos:function(e){var t,n;return n=this._getPositionRelativeToParentContainer(e),t=this.size/2,{x:n.x-t-this.positionDelta.x,y:n.y-t-this.positionDelta.y}},_generateAnnotation:function(e){return this.annotation=new r(this.type,this.subtype,this.size),this._updateViewportCoordinatesFromEvent(e),this.annotation},_updateViewportCoordinatesFromEvent:function(e){var t;return t={x:e.clientX-this.positionDelta.x,y:e.clientY-this.positionDelta.y},this.annotation.viewportCoordinates[0]=[t]},_hideAnnotation:function(e){var t;return this.annotation=null,this.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof(t=this.props).onAnnotationHiddenCallback?t.onAnnotationHiddenCallback():void 0},_placeAnnotation:function(e){return this.setState({isToolVisible:!0,viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y},(function(t){return function(){var n;return t._generateAnnotation(e),"function"==typeof(n=t.props).onAnnotationPlacedCallback?n.onAnnotationPlacedCallback(t.annotation):void 0}})(this))},updateViewportCoordinatesFromMarker:function(){var t,i,o,r;return this.state.isToolVisible&&(r=n.findDOMNode(this.refs.annotationMarker),r&&(t=e(r),i=t.offset(),o={x:i.left+this.annotation.getSize()/2,y:i.top+this.annotation.getSize()/2},this.annotation.viewportCoordinates[0]=[o])),null},_startAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!0,this.positionDelta=this._getOffsetPosition(e),this._updateViewportCoordinatesFromEvent(e),"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(this.annotation):void 0},_endAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!1,this._updateViewportCoordinatesFromEvent(e),this._resetPositionDelta(),"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(this.annotation):void 0},_isOnMarker:function(t){var i
;if(this.state.isToolVisible)return i=n.findDOMNode(this.refs.annotationMarker),null!=i&&(t.target===i||e.contains(i,t.target))},onMouseDownCallback:function(e){if(this.state.isToolVisible&&this._isOnMarker(e))return this._startAnnotationDrag(e),e.preventDefault()},onMouseMoveCallback:function(e){if(this.isInDragMode&&this.state.isToolVisible)return this.setState({viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y}),e.preventDefault()},onMouseUpCallback:function(e){return this.state.isToolVisible?this.isInDragMode?this._endAnnotationDrag(e):this._hideAnnotation(e):this._hasSelectedText()?void 0:(this._placeAnnotation(e),e.preventDefault())},onScrollCallback:function(){var e;if(this.state.isToolVisible)return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onMarkerMouseUp:function(e){return{}},_onMarkerMouseEnter:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},render:function(){var e;return e=[],this.state.isToolVisible&&(e=[l.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},l.div({className:"annotation-maker-inner"}))]),l.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,i){var o;return o=n.DOM,n.createClass({displayName:"AnnotationMarkerUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{options:{}}},componentWillMount:function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onMarkerClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseEnter:function(t){var n,o,r;return n=e(i.findDOMNode(this.refs.annotationMarker)),o=this.props.annotation,null==o.viewportCoordinates&&(o.viewportCoordinates=[]),o.viewportCoordinates[0]=[{x:n.offset().left+o.annotationSize/2,y:n.offset().top+o.annotationSize/2}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:o,commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,i,r;return n=null!=(i=this.props.commentActivity)&&null!=(r=i.comment)?r.resolved:void 0,e=t({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!n,"annotation-marker--resolved":n,"annotation-marker--ghost":this._isGhostAnnotation()}),o.div({className:"annotation-marker-container",ref:"markerContainer"},o.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:e,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},o.div({className:"annotation-maker-inner"})))}})})}.call(this),define("modules/clean/annotations/annotation_message_transformer",["require","exports"],function(e,t){"use strict";function n(e){var t=e.action,n=e.parameters;switch(t){case"annotation-placed":return h(n);case"annotation-hidden":return f(n);case"annotation-start-drag":return _(n);case"annotation-end-drag":return v(n);case"annotation-enter":return g(n);case"annotation-leave":return y(n);case"annotation-ui-click":return E(n);case"annotation-ui-enter":return w(n);case"annotation-ui-leave":return b(n);case"page-rendered":return m(n);default:return e}}function i(e){var t=e.action,n=e.parameters;switch(t){case"file-preview-scroll-to-annotation":return o(n);case"file-preview-update-annotation-creation":return r(n);case"file-preview-update-annotation-region-creation":return s(n);case"file-preview-remove-annotation":return u(n);case"file-preview-load-annotations":return a(n);case"file-preview-reload-annotations":return l(n);case"file-preview-unload-annotations":return c(n);case"file-preview-remove-annotation-draft":return p(n);case"file-preview-finalize-annotation-draft":return d(n);default:return e}}function o(e){return{action:"scroll-to-annotation",parameters:{commentActivity:{activity_key:e.id},page:e.page}}}function r(e){return{action:e.enabled?"enable-annotation-creation":"disable-annotation-creation",parameters:P}}function s(e){return{action:e.enabled?"enable-region-creation":"disable-region-creation",parameters:P}}function a(e){return{action:"update-annotations",parameters:e}}function l(e){return{action:"update-annotations",parameters:e}}function c(e){return{action:"remove-all-annotations",parameters:P}}function u(e){return{action:"remove-annotation",parameters:{commentActivity:{activity_key:e.id}}}}function p(e){return{action:"remove-annotation",parameters:{commentActivity:{activity_key:e.id}}}}function d(e){return{action:"update-annotations",parameters:e}}function m(e){return{action:"file-preview-ready",parameters:e}}function h(e){return{action:"file-preview-annotation-draft-created",parameters:e}}function f(e){return{action:"file-preview-annotation-draft-removed",parameters:e}}function _(e){return{action:"file-preview-annotation-draft-drag-start",parameters:e}}function v(e){return{action:"file-preview-annotation-draft-drag-end",parameters:e}}function g(e){return{action:"file-preview-annotation-draft-mouse-enter",parameters:e}}function y(e){return{action:"file-preview-annotation-draft-mouse-leave",parameters:e}}function E(e){return{action:"file-preview-annotation-click",parameters:e}}function w(e){return{action:"file-preview-annotation-mouse-enter",parameters:e}}function b(e){return{action:"file-preview-annotation-mouse-leave",parameters:e}}Object.defineProperty(t,"__esModule",{value:!0});var P={};t.transformLegacyChildActions=n,t.transformParentActions=i}),function(){define("modules/clean/annotations/annotation_region",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i,o,r){var s,a,l,c;return s=r.Annotation,l=r.AnnotationTypes,a=r.AnnotationSubtypes,c=n.DOM,n.createClass({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:n.PropTypes.func,onAnnotationHiddenCallback:n.PropTypes.func,onAnnotationStartDragCallback:n.PropTypes.func,onAnnotationEndDragCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationScrollCallback:n.PropTypes.func,onAnnotationScaleChangeCallback:n.PropTypes.func,onAnnotationEnterCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,parentContainerOffset:n.PropTypes.object},TYPE:l.REGION,SUBTYPE:a.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e,t,n,i;return i=this.state.rectangle.top+this.props.parentContainerOffset.top,n=this.state.rectangle.right+this.props.parentContainerOffset.left,e=this.state.rectangle.bottom+this.props.parentContainerOffset.top,t=this.state.rectangle.left+this.props.parentContainerOffset.left,this.annotation.viewportCoordinates[0]=[{x:t,y:i},{x:t,y:e},{x:n,y:e},{x:n,y:i}]},_isOnRegion:function(t){var n;return!(!this.state.isToolVisible||(n=i.findDOMNode(this.refs.annotationRegion),null==n))&&(t.target===n||e.contains(n,t.target))},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:o.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:o.clone(t),anchorRectangle:o.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new s(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){var e;return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t,n,i,o;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),i=n.x,o=n.y,t=this.DEFAULT_REGION_SIZE/2,this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:o-t,right:i+t,bottom:o+t,left:i-t}},(function(e){return function(){var t;return e._updateAnnotationFromState(),"function"==typeof(t=e.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e.annotation):void 0}})(this))},onMouseDownCallback:function(e){var t,n;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof(t=this.props).onAnnotationStartDragCallback&&t.onAnnotationStartDragCallback(this.annotation),this._startDragging(n)):void 0:this._showNewRectangle(n)},onMouseMoveCallback:function(e){var t,n,i;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(i=this._getPositionRelativeToParentContainer(e),t={x:i.x-this.state.anchorMouse.x,y:i.y-this.state.anchorMouse.y},n=o.clone(this.state.anchorRectangle),this.state.isInDragMode?n={top:this.state.anchorRectangle.top+t.y,right:this.state.anchorRectangle.right+t.x,bottom:this.state.anchorRectangle.bottom+t.y,left:this.state.anchorRectangle.left+t.x}:this.isResizing&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?n.top=this.state.anchorRectangle.top+t.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(n.bottom=this.state.anchorRectangle.bottom+t.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?n.left=this.state.anchorRectangle.left+t.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(n.right=this.state.anchorRectangle.right+t.x)),n={top:Math.min(n.top,n.bottom),right:Math.max(n.left,n.right),bottom:Math.max(n.top,n.bottom),left:Math.min(n.left,n.right)},this.setState({rectangle:n})):void 0:(i=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(i))},onMouseUpCallback:function(e){var t,n;if(e.preventDefault(),this.state.isToolVisible)return this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof(t=this.props).onAnnotationPlacedCallback&&t.onAnnotationPlacedCallback(this.annotation):"function"==typeof(n=this.props).onAnnotationEndDragCallback&&n.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e)},onScrollCallback:function(){var e;if(this.state.isToolVisible)return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){var t;return this.setState({isHovering:!0}),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){var t;return this.setState({isHovering:!1}),"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){var n,i;return e.preventDefault(),this.isResizing=!0,i=this._getPositionRelativeToParentContainer(e),this._updateAnnotationFromState(),"function"==typeof(n=this.props).onAnnotationStartDragCallback&&n.onAnnotationStartDragCallback(this.annotation),this._startResizing(i,t)},_renderSideHandles:function(){var e;return c.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},function(){var t,n,i,r;for(i=o.values(this.Directions),r=[],t=0,n=i.length;t<n;t++)e=i[t],r.push((function(e){return function(t){return c.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})}})(this)(e));return r}.call(this))},_renderCornerHandles:function(){var e,t,n,i,o,r;for(i=[this.Directions.TOP,this.Directions.BOTTOM],o=[],t=0,n=i.length;t<n;t++)r=i[t],o.push(function(){var t,n,i,o;for(i=[this.Directions.LEFT,this.Directions.RIGHT],o=[],t=0,n=i.length;t<n;t++)e=i[t],o.push((function(e){return function(t,n){return c.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(i){return e._onHandleMouseDown(i,[t,n])}},c.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))}})(this)(r,e));return o}.call(this));return o},render:function(){var e,n;return n=[],this.state.isToolVisible&&(e={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering},n=[c.div({key:"annotationRegion",ref:"annotationRegion",className:t(e),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]),c.div({className:"annotation-region-container"},this.state.isToolVisible?n:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_region_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,i){var o;return o=n.DOM,n.createClass({displayName:"AnnotationRegionUI",propTypes:{annotation:n.PropTypes.object,scaleFactor:n.PropTypes.number,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getDefaultProps:function(){return{scaleFactor:1}},getInitialState:function(){return{}},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onRegionClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseEnter:function(t){var n,o,r,s,a,l,c;return n=e(i.findDOMNode(this.refs.annotationRegion)),o=this.props.annotation,null==o.viewportCoordinates&&(o.viewportCoordinates=[]),c=n.offset().top,a=n.offset().left,s=c+n.height(),l=a+n.width(),o.viewportCoordinates[0]=[{x:a,y:c},{x:a,y:s},{x:l,y:s},{x:l,y:c}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:o,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseOver:function(e){return{}},_onRegionMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,i,r,s,a;return i=null!=(s=this.props.commentActivity)&&null!=(a=s.comment)?a.resolved:void 0,r=this.props.annotation.getBoundingBox(),e=t({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":i,"annotation-region--ui--resolved":i,"annotation-region--ghost":this._isGhostAnnotation()}),o.div({className:"annotation-region-container"},o.div({key:"annotationRegion",ref:"annotationRegion",className:e,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:r.left*this.props.scaleFactor,top:r.top*this.props.scaleFactor,width:(r.right-r.left)*this.props.scaleFactor,height:(r.bottom-r.top)*this.props.scaleFactor}},o.div({className:"annotation-region-inner"}),this.props.options.isAnnotationNumberingEnabled?(n=t({"annotation-number":!0,"annotation-number--resolved":i}),o.div({className:n},this.props.options.annotationNumber)):void 0))}})})}.call(this),function(){define("modules/clean/annotations/annotation_renderer_utils",["jquery","external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/underscore"],function(e,t,n,i,o,r,s){var a,l;return a=n.Annotation,l=n.AnnotationTypes,(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){var n,i,o,r,a,l,c;if((null!=(a=e.annotations)?a.length:void 0)!==(null!=(l=s.keys(t))?l.length:void 0))return!0;for(c=e.annotations,o=0,r=c.length;o<r;o++)if(i=c[o],n=i.commentActivity.activity_key,!s.isEqual(t[n],i))return!0;return!1},e.prototype.renderAnnotation=function(e,t,n){var s,c,u,p;if(null==e.annotation||null==e.commentActivity)return null;if(s=a.createAnnotationFromDict(e.annotation),u=e.commentActivity,null==(null!=s?s.type:void 0)||t(u.activity_key))return null;switch(c=null,s.type){case l.MARKER:c=o;break;case l.HIGHLIGHT:c=i;break;case l.REGION:c=r}return null==c?null:(p=null!=e.options?e.options:{},n(c,s,u,p))},e})()})}.call(this),function(){define("modules/clean/annotations/preview_image_annotations_toolbar",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/core/dom","modules/core/i18n","modules/clean/keycode","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/constants/comments_panel"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m){var h,f,_,v,g,y,E,w,b;return y=s._,b=s.format_percent,h=a.KeyCode,g=c.UserActionNames,v=c.UserActionContextNames,f=u.KeyboardBindingConnector,E=t.createElement,w=t.DOM,_=3e3,t.createClass({displayName:"PreviewImageAnnotationsToolbar",propTypes:{canEnableRegionCreation:t.PropTypes.bool,index:t.PropTypes.number.isRequired,count:t.PropTypes.number.isRequired,zoomPercent:t.PropTypes.number,minimumZoomPercent:t.PropTypes.number,maximumZoomPercent:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,onFullscreen:t.PropTypes.func,onZoomIn:t.PropTypes.func,onZoomOut:t.PropTypes.func,onZoomOriginalOrFit:t.PropTypes.func,onRegionCreationClick:t.PropTypes.func,onKeyPress:t.PropTypes.func},getInitialState:function(){return{isToolbarVisible:!0}},componentDidMount:function(){return window.addEventListener("mousemove",this._onMouseMove)},componentWillUnmount:function(){return window.removeEventListener("mousemove",this._onMouseMove),clearTimeout(this.hideToolbarTimeout)},_onMouseMove:function(e){if(this.state.isToolbarVisible||this.setState({isToolbarVisible:!0}),this.state.isToolbarVisible)return clearTimeout(this.hideToolbarTimeout),this.hideToolbarTimeout=setTimeout((function(t){return function(){return t._maybeHideToolbar(e)}})(this),_)},onKeydown:function(e){var t,n,i,o;return!(!r.focus_in_input()&&!r.is_input(e.target))||(o=e.keyCode,o===h.EQUALS||o===h.PLUS_EQUALS_FF||o===h.PLUS_CHROME||o===h.PLUS_EQUALS_FF_GERMAN?("function"==typeof(t=this.props).onZoomIn&&t.onZoomIn(),i=!0):o===h.MINUS_FF_MAC||o===h.MINUS_FF||o===h.MINUS_CHROME?("function"==typeof(n=this.props).onZoomOut&&n.onZoomOut(),i=!0):this.props.onKeyPress&&(i=this.props.onKeyPress(e)),i&&null!=e.preventDefault&&e.preventDefault(),!i)},_maybeHideToolbar:function(e){if(0===o(e.target).closest(n.findDOMNode(this.refs.previewToolbar)).length)return this.setState({isToolbarVisible:!1})},_flipLabelText:function(){return y("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})},_zoomToolTipText:function(){return y(1===this.props.zoomPercent?"Zoom to fit":"View actual size")},_getZoomLabel:function(){return this.props.zoomPercent?b(Math.round(100*this.props.zoomPercent)):""},_onZoomMouseDown:function(e,t){return this.isZooming||l.logUserAction(t.action,t.context),this.isZooming=!0,this._keepZooming(e,400)},_keepZooming:function(e,t){if(this.isZooming)return e(),setTimeout((function(t){return function(){return t._keepZooming(e,75)}})(this),t)},_onZoomMouseUp:function(){return this.isZooming=!1},_onZoomMouseLeave:function(){return this.isZooming=!1},_onClickPrevious:function(){return this.props.onPrevious(),l.logUserAction(g.FLIP_PREV,v.TOOLBAR)},_onClickNext:function(){return this.props.onNext(),l.logUserAction(g.FLIP_NEXT,v.TOOLBAR)},_onClickFullscreen:function(){return this.props.onFullscreen(),l.logUserAction(g.TOGGLE_FULLSCREEN_ON,v.TOOLBAR)},render:function(){var t,n,o;return!!this.state.isToolbarVisible&&(!(this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen)&&(o={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},n={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},t={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation},w.div({className:"preview-toolbar-overlay-container"},E(f,{allKeyCallback:this.onKeydown}),w.div({className:"preview-toolbar-overlay",ref:"previewToolbar"},w.div({className:"preview-toolbar-content image-toolbar"},this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext?w.span({className:"flip-buttons image-toolbar__item"},w.div({className:"flip-button flip-button--previous",onClick:this._onClickPrevious},E(p,{group:"web",name:"s_flip_left",alt:y("Previous")})),w.div({className:"nav-text"},this._flipLabelText()),w.div({className:"flip-button flip-button--next",onClick:this._onClickNext},E(p,{group:"web",name:"s_flip_right",alt:y("Next")}))):void 0,null!=this.props.onZoomOut||null!=this.props.onZoomIn?w.span({className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?w.div({className:e(o),onMouseDown:i.partial(this._onZoomMouseDown,this.props.onZoomOut,{action:g.ZOOM_OUT,context:v.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},E(p,{group:"web",name:"zoomout",alt:y("Zoom Out")})):void 0,null!=this.props.onZoomOriginalOrFit?E(d,{content:this._zoomToolTipText(),position:d.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},w.div({ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this._getZoomLabel())):void 0,null!=this.props.onZoomIn?w.div({className:e(n),onMouseDown:i.partial(this._onZoomMouseDown,this.props.onZoomIn,{action:g.ZOOM_IN,context:v.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},E(p,{group:"web",name:"zoom",alt:y("Zoom In")})):void 0):void 0,null!=this.props.onFullscreen?w.div({className:"fullscreen image-toolbar__item item-w-label",onClick:this._onClickFullscreen},E(p,{group:"web",name:"fullscreen",alt:y("Fullscreen")}),w.span({className:"item-w-label__label"},y("Fullscreen"))):void 0,m.ALLOW_VIEW_ANNOTATE_MODES?w.div({className:e(t),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},E(p,{group:"web",name:"ic_comment_area_large",alt:y("Comment on specific areas")}),w.span({className:"item-w-label__label"},y("Comment"))):void 0)))))}})})}.call(this),define("modules/clean/attributions/actions",["require","exports","tslib","external/underscore","modules/clean/accounts/api","modules/clean/accounts/constants","modules/clean/accounts/dispatcher","modules/clean/attributions/api","modules/clean/attributions/constants","modules/clean/attributions/dispatcher"],function(e,t,n,i,o,r,s,a,l,c){"use strict";function u(e,t){return n.__awaiter(this,void 0,void 0,function(){var u,p,d;return n.__generator(this,function(n){switch(n.label){case 0:return[4,a.fetchAttributionsByFile(e,t)];case 1:return u=n.sent().attributions,c.attributionsDispatcher.dispatch({type:l.AttributionsAction.FetchAttributionsSuccess,data:{file:t,attributions:u}}),p=i.uniq(u.map(function(e){return e.accountId})),[4,o.fetchAccountsByIds(e,p)];case 2:return d=n.sent().accounts,s.accountsDispatcher.dispatch({type:r.AccountsAction.FetchAccountsSuccess,data:{accounts:d}}),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadAttributionsForFile=u}),define("modules/clean/attributions/api",["require","exports","tslib","modules/clean/ajax_util","modules/clean/api_v2/client"],function(e,t,n,i,o){"use strict";function r(e){return{attributions:e.attributions.map(s)}}function s(e){return{revisionId:e.revision,accountId:e.account_id,page:e.page,area:a(e.area)}}function a(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}function l(e,t){return n.__awaiter(this,void 0,void 0,function(){var s,a,l,u;return n.__generator(this,function(n){switch(n.label){case 0:return s=new o.ApiV2Client,a=e.id,l=c(t.revision_id),[4,i.requestWithRetry(function(){return s.rpc(a,"file_attribution/list_attributions",{path:l})})];case 1:return u=n.sent(),[2,r(u)]}})})}function c(e){return"rev:"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAttributionsByFile=l}),define("modules/clean/attributions/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsAction={FetchAttributionsSuccess:"FetchAttributionsSuccess"}}),define("modules/clean/attributions/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributionsDispatcher=n}),define("modules/clean/attributions/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/attributions/constants","modules/clean/attributions/dispatcher"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.attributionsByRevisionId={},n}return n.__extends(t,e),t.prototype.getAttributionsForFile=function(e){return this.attributionsByRevisionId[e.revision_id]||[]},t.prototype.handleFetchAttributionsSuccess=function(e){this.attributionsByRevisionId[e.file.revision_id]=e.attributions,this.__emitChange()},t.prototype.__onDispatch=function(e){e.action.type===o.AttributionsAction.FetchAttributionsSuccess&&this.handleFetchAttributionsSuccess(e.action.data)},t})(i);t.attributionsStore=new s(r.attributionsDispatcher)}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),function(){var e=[].slice;define("modules/clean/comments/action_creators",["external/underscore","external/react","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/annotations/annotation","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/logged_out_utils","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/file_activity/models/file_activity","modules/clean/immutability_helper","modules/clean/react/file_comments/onboarding","modules/clean/react/file_comments/shared_link_signup_modals","modules/clean/react/file_viewer/actions","modules/clean/react/modal","modules/clean/storage","modules/constants/legacy","modules/constants/comments_panel","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/revisions/file_revisions_iterator"],function(t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C,A,S,T,I,O,R){var L,N,x,F,D,k,M,U,W,B,V,H,K,z,q,j,G,Z,Y,Q,X,J,assert,$,ee,te,ne,ie,oe,re,se,ae,le,ce,ue,pe,de,me,he,fe;return k=i.EmailVerification,D=r.CommentsVortexLogger,L=s.Annotation,x=c.CommentsEvents,p.CommentMetadata,N=d.CommentActivity,oe=m.isRevisionOlderThan,ne=m.getFileWithRevision,g.FileActivity,ae=y.merge,F=w.CommentsSharedLinkSignupModals,W=P.Modal,U=C.LocalStorage,assert=T.assert,B=I._,M=R.FileRevisionsIterator,Z=function(e,t){var n;return n=v.getInstance().commitOptimisticUpdate(t),e.then(function(e){return v.getInstance().rebase(n),e}),e.catch(function(e){return v.getInstance().rollbackOptimisticUpdate(n),Promise.reject(e)})},z=function(e){var t,n,i,o,r,s,a,l,c
;return c=e.targetActivityKey,r=e.pendingCommentActivity,n=h.state.activity.activity_key,i=c===n?null:c,l=r.comment,a=l.raw_comment_text,t=l.comment_metadata,s=_.addComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:i,text:a,metadata:null!=t?t.toDict():void 0,oref:h.state.oref}),o=v.getInstance().commitOptimisticUpdate(function(e){return e.appendComment(c,r)}),s.then(function(e){var t;return t=v.getInstance(),t.rollbackOptimisticUpdate(o),t.rebase(function(t){return t.appendComment(c,e)})}),[s,o]},K=function(e,t){return ae(e,{status:"FAILED",activity_key:t})},V=function(e){var t,n,i,o,r,s,l,c,u,p,d,m;return d=e.targetActivityKey,n=e.body,t=e.annotation,i=f.getActivityUser(h.state.actorId),o=h.state.activity,o.activity_key,m=null!=(u=n.text)?u:"",r=a.buildCommentMetadata(n,t),l=N.createLocalInstance({commenter:i,rawCommentText:m,metadata:r,status:"POSTING"}),p=z({targetActivityKey:d,pendingCommentActivity:l}),c=p[0],s=p[1],c.catch(function(e){var t;return t=v.getInstance(),t.rollbackOptimisticUpdate(s),t.commitOptimisticUpdate(function(e,t){var n;return n=K(l,t),e.appendComment(d,n)}),Promise.reject(e)}),[l,c]},Y=function(e,t,n){var i,r,s;return i=f.getActivityUser(h.state.actorId),s=h.state.activity.activity_key,i.is_signed_in?!!i.is_email_verified||(r=k.get_for_user(i),k.set_should_use_simple_ui(!1),r.show_verify_modal(null,o.ADD_COMMENT),!1):(u.saveActionCreator({name:e,fileActivityKey:s,args:t}),x.emit("show-sign-up-modal",{fileActivityKey:s,variant:F.POST_COMMENT_VARIANT}),u.logSignUpModal({fileActivityKey:s,commentActivityKey:n,originType:A.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON}),U.set("tmp-file-comment",null),!1)},le=function(e){var t,n,i,o,r;return r=e.targetActivityKey,n=e.pendingCommentActivity,D.log("retry-post-attempt"),v.getInstance().rollbackOptimisticUpdate(n.activity_key),n=n.setStatus("POSTING"),o=z({targetActivityKey:r,pendingCommentActivity:n}),i=o[0],t=o[1],i.catch(function(e){var i;return i=v.getInstance(),i.rollbackOptimisticUpdate(t),i.commitOptimisticUpdate(function(e){var i;return i=K(n,t),e.appendComment(r,i)}),Promise.reject(e)}),l.addedComment(),i.then(function(){return D.log("retry-post-success")})},Q=function(e){var t,n,i;if(Y("addFileComment",[e]))return D.log("add-comment-attempt"),i=h.state.activity.activity_key,n=V({targetActivityKey:i,body:e}),n[0],t=n[1],l.addedComment(),t.then(function(){return D.log("add-comment-success")})},X=function(e){var t,n,i,o;if(t=h.state.createAnnotation.annotation,null!=t&&Y("addInlineAnnotation",[e]))return D.log("add-annotation-attempt"),o=V({targetActivityKey:h.state.activity.activity_key,body:e,annotation:t}),n=o[0],i=o[1],H(n),l.addedComment(),i.then(function(){return D.log("add-annotation-success")})},J=function(e){var t,n,i,o,r;if(r=e.targetActivityKey,t=e.body,Y("addReply",[{targetActivityKey:r,body:t}]))return D.log("add-reply-attempt"),o=V({targetActivityKey:r,body:t}),n=o[0],i=o[1],H(n),l.addedComment(),i.then(function(){return D.log("add-reply-success")})},H=function(e){return t.defer(function(){return ue({activityKey:e.activity_key,expandConversation:!1})})},$=function(e){var t,n;return t=e.commentActivityKey,D.log("delete-comment-attempt"),assert(null!=h.state.activity.findCommentByKey(t),"Comment activity to delete does not exist: "+t),n=_.deleteComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:t,oref:h.state.oref}),Z(n,function(e){return e.purgeCommentByKey(t)}),n.then(function(){return D.log("delete-comment-success")})},pe=function(e){var t,n,i,o,r;return n=e.commentActivityKey,r=e.resolved,D.log("set-resolved-attempt"),t=h.state.activity.findCommentByKey(n),assert(null!=t,"Comment activity to resolve/unresolve does not exist: "+n),o=_.updateResolveComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:n,resolved:r,oref:h.state.oref}),i=t.comment.resolved?function(e){return e.unresolveCommentByKey(n)}:function(e){return e.resolveCommentByKey(n)},Z(o,i),o.then(function(){return D.log("set-resolved-success")})},me=function(e){var t,n,i;return t=e.enabled,D.log("set-enabled-attempt"),i=_.updateCommentSetting({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,enableComment:t,oref:h.state.oref}),n=h.state.activity.feedback_off?function(e){return e.enableCommenting()}:function(e){return e.disableCommenting()},Z(i,n),t?l.enableCommenting():l.disableCommenting(),i.then(function(){return D.log("set-enabled-success")})},de=function(t){var n,i,r,s,a;return a=t.subscribed,n=f.getActivityUser(h.state.actorId),r=h.state.activity.activity_key,n.is_signed_in?n.is_email_verified?(D.log("set-subscribed-attempt"),s=_.updateFileActivitySubscription({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,targetUserEmail:null,subscribed:a,oref:h.state.oref}),a?s.then(function(){return O.success(B("You have been subscribed."))}).catch(function(e){return O.error(B("We failed to unsubscribe you.")),Promise.reject(e)}):s.then(function(){return O.success(B("You have been unsubscribed."))}).catch(function(e){return O.error(B("We failed to unsubscribe you.")),Promise.reject(e)}),s.then(function(){return D.log("set-subscribe-success")})):(i=k.get_for_user(n),k.set_should_use_simple_ui(!1),void i.show_verify_modal(null,o.SUBSCRIBE_TO_COMMENTS)):(u.saveActionCreator({name:"setCommentSubscribed",fileActivityKey:r,args:e.call(arguments)}),x.emit("show-sign-up-modal",{fileActivityKey:r,variant:F.SUBSCRIBE_VARIANT}),void u.logSignUpModal({fileActivityKey:r,originType:A.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON}))},se=function(e){var n,i,o,r,s,a,l;if(r=h.state.activity,i=r.findConversationByKey(e),n=f.getActivityUser(h.state.actorId),null!=i&&n.is_signed_in&&(s=function(e){return!(e.is_pending||e.is_seen)},o=i.comment_activities.filter(s),s(i)&&o.push(i),o.length>0))return D.log("mark-conversation-seen-attempt"),a=t.pluck(o,"activity_key"),l=_.markCommentSeenBatch({isBackgroundRequest:!0,actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKeys:a}),Z(l,function(e){return r.markCommentSeenByKeyBatch(a)}),l.then(function(){return D.log("mark-conversation-seen-success")})},ue=function(e){var t,n;return t=e.activityKey,n=e.expandConversation,x.emit("reveal-comment-in-pane",{activityKey:t,expandConversation:n})},ce=function(e){var t,n,i,o,r,s,a;if(o=h.state.activity,null!=o&&(i=o.findConversationByKey(e),null!=i&&null!=(r=i.comment.comment_metadata)?r.annotation:void 0))return s=i.comment.comment_metadata,n=s.annotation,a=s.revision,t=L.createAnnotationFromDict(n),null!=a&&l.switchRevision({revision:a,commentActivity:i}),x.emit("reveal-annotation",{page:t.getFirstPdfPage(),commentActivity:i})},q=function(e){var t,n,i;if(i=h.state.activity,t=f.getActivityUser(h.state.actorId),h.state.viewing.file&&i&&e&&oe(i.latest_revision,e.latest_revision)&&(n=ne(h.state.viewing.file,e.latest_revision),b.fastForwardRevision(n)),l.receiveFileActivity(e),t.is_signed_in&&null==i&&null!=e&&u.replayActionCreators({actionCreators:ee,fileActivityKey:e.activity_key}),h.state.isPreviewReady&&null==i)return x.emit("preview-and-comments-ready")},G=function(){var e,t;return e=h.state.actorId,t=n.createElement(E,{onOpen:function(){return l.setShouldShowOnboarding(!1),_.markCommentingOnboardingSeen({actorId:e}).catch(function(){})}}),W.showInstance(t)},fe=function(){var e,t,n,i,o,r;if(e=h.state.actorId,r=h.state.shouldShowOnboarding,o=h.state.viewing,t=o.context,n=o.file,i=f.getPreviewType(t,null!=n?n.preview_type:void 0),null!=e&&null!=i){if(null==r)return _.shouldShowCommentingOnboarding({actorId:e}).then(function(e){if(l.setShouldShowOnboarding(e),e)return G()}).catch(function(){});if(r===!0)return G()}},he=function(){if(D.log("show-comments-attempt"),h.areCommentsHidden())return j(!0),l.showComments(),D.log("show-comments-success")},ie=function(){if(D.log("hide-comments-attempt"),!h.areCommentsHidden())return j(!1),l.hideComments(),D.log("hide-comments-success")},j=function(e){return null!=h.state.actorId?_.setCommentingPaneVisibility({actorId:h.state.actorId,shouldShow:e}):_.setSessionCommentingPaneVisibility({shouldShow:e})},re=function(){return _.setShowCommentsTutorial({actorId:h.state.actorId,shouldShow:!1})},te=function(e){var t,n;return t=new M(e,h.state.actorId),n=t.next(),n.then(function(e){return l.receiveRevisions(e.revisions)})},x.on("file-activity-updated",q),ee=t.extend({},l,{addReply:J,addFileComment:Q,addInlineAnnotation:X,retryPostingComment:le,deleteComment:$,setCommentResolved:pe,setCommentSubscribed:de,setCommentsEnabled:me,markConversationSeen:se,showOnboardingIfNecessary:fe,revealCommentInPane:ue,revealAnnotationInPreview:ce,markCommentsTutorialAsDone:re,showComments:he,hideComments:ie,fetchRevisions:te})})}.call(this),define("modules/clean/comments/action_creators_helpers",["require","exports","modules/clean/comments/models/comment","modules/clean/comments/store"],function(e,t,n,i){"use strict";function o(e,t){if(e.stickerId||t){var o=t?i.state.activity.latest_revision:null,r=t?t.toMetadataDict():null;return new n.CommentMetadata({revision:o,annotation:r,sticker_id:e.stickerId})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.buildCommentMetadata=o}),function(){define("modules/clean/comments/actions",["external/underscore","external/reflux"],function(e,t){return t.createActions(e.object(e.map(["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"],function(e){return[e,{sync:!0}]})))})}.call(this),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/constants",["require","exports","modules/constants/legacy"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileActivityLogEventType=n.FILE_ACTIVITY_LOG_EVENT_TYPE,t.FileActivityLogClientOriginType=n.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE;(function(e){e[e.MARKER=0]="MARKER",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.REGION=2]="REGION"})(t.AnnotationTypes||(t.AnnotationTypes={})),t.AnnotationSubtypes={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}}}),define("modules/clean/comments/demo_action_creators",["require","exports","external/immutable","external/underscore","modules/clean/activity/activity_user","modules/clean/comments/action_creators","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/contacts/demo_contacts_min","modules/clean/immutability_helper","modules/core/notify","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";function _(e){var t=g(e);a.receiveFileActivity(t)}function v(e){for(var t,n=/@\[(dbid:demo\-data\-[0-9]+):.+?\]/g,i=[];null!=(t=n.exec(e));)i.push(t[1]);return i}function g(e){if(0===Object.keys(F).length)for(var t=0,i=d.demoContacts;t<i.length;t++){var r=i[t];F[r.dbx_account_id]=o.ActivityUser.fromDict({id:parseInt(r.dbx_account_id.split("-").slice(-1)[0],10),fname:r.fname,lname:r.lname,display_name:r.name,email:r.email})}for(var s=n.Set(),a=0,l=e.comment_activities;a<l.length;a++){var c=l[a],u=c.comment.raw_comment_text;s=s.union(v(u))}var h=[];return s.forEach(function(e){return h.push(F[String(e)])}),h.push(p.getActivityUser(-1)),m.set(e,"users_to_notify",h)}function y(e,t,n){var o=t.text,r=u.state.activity,d=s.buildCommentMetadata(t,n),m=new l.Comment({comment_gid:i.uniqueId("demo-data-"),commenter:p.getActivityUser(-1),comment_text:o,raw_comment_text:o,when_mses:1e3*Date.now(),resolved:!1,comment_metadata:d}),h=new c.CommentActivityPermissions({user_ids_who_can_delete:[-1]}),f=new c.CommentActivity({activity_key:i.uniqueId("demo-data-"),comment_activities:[],users_to_notify:[],is_seen:!0,highlight_as_unread:!1,comment:m,permissions:h,status:"POSTED"}),v=r.appendComment(e,f);return a.addedComment(),_(v),f}function E(e){y(u.state.activity.activity_key,e,null)}function w(e){i.defer(function(){R(e.activity_key,!1)})}function b(e){w(y(e.targetActivityKey,e.body,null))}function P(e){var t=u.state.createAnnotation.annotation;if(t){w(y(u.state.activity.activity_key,e,t))}}function C(e){}function A(e){_(u.state.activity.purgeCommentByKey(e.commentActivityKey))}function S(e){var t,n=u.state.activity,i=e.commentActivityKey,o=e.resolved;t=o?n.resolveCommentByKey(i):n.unresolveCommentByKey(i),_(t)}function T(e){var t=u.state.activity,n=t.users_to_notify,i=[],o=p.getActivityUser(-1);if(e.subscribed)i=m.push(n,o),h.success(f._("You have been subscribed."));else{for(var s=0,a=0,l=n;a<l.length;a++){s=l[a].id!==o.id?s++:s}i=m.splice(n,s,1),h.success(f._("You have been unsubscribed."))}var c=m.set(t,"users_to_notify",i);r.receiveFileActivity(c)}function I(e){}function O(){}function R(e,t){r.revealCommentInPane({activityKey:e,expandConversation:t})}function L(e){r.revealAnnotationInPreview(e)}function N(){}function x(){}var F={};return i.extend({},a,{addFileComment:E,addReply:b,addInlineAnnotation:P,retryPostingComment:C,deleteComment:A,setCommentResolved:S,setCommentSubscribed:T,markConversationSeen:I,showOnboardingIfNecessary:O,revealCommentInPane:R,revealAnnotationInPreview:L,markCommentsTutorialAsDone:N,fetchRevisions:x})}),define("modules/clean/comments/demo_file_activity",["require","exports","external/underscore","modules/core/i18n"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Date.now(),r={dbx_account_id:"dbid:demo_user",initials_url:"",id:-1,photo_url:null,display_name:"Demo User",lname:"User",role:"personal",photo_circle_url:null,fname:"Demo",email:"",unique_id:"dbid:demo_user"};t.demoFileActivity={activity_key:n.uniqueId("demo-data-"),feedback_off:!1,can_edit_feedback:!0,users_to_notify:[r],latest_revision:{direct_blockserver_link:"//dl-web.dropbox.com/get/sample%27%60~%24%25%26%E5%8F%89%E7%87%92.docx?_subject_uid=1&cached=False&generate_preview=True&sjid=3&w=AABUizp6_6TII8-KN2rtsYW-2K5nhkGsEru5G06jfc5sgA&get_preview=True&revision_id=AADPqDXmAC_HT_jbF5QOIC2JkAnqkcMedYLMvB8IL_DAa4Om1dCo2-GyFIkc9ampdt5eNvg8yJG84ocUW1MiUMFScACtdFgtxIqWx9NXrrxsxg",rev_owner:null,preview_link:null,when:o,revision_id:"demo_revision_id"},comment_activity_dicts:[{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:i._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),raw_comment_text:i._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:i._("Keep discussions and feedback all in one place, right next to the file you’re working on."),raw_comment_text:i._("Keep discussions and feedback all in one place, right next to the file you’re working on."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:i._("You can comment on the entire file by typing in the box at the top of the comment pane."),raw_comment_text:i._("You can comment on the entire file by typing in the box at the top of the comment pane."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:i._("You can also add comments to anywhere on the file, like this one."),raw_comment_text:i._("You can also add comments to anywhere on the file, like this one."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:{annotation:{type:2,subtype:0,thumbnail_url:"",pdf_coordinates:[{coordinates:[{x:279.1885714285714,y:755.8628571428573},{x:279.1885714285714,y:720.8914285714286},{x:314.16,y:720.8914285714286},{x:314.16,y:755.8628571428573}],page:1,page_size:{height:792,width:612}}]},revision:{revision_id:"demo_revision_id",when:o}}},permissions:{user_ids_who_can_delete:[-1]}}]}}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,i){this.__commentsEvents.push([e,n,i]),t.CommentsEvents.on(e,n,i)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],i=e[1],o=e[2];t.CommentsEvents.off(n,i,o)}),this.__commentsEvents=null}}}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,i,o){o.value=n.takes.apply(void 0,e.concat([o.value]))}}function o(e){return function(t,i,o){o.value=n.returns(e,o.value)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takes=i,t.returns=o}),function(){define("modules/clean/comments/logged_out_utils",["modules/clean/react/file_comments/logger","modules/clean/storage","modules/constants/legacy"],function(e,t,n){var i,o,r,s,a,l,c,u;return a=t.SessionStorage,i=n.FILE_ACTIVITY_LOG_EVENT_TYPE,o="commenting_actions",s="v1",r=o+":"+s,l=function(t){var n,o,r,s;return o=t.fileActivityKey,n=null!=(s=t.commentActivityKey)?s:null,r=t.originType,e.log_event(i.CLIENT_SIGN_UP_MODAL,o,n,r)},u=function(e){var t,n,i,o,s,l,c;s=e.name,o=e.fileActivityKey,n=e.args;try{return c=r+":"+o,t=null!=(l=a.get(c))?l:[],t.push({name:s,args:n}),a.set(c,t)}catch(e){i=e,console.error(i)}},c=function(e){var t,n,i,o,s,l;t=e.actionCreators,o=e.fileActivityKey;try{return l=r+":"+o,n=null!=(s=a.get(l))?s:[],a.set(l,null),n.forEach(function(e){var n,i;return i=e.name,n=e.args,t[i].apply(t,n)})}catch(e){i=e,console.error(i)}},{logSignUpModal:l,saveActionCreator:u,replayActionCreators:c}})}.call(this),define("modules/clean/comments/logging",["require","exports","modules/clean/comments/store","modules/clean/react/file_comments/logger"],function(e,t,n,i){"use strict";function o(e,t){var o=n.state,r=o.actorId,s=o.activity,a=o.viewing.context;try{i.log_event(e,s.activity_key,null,t,r,a)}catch(e){console.warn("logEvent failed",e)}}function r(e,t){var o=n.state,r=o.actorId,s=o.activity,a=o.viewing.context,l=s.findCommentByKey(t);try{i.log_annotation_event(e,s.activity_key,t,r,a,l.comment.comment_metadata.annotation)}catch(e){console.warn("logAnnotationEvent failed",e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.logEvent=o,t.logAnnotationEvent=r}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/underscore","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,i,o,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,i=void 0===n?null:n,r=t.annotation,s=void 0===r?null:r,a=t.sticker_id,l=void 0===a?null:a,c=t.thumbnail_url,u=void 0===c?null:c;this.revision=i,this.annotation=s,this.sticker_id=l,this.thumbnail_url=u,o(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return i.pick({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},n.__decorate([a.takes({revision:r.Any,annotation:r.Any,stickers:r.Maybe({id:Number}),thumbnail_url:r.Maybe(String)})],e,"fromDict",null),e})();t.CommentMetadata=c;var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,i=void 0===n?"":n,r=t.commenter,s=void 0===r?l.ActivityUser.anonymous:r,a=t.comment_text,c=void 0===a?"":a,u=t.raw_comment_text,p=void 0===u?"":u,d=t.when_mses,m=void 0===d?0:d,h=t.resolved,f=void 0!==h&&h,_=t.comment_metadata,v=void 0===_?null:_;this.comment_gid=i,this.commenter=s,this.comment_text=c,this.raw_comment_text=p,this.when_mses=m,this.resolved=f,this.comment_metadata=v,o(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:l.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?c.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return s.set(this,"resolved",!0)},e.prototype.unresolve=function(){return s.set(this,"resolved",!1)},n.__decorate([a.takes({comment_gid:String,commenter_dict:r.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:r.Maybe(Object)})],e,"fromDict",null),e})();t.Comment=u}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n,i(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!o.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},n.__decorate([l.takes({user_ids_who_can_delete:Array})],e,"fromDict",null),e})();t.CommentActivityPermissions=u;var p=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,r=t.comment_activities,s=void 0===r?[]:r,a=t.users_to_notify,l=void 0===a?[]:a,p=t.is_seen,d=void 0!==p&&p,m=t.highlight_as_unread,h=void 0!==m&&m,f=t.comment,_=void 0===f?new c.Comment:f,v=t.permissions,g=void 0===v?new u:v,y=t.status,E=void 0===y?"POSTED":y;this.activity_key=o,this.comment_activities=s,this.users_to_notify=l,this.is_seen=d,this.highlight_as_unread=h,this.comment=_,this.permissions=g,this.status=E,i(this)}return e.createLocalInstance=function(t){var n=t.activityKey,i=void 0===n?o.uniqueId("local-comment-activity-"):n,r=t.commenter,s=t.rawCommentText,a=t.metadata,l=void 0===a?null:a,u=t.status,p=void 0===u?"POSTING":u;return new e({activity_key:i,comment:new c.Comment({comment_gid:o.uniqueId("pending-comment-gid-"),commenter:r,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:l}),is_seen:!0,highlight_as_unread:!1,status:p})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:c.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return s.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return s.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return s.set(this,"status",e)},e.prototype.markSeen=function(){return s.merge(this,{is_seen:!0,highlight_as_unread:!1})},n.__decorate([l.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],e,"fromDict",null),e})();t.CommentActivity=p}),function(){define("modules/clean/comments/models/loading_spinner",[],function(){return function(e,t){return(null==t||t.comment_activities.length>0)&&e}})}.call(this),function(){define("modules/clean/comments/models/preview_types",[],function(){return{PDF:0,IMAGE:1}})}.call(this),function(){define("modules/clean/comments/revisions",["external/underscore"],function(e){var t,n,i,o,r;return n=function(t,n){var i;return i=e.pick(n,"direct_blockserver_link","preview_ssr_image_url_tmpl","preview_ssr_text_url_tmpl","preview_ssr_refresh_url"),i.preview_url=n.preview_link,null!=t.set?t.merge(i):e.extend({},t,i)},t=function(e,t){return t.when-e.when},r=function(e,n){return t(e,n)>0},o=function(e,n){return t(e,n)<0},i=function(e,n){return 0===t(e,n)},{getFileWithRevision:n,compareRevision:t,isRevisionOlderThan:r,isRevisionNewerThan:o,isRevisionEqual:i}})}.call(this),function(){define("modules/clean/comments/store",["external/underscore","external/reflux","modules/constants/comments_panel","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/clean/annotations/annotation","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/demo_file_activity","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/comments/components/ui_constants","modules/clean/file_activity/models/file_activity","modules/clean/react/file_viewer/actions","modules/clean/react/file_comments/logger"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_){var v,g,y,E,w,b,P,C,A,assert,S;return assert=o.assert,r._,s.Annotation,a.AnnotationTypes,S=c.demoFileActivity,v=u.CommentsEvents,w=m.TUTORIAL_INITIATOR,C=m.TUTORIAL_REPLY,A=m.TUTORIAL_REPLY_SUCCESS,b=m.TUTORIAL_MENTION,P=m.TUTORIAL_MENTION_SUCCESS,y=m.TUTORIAL_CREATE_ANNOTATION,E=m.TUTORIAL_CREATE_ANNOTATION_SUCCESS,g=h.FileActivity,t.createStore({listenables:l,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:n.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:w,showCommentsPref:n.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(t){return e.extend(this.state,t),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){var t,n,i,o,r;if(null!=(i=this.state.activity)?i.users_to_notify:void 0)for(o=this.state.activity.users_to_notify,t=0,n=o.length;t<n;t++)if(r=o[t],r.id===e)return!0;return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:null==this.state.viewing.file||!this.state.viewing.file.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){var e;return null!=(e=this.state.activity)?e.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){var e;return!!(null!=(e=this.state.activity)?e.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){var e,t;return null==this.state.activity?null:(e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)},this.state.activity.comment_activities.reduce(t,0))},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n,i,o,r,s,a,l;return t=e.actorId,n=e.context,i=e.contextData,r=e.oref,o=e.file,e.previewSelector,s=e.showCommentsOverride,l=e.showTutorialOverride,a=null===this.state.contextData||p(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:t,viewing:{context:n,contextData:i,file:o,revision:null,showCommentsOverride:s,showTutorialOverride:l},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:a,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return v.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{conversationHover:t}),this.setState({viewAnnotation:n})},
onUpdateAnnotationUiHover:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{annotationHover:t}),this.setState({viewAnnotation:n})},onShowAnnotationConversation:function(e){var t,n;return n=e.annotation,t=e.activityKey,assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),assert(null!=n,"Invalid annotation to show"),assert(null!=this.state.activity.findConversationByKey(t),"Invalid inline comment to show: "+t),this.setState({viewAnnotation:{annotation:n,activityKey:t,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{replyFocused:t}),this.setState({viewAnnotation:n})},onStartAnnotationCreation:function(e){var t;return t=e.annotation,this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(t){var n,i,o,r;return n=t.activityKey,r=t.text,n in this.state.annotationReplyTextByKey&&!r?(i=e.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:i})):(i=e.extend({},this.state.annotationReplyTextByKey,(o={},o[""+n]=r,o)),this.setState({annotationReplyTextByKey:i}))},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(t){var n,o,r,s,a;if(a=t.revision,n=t.commentActivity,assert(null!=a,"Revision to switch to must not be null!"),assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!d.isRevisionEqual(a,this.state.viewing.revision))return d.isRevisionEqual(a,this.state.activity.latest_revision)?(o=i.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,f.restoreRevision()):(o=i.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION,r=d.getFileWithRevision(this.state.viewing.file,a),f.switchRevision(r)),this.setState({viewing:e.extend({},this.state.viewing,{revision:a}),isPreviewReady:!1}),v.emit("revision-did-change"),_.log_annotation_event(o,this.state.activity.activity_key,null!=n?n.activity_key:void 0,this.state.actorId,this.state.viewing.context,null!=n&&null!=(s=n.comment.comment_metadata)?s.annotation:void 0)},onShowComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){var e;return null!=this.state.createAnnotation?(this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null)):null!=this.state.viewAnnotation?(e=this.state.viewAnnotation.activityKey,this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})):void 0},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(t){return n.SHOW_COMMENTS_TUTORIAL=t,this.setState({showTutorial:t,viewing:e.extend(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===y&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:E}):this.state.currentTutorialStep===C&&this.state.expandedComment?this.setState({currentTutorialStep:A}):this.state.currentTutorialStep===b&&this.state.mentionedContact?this.setState({currentTutorialStep:P}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})},demoLoadData:function(){return this.onReceiveFileActivity(g.fromDict(S))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/utils",["modules/clean/annotations/annotation","modules/clean/activity/constants","modules/clean/activity/activity_user","modules/clean/comments/models/preview_types","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/react/file_viewer/store","modules/clean/viewer","modules/constants/comments_panel","modules/core/exception","modules/core/i18n"],function(t,n,i,o,r,s,a,l,c,u,p){var d,m,h,f,_,v,g,y,E,w,b,P;return t.Annotation,d=n.ActivityContext,m=i.ActivityUser,w=r.isRevisionEqual,h=a.FileViewerStore,p._,g=function(e){var t;return e===-1?new m({id:-1,fname:"Demo",lname:"User",display_name:"Demo User",email:"demo_user@example.com",initials:"DU",is_email_verified:!0,is_signed_in:!0}):(t=l.get_viewer(),null!=e?m.fromUser(t.get_user_by_id(e)):t.work_user||t.personal_user?m.fromUser(t.work_user||t.personal_user):t.is_signed_in?void 0:new m)},y=function(t,n){var i;if(i=[d.BROWSE_FILE_VIEWER,d.SHARED_LINK_VIEW,d.SHARED_CONTENT_LINK_VIEW],e.call(i,t)>=0&&null!=n){if("photo"===n)return o.IMAGE;if("doc"===n||"adobecs"===n)return o.PDF}return null},_=function(e){return g(e.actorId).is_signed_in},f=function(){var e;return!!s.isFileActivityReady()&&(e=s.isCommentingEnabled(),c.ALLOW_VIEW_ANNOTATE_MODES||(e=e&&!s.areCommentsHidden()),e)},v=function(e){var t;return!!s.isFileActivityReady()&&(t=_(s.state),null==e&&(e=h.instance.getIsFullscreen()),t&&f()&&!e&&w(s.state.viewing.revision,s.state.activity.latest_revision))},E=function(){return!!v()&&(c.ALLOW_VIEW_ANNOTATE_MODES?s.state.regionCreationEnabled:!s.areCommentsHidden())},P=function(){return!s.areCommentsHidden()&&f()},b=function(){return this.keyCode||this.which||this.charCode},{normalizedKeyCode:b,canAnnotate:v,getActivityUser:g,getPreviewType:y,isRegionCreationEnabled:E,shouldShowExistingAnnotations:P}})}.call(this),define("modules/clean/contacts/demo_contacts_min",["require","exports","external/underscore","modules/clean/contacts/types","modules/clean/static_urls"],function(e,t,n,i,o){"use strict";function r(e,t){return{dbx_account_id:n.uniqueId("dbid:demo-data-"),fname:e,lname:t,name:e+" "+t,name_tokens:[e,t],email:e.toLowerCase()+"."+t.toLowerCase()+"@example.com",type:i.EMAIL,priority:1,photo_url:s[""+e+t]}}Object.defineProperty(t,"__esModule",{value:!0});var s={AngelaZhang:o.static_url("/static/images/commenting/demoavatars/Angela-Zhang-vfldVUJsW.jpg"),AnnThompson:o.static_url("/static/images/commenting/demoavatars/Ann-Thompson-vflDjeXVl.jpg"),AnthonyAbate:o.static_url("/static/images/commenting/demoavatars/Anthony-Abate-vflb_Crc1.jpg"),AnthonyDavis:o.static_url("/static/images/commenting/demoavatars/Anthony-Davis-vflb_Crc1.jpg"),DanielSmith:o.static_url("/static/images/commenting/demoavatars/Daniel-Smith-vfl0ZULp0.jpg"),DavidZheng:o.static_url("/static/images/commenting/demoavatars/David-Zheng-vflAyZL7F.jpg"),JaySingh:o.static_url("/static/images/commenting/demoavatars/Jay-Singh-vflW3UZd2.jpg"),JonathanCosta:o.static_url("/static/images/commenting/demoavatars/Jonathan-Costa-vfllqTPyT.jpg"),JoshuaMiller:o.static_url("/static/images/commenting/demoavatars/Joshua-Miller-vflEp0Mg9.jpg"),JustinAnderson:o.static_url("/static/images/commenting/demoavatars/Justin-Anderson-vfl9uxp54.jpg"),KimberlyWilliams:o.static_url("/static/images/commenting/demoavatars/Kimberly-Williams-vfl8qwtRR.jpg"),MichelleWallace:o.static_url("/static/images/commenting/demoavatars/Michelle-Wallace-vflzfTdeL.jpg"),PatriciaJohnson:o.static_url("/static/images/commenting/demoavatars/Patricia-Johnson-vfllowBwb.jpg"),RobertAnderson:o.static_url("/static/images/commenting/demoavatars/Robert-Anderson-vfl9uxp54.jpg"),RobertHaobyan:o.static_url("/static/images/commenting/demoavatars/Robert-Haobyan-vflKVjOwM.jpg"),WendyJones:o.static_url("/static/images/commenting/demoavatars/Wendy-Jones-vflnVCeNz.jpg"),WilliamJackson:o.static_url("/static/images/commenting/demoavatars/William-Jackson-vflNt93cU.jpg")};t.demoContacts=[r("Angela","Zhang"),r("Ann","Thompson"),r("Anthony","Abate"),r("Anthony","Davis"),r("Daniel","Smith"),r("David","Zheng"),r("Jay","Singh"),r("Jonathan","Costa"),r("Joshua","Miller"),r("Justin","Anderson"),r("Kimberly","Williams"),r("Michelle","Wallace"),r("Patricia","Johnson"),r("Robert","Anderson"),r("Robert","Haobyan"),r("Wendy","Jones"),r("William","Jackson")]}),define("modules/clean/contacts/types",["require","exports"],function(e,t){"use strict";var n;return(function(e){e[e.EMAIL=0]="EMAIL",e[e.FB=1]="FB",e[e.INVALID_ID=2]="INVALID_ID",e[e.NEW_STYLE_GROUP=4]="NEW_STYLE_GROUP",e[e.DBX_ID=5]="DBX_ID"})(n||(n={})),n}),function(){define("modules/clean/crypto",["external/sjcl"],function(e){var t;return t={},t.getRandomValues=function(t){var n,i,o,r;for(r=e.random.randomWords(t.length),n=i=0,o=t.length;0<=o?i<o:i>o;n=0<=o?++i:--i)t[n]=r[n];return t},t})}.call(this),function(){define("modules/clean/file_activity/api",["external/underscore","modules/core/types","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity"],function(e,t,n,i,o){var r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C,A,S,T,I,O,R,L,N,x,F,D,k,M,U,W,B,V;return U=t.takes,N=t.returns,m=t.Maybe,t.Either,s=i.CommentActivity,p=o.FileActivity,g={actorId:m(Number),oref:m(String),isBackgroundRequest:m(Boolean)},P=function(t){var i,o,r,s,a,l,c,u;return u=t.url,c=t.type,o=t.data,i=t.actorId,s=t.oref,r=t.isBackgroundRequest,l=r?n.SilentBackgroundRequestOref:n.WebRequestOref,a=new Promise(function(t,n){return l({url:u,type:c,data:e.extend({oref:s},o),subject_user:i,success:t,error:function(e,t,i){return n(Error(i))}})}),a.then(JSON.parse)},E=function(e){var t,n,i;if("error"===e.status)throw n=null!=(i=e.payload)?i.error_text:void 0,t=Error(n),t.payload=e.payload,t.error_text=n,t;return e.payload},w=function(e){var t,n;return n=E(e),t=e.bolt_data,[n,t]},y=function(e){return p.fromDict(e)},r=e.extend({commentActivityKey:m(String),context:Number,contextData:String,text:String,metadata:m(Object)},g),C=U(r,N(Promise,function(e){var t,n,i,o,r,a,l,c;return t=e.actorId,n=e.commentActivityKey,i=e.context,o=e.contextData,c=e.text,a=e.metadata,l=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:i,activity_context_data:o,comment_text:c,comment_metadata_json:JSON.stringify(a),target_comment_activity_key:n},oref:l,isBackgroundRequest:r}).then(E).then(s.fromDict)})),a=e.extend({commentActivityKey:String,context:Number,contextData:String},g),A=U(a,N(Promise,function(e){var t,n,i,o,r,s;return t=e.actorId,n=e.commentActivityKey,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:n,activity_context:i,activity_context_data:o},oref:s,isBackgroundRequest:r}).then(E)})),f=e.extend({enableComment:Boolean,context:Number,contextData:String},g),W=U(f,N(Promise,function(e){var t,n,i,o,r,s;return t=e.actorId,o=e.enableComment,n=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:n,activity_context_data:i,feedback_off:!o},oref:s,isBackgroundRequest:r}).then(E)})),_=e.extend({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},g),V=U(_,N(Promise,function(e){var t,n,i,o,r,s,a;return t=e.actorId,a=e.resolved,n=e.commentActivityKey,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:n,activity_context:i,activity_context_data:o,resolved:a},oref:s,isBackgroundRequest:r}).then(E)})),d=e.extend({commentActivityKeys:Array,context:Number,contextData:String},g),R=U(d,N(Promise,function(e){var t,n,i,o,r,s;return t=e.actorId,n=e.commentActivityKeys,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:i,activity_context_data:o},oref:s,isBackgroundRequest:r}).then(E)})),u=e.extend({context:Number,contextData:String},g),b=function(e){var t,n,i,o,r;return t=e.actorId,n=e.context,i=e.contextData,r=e.oref,o=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/file_activity",type:"GET",data:{activity_context:n,activity_context_data:i},oref:r,isBackgroundRequest:o})},I=U(u,N(Promise,function(e){return b(e).then(E).then(y)})),O=U(u,N(Promise,function(e){return b(e).then(w).then(function(e){var t,n;return t=e[0],n=e[1],[y(t),n]})})),c=e.extend({context:Number,contextDataList:Array},g),T=U(c,N(Promise,function(t){var n,i,o,r,s;return n=t.actorId,i=t.context,o=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:i,activity_context_data_batch:JSON.stringify(o)},oref:s,isBackgroundRequest:r}).then(function(t){return e.mapObject(t,y)})})),v=e.extend({targetUserEmail:m(String),subscribed:Boolean,context:Number,contextData:String},g),B=U(v,N(Promise,function(e){var t,n,i,o,r,s,a;return t=e.actorId,a=e.targetUserEmail,s=e.subscribed,n=e.context,i=e.contextData,r=e.oref,o=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:n,activity_context_data:i,subscribed:s,target_user_identifier:a},oref:r,isBackgroundRequest:o}).then(E)})),l=e.extend({context:Number,contextDataList:Array},g),S=U(l,N(Promise,function(t){var n,i,o,r,s;return n=t.actorId,i=t.context,o=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:i,activity_context_data_batch:JSON.stringify(o)},oref:s,isBackgroundRequest:r}).then(E).then(function(t){return e.mapObject(t,function(e){var t,n,i;return n=e.feedback_off,t=e.comment_count,i=e.unresolved_comment_count,{feedback_off:n,comment_count:t,unresolved_comment_count:i}})})})),h=e.extend({feedbackText:String,context:Number,contextData:String},g),M=U(h,N(Promise,function(e){var t,n,i,o,r,s;return t=e.actorId,o=e.feedbackText,n=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:n,activity_context_data:i,feedback_text:o},oref:s,isBackgroundRequest:r}).then(E)})),L=U({actorId:Number},N(Promise,function(e){var t,i;return t=e.actorId,i=new Promise(function(e,i){return n.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:i,subject_user:t})}),i.then(JSON.parse).then(E)})),k=U({actorId:Number},N(Promise,function(e){var t,i;return t=e.actorId,i=new Promise(function(e,i){return n.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:i,subject_user:t})}),i.then(JSON.parse).then(E)})),x=U({actorId:Number,shouldShow:Boolean},N(Promise,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:n}}).then(E)})),F=U({shouldShow:Boolean},N(Promise,function(e){var t;return t=e.shouldShow,P({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:t}}).then(E)})),D=U({actorId:Number,shouldShow:Boolean},N(Promise,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:n}}).then(E)})),{markCommentingOnboardingSeen:L,shouldShowCommentingOnboarding:k,setCommentingPaneVisibility:x,setSessionCommentingPaneVisibility:F,setShowCommentsTutorial:D,addComment:C,deleteComment:A,updateResolveComment:V,updateCommentSetting:W,markCommentSeenBatch:R,fetchCommentStatusBatch:S,fetchFileActivity:I,fetchFileActivityWithBoltData:O,fetchFileActivities:T,updateFileActivitySubscription:B,submitProductFeedback:M}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/file_activity/clients/file_activity_bolt_client",["external/underscore","modules/core/exception","modules/core/types","modules/clean/analytics","modules/clean/bolt","external/eventemitter3","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage"],function(n,i,o,r,s,a,l,c,u){var p,d,m,h,f,_,v;return v=o.takes,d=o.Maybe,p=r.CommentsVortexLogger,m=c.Optimist,h=u.SessionStorage,f=function(e,t){return new s.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},_=function(e){var t,n;return t=e.revision,n=e.token,{revision:t,token:n}},(function(n){function o(){return this._onBoltRefresh=e(this._onBoltRefresh,this),this._onBoltUpdate=e(this._onBoltUpdate,this),r.apply(this,arguments)}var r;return t(o,n),r=v({actorId:d(Number),context:Number,contextData:String,oref:d(String)},function(e){var t,n,i,o;return t=e.actorId,n=e.context,i=e.contextData,o=e.oref,this.__requestOptions={actorId:t,context:n,contextData:i,oref:o,isBackgroundRequest:!0},this.__optimist=new m(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0}),o.prototype.getFileActivity=function(){return this.__optimist.getValue()},o.prototype.isReady=function(){return this.__isReady},o.prototype.isLive=function(){return this.__isLive},o.prototype.rebase=function(e){var t;return i.assert(this.__isReady,"Cannot rebase when server data is not ready"),t=this.getFileActivity(),this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},o.prototype.commitOptimisticUpdate=function(e){var t,n;return i.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready"),n=this.getFileActivity(),t=this.__optimist.commit(e),this.emit("updated",this.getFileActivity(),n),t},o.prototype.rollbackOptimisticUpdate=function(e){var t;if(i.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready"),t=this.getFileActivity(),this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},o.prototype.init=function(){i.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then((function(e){return function(){if(p.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}})(this)).catch((function(e){return function(){return e.__canInit=!0}})(this))},o.prototype.startLiveUpdate=function(){return i.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},o.prototype.stopLiveUpdate=function(){var e;return this.__isLive=!1,null!=(e=this.__boltClient)?e.unsubscribe():void 0},o.prototype._doStartLiveUpdate=function(){var e;return e=f(this.getFileActivity(),this.__boltData),this.__boltClient=new s.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},o.prototype._pullFromServer=function(){var e;return h.set("reload-timestamp",(new Date).getTime()),e=l.fetchFileActivityWithBoltData(this.__requestOptions),e.then((function(e){return function(t){var n,i,o;return i=t[0],n=t[1],e.__boltData=n,o=e.__optimist.getValue(),e.__optimist.rebase(function(){return i}),i=e.__optimist.getValue(),e.__isReady?e.emit("updated",i,o):(e.__isReady=!0,e.emit("ready",i))}})(this)),e.catch((function(e){return function(t){return e.emit("error",t)}})(this)),e},o.prototype._onBoltUpdate=function(e){var t;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key)return t=e[0],this.__boltData=_(t),this._pullFromServer().then((function(e){return function(){if(e.__isLive)return t=f(e.getFileActivity(),e.__boltData),e.__boltClient.update_states([t])}})(this))},o.prototype._onBoltRefresh=function(e){return this._pullFromServer().then((function(e){return function(){if(e.__isLive)return e.stopLiveUpdate(),e.startLiveUpdate()}})(this))},o})(a)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/file_activity/clients/file_activity_data_source",["external/underscore","external/lru","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(t,n,i,o,r,s){var a,assert,l;return a=i.CommentsEvents,assert=s.assert,l=function(e,t,n,i){return null==i&&(i=""),e=null!=e?e:"",e+":"+t+":"+n+":"+i},(function(){function i(t){this._cache=t._cache,this._unsubscribeStore=t._unsubscribeStore,this._sendFileActivity=t._sendFileActivity,this._state=t._state,this.onClientUpdated=e(this.onClientUpdated,this),this.onStoreUpdate=e(this.onStoreUpdate,this)}return i.initInstance=function(){var e;if(e=i,null==e.__instance)return e.__instance=e.create(o,function(e){return a.emit("file-activity-updated",e)})},i.getInstance=function(){var e;return e=i,assert(null!=e.__instance),e.__instance},i.create=function(e,t,o){var r,s;return null==o&&(o=10),r=new n(o),r.shift=function(){var e,t;return t=n.prototype.shift.call(this),e=t.value,null!=e&&e.removeAllListeners(),null!=e&&e.stopLiveUpdate(),t},s=new i({_cache:r,_state:{},_sendFileActivity:t}),s._unsubscribeStore=e.listen(s.onStoreUpdate),s.onStoreUpdate(e.state),s},i.prototype.dispose=function(){return this._unsubscribeStore()},i.prototype.resetCache=function(){return this._cache.removeAll()},i.prototype.replaceState=function(e){var t;if(this.shouldUpdate(e))return this.willUpdate(e),t=this._state,this._state=e,this.didUpdate(t)},i.prototype.getState=function(){return this._state},i.prototype.onStoreUpdate=function(e){var t,n,i,o,r,s;return t=e.actorId,r=e.oref,s=e.viewing,n=s.context,i=s.contextData,o={oref:r,actorId:t,context:n,contextData:i},this.replaceState(o)},i.prototype.shouldUpdate=function(e){return!t.isEqual(this._state,e)},i.prototype.willUpdate=function(e){var t;if(t=this.getCurrentClient(),null!=t)return this.deactivateClient(t)},i.prototype.didUpdate=function(e){var t;if(t=this.getCurrentFetchKey(),!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},i.prototype.getFetchKey=function(e){var t,n,i,o;return t=e.actorId,n=e.context,i=e.contextData,o=e.oref,l(t,n,i,o)},i.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},i.prototype.getCurrentClient=function(){var e;return e=this.getCurrentFetchKey(),this._cache.get(e)},i.prototype.isFetching=function(e){var t;return t=this._cache.find(this.getFetchKey(e)),null!=t&&!t.isReady()},i.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},i.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},i.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},i.prototype.deactivateCurrentClient=function(){var e;if(e=this.getCurrentClient(),null!=e)return this.deactivateClient(e)},i.prototype.fetchAndSend=function(e){var t,n,i,o,r,s,a;return t=e.actorId,o=e.context,r=e.contextData,a=e.oref,s=l(t,o,r,a),n=this._cache.get(s),null!=n?this.activateClient(n):(i=this.createFileActivityBoltClient({actorId:t,context:o,contextData:r,oref:a}),i.init(),this._cache.set(s,i),this.activateClient(i))},i.prototype.onClientUpdated=function(e){return this.sendActivity(e)},i.prototype.onClientError=function(e){throw e},i.prototype.sendActivity=function(e){return this._sendFileActivity(e)},i.prototype.createFileActivityBoltClient=function(e){return new r(e)},i.prototype.rebase=function(e){var t;return t=this.getCurrentClient(),null!=t&&t.rebase(e)},i.prototype.commitOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.commitOptimisticUpdate(e):null},i.prototype.rollbackOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t&&t.rollbackOptimisticUpdate(e)},i})()})}.call(this),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,i,o,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,r=t.feedback_off,s=void 0!==r&&r,a=t.can_edit_feedback,l=void 0===a||a,c=t.comment_activities,u=void 0===c?[]:c,p=t.users_to_notify,d=void 0===p?[]:p,m=t.latest_revision,h=void 0===m?null:m;this.activity_key=o,this.feedback_off=s,this.can_edit_feedback=l,this.comment_activities=u,this.users_to_notify=d,this.latest_revision=h,i(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(c.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return s.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return s.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=s.thaw(this),n=this.comment_activities.map(s.thaw);return t.comment_activities=n,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(s.thaw)}),e(t),i(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=o.matches({activity_key:e}),i=0;i<this.comment_activities.length;i++){var r=this.comment_activities[i];if(n(r))return["comment_activities",i];if(!t)for(var s=0;s<r.comment_activities.length;s++)if(n(r.comment_activities[s]))return["comment_activities",i,"comment_activities",s]}return null},e.prototype._updateComment=function(e,t){return e?s.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return s.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),s.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=o.matches({activity_key:e}),n=0;n<this.comment_activities.length;n++){var i=this.comment_activities[n];if(t(i))return i;for(var r=0;r<i.comment_activities.length;r++){var s=i.comment_activities[r];if(t(s))return s}}return null},e.prototype.findConversationByKey=function(e){return o.findWhere(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return s.updateIn(this,t,function(e){return s.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return s.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return o.contains(e,t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},n.__decorate([l.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),latest_revision:u.RevisionShape})],e,"fromDict",null),e})();t.FileActivity=p}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o instanceof RegExp&&e.match(o))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_client",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,i){"use strict";function o(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedOriginForPosting=null,t._validActions=[],t._parentMessageQueue=[],t._onParentReady=null,t}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this._trustedOriginForPosting=null,this._validActions=t,this._trustedMessageHandler=e,this._onParentReady=n},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.requestParentOrigin()},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={});var n=this.packagePostMessage(e,t);null===this._trustedOriginForPosting?this._parentMessageQueue.push(n):this.getWindow().parent.postMessage(n,this._trustedOriginForPosting)},t.prototype.dispatchMessage=function(e,t){"parent-ready"===t.action?this.updateParentOrigin(e.origin):o(t.action,this._validActions)&&null!==this._trustedMessageHandler&&this._trustedMessageHandler(t)},t.prototype.resetOriginsForPosting=function(){this._trustedOriginForPosting=null},t.prototype.updateParentOrigin=function(e){var t=this._trustedOriginForPosting;if(!this.isOriginAllowed(e))return!1;if(this._trustedOriginForPosting=e,this._parentMessageQueue.length>0){
for(var n=0;n<this._parentMessageQueue.length;n++){var i=this._parentMessageQueue[n],o=JSON.parse(i);this.postMessageToParent(o.action,o.parameters)}this._parentMessageQueue=[]}return null!=this._trustedOriginForPosting&&null==t&&null!==this._onParentReady&&this._onParentReady(),!0},t.prototype.requestParentOrigin=function(){var e=this;this.getWindow().parent.postMessage('{"action": "child-requesting-parent-origin"}',"*");var n=function(){null===e._trustedOriginForPosting&&e.requestParentOrigin()};this.getWindow().setTimeout(n,t._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t})(i.FrameMessengerBase);t.FrameMessengerClient=r}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,i){"use strict";function o(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var i=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(i),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var i=n[t],o=""+i.getAttribute("src"),r=this.getOriginFromUrl(o);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var i=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+i},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),o(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var i=this.getTrustedChildOriginForPosting();if(null!==i){var o=this.packagePostMessage(t,n);e.forEach(function(e){return e.contentWindow.postMessage(o,i)})}},t})(i.FrameMessengerBase);t.FrameMessengerHost=r}),define("modules/clean/frame_messenger/frame_messenger_proxy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){this.childMessenger=e,this.parentMessenger=t}return e.prototype.postToParentMessenger=function(e){this.parentMessenger.postMessageToParent(e.action,e.parameters)},e.prototype.postToChildMessenger=function(e){this.childMessenger.postMessageToChildren(e.action,e.parameters)},e})();t.FrameMessengerProxy=n}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_annotations",["jquery","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer","modules/clean/image_preview_util"],function(t,n,i,o){return(function(){function r(){this.onResize=e(this.onResize,this),this._onScroll=e(this._onScroll,this),this._handleMessage=e(this._handleMessage,this)}return r.prototype.onImageLoad=function(e){return null==e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},r.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new i,window.addEventListener("resize",this.onResize),o.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("message",this._handleMessage),this._postPageRendered()},r.prototype._prepareAnnotationInterface=function(){var e,i;return 0===o.getAnnotationContainer().length&&(e=o.getPreviewImageWrapper(),i=t("<div class='"+o.ANNOTATION_CONTAINER+"' />"),this.$annotationContainer=i.appendTo(e)),this._resizeAnnotationContainer(),this.annotationInterface=new n,o.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout((function(e){return function(){var t;return e._resizeAnnotationContainer(),null!=(t=e.annotationInterface)?t.onScaleChangeCallback():void 0}})(this),0)},r.prototype._handleMessage=function(e){var t,n,i,o,r,s,a,l,c,u,p;try{n=JSON.parse(e.data)}catch(e){return void e}switch(n.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=(i=this.annotationInterface)&&i._updateOffset(),null!=(o=this.annotationRenderer)?o.updateAnnotations(n.parameters):void 0;case"remove-annotation":return t=n.parameters.commentActivity,null!=(r=this.annotationRenderer)?r.removeAnnotation(t):void 0;case"remove-all-annotations":return null!=(s=this.annotationRenderer)&&s.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=(a=this.annotationInterface)?a._updateOffset():void 0;case"enable-annotation-creation":return null!=(l=this.annotationInterface)?l.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=(c=this.annotationInterface)?c.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=(u=this.annotationInterface)?u.onHideAnnotation():void 0;case"scroll-to-annotation":return t=n.parameters.commentActivity,null!=(p=this.annotationRenderer)?p.highlightAnnotation(t):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},r.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},r.prototype._postMessage=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},r.prototype._setRegionCreationEnabled=function(e){var t,n,i;return e?null!=(t=this.annotationInterface)&&t.enableRegionCreation():null!=(n=this.annotationInterface)&&n.disableRegionCreation(),this._resizeAnnotationContainer(),null!=(i=this.annotationInterface)?i._updateOffset():void 0},r.prototype._onScroll=function(){var e;return null!=(e=this.annotationInterface)?e.onScrollCallback():void 0},r.prototype.onResize=function(e){var t,n;return null==e&&(e=!0),null!=(t=this.annotationRenderer)&&t.removeAllAnnotations(),this._postMessage("scale-change"),n=(function(e){return function(){var t;return e._resizeAnnotationContainer(),e._postPageRendered(),null!=(t=e.annotationInterface)&&t.onScaleChangeCallback(),"function"==typeof e.resizeImageCallback?e.resizeImageCallback():void 0}})(this),clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},r.prototype._resizeAnnotationContainer=function(){var e,t,n,i,r,s,a,l,c,u,p,d,m;if(e=o.getPreviewImage(),null!=e&&null!=e.offset()&&null!=(null!=(i=e.offsetParent())?i.offset():void 0))return n=e.offset().top-e.offsetParent().offset().top,t=e.offset().left-e.offsetParent().offset().left,n<0&&(n=0),t<0&&(t=0),null!=(r=this.$annotationContainer)&&r.css("margin-top",n),null!=(s=this.$annotationContainer)&&s.css("margin-bottom",n),null!=(a=this.$annotationContainer)&&a.css("margin-left",t),null!=(l=this.$annotationContainer)&&l.css("margin-right",t),(null!=(c=this.annotationInterface)?c.isAnnotationRegionEnabled:void 0)?(null!=(u=this.$annotationContainer)&&u.height(e.height()),null!=(p=this.$annotationContainer)?p.width(e.width()):void 0):(null!=(d=this.$annotationContainer)&&d.height(0),null!=(m=this.$annotationContainer)?m.width(0):void 0)},r.prototype.removeAnnotations=function(){var e;return null!=(e=this.annotationRenderer)?e.removeAllAnnotations():void 0},r.prototype.reset=function(){var e,t;return null!=(e=this.annotationRenderer)&&e.reset(),null!=(t=this.annotationInterface)&&t.reset(),o.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),o.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),this._postMessage("reset-file-feedback-ui")},r})()})}.call(this),function(){define("modules/clean/image_preview_util",["jquery","modules/clean/annotations/annotation"],function(e,t){return t.Annotation,t.AnnotationTypes,t.AnnotationSubtypes,{PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return e("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return e("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return e("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return e("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return e("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){var t,n,i,o,r,s,a,l,c,u,p,d,m,h,f;for(u=[],t=this.getPreviewImageElement(),s=t.clientWidth,r=t.clientHeight,h=e.image_coordinates,o=0,l=h.length;o<l;o++){for(n=h[o],i=[],f=n.coordinates,a=0,c=f.length;a<c;a++)m=f[a],p=m.x*s,d=m.y*r,i.push({x:p,y:d});u.push(i)}return u},convertAnnotationViewportCoordinatesToImagePoints:function(e){var t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v;for(p=[],t=this.getPreviewImageElement(),r=t.getBoundingClientRect(),h=r.left,f=r.top,a=t.clientWidth,s=t.clientHeight,v=e.viewportCoordinates,o=0,c=v.length;o<c;o++){for(n=v[o],i=[],l=0,u=n.length;l<u;l++)_=n[l],d=(_.x-h)/a,m=(_.y-f)/s,i.push({x:d,y:m});p.push({coordinates:i})}return p}}})}.call(this),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,o=i;n<o.length;n++){var r=o[n],s=r[0],a=r[1],l=r[2];if(a>=e||l>=t)return s}return i[i.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_interface",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(t,n,i,o,r){return(function(){function s(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationScaleChangeCallback=e(this.onAnnotationScaleChangeCallback,this),this.onAnnotationScrollCallback=e(this.onAnnotationScrollCallback,this),this.onAnnotationEndDragCallback=e(this.onAnnotationEndDragCallback,this),this.onAnnotationStartDragCallback=e(this.onAnnotationStartDragCallback,this),this.onAnnotationPlacedCallback=e(this.onAnnotationPlacedCallback,this),this.onAnnotationHiddenCallback=e(this.onAnnotationHiddenCallback,this),this.onScaleChangeCallback=e(this.onScaleChangeCallback,this),this.onScrollCallback=e(this.onScrollCallback,this),this.onKeyDownCallback=e(this.onKeyDownCallback,this),this.onMouseUpCallback=e(this.onMouseUpCallback,this),this.onMouseMoveCallback=e(this.onMouseMoveCallback,this),this.onMouseDownCallback=e(this.onMouseDownCallback,this),this.onHideAnnotation=e(this.onHideAnnotation,this),this._prepareAnnotationCoords=e(this._prepareAnnotationCoords,this),this._refreshAnnotationController=e(this._refreshAnnotationController,this),this._prepareAnnotationController=e(this._prepareAnnotationController,this),this.controllerEventHandlers={onMouseMoveCallback:t.noop,onMouseDownCallback:t.noop,onMouseUpCallback:t.noop,onHideAnnotation:t.noop,onScrollCallback:t.noop,onScaleChangeCallback:t.noop,onKeyDownCallback:t.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return s.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},s.prototype._isOnAnnotationUI=function(e){return t(e.target).parents(".db-annotation-layer").length>0},s.prototype._isOnAnnotationOverlay=function(e){return t(e.target).parents("#annotation-overlay").length>0},s.prototype._destroyAnnotationController=function(){var e;if(e=r.getAnnotationLCanvasLayer(),(null!=e?e.length:void 0)>0)return i.unmountComponentAtNode(e[0]),e.remove()},s.prototype._prepareAnnotationController=function(){var e,n;if(e=r.getAnnotationContainer(),0===e.find("."+r.ANNOTATION_CANVAS_LAYER_CSS).length)return n=t("<div class='"+r.ANNOTATION_CANVAS_LAYER_CSS+"' />"),this.$parentContainerEl=n.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()},s.prototype._refreshAnnotationController=function(e){var t;if(null!=(t=this.$parentContainerEl)?t.get(0):void 0)return this.annotationController=i.render(n.createElement(o,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},s.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},s.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=r.convertAnnotationViewportCoordinatesToImagePoints(e),e},s.prototype._updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},s.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},s.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},s.prototype.enableRegionCreation=function(){return t("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},s.prototype.disableRegionCreation=function(){return t("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},s.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),r.getAnnotationContainer().remove()},s.prototype.onHideAnnotation=function(){var e;return null!=(e=this.controllerEventHandlers)?e.onHideAnnotation():void 0},s.prototype.onMouseDownCallback=function(e){var t;if(!this._isOnAnnotationUI(e)&&!this._isOnAnnotationOverlay(e))return null!=(t=this.controllerEventHandlers)?t.onMouseDownCallback(e):void 0},s.prototype.onMouseMoveCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseMoveCallback(e):void 0},s.prototype.onMouseUpCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseUpCallback(e):void 0},s.prototype.onKeyDownCallback=function(e){var t;return t=e.keyCode||e.which||e.charCode,this._sendToParent("on-keydown",{keyCode:t})},s.prototype.onScrollCallback=function(e){var t,n;if(this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onScrollCallback():void 0),!(null!=(n=this.annotationController)?n.hasVisibleActiveAnnotation():void 0))return this._sendToParent("scroll")},s.prototype.onScaleChangeCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},s.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},s.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},s.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},s.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},s})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_renderer",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(t,n,i,o,r,s,a,l){var c;return c=new a,(function(){function o(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationClickCallback=e(this.onAnnotationClickCallback,this),this._renderAnnotation=e(this._renderAnnotation,this),this.updateAnnotations=e(this.updateAnnotations,this),this.removeAnnotation=e(this.removeAnnotation,this),this._annotationsByActivityKey={}}return o.prototype._isAnnotationAlreadyRendered=function(e){return t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},o.prototype.removeAnnotation=function(e){var n;if(this._isAnnotationAlreadyRendered(e.activity_key))return n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0),i.unmountComponentAtNode(n),n.remove()},o.prototype.removeAllAnnotations=function(){return this.reset()},o.prototype.reset=function(){var e,t,n,o;for(t=l.getAnnotationLayers(),n=0,o=t.length;n<o;n++)e=t[n],i.unmountComponentAtNode(e);return t.remove(),this._annotationsByActivityKey={}},o.prototype.highlightAnnotation=function(e){var n;if(this._isAnnotationAlreadyRendered(e.activity_key))return n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']"),n.removeClass("start-highlight-animation"),n.width(n.width()),n.addClass("start-highlight-animation")},o.prototype.updateAnnotations=function(e){var t,n,i,o,r,s;if(c.shouldUpdateAnnotations(e,this._annotationsByActivityKey)){for(this.removeAllAnnotations(),r=e.annotations,s=[],i=0,o=r.length;i<o;i++)n=r[i],c.renderAnnotation(n,this._isAnnotationAlreadyRendered,this._renderAnnotation),t=n.commentActivity.activity_key,s.push(this._annotationsByActivityKey[t]=n);return s}},o.prototype._renderAnnotation=function(e,o,r,s){var a,c,u;if(c=l.getAnnotationContainer(),(null!=c?c.length:void 0)>0)return o.viewportCoordinates=l.convertAnnotationImagePointsToViewportCoordinates(o),u=t("<div class='"+l.ANNOTATION_LAYER_CSS+"' />"),u.attr({"data-comment-activity-key":r.activity_key}),a=u.appendTo(c).get(0),i.render(n.createElement(e,{annotation:o,commentActivity:r,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),a)},o.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},o.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},o.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},o.prototype.onAnnotationOverCallback=function(e){return{}},o.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},o})()})}.call(this),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/underscore","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,i,o,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={};d[r.EventTypes.FILE_PREVIEW_SESSION_ENDED]="preview_session_ended",d[r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]="preview_attempted",d[r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]="support_confirmed",d[r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]="support_denied",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]="download_attempted",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]="download_succeeded",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]="download_failed",d[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]="render_succeeded",d[r.EventTypes.FILE_PREVIEW_RENDER_FAILED]="render_failed",d[r.EventTypes.FILE_PREVIEW_VIDEO_STALLED]="video_stalled",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED]="quality_popup_asked",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED]="quality_popup_answered",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED]="quality_popup_dismissed",d[r.EventTypes.FILE_PREVIEW_USER_ACTION]="user_action",d[r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED]="file_downloaded",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED]="show_contents_attempted",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED]="show_contents_failed",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED]="show_contents_succeeded";var m=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=e;n<i.length;n++){var o=i[n],r=o[0],s=o[1];this._eventHandlers[r]=s}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var i=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:d[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:i?JSON.stringify(i):null,file_preview_size:t.previewSize};o.SilentBackgroundRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),h=(function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,o){void 0===o&&(o={}),i.each(n,function(e,t){return o[l.getQuestionLoggerKey(t)]=e}),t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,e,o)},t._logQuestion=function(e,n){for(var i={},o=0,s=n;o<s.length;o++){var a=s[o];i[l.getQuestionLoggerKey(a)]="1"}t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,e,i)},t._logDismissed=function(e,n){var i={stage:a.getPopupStageLoggerKey(n)};t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,e,i)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,t._logQuestion],[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,t._logAnswers],[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,i){void 0===i&&(i={}),i._client_time=+Date.now();var o=n.sourceContext,r=n.sourceAction;o&&(i._source_context=s.getPreviewSourceContextKey(o)),r&&(i._source_action=s.getPreviewSourceActionKey(r)),e.prototype._log.call(this,t,n,i)},t})(m);t.FilePreviewQualityPopupLogger=h;var f=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_RENDER_FAILED,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SESSION_ENDED,e,t)},n._handleFilePreviewVideoStalled=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_VIDEO_STALLED,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,n._handleFilePreviewAttemptStarted],[r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,n._handleFilePreviewSupportConfirmed],[r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,n._handleFilePreviewSupportDenied],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,n._handleFilePreviewDownloadAttempted],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,n._handleFilePreviewDownloadSucceeded],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,n._handleFilePreviewDownloadFailed],[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,n._handleFilePreviewRenderSucceeded],[r.EventTypes.FILE_PREVIEW_RENDER_FAILED,n._handleFilePreviewRenderFailed],[r.EventTypes.FILE_PREVIEW_SESSION_ENDED,n._handleFilePreviewSessionEnded],[r.EventTypes.FILE_PREVIEW_VIDEO_STALLED,n._handleFilePreviewVideoStalled]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,n.source_context=s.getPreviewSourceContextKey(t.sourceContext),n.source_action=s.getPreviewSourceActionKey(t.sourceAction),n.is_mounted=t.isMounted,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark()),null!=t.secondaryMarkTs&&(n.secondary_mark_ts=t.secondaryMarkTs,n.time_to_secondary_mark=t.timeToSecondaryMark());var o=c.start_time();void 0!==o&&(n.navigation_start=o),null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailInfo&&(n.preview_thumbnail_info=JSON.stringify(t.previewThumbnailInfo)),t.didFallbackToPdfjs&&(n.fallback_pdfjs=!0),t.isSSR&&(n.is_ssr="1"),t.quipVariant&&(n.quip_variant=t.quipVariant),null!=t.lastEvent&&(n.last_event=d[t.lastEvent]),i.isEmpty(t.ssrTimestamps)||(n.ssr_timestamps=JSON.stringify(t.ssrTimestamps)),i.isEmpty(t.ssrTiming)||(n.ssr_timing=JSON.stringify(t.ssrTiming));var a=t.previewTimeline[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED];if(a&&(n.time_to_render=t.timeToMark(a.timestamp)),t.sourceAction===s.PreviewSourceAction.VISIT){var l=c.time_since_start();if(null!=l&&(n.time_to_event=l),e===r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED){var m=c.time_to_view();null!=m&&null!=o&&(n.ttv_ts=m);var h=c.time_to_interactive();null!=h&&null!=o&&(n.time_to_interactive=h-o);var f=p.performance();if(null!=f){var _=f.timing;null!=_&&null!=o&&(n.time_to_first_byte=_.responseStart-o,n.web_timing_data=JSON.stringify(_))}window._timingData&&(window._timingData.pdfjs&&(n.pdfjs_timing_data=JSON.stringify(window._timingData.pdfjs)),window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img)))}}e===r.EventTypes.FILE_PREVIEW_SESSION_ENDED&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched),n.zoom_scales=JSON.stringify(t.zoomScales),n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var i=e.previewTimeline[n],o=this._timelineKey(n);t[o]=i.timestamp}return t},t.prototype._timelineKey=function(e){return d[e]+"_ts"},t})(m);t.FilePreviewTimelineLogger=f;var _=(function(e){function t(){var t=e.call(this)||this;return t._logDownload=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,e,n)},t._logShowContentsAttempted=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,e,n)},t._logShowContentsFailed=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,e,n)},t._logShowContentsSucceeded=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,e,n)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,t._logDownload],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,t._logShowContentsAttempted],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,t._logShowContentsFailed],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,t._logShowContentsSucceeded]),t}return n.__extends(t,e),t})(m);t.FilePreviewArchiveLogger=_;var v=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,i,o){o.action=n,o.context=i,t._log(r.EventTypes.FILE_PREVIEW_USER_ACTION,e,o)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_USER_ACTION,t._logUserAction]),t}return n.__extends(t,e),t})(m);t.FilePreviewUserActionLogger=v}),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/previews/util","modules/constants/python"],function(e,t,n,i,o,r){"use strict";function s(){return i.UserActivityLogger.start("web","file_view_first_page_rendered"),i.PreviewActivityLogger.start("file_view_first_page_rendered"),i.FileViewLogger.start()}function a(e,t){e=e;for(var r=o.get_extension(e),s=n.__assign({},t.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),a=0,l=t.stats;a<l.length;a++){var u=l[a];s[c[u.name]]=u.end-u.start}return i.UserActivityLogger.stop("web","file_view_first_page_rendered",s),
i.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(s)})}function l(e,t,n,s,a,l,c){void 0===c&&(c=!1);var u={user_id:null!=t?t.id:void 0,target:n,platform:r.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:s,action:a,shared_link_url:l,extra:{file_ext:o.get_extension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),is_ndsl:c}};return i.FileViewLogger.stop(u)}Object.defineProperty(t,"__esModule",{value:!0});var c={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.start=s,t.logPageRendered=a,t.logView=l}),function(){define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal"],function(e,t,n,i,o,r,s,a,l){var c,u,assert;return assert=i.assert,u=o._,c=a.DBModal,(function(){function i(){}return i.$element=function(){return e("#db-modal-multiaccount-login-modal")},i.set_during_login_callback=function(e){return assert(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},i.show_modal=function(i){var o,a,l,p,d;return null==i&&(i={}),s.get_viewer().is_team_assume_user_session?this.show_personal_account_disabled_modal():(this.$element=e.isFunction(this.$element)?this.$element():this.$element,assert(null!=(a=this.$element)?a.length:void 0,"MultiaccountLogin needs its @$element to be set"),assert(!(null!=i.on_success&&null!=i.success_href),"on_success and success_href are mutually exclusive"),null!=i.user?d=i.user:null!=i.user_id?d=s.get_viewer().get_user_by_id(i.user_id,!0):null!=i.role&&(d=s.get_viewer().get_user_by_role(i.role,!0)),assert(null!=d,"invalid user"),l=d.role,assert(!s.get_viewer().is_user_signed_in(d),"called MultiaccountLogin for a user that's already signed in"),p="personal"===l?u("Sign in to your personal Dropbox"):u("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),o=this.$element.find("form"),n.get_controller(o).reset(),n.get_controller(o).set_input_value("login_email",d.email),this.auth_success_callback=(function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),n=function(n){return null!=n?(r.error(n),s.get_viewer()._sign_out_user_by_id(d.id),void e.modal.hide()):null!=i.success_href?t.get_uri().toString()!==i.success_href?t.redirect(i.success_href):t.reload():(e.modal.hide(),"function"==typeof i.on_success?i.on_success():void 0)},null!=e._during_login_callback&&null==i.success_href?e._during_login_callback(d,n):n(),!1}})(this),e(document).off("db:multilogin:success"),e(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new c({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(p),this.$element.find('input[name="login_password"]').focus())},i.show_page_login_modal=function(e){var t,n,i,o,r,a,l;for(l=s.get_viewer(),i=null,r=l.get_users(!0),t=0,n=r.length;t<n;t++)if(a=r[t],!l.is_user_signed_in(a)){i=a;break}if(i)return o={user:i},"string"==typeof e?o.success_href=e:"function"==typeof e&&(o.on_success=e),this.show_modal(o),!1},i.show_personal_account_disabled_modal=function(){var e;return e=s.get_viewer(),l.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},i})()})}.call(this),define("modules/clean/open_in_app/actions",["require","exports","modules/clean/open_in_mobile_app","modules/constants/file_viewer"],function(e,t,n,i){"use strict";function o(){var e=navigator.userAgent||"",t=e.match(/OS (\d+)_(\d+)_?(\d+)?/);return!t||parseInt(t[1],10)>=9}function r(e){return e.platform===u.IPAD||e.platform===u.IPHONE}function s(e){return e.platform===u.ANDROID_MARKET}function a(e,t){var i=t.onAppNeeded,a=t.onAppInstalled;r(e)?n.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,o(),i,a):s(e)&&n.open_android_intent(e.androidAppUrl)}function l(e){var t;if(r(e))t=e.iOSAppUrl;else{if(!s(e))return;t=e.androidAppUrl}var n=document.createElement("iframe");n.setAttribute("class","open-in-app-transport"),n.setAttribute("src",t),n.setAttribute("style","display: none"),document.body.appendChild(n)}function c(){n.cleanup()}Object.defineProperty(t,"__esModule",{value:!0});var u=i.OpenInMobileAppPlatform;t.openInApp=a,t.openImmediately=l,t.cleanUp=c}),function(){define("modules/clean/open_in_mobile_app",["jquery","modules/clean/analytics","modules/core/exception","modules/core/i18n"],function(e,t,n,i){var o,assert;return assert=n.assert,o=i._,(function(){function n(){}return n.vischange_listener=null,n.open_app_mode=!0,n._onOpenLoggingHandler=function(){},n._onInstallLoggingHandler=function(){},n.try_open_ios_9=function(e,t,i,o){return null==i&&(i=function(){}),null==o&&(o=function(){}),n.vischange_listener||(n.vischange_listener=function(e){return n.open_app_mode=!0,o()},document.addEventListener("visibilitychange",n.vischange_listener)),n.open_app_mode?(n.open_app_mode=!1,n._onOpenLoggingHandler(),i(),window.location=e):(n._onInstallLoggingHandler(),window.location=t)},n.fallback_will_launch=!1,n.try_open=function(i,o,r){var s,a,l,c,u,p,d,m;if(n._onOpenLoggingHandler(),!n.fallback_will_launch)return s=e("body"),m=function(){var t;return t=e("<iframe />",{src:i,style:"display: none;"}),s.append(t)},u=!1,d=function(e){return u=!0},document.addEventListener("visibilitychange",d),l=!1,c=function(e){return l=!0},window.addEventListener("pagehide",c),null!=r&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN","WEB_MOBILE",{scl_url:r}),m(),p=Date.now(),a=function(){if(n.fallback_will_launch=!1,document.removeEventListener("visibilitychange",d),window.removeEventListener("pagehide",c),!l&&!u&&Date.now()<p+4700)return null!=r&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL","WEB_MOBILE",{scl_url:r}),window.location.replace(o)},setTimeout(a,3200),n.fallback_will_launch=!0},n.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},n.open_on_click=function(t,n,i,r,s,a){var l;return null==a&&(a=null),l=(function(i){return function(l){var c;return l.preventDefault(),s?(r||(r=e("<div/>")),c=r.text(),i.try_open_ios_9(t,n,function(){return r.text(o("Install app?"))},function(){return r.text(c)})):i.try_open(t,n,a)}})(this),e(i).on("click",l)},n.open_ios=function(e,t,n,i,o){return null==i&&(i=function(){}),null==o&&(o=function(){}),n?this.try_open_ios_9(e,t,i,o):this.try_open(e,t)},n.open_android_intent=function(e){var t;return t="intent://www.dropbox.com/sm/launch_intent_or_fallback_page",assert(e&&e.startsWith(t),"intentUrl must use intent:// protocol"),window.location.href=e},n.redirect_on_load=function(e,t){return this.try_open(e,t)},n.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},n})()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["external/underscore","modules/clean/browse_interface","modules/clean/filepath","modules/core/uri"],function(t,n,i,o){return(function(){function r(){}var s,a,l;return r.PRELOAD_URLS={},r.MAX_SUPPORTED_FILE_SIZE_B=157286400,s=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],a=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],l=function(n){var o,r;return r=i.filename(n),o=i.file_extension(r),t.find(a,function(t){return e.call(t.ext,o)>=0})},r.get_open_handler_for=function(e,t){var i,s;return s=l(e.fq_path),s&&r.is_app_supported(s.id)?(i=o.encode_parts(e.fq_path),{icon:s.icon,name:s.name,uri:"/ow/msft/edit"+n.get_browse_root(t)+i}):null},r.file_supported=function(e){return!!l(e.fq_path)},r.is_adobe_app=function(t){return e.call(s,t)>=0},r.is_app_supported=function(e){switch(e){case"word":return!0;case"excel":return!0;case"powerpoint":return!0;case"wopitest":return!1;case"wopitest-unsupported":return!1;default:return!1}},r})()})}.call(this),define("modules/clean/optimistic_update",["require","exports","external/underscore"],function(e,t,n){"use strict";function i(e){return n.isString(e)}Object.defineProperty(t,"__esModule",{value:!0});var o={},r=(function(){function e(e){this._base=e,this._journal=[],this._head=o}return e.prototype.getValue=function(){return this._head===o&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=o,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(i(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=o,this._base=t.patch(this._base,e),!0)}return this._head=o,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=o,this._journal.splice(t,1)[0])},e})();t.Optimist=r}),define("modules/clean/previews/actions",["require","exports","modules/clean/previews/file_view_rams_common","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/store","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,s,a,l){"use strict";function c(e,t,n,i){return!!(e&&null!==n?u(n,t):p({href:t,preview_type:"doc"}))&&(o.logUserAction(r.UserActionNames.PRINT,i),!0)}function u(e,n){var i=l.parse(e||a.get_href());i.setQuery({preview:"1"});var o=l.parse(n).getAuthority();return t.tryNativePdfPrint(i,o)}function p(e){if(null!=e.preview_type){var n=e;if(!(["doc","adobecs"].indexOf(n.preview_type)>-1))return!1;var o=i.get_progressive_url("doc",n.href),r=o.getAuthority();return t.tryNativePdfPrint(o,r)}return!1}function d(){return o.openFullscreen(),!1}function m(){return o.closeFullscreen(),!1}function h(){return s.FileViewerStore.instance.getIsFullscreen()}function f(){return o.broadcastPreviewRenderStatus(r.PreviewRenderStatuses.SUCCEEDED)}Object.defineProperty(t,"__esModule",{value:!0}),t.tryNativePdfPrint=function(e,t){var i=n.getNativePrintUrl(e,t);return null!=i&&(window.open(i,"_blank"),!0)},t.nativePrint=c,t.nativePdfPrintFromSharedLink=u,t.nativePdfPrint=p,t.enterFullscreen=d,t.exitFullscreen=m,t.isFullscreen=h,t.broadcastRenderSucceeded=f}),define("modules/clean/previews/file_view_rams_common",["require","exports","modules/core/browser","modules/core/uri"],function(e,t,n,i){"use strict";function o(e){return e=e.toLowerCase(),a.indexOf(e)>-1}function r(){return n.chrome||n.safari}function s(e,t){if(!r())return null;if(!o(t))return null;var n=e.clone();n.updateQuery({disable_range:"1",from_native_print:"1"});var s=i.parse("https://"+t+"/nativeprint");return s.updateQuery({file:n.toString()}),s.toString()}Object.defineProperty(t,"__esModule",{value:!0});var a=["dl-doc.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","dl-doc.dropboxusercontent.com"];t.getNativePrintUrl=s}),define("modules/clean/previews/pdf_loader",["require","exports","external/underscore","modules/clean/ajax","modules/clean/previews/util","modules/clean/react/previews/frame_messenger_host","modules/constants/file_viewer","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=["exit-parent-fullscreen","failed","pagerendered","viewer-initialized","downloading","loaded","fully-loaded","viewer-ready","page-already-opened","page-rendered","page-repositioned","password-needed","zoomed-in","zoomed-out"],u=(function(){function e(e){var t=this;this.options={},this.handleTrustedMessageFromChild=function(e){switch(e.action){case"viewer-initialized":t.onViewerInitialized();break;case"viewer-ready":t.isFullscreen&&t.sendEnterFullscreenAction();break;case"exit-parent-fullscreen":t.isFullscreen=!1,null!=t.exitFullscreenCallback&&t.exitFullscreenCallback();break;case"downloading":t.onLoadAttempted();break;case"failed":t.onFailed(e.parameters);break;case"pagerendered":t.onFirstPageRendered(e.parameters);break;case"loaded":case"fully-loaded":t.onLoaded(e.parameters);break;case"page-already-opened":t.onPagePreloaded(e.parameters);break;case"page-rendered":null!=t.onPageRendered&&t.onPageRendered(e.parameters);break;case"page-repositioned":t.onPageRepositioned(e.parameters);break;case"password-needed":t.onPasswordNeeded();break;case"zoomed-in":case"zoomed-out":null!=t.onZoom&&t.onZoom(e.parameters)}},this.onLoadAttempted=function(){t.onDownloadAttempted&&t.onDownloadAttempted()},this.onPagePreloaded=function(e){if(t.onLoadAttempted(),e.isLoaded&&(t.onLoaded(e),e.isRendered)){var n={attributes:e};t.onFirstPageRendered(n)}e.isPasswordNeeded&&t.onPasswordNeeded(),e.hasFailed&&t.onFailed(e.failureParameters)},this.frameMessenger=e?e:new r.PreviewFrameMessengerHost,this.isFullscreen=!1,this.ducId=o.generateDucId(64)}return e.prototype.startListening=function(){this.frameMessenger.configureChildMessaging("iframe.pdfjs",this.handleTrustedMessageFromChild,c),this.frameMessenger.startListening()},e.prototype.stopListening=function(){this.frameMessenger.stopListening()},e.prototype.setExitFullscreenCallback=function(e){this.exitFullscreenCallback=e},e.prototype.setIsFullscreen=function(e){this.isFullscreen=e},e.prototype.setOnDownloadAttempted=function(e){this.onDownloadAttempted=e},e.prototype.setOnDownloadSucceeded=function(e){this.onDownloadSucceeded=e},e.prototype.setOnDownloadFailed=function(e){this.onDownloadFailed=e},e.prototype.setOnFirstRenderSucceeded=function(e){this.onFirstRenderSucceeded=e},e.prototype.setOnPageRendered=function(e){this.onPageRendered=e},e.prototype.setOnZoom=function(e){this.onZoom=e},e.prototype.setOnRenderFailed=function(e){this.onRenderFailed=e},e.prototype.setOnPageRepositioned=function(e){this.onPageRepositioned=e},e.prototype.setOnPasswordNeeded=function(e){this.onPasswordNeeded=e},e.prototype.repositionFile=function(e){null!=e&&this.frameMessenger.postMessageToChildren("reposition-file",{scrollPosition:e})},e.prototype.openFile=function(e,t){var o=this;if(void 0===t&&(t={}),this.hasDocumentDownloaded=!1,null!=e){var r=l.parse(e),c=r.getQuery(),u=null;"duc_id"in c||(u=this.ducId),n.defaults(t,{disableRange:!!a.safari_version_at_most(8),chunkSizeGandalf:"64000",minRangeSizeGandalf:s.DOCPREVIEW_DOC_RANGE_REQUEST,presentationMode:!1,dropboxDucId:u,renderAtFirstPage:s.WEB_PDF_LOAD_FIRST_PAGE_ENABLED});var p="",d="";if(s.DOCPREVIEW_DEBUG_FORCE_TEST_PDF?p="test.pdf":s.DOCPREVIEW_DEBUG_FORCE_TEST_DECK_PDF?p="test-deck.pdf":"password_protected"===s.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?d="riviera_exception_password":"too_big"===s.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&(d="riviera_exception_too_big"),""!==p?(c.canned_file_name=p,r.setQuery(c)):""!==d&&(c.canned_exception=d,r.setQuery(c)),0===r.getPath().toString().indexOf("/pri")){var m=r.getPath().toString().slice(8);r.setPath("/pri/get_content_url"),i.WebRequest({url:r.toString(),data:{path:m},success:function(e){var n=JSON.parse(e);o.finishOpenFile(n.url,t)}})}else this.finishOpenFile(r,t)}},e.prototype.finishOpenFile=function(e,t){void 0===t&&(t={}),this.isNewFileUrl(e)&&(this.fileUrl=e.toString(),this.options=t,this.sendOpenFileAction())},e.prototype.isNewFileUrl=function(e){return e.toString()!==this.fileUrl},e.prototype.sendOpenFileAction=function(){this.frameMessenger.postMessageToChildren("open-file",{fileUrl:this.fileUrl,options:this.options})},e.prototype.sendEnterFullscreenAction=function(){this.frameMessenger.postMessageToChildren("enter-fullscreen")},e.prototype.onViewerInitialized=function(){this.sendOpenFileAction()},e.prototype.onLoaded=function(e){null!=this.onDownloadSucceeded&&this.onDownloadSucceeded({size:e.size,pageCount:e.pageCount}),this.hasDocumentDownloaded=!0},e.prototype.onFirstPageRendered=function(e){void 0===e&&(e={});var t=void 0;null!=e.attributes&&(t=e.attributes.page),null!=this.onFirstRenderSucceeded&&this.onFirstRenderSucceeded({pageRendered:t})},e.prototype.onFailed=function(e){if(this.hasDocumentDownloaded)null!=this.onRenderFailed&&this.onRenderFailed();else{var t=void 0;null!=e&&(t=e.rivieraStatus);var n={rivieraStatus:t};null!=this.onDownloadFailed&&this.onDownloadFailed(n)}},e})();t.PdfLoader=u}),define("modules/clean/previews/pending_upload_watcher",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/actions","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e,t,n){void 0===n&&(n=""),this.linkType=e,this.pollUrl=new r({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void i.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():o.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s}),define("modules/clean/previews/preview_toolbar_actions",["require","exports","external/reflux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarActions=n.createActions(["hideToolbar","showToolbar"])}),define("modules/clean/previews/preview_toolbar_store",["require","exports","external/reflux","modules/clean/previews/preview_toolbar_actions"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarStore=n.createStore({listenables:i.PreviewToolbarActions,init:function(){this.state=this.getInitialState()},getInitialState:function(){return{hideToolbar:!1}},onHideToolbar:function(){this.state.hideToolbar=!0,this.trigger(this.state)},onShowToolbar:function(){this.state.hideToolbar=!1,this.trigger(this.state)}})}),define("modules/clean/previews/util",["require","exports","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/constants/static","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u){"use strict";function p(){return".react-file-viewer__preview iframe"}function d(){return l.PASS_PERF_EXPERIMENT}function m(e){return void 0===e&&(e=""),_(e)&&l.DOCPREVIEW_EXCEL2}function h(e){return e?"flv"===e?t.FLV_CONTAINER:"webm"===e?"video/webm":"application/vnd.apple.mpegurl":f()?"application/vnd.apple.mpegurl":t.FLV_CONTAINER}function f(){return l.FILE_VIEWER_VIDEO_USE_HLS}function _(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function v(e){var t=s.isBrowseFile(e)?e.fq_path:e.filename;return r.file_extension(t)}function g(e){var t=s.isBrowseFile(e)?e.fq_path:e.filename;return r.filename(t)}function y(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function E(e,t){var n,i=y(e),o=u.parse(t);return"xls"!==i||m(i)||(n="xls/preview"),null!=n&&(o.setPath(o.getPath().replace("/pri/get/","/get/")),o.setPath(o.getPath().replace("/get/","/"+n+"/"))),o=o.updateQuery({get_preview:"1"})}function w(e){return m(e)?u.parse(c.static_url_pdfjs_excel):u.parse(c.static_url_pdfjs_viewer)}function b(e){if(e.ts)return o.getActingTime(1e3*e.ts)}function P(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function C(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function A(e,t){return C(new u({path:"/history"+e.fq_path}),t.id)}function S(e,t){i.UserActivityLogger.log("web","view_version_history");var o=A(e,t);n.redirect(o.toString())}function T(e){return t.VALID_PREVIEW_TYPES.indexOf(e.preview_type)>-1}function I(e){var t=v(e),n=e.bytes,i=Number.MAX_VALUE;return"pdf"===t?i=Number(83886080):"archive"===e.preview_type?i=268435456:"text"===e.preview_type?i=Number(4194304):"linkfile"===e.preview_type?i=Number(10240):n=0,n<i}function O(e){return 0===e.bytes}function R(e){return T(e)&&I(e)}function L(e){var t=v(e);return R(e)&&N(t)}function N(e){var t=y(e);return["doc","ppt","xls","key","eps","ai","indd"].indexOf(t)>-1}function x(e){return["excel","text","doc"].indexOf(e)>-1}function F(e){var t=a.ErrorTypes.LOAD_ERROR;return e===a.RivieraPreviewResponseTypes.UNSUPPORTED_FORMAT?t=a.ErrorTypes.EXTENSION_ERROR:e===a.RivieraPreviewResponseTypes.TOO_BIG?t=a.ErrorTypes.FILE_SIZE_ERROR:e===a.RivieraPreviewResponseTypes.PASSWORD_PROTECTED&&(t=a.ErrorTypes.PASSWORD_PROTECTED_ERROR),t}function D(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}Object.defineProperty(t,"__esModule",{value:!0});t.getIframeQuery=p,t.isPassPerfExperiment=d,t.use_excel2_for_extension=m;t.FLV_CONTAINER="video/flv";t.video_type=h,t.use_hls_video=f,t.is_excel2_file=_,t.get_extension=v,t.get_filename=g,t.normalize_extension=y,t.get_progressive_url=E,t.get_pdf_js_url=w,t.getModifierString=b,t.update_url_for_annotation=P,t.update_url_with_user_id=C,t.getVersionHistoryUrl=A,t.redirectToVersionHistory=S,t.VALID_PREVIEW_TYPES=["photo","video","linkfile","adobecs","doc","excel","html","text","audio","archive","cloud_content"],t.extensionSupported=T,t.filesizeSupported=I,t.isEmptyFile=O,t.isPreviewable=R,t.canGeneratePreview=L,t.extCanGeneratePreview=N,t.usesFrameMessenger=x,t.mapRivieraStatusToErrorType=F,t.generateDucId=function(e){var t,n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{t=crypto.getRandomValues(new Uint8Array(e))}catch(e){t=[]}null==t&&(t=[]);for(var i="",o=0;o<e;++o){var r=void 0;r=e===t.length?t[o]%n.length:Math.floor(Math.random()*n.length),i+=n[r]}return i},t.iOSIframeScrollStyles=D}),define("modules/clean/react/async/loadable",["require","exports","tslib","external/react","modules/core/cancelable_promise"],function(e,t,n,i,o){"use strict";function r(e){var t=e.loader,r=e.loading;return(function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={loaded:!1},t}return n.__extends(s,e),s.prototype.componentDidMount=function(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.loader=o.makeCancelable(t()),[4,this.loader.then(function(t){e.loadedComponent=t,e.setState({loaded:!0})})];case 1:return n.sent(),[2]}})})},s.prototype.componentWillUnmount=function(){this.loader.cancel()},s.prototype.render=function(){return this.state.loaded&&null!=this.loadedComponent?i.createElement(this.loadedComponent,this.props):r?r:null},s.displayName="LoadableComponent",s})(i.Component)}Object.defineProperty(t,"__esModule",{value:!0}),t.Loadable=r}),define("modules/clean/react/breadcrumb/trail",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react/bubble_menu","modules/clean/react/css","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BreadcrumbOverflowPositions=r.BubbleMenu.POSITIONS;var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSegmentClicked=function(e,n){t.onCrumbClicked(e,n)},t.onMenuClicked=function(e,n,i){t.onCrumbClicked(e,n)},t}return n.__extends(t,e),t.prototype.getSplitCrumbs=function(){var e=this.props.crumbs;if(1===e.length)return{overflowCrumbs:[],inlineCrumbs:e};for(var t=this.getMaxInlineTrailWidth(!0),n=e.map(function(e){return new o(e.label).length}),i=1,r=n[e.length-1],s=e.length-2;s>=0;s--){var a=1.64+n[s];if(r+a>t)break;i+=1,r+=a}var l=e.length-i;return{overflowCrumbs:e.slice(0,l),inlineCrumbs:e.slice(l)}},t.prototype.getMaxInlineTrailWidth=function(e){return e?25.375:28},t.prototype.onCrumbClicked=function(e,t){this.props.onChange&&this.props.onChange(e,t,this.props.crumbs.indexOf(t))},t.prototype.render=function(){var e,t=this,n=this.getSplitCrumbs(),o=n.overflowCrumbs,r=n.inlineCrumbs,s=this.getMaxInlineTrailWidth(o.length>0),a=this.props.crumbs[this.props.crumbs.length-1];o.length>0&&(e=i.createElement(m,{crumbs:o,onChange:this.onMenuClicked,overflowDropdownPosition:this.props.overflowDropdownPosition}));var l=r.map(function(e,n){var o=e===a;return i.createElement(f,{key:n,crumb:e,isLastCrumb:o,onClick:t.onSegmentClicked,maxWidth:s})});return i.createElement("span",null,i.createElement("h1",{className:"ax-visually-hidden"},a.label),i.createElement("nav",{className:"breadcrumb-trail u-l-fl","aria-label":c._("Folder Hierarchy"),role:"navigation"},e,l))},t})(i.Component),p=s(u,["/static/css/breadcrumbs-vflLiyKQ8.css"]);t.BreadcrumbTrail=p;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return i.createElement(a,{group:"web",name:"chevron",className:"breadcrumb-separator",alt:""})},t})(i.Component),m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e,n){t.props.onChange&&t.props.onChange(e,n,t.props.crumbs.indexOf(n))},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.crumbs.slice();t.reverse();var n=i.createElement("button",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},i.createElement(a,{group:"web",name:"folder_arrow_32",alt:c._("Show parent folders (descending)")})),o=t.map(function(t,n){return i.createElement(h,{key:n,crumb:t,onClick:e.onClick})});return i.createElement("span",{className:"breadcrumb-menu-container"},i.createElement(r.BubbleMenu,{position:this.props.overflowDropdownPosition,targetButton:n,targetFixed:!0,items:o}),i.createElement(d,null))},t})(i.Component),h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){t.props.onClick&&t.props.onClick(e,t.props.crumb)},t}return n.__extends(t,e),t.prototype.render=function(){var e=o.em_snippet(this.props.crumb.label,37);return i.createElement(r.BubbleMenuItem,{className:"breadcrumb-menu-item",href:this.props.crumb.href,onClick:this.onClick},i.createElement("span",{className:"force-no-break"},i.createElement(l,{group:"web",name:"folder_32",alt:"",text:e})))},t})(i.Component),f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){t.props.onClick&&t.props.onClick(e,t.props.crumb)},t}return n.__extends(t,e),t.prototype.getLabel=function(){return o.em_snippet(this.props.crumb.label,this.props.maxWidth)},t.prototype.render=function(){var e=this.getLabel();return this.props.isLastCrumb?i.createElement("span",{className:"breadcrumb-segment"},e):i.createElement("span",null,i.createElement("a",{className:"breadcrumb-segment",href:this.props.crumb.href,onClick:this.onClick},e),i.createElement(d,null))},t})(i.Component)}),define("modules/clean/react/copy_to_dropbox/actions",["require","exports","tslib","modules/clean/react/copy_to_dropbox/api","modules/core/browser"],function(e,t,n,i,o){"use strict";function r(e,t,r){return n.__awaiter(this,void 0,void 0,function(){var s;return n.__generator(this,function(n){switch(n.label){case 0:return[4,i.copySharedFile(e,t,r)];case 1:return s=n.sent(),o.redirect(s),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.copySharedFile=r}),define("modules/clean/react/copy_to_dropbox/api",["require","exports","modules/clean/ajax_as_promised"],function(e,t,n){"use strict";function i(e,t,i){var o={is_package:e.isPackage,link_key:e.linkKey,link_type:e.linkType,secure_hash:e.secureHash,subpath:e.subPath};return e.itemId&&(o.item_id=e.itemId),new Promise(function(e,r){return n.WebProgressRequest({url:"/sm/c2d",data:o,progress_text:i,subject_user:t,success:e})})}Object.defineProperty(t,"__esModule",{value:!0}),t.copySharedFile=i}),define("modules/clean/react/copy_to_dropbox/modal",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/react/copy_to_dropbox/actions","modules/clean/react/modal","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAccept=function(){var e=t.getProgressMessage();u.success(e),s.copySharedFile(t.props.shareToken,t.props.userId,e)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){o.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.props.fileOrFolder.filename})},t.prototype.getTitle=function(){var e,t=l.get_viewer(),n=this.props.fileOrFolder.filename;if(t.is_paired)switch(this.props.role){case"personal":return e=10,n=r.em_snippet(n,e),c._("Save ‘%(filename)s’ to my personal Dropbox").format({filename:n});case"work":var i=t.team_name,o=new r(i||"").length;return e=Math.max(10,15-o),n=r.em_snippet(n,e),c._("Save ‘%(filename)s’ to my %(team_name)s Dropbox").format({filename:n,team_name:i})}return e=15,n=r.em_snippet(n,e),c._("Save ‘%(filename)s’ to my Dropbox").format({filename:n})},t.prototype.getBodyText=function(){var e=l.get_viewer();if(e.is_paired)switch(this.props.role){case"personal":return this.props.fileOrFolder.is_dir?c._("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):c._("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.");case"work":return this.props.fileOrFolder.is_dir?c._("This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name}):c._("This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name})}return this.props.fileOrFolder.is_dir?c._("This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account."):c._("This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},t.prototype.getProgressMessage=function(){var e=l.get_viewer();if(e.is_paired)switch(this.props.role){case"personal":return c._("Saving to your personal Dropbox...");case"work":return c._("Saving to your %(team_name)s Dropbox...").format({team_name:e.team_name})}return c._("Saving to your Dropbox...")},t.prototype.render=function(){return i.createElement(a.Modal,{title:this.getTitle(),acceptButtonText:c._("Save"),dismissButtonText:c._("Cancel"),onAccept:this.handleAccept,onDismiss:this.props.onDismiss,style:"default-maestro"},i.createElement("p",{className:"db-modal-message"},this.getBodyText()))},t})(i.Component);t.CopyToDropboxModal=p}),function(){define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n){var i,o;return i=t.Annotation,o=(function(){function t(){this.disabled=!1}return t.prototype.set_disabled=function(e){return this.disabled=e},t.prototype.log_event=function(t,i,o,r,s,a,l,c,u){if(null==l&&(l=null),null==c&&(c=null),null==u&&(u=null),
!this.disabled)return n.assert(t,"event_type not provided"),n.assert(i,"file_activity_key not provided"),e.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:i,comment_activity_key:o,client_origin_type:r,activity_context:a,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:s})},t.prototype.log_annotation_event=function(e,t,n,o,r,s){var a,l,c,u;return null==s&&(s=null),null!=s&&(a=i.createAnnotationFromDict(s),u=a.type,c=a.subtype,l=a.getFirstPdfPage()),this.log_event(e,t,n,null,o,r,u,c,l)},t})(),new o})}.call(this),function(){var e=[].slice;define("modules/clean/react/file_comments/onboarding",["external/classnames","external/react","modules/core/i18n","modules/clean/react/image","modules/clean/react/onboarding_modal","modules/clean/static_urls"],function(t,n,i,o,r,s){var a,l,c,u,p,d,m,h;return d=i._,h=s.static_url,m=n.DOM,c=[{src:h("/static/images/commenting/onboarding_step1-vflB01-Fx.png"),srcHiRes:h("/static/images/commenting/onboarding_step1@2x-vflyooTgN.png")},{src:h("/static/images/commenting/onboarding_step2-vflQHsmaO.png"),srcHiRes:h("/static/images/commenting/onboarding_step2@2x-vflEm4vmD.png")},{src:h("/static/images/commenting/onboarding_step3-vflvKl_oO.png"),srcHiRes:h("/static/images/commenting/onboarding_step3@2x-vfljsqrRb.png")}],l=n.createFactory(r),a=n.createFactory(o),p=n.createClass({displayName:"Slide",mixins:[n.addons.PureRenderMixin],statics:{slideImages:c},propTypes:{heading:n.PropTypes.string.isRequired,subheading:n.PropTypes.string.isRequired,image:n.PropTypes.shape({src:n.PropTypes.string.isRequired,srcHiRes:n.PropTypes.string.isRequired}).isRequired,className:n.PropTypes.string},render:function(){return m.div({className:t("comment-onboarding-slide",this.props.className)},a({src:this.props.image.src,srcHiRes:this.props.image.srcHiRes,className:"comment-onboarding-illustration"}),m.h1({className:"comment-onboarding-heading"},this.props.heading),m.h2({className:"comment-onboarding-subheading"},this.props.subheading))}}),u=n.createFactory(p),n.createClass({displayName:"CommentingOnboardingModal",mixins:[n.addons.PureRenderMixin],propTypes:{onOpen:n.PropTypes.func,onClose:n.PropTypes.func},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onOpen?e.onOpen():void 0},getSlides:function(){return[u({className:"comment-slide-1",heading:d("Annotate your files"),subheading:d("Give clear, focused feedback that’s faster than email."),image:c[0]}),u({className:"comment-slide-2",heading:d("Point to what you’re talking about"),subheading:d("Just click anywhere inside the doc, or drag around a specific area."),image:c[1]}),u({className:"comment-slide-3",heading:d("Never lose track of feedback"),subheading:d("Conversations stay with the file, and you can view on any device."),image:c[2]})]},render:function(){return l.apply(null,[{className:"comment-onboarding-modal",slideWidth:600,onClose:this.props.onClose}].concat(e.call(this.getSlides())))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_comments/shared_link_signup_modals",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/react/file_comments/logger","modules/constants/legacy","modules/core/browser","modules/core/i18n","modules/core/notify"],function(t,n,i,o,r,s,a,l){var c,u,p;return u=i.DBModal,p=a._,c=(function(){function t(){this._toggle_form=e(this._toggle_form,this),this._prepare_form=e(this._prepare_form,this),this._reload=e(this._reload,this),this.before_modal=e(this.before_modal,this),this.show_sign_in_modal=e(this.show_sign_in_modal,this),this.show_sign_up_modal=e(this.show_sign_up_modal,this),this.hide_modal=e(this.hide_modal,this),this.init_modals=e(this.init_modals,this),this.show_register=!1,this.init_modals()}return t.POST_COMMENT_VARIANT="post_comment_variant",t.SUBSCRIBE_VARIANT="subscribe_variant",t.prototype.init_modals=function(){return this.default_signup_modal=new u({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},t.prototype.hide_modal=function(){return this.default_signup_modal.hide()},t.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},t.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},t.prototype.set_activity_key=function(e){return this.activity_key=e},t.prototype.before_modal=function(e){var t,n;if(this._prepare_form(e),e.find(".toggle-form-link").click((function(t){return function(){return t._toggle_form(e)}})(this)),n=e.find(".register-form"),n.length&&n.on("db:register:success",(function(e){return function(t,n){return e.user=n,l.success(p("Successfully signed up for Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}})(this)),t=e.find(".login-form"),t.length)return n.length&&n.on("db:register:user_exists",(function(n){return function(i){var o,r,s,a,l;for(n._toggle_form(e),a=i.prefill,l=o=0,s=a.length;o<s;l=++o)r=a[l],t.find(r).val(l);return t.find(i.focus).focus()}})(this)),t.on("db:login:success",(function(e){return function(t,n){return e.user=n,l.success(p("Successfully signed in to Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}})(this))},t.prototype._reload=function(){return s.reload()},t.prototype._prepare_form=function(e){switch(e.find(".form-component").hide(),e.find(".text-variant").hide(),this.show_register?e.find(".register-form-component").show():e.find(".login-form-component").show(),this.variant){case t.POST_COMMENT_VARIANT:return e.find(".text-variant.post-comment-variant").show();case t.SUBSCRIBE_VARIANT:return e.find(".text-variant.subscribe-variant").show();default:return e.find(".text-variant.default-variant").show()}},t.prototype._toggle_form=function(e){var t,n,i;return i=e.find(".register-form-component"),n=e.find(".login-form-component"),i.is(":visible")?(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,i.fadeOut({complete:function(){return n.show()}})):(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,n.fadeOut({complete:function(){return i.show()}})),o.log_event(t,this.activity_key,null,r.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},t})(),{CommentsSharedLinkSignupModals:c}})}.call(this),define("modules/clean/react/file_sidebar/constants",["require","exports","external/react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=n.PropTypes.shape({dispatch:n.PropTypes.func.isRequired,getState:n.PropTypes.func.isRequired,subscribe:n.PropTypes.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","external/react","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i.PropTypes,a=(function(t){function a(n){var i=t.call(this,n)||this,o=e.defined("modules/clean/react/file_sidebar/store/instance"),r=o?e("modules/clean/react/file_sidebar/store/instance").store:void 0;return i.state={loaded:o,store:r},i}return n.__extends(a,t),a.prototype.getChildContext=function(){return e={},e[o.STORE_KEY]=this.state.store,e;var e},a.prototype.componentWillMount=function(){var t=this;r.IS_ON&&!this.state.loaded&&e(["modules/clean/react/file_sidebar/store/instance"],function(e){var n=e.store;t.setState({loaded:!0,store:n})})},a.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},a.prototype.render=function(){return i.Children.only(this.props.children)},a.propTypes={children:s.element.isRequired},a.childContextTypes=(l={},l[o.STORE_KEY]=o.STORE_SHAPE,l),a})(i.Component);t.FileSidebarProvider=a;var l}),define("modules/clean/react/file_viewer/actions",["require","exports","modules/clean/downloads","modules/clean/flux/dispatcher","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,s,a,l){"use strict";function c(e,t,n,r){void 0===r&&(r={}),i.dispatch({type:o.ActionTypes.SETUP,data:{files:e,currentIndex:t,user:n,sharedLinkInfos:r.sharedLinkInfos,shareTokens:r.shareTokens,sharePermissions:r.sharePermissions,disableFlipping:r.disableFlipping}})}function u(){i.dispatch({type:o.ActionTypes.CLEANUP})}function p(e){i.dispatch({type:o.ActionTypes.UPDATE_FILES,data:{files:e}})}function d(){i.dispatch({type:o.ActionTypes.FLIP_NEXT})}function m(){i.dispatch({type:o.ActionTypes.FLIP_PREVIOUS})}function h(){i.dispatch({type:o.ActionTypes.OPEN_FULLSCREEN})}function f(){i.dispatch({type:o.ActionTypes.CLOSE_FULLSCREEN})}function _(e){i.dispatch({type:o.ActionTypes.SWITCH_REVISION,data:{file:e}})}function v(){i.dispatch({type:o.ActionTypes.RESTORE_REVISION})}function g(e){i.dispatch({type:o.ActionTypes.FAST_FORWARD_REVISION,data:{file:e}})}function y(e){var t=l.parse(e.href);t.updateQuery({dl:"1"}),n.get({url:t.toString(),__do_not_use_expected_domain:"dl.dropboxusercontent.com"})}function E(e,t,n){void 0===n&&(n={}),null!=s.FilePreviewSession.currentSession&&r.filePreviewEventEmitter.emit(o.EventTypes.FILE_PREVIEW_USER_ACTION,s.FilePreviewSession.currentSession,e,t,n)}function w(){a.reload(!0)}function b(e){i.dispatch({type:o.ActionTypes.BROADCAST_RENDER_STATUS,data:{newStatus:e}})}function P(){i.dispatch({type:o.ActionTypes.HIDE_OPEN_IN_APP_BANNER})}function C(){i.dispatch({type:o.ActionTypes.CLOSE_PREVIEW_QUALITY_POPUP})}Object.defineProperty(t,"__esModule",{value:!0}),t.setup=c,t.cleanup=u,t.updateFiles=p,t.flipNext=d,t.flipPrevious=m,t.openFullscreen=h,t.closeFullscreen=f,t.switchRevision=_,t.restoreRevision=v,t.fastForwardRevision=g,t.download=y,t.logUserAction=E,t.pendingFileUploaded=w,t.broadcastPreviewRenderStatus=b,t.hideOpenInAppBanner=P,t.closePreviewQualityPopup=C}),define("modules/clean/react/file_viewer/coach_mark",["require","exports","tslib","external/react","modules/clean/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/sharing/views/hover_close_button"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ARROW_POSITION={TOP:"top",TOP_RIGHT:"top-right"};var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentWillMount=function(){o.require_css("/static/css/legacy_packages/components-vflfWNhxV.css"),o.require_css("/static/css/components/coach_mark-vflub6W6p.css")},t.prototype.componentDidMount=function(){this.props.onShown&&this.props.onShown()},t.prototype.renderCloseButton=function(){return this.props.showClose?i.createElement(a,{className:"c-coach-mark__x",onClick:this.props.onCloseButtonClick}):null},t.prototype.renderCoachMarkImage=function(){if(this.props.imageProps){var e=this.props.imageProps,t=e.imageUrl,n=e.imageUrl2x,o=e.imageAlt;return i.createElement(s,{className:"c-coach-mark__img u-pad-right-xs",src:t,srcHiRes:n,alt:o})}return null},t.prototype.renderCoachMarkMessage=function(){return i.createElement("div",{className:"coach-mark_message"},i.createElement("div",{className:"c-coach-mark__header"},this.renderCloseButton(),i.createElement("h4",null,this.props.title)),i.createElement("p",null,this.props.children),i.createElement("button",{className:"button-primary button-small c-coach-mark__button",onMouseUp:this.props.onButtonClick},this.props.buttonText))},t.prototype.render=function(){var e="c-coach-mark bubble-dropdown "+this.props.arrowPosition;return i.createElement("div",{className:e},i.createElement(r.Flag,{leftAttachment:this.renderCoachMarkImage()},this.renderCoachMarkMessage()),i.createElement("div",{className:"bubble-arrow-border"}),i.createElement("div",{className:"bubble-arrow"}))},t.defaultProps={onCloseButtonClick:function(){},showCloseButton:!1},t})(i.Component);t.CoachMark=l}),define("modules/clean/react/file_viewer/constants",["require","exports","modules/clean/react/size_class/constants"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes={SETUP:"SETUP",CLEANUP:"CLEANUP",UPDATE_FILES:"UPDATE_FILES",FLIP_NEXT:"FLIP_NEXT",FLIP_PREVIOUS:"FLIP_PREVIOUS",OPEN_FULLSCREEN:"OPEN_FULLSCREEN",CLOSE_FULLSCREEN:"CLOSE_FULLSCREEN",SWITCH_REVISION:"SWITCH_REVISION",RESTORE_REVISION:"RESTORE_REVISION",FAST_FORWARD_REVISION:"FAST_FORWARD_REVISION",BROADCAST_RENDER_STATUS:"BROADCAST_RENDER_STATUS",HIDE_OPEN_IN_APP_BANNER:"HIDE_OPEN_IN_APP_BANNER",CLOSE_PREVIEW_QUALITY_POPUP:"CLOSE_PREVIEW_QUALITY_POPUP"};(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SUCCEEDED=1]="SUCCEEDED"})(t.PreviewRenderStatuses||(t.PreviewRenderStatuses={})),t.EventTypes={FILE_VIEWER_OPENED:"FILE_VIEWER_OPENED",FILE_PREVIEW_SESSION_ENDED:"FILE_PREVIEW_SESSION_ENDED",FILE_PREVIEW_ATTEMPT_STARTED:"FILE_PREVIEW_ATTEMPT_STARTED",FILE_PREVIEW_SUPPORT_CONFIRMED:"FILE_PREVIEW_SUPPORT_CONFIRMED",FILE_PREVIEW_SUPPORT_DENIED:"FILE_PREVIEW_SUPPORT_DENIED",FILE_PREVIEW_DOWNLOAD_ATTEMPTED:"FILE_PREVIEW_DOWNLOAD_ATTEMPTED",FILE_PREVIEW_DOWNLOAD_SUCCEEDED:"FILE_PREVIEW_DOWNLOAD_SUCCEEDED",FILE_PREVIEW_DOWNLOAD_FAILED:"FILE_PREVIEW_DOWNLOAD_FAILED",FILE_PREVIEW_RENDER_SUCCEEDED:"FILE_PREVIEW_RENDER_SUCCEEDED",FILE_PREVIEW_RENDER_FAILED:"FILE_PREVIEW_RENDER_FAILED",FILE_PREVIEW_PASS_SHOWN:"FILE_PREVIEW_PASS_SHOWN",FILE_PREVIEW_PASS_HOVER:"FILE_PREVIEW_PASS_HOVER",FILE_PREVIEW_PASS_CLICK:"FILE_PREVIEW_PASS_CLICK",BROWSE_PASS_SHOWN:"BROWSE_PASS_SHOWN",BROWSE_PASS_HOVER:"BROWSE_PASS_HOVER",BROWSE_PASS_CLICK:"BROWSE_PASS_CLICK",FILE_PREVIEW_QUALITY_POPUP_ASKED:"FILE_PREVIEW_QUALITY_POPUP_ASKED",FILE_PREVIEW_QUALITY_POPUP_ANSWERED:"FILE_PREVIEW_QUALITY_POPUP_ANSWERED",FILE_PREVIEW_QUALITY_POPUP_DISMISSED:"FILE_PREVIEW_QUALITY_POPUP_DISMISSED",FILE_PREVIEW_FILE_DOWNLOADED:"FILE_PREVIEW_FILE_DOWNLOADED",FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED:"FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED",FILE_PREVIEW_SHOW_CONTENTS_FAILED:"FILE_PREVIEW_SHOW_CONTENTS_FAILED",FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED:"FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED",FILE_PREVIEW_USER_ACTION:"FILE_PREVIEW_USER_ACTION",FILE_PREVIEW_VIDEO_STALLED:"FILE_PREVIEW_VIDEO_STALLED",FILE_PREVIEW_VIDEO_TRUNCATED:"FILE_PREVIEW_VIDEO_TRUNCATED"},t.PathContext={BROWSE:"BROWSE",SHARED_LINK_FILE:"SHARED_LINK_FILE",SHARED_LINK_FOLDER:"SHARED_LINK_FOLDER",SHARED_LINK_COLLECTION:"SHARED_LINK_COLLECTION",VERSION_HISTORY:"VERSION_HISTORY"},t.CannedTestFilenames={EXCEL_HTML:"test-workbook.html"};(function(e){e[e.TITLE_BAR=0]="TITLE_BAR",e[e.PREVIEW_CONTENT=1]="PREVIEW_CONTENT",e[e.SIDEBAR=2]="SIDEBAR"})(t.FileViewerPane||(t.FileViewerPane={})),t.UserActionNames={SHARE:"share",DOWNLOAD:"download",SAVE_TO_DROPBOX:"save_to_dropbox",SAVE_TO_DROPBOX_PERSONAL:"save_to_dropbox_personal",SAVE_TO_DROPBOX_WORK:"save_to_dropbox_work",OPEN_IN_APP:"open_in_app",OPEN_IN_OFFICE_ONLINE:"open_in_office_online",OPEN_IN_UNITY:"open_in_unity",OPEN_IN_UNITY_FOLDER:"open_in_unity_folder",REMOVE_LINK:"remove_link",VIEW_REVISIONS:"view_revisions",CLICK_DROPBOX_LOGO:"click_dropbox_logo",CLICK_CUSTOM_LOGO:"click_custom_logo",TOGGLE_COMMENTS_ON:"toggle_comments_on",TOGGLE_COMMENTS_OFF:"toggle_comments_off",SIGN_IN:"sign_in",CLICK_NOTIFICATIONS:"click_notifications",CLICK_ACCOUNT_MENU:"click_account_menu",TOGGLE_FULLSCREEN_ON:"toggle_fullscreen_on",TOGGLE_FULLSCREEN_OFF:"toggle_fullscreen_off",PRINT:"print",INLINE_SEARCH:"inline_search",FLIP_NEXT:"flip_next",FLIP_PREV:"flip_prev",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out"},t.UserActionContextNames={TITLE_BAR_MAIN:"title_bar_main",TITLE_BAR_SPLIT_BUTTON:"title_bar_open_split_button",TITLE_BAR_MORE:"title_bar_more",PREVIEW_CONTENT_MAIN:"preview_content_main",PREVIEW_CONTENT_SPLIT_BUTTON:"preview_content_open_split_button",TOOLBAR:"toolbar",VIDEO_PLAYER:"video_player",OPEN_IN_APP_BANNER:"open_in_app_banner",OPEN_IN_APP_BUTTON:"open_in_app_button",LIGHTBOX_FRAME:"lightbox_frame",LIGHTBOX_TOOLBAR:"lightbox_toolbar",LIGHTBOX_CLOSE_BUTTON:"lightbox_close_button",SIDEBAR:"sidebar",KEYBOARD:"keyboard",BROWSER:"browser",UNKNOWN:"unknown"};(function(e){e[e.MAIN=0]="MAIN",e[e.SPLIT=1]="SPLIT"})(t.SplitButtonActionLocation||(t.SplitButtonActionLocation={}));t.SizeClassFilenameLengthMap=(i={},i[n.SizeClass.Small]=12,i[n.SizeClass.Medium]=25,i[n.SizeClass.Large]=35,i),t.ResponsiveClassName="responsive-enabled";var i}),define("modules/clean/react/file_viewer/controller",["require","exports","tslib","external/react","external/react-dom","modules/clean/activity/constants","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/constants/python","modules/core/browser","modules/core/dom"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";function _(e,t,r,l,u){if(!y()){A=l;var p=E(u),d={disableFlipping:!!p.disableFlipping,sharedLinkInfos:p.sharedLinkInfos,shareTokens:p.shareTokens,sharePermissions:p.sharePermissions};a.setup(e,t,r,d),s.start(),f.scroll_lock_document();var m=document.getElementById(A);C=o.render(i.createElement(c.FileViewer,n.__assign({},p)),m)}}function v(e){y()&&a.updateFiles(e)}function g(){if(y()){var e=document.getElementById(A);o.unmountComponentAtNode(e),a.cleanup(),f.scroll_unlock_document(),C=null}}function y(){return null!=C}function E(e){var t=n.__assign({},e);if(t.canClose=!0,t.activityContext=w(t.fileViewTarget),null==t.initialPreviewSourceContext&&(t.initialPreviewSourceContext=b()),null==t.initialPreviewSourceAction&&(t.initialPreviewSourceAction=P()),d.RESPONSIVE_FILE_VIEWER_ENABLED){var i=h.is_supported_mobile_browser();t.isMobileUserAgent=i,i&&(t.hideComments=!0)}var o=t.onCloseViewer;return t.onCloseViewer=function(){return g(),"function"==typeof o?o():void 0},t}function w(e){return e===m.FileViewTargetType.SHARED_LINK?r.ActivityContext.SHARED_LINK_VIEW:e===m.FileViewTargetType.SHARED_CONTENT_LINK?r.ActivityContext.SHARED_CONTENT_LINK_VIEW:r.ActivityContext.BROWSE_FILE_VIEWER}function b(){var e=u.determinePathContext();return e===l.PathContext.SHARED_LINK_COLLECTION?p.PreviewSourceContext.SHARED_LINK_COLLECTION:e===l.PathContext.VERSION_HISTORY?p.PreviewSourceContext.VERSION_HISTORY:p.PreviewSourceContext.BROWSE}function P(){var e=u.determinePathContext();return[l.PathContext.SHARED_LINK_FILE,l.PathContext.SHARED_LINK_FOLDER].includes(e)?p.PreviewSourceAction.VISIT:p.PreviewSourceAction.CLICK}Object.defineProperty(t,"__esModule",{value:!0});var C=null,A="";t.open=_,t.updateFiles=v,t.close=g,t.isShown=y}),define("modules/clean/react/file_viewer/data/actions",["require","exports"],function(e,t){"use strict";function n(e){return{type:e?t.Actions.OpenFullScreen:t.Actions.CloseFullScreen}}Object.defineProperty(t,"__esModule",{value:!0}),t.Actions={OpenFullScreen:"OpenFullScreen",CloseFullScreen:"CloseFullScreen"},t.setFullScreen=n}),define("modules/clean/react/file_viewer/data/reducer",["require","exports","tslib","modules/clean/react/file_viewer/data/actions"],function(e,t,n,i){"use strict";function o(e,t){switch(void 0===e&&(e=r),t.type){case i.Actions.OpenFullScreen:return n.__assign({},e,{data:n.__assign({},e.data,{isFullScreen:!0})});case i.Actions.CloseFullScreen:return n.__assign({},e,{data:n.__assign({},e.data,{isFullScreen:!1})});default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_VIEWER_REDUCER_KEY="FILE_VIEWER_REDUCER";var r={data:{isFullScreen:!1}};t.fileViewerReducer=o}),define("modules/clean/react/file_viewer/data/selectors",["require","exports","modules/clean/react/file_viewer/data/reducer"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e[n.FILE_VIEWER_REDUCER_KEY]};t.getIsFullScreen=function(e){return i(e).data.isFullScreen}}),define("modules/clean/react/file_viewer/data/store",["require","exports","modules/clean/redux/store","modules/clean/react/file_viewer/data/reducer"],function(e,t,n,i){"use strict";function o(){return n.getStoreAndRegisterReducers((e={},e[i.FILE_VIEWER_REDUCER_KEY]=i.fileViewerReducer,e));var e}Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFileViewer=o}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return i.createElement("div",{className:"fileviewer-upsell-banner"},a.reactFormat(s._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:i.createElement("a",{href:e})}))},t})(i.Component);t.ExpFileViewerUpsellBannerV2=o(l,["/static/css/exp_file_preview_upsell-vflq1COh7.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/utils","modules/clean/react/gutter_attributions/controller","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_error","modules/clean/react/previews/archive/preview_archive","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/preview_video","modules/clean/react/previews/preview_pdf","modules/clean/react/previews/preview_pdf_ssr","modules/core/i18n","modules/core/browser","modules/core/exception","modules/constants/file_viewer"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C,A,S,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={fallbackToPdfJs:!1,hasError:!1},t.windowCloseHandler=function(){t.logPreviewSessionEnded(d.PreviewSessionEndReasons.BEFORE_UNLOAD)},t.startLogger=function(){t.frameMessenger=new m.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t.onFrameMessage=function(e){switch(e.action){case"pagerendered":r.logPageRendered(t.props.file,e.parameters)}},t.logPreviewSessionEnded=function(e){void 0===e&&(e=d.PreviewSessionEndReasons.UNKNOWN);var n={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:d.getSessionEndReasonLoggingKey(e)};t.state.filePreviewSession.recordEvent(a.EventTypes.FILE_PREVIEW_SESSION_ENDED,n)},t.onContextMenu=function(e){e.preventDefault()},t.triggerError=function(e){t.setState({hasError:!0,errorType:e})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){u.areFilesEqual(e.file,this.props.file)||(this.setState({hasError:!1,errorType:void 0}),this.logPreviewSessionEnded(d.PreviewSessionEndReasons.NEW_FILE),this.startNewFilePreviewSession(e))},t.prototype.componentWillMount=function(){this.startNewFilePreviewSession(this.props)},t.prototype.componentDidMount=function(){this.startLogger(),window.addEventListener("beforeunload",this.windowCloseHandler),window.setTimeout(u.cleanupPrerenderPreview)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(d.PreviewSessionEndReasons.UNMOUNT),this.stopLogger(),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.setUpFilePreviewLogger=function(e){this.teardownFilePreviewLogger(),this.filePreviewTimelineLogger=new o.FilePreviewTimelineLogger(e.id),this.filePreviewTimelineLogger.listenTo(l.filePreviewEventEmitter),this.filePreviewUserActionLogger=new o.FilePreviewUserActionLogger,this.filePreviewUserActionLogger.listenTo(l.filePreviewEventEmitter)},t.prototype.startNewFilePreviewSession=function(e){var t=e.file,n=e.sourceContext,i=e.sourceAction,o=new c.FilePreviewSession({fileViewerSession:c.FileViewerSession.currentSession,file:t,isMounted:!this.props.sharedLinkUrl,sourceContext:n,sourceAction:i});c.FilePreviewSession.currentSession=o,this.setState({filePreviewSession:o}),this.setUpFilePreviewLogger(o),null!==t.ns_id&&o.recordEvent(a.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED)},t.prototype.teardownFilePreviewLogger=function(){null!=this.filePreviewTimelineLogger&&this.filePreviewTimelineLogger.unlistenTo(l.filePreviewEventEmitter),this.filePreviewUserActionLogger&&this.filePreviewUserActionLogger.unlistenTo(l.filePreviewEventEmitter)},t.prototype.renderImagePreview=function(){var e,t=this,o=this.props.file,r=s.get_extension(o),a=o.preview_url||o.thumbnail_url_tmpl;if(null==a)return this.renderUnsupportedErrorPreview();if(this.props.sharePermissions&&this.props.sharePermissions.canViewContextMenuRoles&&0===this.props.sharePermissions.canViewContextMenuRoles.length&&(e=this.onContextMenu),this.props.isFullscreen)return i.createElement(y.PreviewImageZoom,{thumbnailUrlTmpl:a,fileExtension:r,isFlippable:!0,filePreviewSession:this.state.filePreviewSession,onContextMenu:e,fileName:s.get_filename(this.props.file)});var l={"preview-url":a,"file-extension":s.get_extension(o),isFullscreen:this.props.isFullscreen,supportsAnnotations:this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return t.triggerError(d.ErrorTypes.LOAD_ERROR)},onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onContextMenu:e,commentsActionCreators:this.props.commentsActionCreators,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:s.get_filename(this.props.file),sizeClass:this.props.sizeClass};return i.createElement(g.PreviewImageWithAnnotations,n.__assign({},l))},t.prototype.renderVideoPreview=function(){var e=this.props.file;return i.createElement(w.PreviewVideo,{previewUrl:e.video_transcode_url,thumbnailUrlTmpl:e.thumbnail_url_tmpl,videoMetadataUrl:e.video_metadata_url,videoContainer:e.video_container,isFullscreen:this.props.isFullscreen,shouldDisplayAnnotationsToolbar:this.props.shouldDisplayAnnotationsToolbar,shouldFocusOnReady:this.props.shouldFocusOnReady,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext})},t.prototype.renderLinkfilePreview=function(){var e=this.props.file;return i.createElement(E.PreviewLinkfile,{filename:s.get_filename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.state.filePreviewSession})},t.prototype.renderPDFPreview=function(){var e=this,t=this.props.file;if(!this.state.fallbackToPdfJs&&t.preview_ssr_text_url_tmpl&&t.preview_ssr_image_url_tmpl){var n=function(t){T.PW_PROTECTED_PDFSSR_ENABLED?e.triggerError(t):(e.state.filePreviewSession&&(e.state.filePreviewSession.didFallbackToPdfjs=!0),e.setState({fallbackToPdfJs:!0}))},o=i.createElement(P.PreviewPdfSSR,{commentsActionCreators:this.props.commentsActionCreators,fileExtension:s.get_extension(t),fileHref:t.href,filePreviewSession:this.state.filePreviewSession,imageUrl:t.preview_ssr_image_url_tmpl,isFullscreen:this.props.isFullscreen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:n,isErrorRecoverable:!0,previewThumbnailUrl:t.preview_thumbnail_url,previewType:t.preview_type,refreshUrl:t.preview_ssr_refresh_url||void 0,src:t.direct_blockserver_link,sharePermissions:this.props.sharePermissions,sizeClass:this.props.sizeClass,textUrl:t.preview_ssr_text_url_tmpl});return T.PREVIEW_ATTRIBUTIONS_ENABLED&&(o=i.createElement(p.GutterAttributionsController,{file:this.props.file,viewingUser:this.props.user},o)),o}var r=s.get_extension(t);return i.createElement(b.PreviewPDF,{commentsActionCreators:this.props.commentsActionCreators,fileExtension:r,fileHref:t.href,filePreviewSession:this.state.filePreviewSession,fqPath:u.isBrowseFile(t)?t.fq_path:void 0,isFullscreen:this.props.isFullscreen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,previewType:t.preview_type,previewUrl:t.preview_url,src:t.direct_blockserver_link,thumbnailUrl:t.preview_thumbnail_url,userId:null!=this.props.user?this.props.user.id:void 0,sharePermissions:this.props.sharePermissions,sizeClass:this.props.sizeClass})},t.prototype.renderHTMLPreview=function(){var e=this.props.file,t=s.get_extension(e),n=e.direct_blockserver_link;if("excel"===e.preview_type&&n){var o=s.normalize_extension(t);n=s.get_progressive_url(o,n).toString()}else n=e.htmlified_link||n;if(!n)return this.renderUnsupportedErrorPreview();var r=s.usesFrameMessenger(e.preview_type);return i.createElement(v.PreviewHTML,{src:n,filename:s.get_filename(this.props.file),previewType:e.preview_type,isFullscreen:this.props.isFullscreen,onError:this.triggerError,fileExtension:t,usesFrameMessenger:r,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession,commentsActionCreators:this.props.commentsActionCreators,sizeClass:this.props.sizeClass})},t.prototype.renderAudioPreview=function(){return i.createElement(_.PreviewAudio,{bytes:this.props.file.bytes,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError,src:this.props.file.direct_blockserver_link})},t.prototype.renderArchivePreview=function(){return i.createElement(f.PreviewArchive,{file:this.props.file,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError,navigationEnabled:T.DOCPREVIEW_ARCHIVE_NAVIGATION_ENABLED,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermissions})},t.prototype.renderCloudContentPreview=function(){return this.props.file.preview_url?(A.replace_location(this.props.file.preview_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(d.ErrorTypes.SUPPORT_ERROR)},t.prototype.getErrorMessage=function(e,t){if(t&&"sketch"===s.get_extension(t)&&e===d.ErrorTypes.LOAD_ERROR)return C._("This file can’t be previewed. Previews are                 only available for files created in Sketch v43 and up.")},t.prototype.renderErrorPreview=function(e,t){var n=this.getErrorMessage(e,t),o=this.props.shouldDisplayAnnotationsToolbar&&u.FlippableHelpers.isFlippableFile(this.props.file);return i.createElement(h.PreviewError,{file:this.props.file,maxFilenameEmLength:this.props.maxFilenameEmLength,filePreviewSession:this.state.filePreviewSession,errorType:e,user:this.props.user,areActionablesEnabled:this.props.areActionablesEnabled,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,shouldDisplayAnnotationsToolbar:o,index:this.props.index,isMobileUserAgent:this.props.isMobileUserAgent,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,message:n})},t.prototype.choosePreview=function(){if(null===this.props.file.ns_id)return this.renderErrorPreview(d.ErrorTypes.PENDING_UPLOAD_ERROR);if(this.props.file.is_dir)return this.renderErrorPreview(d.ErrorTypes.EXTENSION_ERROR)
;if(s.isEmptyFile(this.props.file)&&"cloud_content"!==this.props.file.preview_type)return this.renderErrorPreview(d.ErrorTypes.EMPTY_FILE_ERROR);if(!s.extensionSupported(this.props.file))return this.renderErrorPreview(d.ErrorTypes.EXTENSION_ERROR);if(!s.filesizeSupported(this.props.file))return this.renderErrorPreview(d.ErrorTypes.FILE_SIZE_ERROR);var e=s.get_extension(this.props.file);switch(this.props.file.preview_type){case"photo":return this.renderImagePreview();case"video":return this.renderVideoPreview();case"linkfile":return this.renderLinkfilePreview();case"adobecs":case"doc":return"indd"===e?this.renderErrorPreview(d.ErrorTypes.EXTENSION_ERROR):this.renderPDFPreview();case"excel":return s.use_excel2_for_extension(e)?this.renderPDFPreview():this.renderHTMLPreview();case"html":case"text":return this.renderHTMLPreview();case"audio":return this.renderAudioPreview();case"archive":return this.renderArchivePreview();case"cloud_content":return this.renderCloudContentPreview();default:S.assert(!1,"Preview type "+this.props.file.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}return null},t.prototype.render=function(){return this.state.hasError?this.renderErrorPreview(this.state.errorType,this.props.file):this.choosePreview()},t.defaultProps={user:null,isFullscreen:!1,sharePermissions:null,areActionablesEnabled:!0},t})(i.Component);t.FilePreview=I}),define("modules/clean/react/file_viewer/file_preview_event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filePreviewEventEmitter=new n}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","external/classnames","external/keymaster","external/react","external/react-dom","external/underscore","external/react-redux","modules/clean/react/file_viewer/data/selectors","external/react-redux","modules/clean/react/file_viewer/data/store","modules/clean/react/async/loadable","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/analytics","modules/clean/comments/action_creators","modules/clean/comments/demo_action_creators","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/history","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_comments/logger","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/file_viewer/title_bar","modules/clean/react/file_viewer/utils","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/constants/file_activity_stream","modules/constants/python","modules/core/dom","modules/core/uri","modules/core/browser","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C,A,S,T,I,O,R,L,N,x,F,D,k,M,U,W,B,V,H,K,z,q,j){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var G=d.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/paper/open_in_paper_banner"],t,n)}).then(function(e){return e.OpenInPaperBanner})}}),Z="",Y="",Q=(function(t){function l(){var i=null!==t&&t.apply(this,arguments)||this;return i._isMounted=!1,i.state=n.__assign({fileSidebarLoaded:e.defined("modules/clean/react/file_sidebar/file_sidebar"),previewSourceContext:i.props.initialPreviewSourceContext,previewSourceAction:i.props.initialPreviewSourceAction},i.getStateFromStore()),i.onUpdateFromStore=function(){i.setState(i.getStateFromStore)},i.focusInViewer=function(){if(!i.props.shouldFocusCommentInput){var e=s.findDOMNode(i).querySelector(".button-primary");if(e)e.focus();else{var t=V.getTabbableElementsIn(".react-file-viewer");t.length&&t[0].focus()}}},i.flipNext=function(){C.flipNext()},i.flipPrevious=function(){C.flipPrevious()},i.setupKeymaster=function(){L.FlippableHelpers.isFlippableFile(i.state.currentFile)&&(o("left","fileviewer",function(){i.flipPrevious(),C.logUserAction(A.UserActionNames.FLIP_PREV,A.UserActionContextNames.KEYBOARD)}),o("right","fileviewer",function(){i.flipNext(),C.logUserAction(A.UserActionNames.FLIP_NEXT,A.UserActionContextNames.KEYBOARD)})),o("esc","fileviewer",function(e){V.focus_in_input()||V.is_input(e.target)||document.querySelector(".annotation-bubble")||null!=i.props.onCloseViewer&&i.props.onCloseViewer()}),Z=o.getScope(),o.setScope("fileviewer")},i.cleanupKeymaster=function(){o.clearScope("fileviewer"),o.setScope(Z)},i}return n.__extends(l,t),l.prototype.componentWillMount=function(){var t=this;this.setUpLogging(),this.props.hidePageChrome||(W.IS_ON?e(["modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/store/instance","modules/clean/react/file_sidebar/store/app/actions"],function(e,n,i){e.FileSidebar;n.store.dispatch(i.setState({hideComments:t.props.hideComments,hidePageChrome:t.props.hidePageChrome,isCommentsDemo:t.props.isCommentsDemo})),t._isMounted&&t.setState({fileSidebarLoaded:!0})}):this.state.fileSidebarLoaded||e(["modules/clean/react/file_sidebar/file_sidebar"],function(){t._isMounted&&t.setState({fileSidebarLoaded:!0})})),this.props.isCommentsDemo?b.set_disabled(!0):v.initInstance()},l.prototype.componentDidMount=function(){this._isMounted=!0,null!=this.props.onComponentDidMount&&this.props.onComponentDidMount(),this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),this.removeStoreListener=O.FileViewerStore.instance.addListener(this.onUpdateFromStore),this.setupPreviewUrl(this.state.currentFile),this.preloadImages(this.state.files,this.state.currentIndex),this.setDocumentTitle(E.get_filename(this.state.currentFile),!0),V.scroll_lock_document(),y.start(),this.logView()},l.prototype.componentWillUpdate=function(e,t){var n=t.currentFile;n!==this.state.currentFile&&(this.updatePreviewUrl(n),this.setDocumentTitle(E.get_filename(n)),this.preloadImages(t.files,t.currentIndex)),o.setScope("fileviewer")},l.prototype.componentDidUpdate=function(e,t){L.areFilesEqual(t.currentFile,this.state.currentFile)||this.logView()},l.prototype.componentWillUnmount=function(){this.removeStoreListener(),this.teardownPreviewUrl(),this.unsetDocumentTitle(),V.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),N.Modal.close(),this._isMounted=!1},l.prototype.shouldSuppressPassInfo=function(){return this.props.isCommentsDemo||null==this.state.currentFile.ns_id},l.prototype.getStateFromStore=function(e){var t={currentIndex:O.FileViewerStore.instance.getCurrentIndex(),currentFile:O.FileViewerStore.instance.getCurrentFile(),files:O.FileViewerStore.instance.getFiles(),sharedLinkInfo:O.FileViewerStore.instance.getSharedLinkInfo(),sharePermissions:O.FileViewerStore.instance.getSharePermissions(),shareToken:O.FileViewerStore.instance.getShareToken(),showOverQuotaUpsell:O.FileViewerStore.instance.shouldShowOQUpsell(),showPreviewQualityPopup:O.FileViewerStore.instance.shouldShowPreviewQualityPopup(),showViewInAppBanner:O.FileViewerStore.instance.shouldShowOpenInAppBanner(),user:O.FileViewerStore.instance.getUser()};return e&&!L.areFilesEqual(e.currentFile,t.currentFile)&&(t.previewSourceContext=F.PreviewSourceContext.FILE_VIEWER,t.previewSourceAction=F.PreviewSourceAction.CLICK),t},l.prototype.setUpLogging=function(){if(I.FileViewerSession.currentSession=new I.FileViewerSession,this.props.fileViewTarget===B.FileViewTargetType.SHARED_CONTENT_LINK){var e=M.start_time(),t=(new Date).getTime();this.state.user&&h.ShareTibEventLogger.log(this.state.user.id,"PREVIEW_RENDER","PREVIEW_PAGE",{timing:t-e,containing_ns_id:this.state.currentFile.ns_id,sjid:this.state.currentFile.sjid})}},l.prototype.setupPreviewUrl=function(e){this.props.skipOuterRouting||this.setPreviewUrl(e)},l.prototype.updatePreviewUrl=function(e){this.setPreviewUrl(e,!1)},l.prototype.teardownPreviewUrl=function(){this.props.skipOuterRouting||this.unsetPreviewUrl()},l.prototype.setPreviewUrl=function(e,t){if(void 0===t&&(t=!0),!this.props.disableRouting){var n=E.get_filename(e),i=H.parse(g.get_url()),o=H.encode_parts(i.getPath()),r=i.removeQuery("select").updateQuery({preview:n}).getQuery();t?g.push_state(o,r,{immediatelyRestoreState:!1}):g.replace_state(o,r)}},l.prototype.unsetPreviewUrl=function(){if(!this.props.disableRouting){var e=H.parse(g.get_url()),t=H.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery();g.push_state(t,n,{immediatelyRestoreState:!1})}},l.prototype.preloadImages=function(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(i){var o=(t+i+e.length)%e.length;n.indexOf(o)===-1&&n.push(o)}),n.forEach(function(t){if(e.length>t&&"photo"===e[t].preview_type){var n=e[t],i=n.preview_url||n.thumbnail_url_tmpl;i&&D.preloadImage(i).then(function(e){var n=I.FileViewerSession.currentSession;null==n||t in n.imagesFetched||(n.imagesFetched[t]=e)})}})}},l.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),this.props.isCommentsDemo||(t&&(Y=document.title),document.title=e)},l.prototype.unsetDocumentTitle=function(){this.props.isCommentsDemo||""!==Y&&(document.title=Y)},l.prototype.logView=function(){if(null!==this.state.currentFile.ns_id&&L.determinePathContext()!==A.PathContext.SHARED_LINK_COLLECTION&&!this.props.hidePageChrome){var e=!1;this.state.sharePermissions&&this.state.sharePermissions.canDownloadRoles&&(e=0===this.state.sharePermissions.canDownloadRoles.length),y.logView(this.state.currentFile,this.state.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.state.sharedLinkInfo?this.state.sharedLinkInfo.url:void 0,e)}},l.prototype.getCommentsActionCreators=function(){return this.props.isCommentsDemo?_:f},l.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===z.SizeClass.Small)&&(!this.props.hidePageChrome||this.props.isCommentsDemo)},l.prototype.renderFlippableControls=function(){if(L.FlippableHelpers.isFlippableFile(this.state.currentFile)&&!this.props.isFullscreen&&!this.isImagePreviewAnnotationEnabled())return r.createElement(T.FlippableControls,{index:""+(this.state.currentIndex+1),numFlippableFiles:this.state.files.length,onNext:this.flipNext,onPrevious:this.flipPrevious})},l.prototype.renderOpenInPaperBanner=function(){var e=!this.state.sharedLinkInfo,t=e||this.state.sharePermissions&&this.state.sharePermissions.canDownloadRoles.length>0,n=!!this.state.user&&!this.state.user.is_paper_disabled;if(U.OPEN_IN_PAPER_VARIANT in["VARIANT_A","ON"]&&n&&t&&this.props.sizeClass===z.SizeClass.Large&&!this.props.isFullscreen&&!this.props.hidePageChrome){var i=this.state.sharedLinkInfo?"shared_file_actions":"mounted_file_actions",o=this.state.sharedLinkInfo?this.state.sharedLinkInfo.url:void 0;return r.createElement(G,{file:this.state.currentFile,sharedLink:o,source:i})}return null},l.prototype.renderFilePreview=function(){var e=this.state.showViewInAppBanner&&!this.props.hidePageChrome;return K.is_tablet()&&(e=e&&L.renderOpenInAppAsBanner()),r.createElement("div",{className:"react-file-viewer__preview react-file-preview"},r.createElement("div",{className:"flex-preview-container"},this.renderPreviewQualityPopup(),e&&r.createElement(x.OpenInAppBanner,{urls:this.state.currentFile.open_in_app_data,onClose:C.hideOpenInAppBanner}),r.createElement(S.FilePreview,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.state.currentFile.ns_id,commentsActionCreators:this.getCommentsActionCreators(),count:this.state.files.length,file:this.state.currentFile,fileViewAction:this.props.fileViewAction,fileViewTarget:this.props.fileViewTarget,fileViewOrigin:this.props.fileViewOrigin,index:this.state.currentIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,maxFilenameEmLength:A.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onNext:this.flipNext,onPrevious:this.flipPrevious,sharedLinkInfo:this.state.sharedLinkInfo,sharePermissions:this.state.sharePermissions,shareToken:this.state.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.state.previewSourceAction,sourceContext:this.state.previewSourceContext,sharedLinkUrl:null!=this.state.sharedLinkInfo?this.state.sharedLinkInfo.url:void 0,shouldDisplayAnnotationsToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.state.user}),this.renderFlippableControls()))},l.prototype.renderSidebar=function(){if(this.state.fileSidebarLoaded&&this.props.sizeClass===z.SizeClass.Large&&!this.props.isFullscreen&&!this.props.hidePageChrome){var t=e("modules/clean/react/file_sidebar/file_sidebar").FileSidebar;return r.createElement(t,{activityContext:this.props.activityContext,currentFile:this.state.currentFile,headerComponent:this.props.sidebarHeaderComponent,hideComments:this.props.hideComments,hidePageChrome:this.props.hidePageChrome,isCommentsDemo:this.props.isCommentsDemo,isVersionHistoryMode:this.props.isVersionHistoryMode,sharedLinkInfo:this.state.sharedLinkInfo,shouldInitiallyFocusInput:this.props.shouldFocusCommentInput,user:this.state.user})}return null},l.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome?null:r.createElement("div",{className:"react-file-viewer__title-bar"},r.createElement(R.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,file:this.state.currentFile,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isDemoMode:this.props.isCommentsDemo,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,maxFilenameEmLength:A.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onRestoreRevision:this.props.onRestoreRevision,sharedLinkInfo:this.state.sharedLinkInfo,sharePermissions:this.state.sharePermissions,shareToken:this.state.shareToken,sizeClass:this.props.sizeClass,user:this.state.user||null,onMount:this.focusInViewer}),this.renderUpsellBanner())},l.prototype.shouldAllowFileDonation=function(){return null==this.state.sharedLinkInfo&&(null==this.state.user||this.state.user.home_ns_id===this.state.currentFile.ns_id)},l.prototype.renderPreviewQualityPopup=function(){var e=this.props.sizeClass===z.SizeClass.Small;return this.props.hidePageChrome||!this.state.showPreviewQualityPopup||e?null:r.createElement(k.PreviewQualityPopup,{file:this.state.currentFile,showProbability:U.PREVIEW_QUALITY_POPUP_PROBABILITY,allowFileDonation:this.shouldAllowFileDonation()})},l.prototype.renderViewer=function(){var e=E.get_filename(this.state.currentFile),t=i("react-file-viewer",this.props.className,{"no-background":this.props.transparentBackground&&!this.props.isFullscreen});return r.createElement("div",{className:t,role:"dialog","aria-label":e},this.renderTitleBar(),this.renderOpenInPaperBanner(),r.createElement("div",{className:"react-file-viewer__content"},this.renderFilePreview(),this.renderSidebar()))},l.prototype.renderUpsellBanner=function(){return this.state.showOverQuotaUpsell?r.createElement(m.ExpFileViewerUpsellBannerV2,null):null},l.prototype.render=function(){var e=this.renderViewer();return r.createElement(j.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},W.IS_ON?r.createElement(P.FileSidebarProvider,null,e):e)},l.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",disableRouting:!1,hideComments:!1,hidePageChrome:!1,isCommentsDemo:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:B.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:z.SizeClass.Large,skipOuterRouting:!1},l})(r.Component);t.FileViewerWithoutCss=Q;var X=q.withSizeClass(Q,{isResponsiveEnabled:L.isResponsiveEnabled,responsiveClassName:A.ResponsiveClassName}),J=l.connect(function(e){return{isFullscreen:c.getIsFullScreen(e)}})(X),$=p.getStoreForFileViewer(),ee=function(e){return r.createElement(u.Provider,{store:$},r.createElement(J,n.__assign({},e)))},te=["/static/css/preview_archive-vflUMeaLl.css","/static/css/preview_image_with_annotations-vflex8M7t.css","/static/css/preview_pdf-vfl7H-lqY.css","/static/css/preview_flexbox_layout-vflHOeSGP.css","/static/css/preview_linkfile-vflLAlKbW.css","/static/css/preview_quality_popup-vflyrlOUZ.css","/static/css/preview_toolbar-vflyy2h8i.css","/static/css/react_file_viewer-vflnV9-8n.css","/static/css/react_title_bar-vflH7AUmg.css","/static/css/spectrum/index-vflGnGWGn.css"];t.FileViewer=w(ee,te)}),define("modules/clean/react/file_viewer/file_viewer_interface_controller",["require","exports","tslib","external/eventemitter3","modules/clean/annotations/annotation_message_transformer","modules/clean/comments/models/preview_types","modules/clean/frame_messenger/frame_messenger_proxy","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/frame_messenger_host"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=["annotation-hidden","annotation-placed","annotation-start-drag","annotation-end-drag","annotation-ui-enter","annotation-ui-over","annotation-ui-leave","annotation-ui-click","annotation-enter","annotation-leave","page-rendered","scroll","scale-change","on-keydown","mouse-up"],p=["file-preview-scroll-to-annotation","file-preview-update-annotation-creation","file-preview-update-annotation-region-creation","file-preview-remove-annotation","file-preview-reload-annotations","file-preview-unload-annotations","file-preview-load-annotations","file-preview-remove-annotation-draft","file-preview-finalize-annotation-draft","file-preview-change-file"],d=(function(){function e(e,t,s,c){var u=this;switch(this.setupFilePreviewEventListeners=function(e){var t=u.buildPreviewEventHandler(e,"file-preview-render-succeeded"),n=u.buildPreviewEventHandler(e,"file-preview-render-failed"),i=u.buildPreviewEventHandler(e,"file-preview-download-failed"),o=u.buildPreviewEventHandler(e,"file-preview-support-denied"),r=u.buildPreviewEventHandler(e,"file-preview-video-metadata",{is_truncated:!0});u.filePreviewEventHandlers[a.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]=t,u.filePreviewEventHandlers[a.EventTypes.FILE_PREVIEW_RENDER_FAILED]=n,u.filePreviewEventHandlers[a.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]=i,u.filePreviewEventHandlers[a.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]=o,u.filePreviewEventHandlers[a.EventTypes.FILE_PREVIEW_VIDEO_TRUNCATED]=r;for(var s in u.filePreviewEventHandlers)if(u.filePreviewEventHandlers.hasOwnProperty(s)){var c=u.filePreviewEventHandlers[s];l.filePreviewEventEmitter.addListener(s,c)}},this.buildPreviewEventHandler=function(e,t,i){return void 0===i&&(i={}),function(){var o=n.__assign({},i,{protectedToken:u.protectedToken});e.postMessageToParent(t,o)}},this.handleMessageFromParent=function(e){u.proxyMessageFromParent(e)},this.prepareImageInterface=function(){window.addEventListener("message",u.handleMessageFromWindow)},this.handleMessageFromChild=function(e){u.eventEmitter.emit(e.action,e.parameters),u.frameMessengerProxy&&u.proxyMessageFromChild(e)},this.proxyMessageFromChild=function(e){var t=o.transformLegacyChildActions(e);u.frameMessengerProxy.postToParentMessenger(t)},this.proxyMessageFromParent=function(e){var t=o.transformParentActions(e);u.frameMessengerProxy.postToChildMessenger(t)},this.handleMessageFromWindow=function(e){var t;try{t=JSON.parse(e.data),u.eventEmitter.emit(t.action,t.parameters)}catch(e){}},this.eventEmitter=new i,this.previewType=e,this.previewSelector=t,this.parentFrameMessenger=s,this.filePreviewEventHandlers={},this.protectedToken=c,this.parentFrameMessenger&&(this.prepareParentMessenger(this.parentFrameMessenger),this.setupFilePreviewEventListeners(this.parentFrameMessenger)),this.previewType){case r.PDF:this.preparePdfInterface(this.parentFrameMessenger);break;case r.IMAGE:this.prepareImageInterface()}}return e.prototype.cleanupPreviewEventListeners=function(){for(var e in this.filePreviewEventHandlers)if(this.filePreviewEventHandlers.hasOwnProperty(e)){var t=this.filePreviewEventHandlers[e];l.filePreviewEventEmitter.removeListener(e,t)}this.filePreviewEventHandlers={}},e.prototype.addListener=function(e,t){this.eventEmitter.on(e,t)},e.prototype.removeListener=function(e,t){this.eventEmitter.off(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.dispatchEvent=function(e,t){switch(this.previewType){case r.PDF:this.frameMessenger.postMessageToChildren(e,t);break;case r.IMAGE:window.postMessage(JSON.stringify({action:e,parameters:t}),"*")}},e.prototype.destroy=function(){switch(this.eventEmitter.removeAllListeners(),this.parentFrameMessenger&&this.parentFrameMessenger.stopListening(),this.cleanupPreviewEventListeners(),this.previewType){case r.PDF:this.frameMessenger&&this.frameMessenger.stopListening();break;case r.IMAGE:window.removeEventListener("message",this.handleMessageFromWindow)}},e.prototype.preparePdfInterface=function(t){e.frameMessengerFactory?this.frameMessenger=e.frameMessengerFactory():this.frameMessenger=new c.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("#pdf-embed-iframe",this.handleMessageFromChild,u),this.frameMessenger.startListening(),t&&this.prepareMessageProxy(t,this.frameMessenger)},e.prototype.prepareParentMessenger=function(e){e.configureParentMessaging(this.handleMessageFromParent,p),e.startListening()},e.prototype.prepareMessageProxy=function(e,t){this.frameMessengerProxy=new s.FrameMessengerProxy(t,e)},e.setFrameMessengerFactory=function(t){e.frameMessengerFactory=t},e})();t.FileViewerInterfaceController=d}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=r._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=r._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return i.createElement("div",{className:"react-file-viewer__controls"},i.createElement("button",{className:"nav-control",alt:e,onClick:this.handlePreviousClick},i.createElement(o,{group:"web",name:"s_flip_left",alt:e})),i.createElement("div",{className:"nav-text"},this.getNavText()),i.createElement("button",{className:"nav-control",alt:t,onClick:this.handleNextClick},i.createElement(o,{group:"web",name:"s_flip_right",alt:t})))},t})(i.Component);t.FlippableControls=s}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r){"use strict";function s(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("msfullscreenchange",e),document.addEventListener("mozfullscreenchange",e)}function a(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("msfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e)}function l(e){window.addEventListener("popstate",e)}function c(e){window.removeEventListener("popstate",e)}function u(){var e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function p(){var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}function d(){b.dispatch(i.setFullScreen(!0))}function m(){b.dispatch(i.setFullScreen(!1))}function h(){w()||y(r.UserActionContextNames.BROWSER)}function f(){y(r.UserActionContextNames.BROWSER)}function _(){s(h),l(f)}function v(){a(h),c(f)}function g(e,t){d(),e&&(u(),_()),t&&o.logUserAction(r.UserActionNames.TOGGLE_FULLSCREEN_ON,t)}function y(e){v(),m(),p(),e&&o.logUserAction(r.UserActionNames.TOGGLE_FULLSCREEN_OFF,e)}function E(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen}function w(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}Object.defineProperty(t,"__esModule",{value:!0});var b=n.getStoreForFileViewer();t.enterFullScreen=g,t.exitFullScreen=y,t.browserSupportFullScreen=E,t.isBrowserFullscreen=w}),define("modules/clean/react/file_viewer/models",["require","exports","tslib","external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/constants","modules/clean/uuid","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/browser","modules/core/exception"],function(e,t,n,i,o,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={};d[o.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]=null,d[o.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]=o.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,d[o.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]=o.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,d[o.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]=o.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,d[o.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=o.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,d[o.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]=o.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,d[o.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]=o.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,d[o.EventTypes.FILE_PREVIEW_RENDER_FAILED]=o.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED;var m=i.Record({id:void 0,sourceContext:void 0,isSharedLink:!1}),h=(function(e){function t(t,n){var i=e.call(this,{id:t||a.v4({allowInsecure:!0})})||this;return i.imagesFetched=n||{},i.deviceType=i._deviceTypeString(),i}return n.__extends(t,e),t.prototype._deviceTypeString=function(){return u.is_supported_mobile_browser()?"mobile":u.is_tablet()?"tablet":"desktop"},t.currentSession=null,t})(m);t.FileViewerSession=h;var f=(function(){function e(e){var t=e.id,n=e.fileViewerSession,i=e.file,o=e.sourceContext,r=e.sourceAction,s=e.isMounted;this.ssrTiming={},this.ssrTimestamps={},p.assert(!!n,"FileViewerSession required"),p.assert(!!i,"File required"),this.id=t||a.v4({allowInsecure:!0}),this.fileViewerSession=n,this.file=i,this.sourceContext=o,this.sourceAction=r,this.previewTimeline={},this.lastEvent=null,this.pagesRendered={},this.zoomScales=[],this.passwordNeeded=!1,this.isMounted=s}return e.prototype.recordEvent=function(e,t){if(void 0===t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");if(o.EventTypes.hasOwnProperty(e)&&!this._isEventInTimeline(e)){if(d.hasOwnProperty(e)&&this.lastEvent!==d[e])return void(c.FILE_VIEWER_LOGGER_ERRORS&&p.reportStack("FilePreviewLogger event called out of order",{tags:["file_preview_logger_bad_event_order"],severity:p.SEVERITY.NONCRITICAL,exc_extra:{event:e,filePreviewSessionId:this.id,fileViewerSessionId:this.fileViewerSession.id,lastEvent:this.lastEvent,previewTimeline:this.previewTimeline,sourceAction:this.sourceAction,sourceContext:this.sourceContext}}));this._addToTimeline(e),r.filePreviewEventEmitter.emit(e,this,t),this.lastEvent=e}},e.prototype.markPrimaryEvent=function(){var e;e=window._timingData&&window._timingData.tti?window._timingData.tti.getTime():u.now(),this.primaryMarkTs||(this.primaryMarkTs=e)},e.prototype.markSecondaryEvent=function(){this.primaryMarkTs&&!this.secondaryMarkTs&&(this.secondaryMarkTs=u.now())},e.prototype.timeToPrimaryMark=function(){return this.timeToMark(this.primaryMarkTs)},e.prototype.timeToSecondaryMark=function(){return this.timeToMark(this.secondaryMarkTs)},e.prototype.logSSREvent=function(e){void 0===this.ssrTimestamps[e]&&(this.ssrTimestamps[e]=u.now())},e.prototype.timeToMark=function(e){if(void 0!==e)switch(this.sourceAction){case s.PreviewSourceAction.VISIT:var t=l.start_time();if(void 0!==t)return e-t;return;case s.PreviewSourceAction.CLICK:var n=this.previewTimeline[o.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED];if(!n)return;var i=n.timestamp;if(void 0===i)return;return e-i}},e.prototype._isEventInTimeline=function(e){return e in this.previewTimeline},e.prototype._addToTimeline=function(e){this.previewTimeline[e]={timestamp:u.now()}},e.currentSession=null,e})();t.FilePreviewSession=f}),define("modules/clean/react/file_viewer/open_button",["require","exports","tslib","external/classnames","external/react","modules/clean/open_with","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button_coachmark","modules/clean/react/file_viewer/unity_utils","modules/clean/react/file_viewer/utils","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={coachmarkHidden:!1,unityInfo:null},t.mounted=!1,t.hideCoachmark=function(){t.setState({coachmarkHidden:!0})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,u.UnityHelpers.isUnityEnabled()&&this.setupUnity()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.setupUnity=function(){var e=this;if(this.props.isUnityDisabled)return void this.disableUnity();u.UnityHelpers.getUnityFileInfo(this.props.file.ns_id,this.props.file.ns_path,this.props.user.id,function(t){e.mounted&&e.setState({unityInfo:t})},function(){e.disableUnity()}),window.setTimeout(function(){null===e.state.unityInfo&&e.disableUnity()},1e4)},t.prototype.disableUnity=function(){this.mounted&&this.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1}})},t.prototype.hasUnityFolderSupport=function(){return!this.props.isUnityDisabled&&null!==this.state.unityInfo&&(!!this.state.unityInfo.is_locally_available||!!this.state.unityInfo.is_infinite_placeholder)&&u.UnityHelpers.clientSupportsOpenInFileBrowser()},t.prototype.hasUnityFileSupport=function(){return!this.props.isUnityDisabled&&null!==this.state.unityInfo&&!!this.state.unityInfo.is_locally_available&&this.state.unityInfo.can_open_directly!==!1},t.prototype.hasOpenWithSupport=function(){return!this.props.isOpenWithDisabled&&p.OpenWithHelpers.canOpenWith(this.props.file,this.props.user)},t.prototype.getNumEnabled=function(){return(this.hasOpenWithSupport()?1:0)+(this.hasUnityFileSupport()?1:0)+(this.hasUnityFolderSupport()?1:0)},t.prototype.isDropdownDisabled=function(){return this.getNumEnabled()<2},
t.prototype.isButtonDisabled=function(){return null===this.state.unityInfo},t.prototype.getFileBrowserLabel=function(){var e=(null!==this.state.unityInfo?this.state.unityInfo.file_browser_display_name:void 0)||m._("File Browser");return m._("Show in %(file_browser)s").format({file_browser:e})},t.prototype.getNativeAppLabel=function(){var e=(null!==this.state.unityInfo?this.state.unityInfo.open_application_name:void 0)||m._("Desktop");return m._("Open in %(app_name)s").format({app_name:e})},t.prototype.onClickAnyOpenButtonType=function(e){this.hideCoachmark(),this.props.onClick&&this.props.onClick(e)},t.prototype.getActionContext=function(e){return null!==this.props.location?p.getSplitButtonUserActionContext(e,this.props.location)||l.UserActionContextNames.UNKNOWN:l.UserActionContextNames.UNKNOWN},t.prototype.handleUnityFileClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n);var i=t.props.file;u.UnityHelpers.openFile(i.ns_id,i.ns_path,t.props.user.id,!1),a.logUserAction(l.UserActionNames.OPEN_IN_UNITY,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleUnityFolderClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n);var i=t.props.file;u.UnityHelpers.openFile(i.ns_id,i.ns_path,t.props.user.id,!0),a.logUserAction(l.UserActionNames.OPEN_IN_UNITY_FOLDER,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleOpenWithClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n),p.OpenWithHelpers.openWith(t.props.file,t.props.user),a.logUserAction(l.UserActionNames.OPEN_IN_OFFICE_ONLINE,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleDownloadClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n),a.download(t.props.file),a.logUserAction(l.UserActionNames.DOWNLOAD,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.renderCoachmark=function(e,t){var n=null;return this.state.coachmarkHidden||(n=o.createElement(c.OpenButtonCoachmark,{file:this.props.file,user:this.props.user,inDropdown:t})),o.createElement("div",{className:"c-coach-mark__container"},e,n)},t.prototype.renderMainButton=function(){var e={"c-btn":!0,"c-split-btn":!this.isDropdownDisabled(),"c-split-btn--left":!this.isDropdownDisabled(),control__button:!0,disabled:this.isButtonDisabled()};if(e["button-"+this.props.importance]=!0,e["c-btn--"+this.props.importance]=!0,this.hasUnityFileSupport()){e["open-button__unity"]=!0;var t=o.createElement("button",{className:i(e),onClick:this.handleUnityFileClick(l.SplitButtonActionLocation.MAIN)},m._("Open")),n=void 0;return null!==this.state.unityInfo&&(n=this.state.unityInfo.open_application_identifier),r.is_adobe_app(n)?this.renderCoachmark(t,!1):t}if(this.hasUnityFolderSupport())return e["open-button__unity-folder"]=!0,o.createElement("button",{className:i(e),onClick:this.handleUnityFolderClick(l.SplitButtonActionLocation.MAIN)},m._("Open"));if(this.hasOpenWithSupport()&&!this.isButtonDisabled()){e["open-button__open-with"]=!0;var s=o.createElement("button",{className:i(e),onClick:this.handleOpenWithClick(l.SplitButtonActionLocation.MAIN)},m._("Open"));return this.renderCoachmark(s,!1)}return this.isButtonDisabled()?o.createElement("button",{className:i(e),"aria-label":""}):(e["open-button__download"]=!0,o.createElement("button",{className:i(e),onClick:this.handleDownloadClick(l.SplitButtonActionLocation.MAIN)},m._("Download")))},t.prototype.renderDropdownButton=function(){var e={"c-btn":!0,"download-button":!0,control__button:!0,disabled:this.isButtonDisabled()};e["button-"+this.props.importance]=!0,e["c-btn--"+this.props.importance]=!0;var t=!1,n=null!==this.state.unityInfo?this.state.unityInfo.open_application_identifier:void 0;this.hasUnityFileSupport()&&r.is_adobe_app(n)?t=!0:this.hasOpenWithSupport()&&!this.isButtonDisabled()&&(t=!0);var s=o.createElement("button",{className:i(e)},m._("Open ▾"));return t?this.renderCoachmark(s,!0):s},t.prototype.renderMenu=function(e){var t=p.OpenWithHelpers.getOpenWithHandlerData(this.props.file,this.props.user),n=null;this.hasUnityFileSupport()&&(n=o.createElement("li",null,o.createElement("a",{href:"#",className:"open-button__unity",onClick:this.handleUnityFileClick(l.SplitButtonActionLocation.SPLIT)},o.createElement(d,{group:"web",name:"ow_desktop",text:this.getNativeAppLabel()}))));var i=null;this.hasOpenWithSupport()&&(i=o.createElement("li",null,o.createElement("a",{href:"#",className:"open-button__open-with",onClick:this.handleOpenWithClick(l.SplitButtonActionLocation.SPLIT)},o.createElement(d,{group:"web",name:null!=t?t.icon:void 0,text:null!=t?t.name:void 0}))));var r=null;return this.hasUnityFolderSupport()&&(r=o.createElement("li",null,o.createElement("a",{href:"#",className:"open-button__unity-folder",onClick:this.handleUnityFolderClick(l.SplitButtonActionLocation.SPLIT)},o.createElement(d,{group:"web",name:"ow_folder",text:this.getFileBrowserLabel()})))),o.createElement(s,{targetButton:e,arrow_position:this.props.justifyRight?"top-right":"top",extra_css_class:"react-file-viewer-dropdown",vertical_displacement:4,bubbleDropdownShown:this.hideCoachmark},o.createElement("ul",{className:"dropdown-contents"},n,i,r))},t.prototype.render=function(){var e;return e=this.isDropdownDisabled()?this.renderMainButton():this.renderMenu(this.renderDropdownButton()),o.createElement("div",{className:"open-button"},e)},t.defaultProps={isUnityDisabled:!1,isOpenWithDisabled:!1,justifyRight:!0,onClick:null,location:null,importance:"secondary"},t})(o.Component);t.OpenButton=h}),define("modules/clean/react/file_viewer/open_button_coachmark",["require","exports","tslib","external/react","modules/clean/previews/util","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/utils","modules/clean/react_format","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c){"use strict";function u(e,t){if("msft"===t)switch(e){case"word":return _;case"excel":return f;case"powerpoint":return h}if("adbe"===t)switch(e){case"acrobat_or_reader":return m}return null}Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){return a.reactFormat(e,{strong:i.DOM.strong()})},d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.setCoachmarkConfig=function(e,n){t.setState({vendor:e,application:n})},t.clearCoachmarkConfig=function(){t.setCoachmarkConfig(void 0,void 0)},t.onReceiveTooltipInfo=function(e){var n=o.get_extension(t.props.file),i=s.TooltipHelpers.getVendorAndApplication(e,n);if(null!==i){var r=i.vendor,a=i.application;t.setCoachmarkConfig(r,a)}},t.hasCoachmark=function(){return t.state.vendor&&t.state.application},t.dismissCoachmark=function(){t.clearCoachmarkConfig()},t.onCoachmarkShown=function(){var e=o.get_extension(t.props.file);s.TooltipHelpers.logImpression(e,t.props.user.id,t.state.application)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){s.TooltipHelpers.fetchTooltipInfo(this.props.user.id,this.onReceiveTooltipInfo)},t.prototype.render=function(){if(!this.hasCoachmark)return null;var e=this.state,t=e.application,n=e.vendor,o=u(t,n);if(!o)return null;var s=o.dropdownBody,a=o.imageUrl,l=o.imageUrl2x,p=o.imageAlt,d=o.openButtonBody,m=o.title,h={imageUrl:a,imageUrl2x:l,imageAlt:p};return i.createElement(r.CoachMark,{arrowPosition:r.ARROW_POSITION.TOP_RIGHT,buttonText:c._("Got it."),imageProps:h,onButtonClick:this.dismissCoachmark,onShown:this.onCoachmarkShown,title:m},this.props.inDropdown?s:d)},t})(i.Component);t.OpenButtonCoachmark=d;var m={title:c._("Want to edit this PDF?"),imageUrl:l.static_url("/static/images/file_viewer/coach_mark_pdf-vflIMdX1a.png"),imageUrl2x:l.static_url("/static/images/file_viewer/coach_mark_pdf@2x-vflUkcAgn.png"),imageAlt:c._("An illustration of a PDF file"),openButtonBody:p(c._("You’re looking at a preview. To open this file for editing, click <strong>Open</strong>.")),dropdownBody:c._("You’re looking at a preview. To open this file for editing, click here.")},h={title:c._("Edit shared presentations together"),imageUrl:l.static_url("/static/images/file_viewer/coach_mark_pptx-vfltjppV8.png"),imageUrl2x:l.static_url("/static/images/file_viewer/coach_mark_pptx@2x-vflpvn3tE.png"),imageAlt:c._("An illustration of a Powerpoint file"),openButtonBody:p(c._("Click <strong>open</strong> to edit together in Microsoft PowerPoint Online.")),dropdownBody:p(c._("Choose <strong>Microsoft PowerPoint Online</strong> to edit together."))},f={title:c._("Edit shared spreadsheets together"),imageUrl:l.static_url("/static/images/file_viewer/coach_mark_xlsx-vflaEwaN7.png"),imageUrl2x:l.static_url("/static/images/file_viewer/coach_mark_xlsx@2x-vflkU3Ma1.png"),imageAlt:c._("An illustration of an Excel file"),openButtonBody:p(c._("Click <strong>open</strong> to edit together in Microsoft Excel Online.")),dropdownBody:p(c._("Choose <strong>Microsoft Excel Online</strong> to edit together."))},_={title:c._("Edit shared docs together"),imageUrl:l.static_url("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:l.static_url("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:c._("An illustration of a Word file"),openButtonBody:p(c._("Click <strong>open</strong> to edit together in Microsoft Word Online.")),dropdownBody:p(c._("Choose <strong>Microsoft Word Online</strong> to edit together."))}}),define("modules/clean/react/file_viewer/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/flux/dispatcher","modules/core/browser","modules/constants/file_viewer"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t){var n=e.call(this,t)||this;return n.files=[],n.currentIndex=0,n.sharedLinkInfos={},n.shareTokens={},n.sharePermissions={},n.isFullscreen=!1,n.renderStatuses={},n.openInAppBannerClosed=!1,n.previewQualityPopupClosed={},n.cachedLatestRevision=null,n.disableFlipping=!1,n.expSubgrowthOverquotaFilePreview=null,n}return n.__extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.INSTANCE},enumerable:!0,configurable:!0}),t.prototype.getFiles=function(){return this.files},t.prototype.getCurrentIndex=function(){return this.currentIndex},t.prototype.getUser=function(){return this.user},t.prototype.getSharedLinkInfo=function(){return this.sharedLinkInfos[s.revisionKey(this.getCurrentFile())]},t.prototype.getShareToken=function(){return this.shareTokens[s.revisionKey(this.getCurrentFile())]},t.prototype.getSharePermissions=function(){return this.sharePermissions[s.revisionKey(this.getCurrentFile())]},t.prototype.getIsFullscreen=function(){return this.isFullscreen},t.prototype.getCurrentFile=function(){return this.files[this.currentIndex]},t.prototype.getIsViewingLatestRevision=function(){return!this.cachedLatestRevision},t.prototype.renderStatus=function(){return this.getCurrentFile()?this.renderStatuses[s.revisionKey(this.getCurrentFile())]:r.PreviewRenderStatuses.UNKNOWN},t.prototype.shouldShowPreviewQualityPopup=function(){if(c.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)return!1;var e=s.revisionKey(this.getCurrentFile()),t=this.renderStatuses[e]===r.PreviewRenderStatuses.SUCCEEDED,n=this.previewQualityPopupClosed[e]===!1;return t&&n},t.prototype.shouldShowOpenInAppBanner=function(){if(this.openInAppBannerClosed||l.safari)return!1;var e=this.getCurrentFile();return!!e&&!!e.open_in_app_data},t.prototype.shouldShowOQUpsell=function(){return"V2"===this.expSubgrowthOverquotaFilePreview},t.prototype.setup=function(e){this.user=e.user,this.disableFlipping=e.disableFlipping,void 0!==e.files&&void 0!==e.currentIndex&&this.updateFiles(e.files[e.currentIndex],{files:e.files},e.sharedLinkInfos,e.shareTokens,e.sharePermissions),this.fetchSubgrowthProOverquotaFilePreviewVariant()},t.prototype.updateFiles=function(e,t,n,i,o){if(void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===o&&(o=[]),t.files){this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={};for(var a=0;a<t.files.length;a++){var l=s.revisionKey(t.files[a]);n.length>a&&(this.sharedLinkInfos[l]=n[a]),i.length>a&&(this.shareTokens[l]=i[a]),o.length>a&&(this.sharePermissions[l]=o[a]),this.renderStatuses[l]=r.PreviewRenderStatuses.UNKNOWN,this.previewQualityPopupClosed[l]=this.previewQualityPopupClosed[l]||!1}var c=s.FlippableHelpers.isFlippableFile(e),u=this.getFileIndex(t.files,e)>=0;!this.disableFlipping&&c&&u?(this.files=s.FlippableHelpers.filterFlippableFiles(t.files),this.currentIndex=this.getFileIndex(this.files,e)):(this.files=[e],this.currentIndex=0),this.__emitChange()}},t.prototype.cleanup=function(){this.files=[],this.currentIndex=0,this.user=void 0,this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={},this.isFullscreen=!1,this.cachedLatestRevision=null},t.prototype.nextFile=function(){this.restoreRevision(),this.currentIndex===this.files.length-1?this.currentIndex=0:this.currentIndex=this.currentIndex+1,this.__emitChange()},t.prototype.previousFile=function(){this.restoreRevision(),0===this.currentIndex?this.currentIndex=this.files.length-1:this.currentIndex=this.currentIndex-1,this.__emitChange()},t.prototype.setIsFullscreen=function(e){this.isFullscreen=e,this.__emitChange()},t.prototype.switchRevision=function(e){this.cachedLatestRevision||(this.cachedLatestRevision=this.files[this.currentIndex]),this.files[this.currentIndex]=e.file,this.__emitChange()},t.prototype.restoreRevision=function(){this.cachedLatestRevision&&(this.files[this.currentIndex]=this.cachedLatestRevision,this.cachedLatestRevision=null,this.__emitChange())},t.prototype.fastForwardRevision=function(e){this.cachedLatestRevision=e.file,this.__emitChange()},t.prototype.updateRenderStatus=function(e){this.getCurrentFile()&&(this.renderStatuses[s.revisionKey(this.getCurrentFile())]=e.newStatus,this.__emitChange())},t.prototype.markPreviewQualityPopupAsClosed=function(){this.previewQualityPopupClosed[s.revisionKey(this.getCurrentFile())]=!0,this.__emitChange()},t.prototype.markOpenInAppBannerAsClosed=function(){this.openInAppBannerClosed=!0,this.__emitChange()},t.prototype.fetchSubgrowthProOverquotaFilePreviewVariant=function(){var e=this;this.user&&o.SilentBackgroundRequest({url:"/get_file_preview_upsell_variant",data:{_subject_uid:this.user.id},success:function(t){try{var n=JSON.parse(t);n&&n.variant&&(e.expSubgrowthOverquotaFilePreview=n.variant,e.__emitChange())}catch(e){}}})},t.prototype.getFileIndex=function(e,t){for(var n=0;n<e.length;n++)if(s.areFilesEqual(t,e[n]))return n;return-1},t.prototype.__onDispatch=function(e){switch(e.action.type){case r.ActionTypes.SETUP:this.setup(e.action.data);break;case r.ActionTypes.CLEANUP:this.cleanup();break;case r.ActionTypes.UPDATE_FILES:this.updateFiles(this.getCurrentFile(),e.action.data);break;case r.ActionTypes.FLIP_NEXT:this.nextFile();break;case r.ActionTypes.FLIP_PREVIOUS:this.previousFile();break;case r.ActionTypes.OPEN_FULLSCREEN:this.setIsFullscreen(!0);break;case r.ActionTypes.CLOSE_FULLSCREEN:this.setIsFullscreen(!1);break;case r.ActionTypes.FAST_FORWARD_REVISION:this.fastForwardRevision(e.action.data);break;case r.ActionTypes.SWITCH_REVISION:this.switchRevision(e.action.data);break;case r.ActionTypes.RESTORE_REVISION:this.restoreRevision();break;case r.ActionTypes.BROADCAST_RENDER_STATUS:this.updateRenderStatus(e.action.data);break;case r.ActionTypes.CLOSE_PREVIEW_QUALITY_POPUP:this.markPreviewQualityPopupAsClosed();break;case r.ActionTypes.HIDE_OPEN_IN_APP_BANNER:this.markOpenInAppBannerAsClosed()}},t.INSTANCE=new t(a),t})(i);t.FileViewerStore=u}),define("modules/clean/react/file_viewer/title_bar",["require","exports","external/react","modules/clean/react/async/loadable"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TitleBar=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/title_bar_component"],t,n)}).then(function(e){return e.TitleBar})},loading:n.createElement("div",{className:"react-title-bar"})})}),define("modules/clean/react/file_viewer/unity_utils",["require","exports","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,n,i){"use strict";function o(){return null!=i}function r(e,t){return!!n.is_cached_and_locally_available(e,t)}function s(){return i.client_supports_open_in_file_browser()}function a(e,t){return n.get(e,t)}function l(e,t){var n=function(n){e.file_browser_display_name=n,t(e)},o=function(){return t(e)};i.file_browser_display_name(n,o)}function c(e,t,n,o,r){var s=function(e){e.is_locally_available?l(e,o):o(e)};i.check_file(e,t,n,s,r)}function u(e,n,i,o,r){if(t.UnityHelpers.isFileInUnityCache(e,n)){var s=t.UnityHelpers.getFileInfoFromUnityCache(e,n);s.is_locally_available&&null==s.file_browser_display_name?l(s,o):o(s)}else t.UnityHelpers.fetchUnityFileInfo(e,n,i,o,r)}function p(e,t,n,o){i.open_file(e,t,n,i.standard_open_file_handler,function(e){return i.standard_open_file_handler(!1)},o)}Object.defineProperty(t,"__esModule",{value:!0}),t.UnityHelpers={isUnityEnabled:o,isFileInUnityCache:r,clientSupportsOpenInFileBrowser:s,getFileInfoFromUnityCache:a,fetchUnityFileInfo:c,getUnityFileInfo:u,openFile:p}}),define("modules/clean/react/file_viewer/utils",["require","exports","modules/clean/ajax","modules/core/browser","modules/clean/open_with","modules/clean/react/file_viewer/constants","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,i,o,r,s,a){"use strict";function l(e,t){return e.ns_id===t.ns_id&&e.sjid===t.sjid}function c(e){return e.ns_id+":"+e.sjid}function u(e){return"fq_path"in e}function p(e){return A.indexOf(e.preview_type)>-1}function d(e){return Array.isArray(e)?e.filter(function(e){return p(e)}).map(function(e){return e}):[]}function m(e,t){return s.WOPI_BUTTON_VISIBLE&&e.bytes<=o.MAX_SUPPORTED_FILE_SIZE_B&&null!==o.get_open_handler_for(e,t)}function h(e,t){return o.get_open_handler_for(e,t)}function f(e,t){var n=h(e,t),o=n.uri+"?hpt_click_ts="+Date.now();i.redirect(o)}function _(e,t){n.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function v(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o],s=r.extensions;if(s.indexOf(t)>-1)return{vendor:n,application:o}}}return null}function g(e,t,i){"acrobat_or_reader"===i?n.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:i,extension:e},subject_user:t}):n.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:i,extension:e},subject_user:t})}function y(e,t){if(e===r.SplitButtonActionLocation.MAIN){if(t===r.FileViewerPane.TITLE_BAR)return r.UserActionContextNames.TITLE_BAR_MAIN;if(t===r.FileViewerPane.PREVIEW_CONTENT)return r.UserActionContextNames.PREVIEW_CONTENT_MAIN}else if(e===r.SplitButtonActionLocation.SPLIT){if(t===r.FileViewerPane.TITLE_BAR)return r.UserActionContextNames.TITLE_BAR_SPLIT_BUTTON;if(t===r.FileViewerPane.PREVIEW_CONTENT)return r.UserActionContextNames.PREVIEW_CONTENT_SPLIT_BUTTON}return r.UserActionContextNames.UNKNOWN}function E(){var e=i.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?r.PathContext.BROWSE:/^\/(s|scl\/fi)\//.test(e)?r.PathContext.SHARED_LINK_FILE:/^\/(sh|scl\/fo)\//.test(e)?r.PathContext.SHARED_LINK_FOLDER:/^\/sc\//.test(e)?r.PathContext.SHARED_LINK_COLLECTION:/^\/history/.test(e)?r.PathContext.VERSION_HISTORY:""}function w(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}function b(){return s.QUIP_VARIANT.indexOf("LOW_RES_THUMB")>=0}function P(){return new a({path:"/login",query:{cont:i.get_href()}}).toString()}function C(){return"BANNER"===s.OPEN_IN_APP_VARIANT}Object.defineProperty(t,"__esModule",{value:!0});var A=["photo","video"];t.areFilesEqual=l,t.revisionKey=c,t.isBrowseFile=u,t.FlippableHelpers={isFlippableFile:p,filterFlippableFiles:d},t.OpenWithHelpers={canOpenWith:m,getOpenWithHandlerData:h,openWith:f},t.TooltipHelpers={fetchTooltipInfo:_,getVendorAndApplication:v,logImpression:g},t.getSplitButtonUserActionContext=y,t.determinePathContext=E,t.isResponsiveEnabled=function(){var e=E();return e!==r.PathContext.VERSION_HISTORY&&e!==r.PathContext.SHARED_LINK_COLLECTION&&(!(e===r.PathContext.BROWSE&&!s.RESPONSIVE_FILE_VIEWER_ENABLED)&&(!(e===r.PathContext.SHARED_LINK_FOLDER&&!s.RESPONSIVE_FOLDER_SHARED_LINK_ENABLED)&&!(e===r.PathContext.SHARED_LINK_FILE&&!s.RESPONSIVE_SHARED_LINK_ENABLED)))},t.cleanupPrerenderPreview=w,t.quipLowResThumbEnabled=b,t.getSharedLinkLoginUrl=P,t.renderOpenInAppAsBanner=C}),define("modules/clean/react/gutter_attributions/attribution",["require","exports","tslib","external/react","modules/clean/avatar/style"],function(e,t,n,i,o){"use strict";function r(e){return 100*e+"%"}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"top",{get:function(){return r(this.props.attribution.area.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return r(this.props.attribution.area.height)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.props.account?o.colorValueForAvatarName(this.props.account.name.displayName):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initials",{get:function(){return this.props.account?this.props.account.name.abbreviatedName:null},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e={top:this.top,height:this.height,color:this.color};return i.createElement("div",{className:"gutter-attributions-attribution",style:e},this.initials)},t})(i.Component);t.GutterAttributionsAttribution=s}),define("modules/clean/react/gutter_attributions/container",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/gutter_attributions/attribution"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.attributions.map(function(t,n){var o=e.props.accounts[t.accountId];return i.createElement(r.GutterAttributionsAttribution,{key:n,attribution:t,account:o})});return i.createElement("div",{className:"preview-document-page-gutter"},i.createElement("div",{className:"gutter-attributions-container"},t))},t})(i.Component),a=o(s,["/static/css/preview/gutter_attributions-vfl5ihuF3.css"]);t.GutterAttributionsContainer=a}),define("modules/clean/react/gutter_attributions/controller",["require","exports","tslib","external/react","modules/clean/accounts/store","modules/clean/attributions/actions","modules/clean/attributions/store","modules/clean/comments/models/preview_types","modules/clean/react/file_viewer/file_viewer_interface_controller"],function(e,t,n,i,o,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.onUpdateFromStore=function(){n.setState(n.getStateFromStore())},n.state=n.getStateFromStore(),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.unsubscribeFromAttributions=s.attributionsStore.addListener(this.onUpdateFromStore),this.unsubscribeFromAccounts=o.accountsStore.addListener(this.onUpdateFromStore),this.props.viewingUser&&r.loadAttributionsForFile(this.props.viewingUser,this.props.file)},t.prototype.componentDidMount=function(){this.fileViewerInterfaceController=new l.FileViewerInterfaceController(a.PDF,".react-file-viewer__preview .flex-preview-container"),this.sendAnnotations()},t.prototype.componentWillUpdate=function(e){e.viewingUser&&e.file!==this.props.file&&r.loadAttributionsForFile(e.viewingUser,e.file)},t.prototype.componentDidUpdate=function(e,t){this.sendAnnotations()},t.prototype.componentWillUnmount=function(){this.unsubscribeFromAttributions(),this.unsubscribeFromAccounts()},t.prototype.getStateFromStore=function(){var e=s.attributionsStore.getAttributionsForFile(this.props.file);return{attributions:e,accounts:e?e.map(function(e){return o.accountsStore.get(e.accountId)}).filter(function(e){return!!e}):[]}},t.prototype.sendAnnotations=function(){this.fileViewerInterfaceController.dispatchEvent("set-attributions",{attributions:this.state.attributions,accounts:this.state.accounts})},t.prototype.render=function(){return this.props.children?i.Children.only(this.props.children):null},t})(i.Component);t.GutterAttributionsController=c}),define("modules/clean/react/icon",["require","exports","tslib","external/classnames","external/react","external/spectrum/icon_content","external/spectrum/file_icon","modules/clean/react/icon/icon_helper","modules/clean/react/sprite","modules/constants/rebrand"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICON_SIZES=a.ICON_SIZES;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.alt,n=e.className,r=e.name;return o.createElement(l,{alt:t,className:i(["icon",n]),group:"web",name:r})},t.defaultProps={alt:"",className:""},t})(o.PureComponent),p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.alt,n=e.className,i=e.filename,r=e.size;return c.USE_SPECTRUM_ICONS?o.createElement(s.FileIcon,{alt:t,className:n,path:i,variant:a.to_spectrum_icon_size(r)}):o.createElement(u,{alt:t,className:n,name:a.file_icon(i,{size:r})})},t.defaultProps={size:a.ICON_SIZES.LARGE},t})(o.PureComponent);t.FileIcon=p;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.alt,n=e.className,i=e.size;return c.USE_SPECTRUM_ICONS?o.createElement(r.IconContent,{alt:t,className:n,name:a.spectrum_folder_icon({size:i})}):o.createElement(u,{alt:t,className:n,name:a.folder_icon({size:i})})},t.defaultProps={size:a.ICON_SIZES.LARGE},t})(o.PureComponent);t.FolderIcon=d}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/underscore","modules/clean/keycode"],function(e,t,n,i,o){"use strict";function r(e){return n.__assign({},t.genericKeyboardEventCriteria,{which:e})}function s(e){return n.__assign({},y,{which:e})}function a(e){return{keyboardEventCriteria:n.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:E}}function l(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}}function c(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}}function u(e){return n.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})}function p(e,t){return[(n={which:e},n[t]=!0,n),(i={which:e},i[t]=!1,i)];var n,i}function d(e){return function(t){return p(t,e)}}function m(e){return i.flatten(e.map(d("shiftKey")))}function h(e,t){return e.map(function(e){return a({keyboardEventCriteria:e,callback:t})})}function f(e){return h(w,e)}function _(e){return h(b,e)}function v(e){return void 0!==e.preventDefault}function g(e){return function(t){e(),v(t)&&t.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var y={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(y),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=r,t.generateUnmodifiedSimpleKeyboardEvent=s;var E=function(){};t.hydrateKeyboardBinding=a,t.getKeyboardEventCriteria=l,t.getSimpleKeyboardEvent=c,t.addLegacyPropertiesToSimpleKeyboardEvent=u;var w=m([o.KeyCode.EQUALS,o.KeyCode.PLUS_EQUALS_FF,o.KeyCode.PLUS_CHROME,o.KeyCode.PLUS_EQUALS_FF_GERMAN]),b=m([o.KeyCode.MINUS_FF_MAC,o.KeyCode.MINUS_FF,o.KeyCode.MINUS_CHROME]);t.getEqualsKeyBindings=f,t.getMinusKeyBindings=_,t.isKeyboardEvent=v,t.withPreventDefault=g}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","external/react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(t,n){var i=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return i}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=o.KeyboardBindingProviderContextTypes,t})(i.Component);t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","external/react","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode"],function(e,t,n,i,o,r){"use strict";function s(e){var t=o.getKeyboardEventCriteria(e),n="";return o.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function a(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,i=t.callback,o=s(n);return e[o]=e[o]||[],e[o].push(i),e},e)},{})}function l(e){var t=o.addLegacyPropertiesToSimpleKeyboardEvent(e);u.forEach(function(e){return e(t)})}function c(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,i=e.which,o="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,s=["submit","button"].indexOf(t.type)!==-1,a=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();return!(o&&!s||a)||(i===r.KeyCode.ESC||i===r.KeyCode.TAB)}Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:i.PropTypes.func,registerKeyBindings:i.PropTypes.func,unregisterKeyBindings:i.PropTypes.func,updateKeyBindings:i.PropTypes.func};var u=[];t.noop=function(e){};var p=(function(e){function o(n){var i=e.call(this,n)||this;return i.registrationIdentifier=0,i.registeredBindings=[],i.keyboardBindingsByCriteria={},i.allKeyHandlers=[],i.registerKeyBindings=function(e){var n=i.registrationIdentifier++;return i.updateKeyBindings(n,e),i.allKeyHandlers[n]||(i.allKeyHandlers[n]=t.noop),n},i.registerAllKeyCallback=function(e,n){i.allKeyHandlers[e]=null!=n?n:t.noop},i.unregisterKeyBindings=function(e){i.updateKeyBindings(e,[]),i.allKeyHandlers[e]=t.noop},i.updateKeyBindings=function(e,t){i.registeredBindings[e]=null!=t?t:[],i.keyboardBindingsByCriteria=a(i.registeredBindings)},i.onKeyDown=function(e){if(c(e)){i.getCallbacksForKey(e).forEach(function(t){return t(e)})}},i.allKeyHandlers=[],i.registeredBindings=[],i}return n.__extends(o,e),o.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=u.length,u.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},o.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),u[this.providerIdentifier]=t.noop,
this.props.onDestroy&&this.props.onDestroy()},o.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},o.prototype.getCallbacksForKey=function(e){var t=s(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},o.prototype.render=function(){return i.Children.only(this.props.children)},o.childContextTypes=t.KeyboardBindingProviderContextTypes,o})(i.Component);t.KeyboardBindingProvider=p,t.getIndexForkeyboardBindingsByCriteria=s,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=a,t.simulateKeyEvent=l}),function(){define("modules/clean/react/onboarding_modal",["external/classnames","external/react","modules/core/i18n","modules/core/exception","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/slider"],function(e,t,n,i,o,r,s){var a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,assert;return b=n._,assert=i.assert,l=o.button,m=r.Modal,p=s.IndicatorGroup,w=s.Slides,y=s.Slider,f=s.NavButtonGroup,t.DOM,d=t.createFactory(m),a=t.createFactory(l),g=t.createFactory(y),E=t.createFactory(w),u=t.createFactory(p),h=t.createFactory(f),c=640,v=t.createClass({displayName:"OnboardingSlider",mixins:[t.addons.PureRenderMixin],propTypes:{width:t.PropTypes.number.isRequired,height:t.PropTypes.number,className:t.PropTypes.string,onSlideChange:t.PropTypes.func,onSlideEnd:t.PropTypes.func,initialSlideIndex:t.PropTypes.number,children:function(e,n,i){var o;return o=t.Children.count(e[n]),assert(o>0,i+" has no slide to show")}},getDefaultProps:function(){return{initialSlideIndex:0}},getInitialState:function(){return{currentSlideIndex:this.props.initialSlideIndex}},isAtLastSlide:function(){return this.state.currentSlideIndex+1===this.getSlideCount()},getSlideCount:function(){return t.Children.count(this.props.children)},gotoSlide:function(e){if(e!==this.state.currentSlideIndex)return assert(0<=e&&e<this.getSlideCount(),"Invalid slide index: "+e),this.setState({currentSlideIndex:e},(function(t){return function(){var n;return"function"==typeof(n=t.props).onSlideChange?n.onSlideChange(e):void 0}})(this))},prevSlide:function(){return this.gotoSlide(this.state.currentSlideIndex-1)},nextSlide:function(){return this.gotoSlide(this.state.currentSlideIndex+1)},render:function(){return g({className:this.props.className},E({width:this.props.width,height:this.props.height,currentSlideIndex:this.state.currentSlideIndex},this.props.children),u({slideCount:this.getSlideCount(),currentSlideIndex:this.state.currentSlideIndex,onIndicatorClick:this.gotoSlide}),h(null,this.isAtLastSlide()?a({className:"is-done",onClick:this.props.onSlideEnd},b("Got it")):a({className:"is-next",onClick:this.nextSlide},b("Next"))))}}),_=t.createFactory(v),t.createClass({displayName:"OnboardingModal",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,onClose:t.PropTypes.func,slideWidth:t.PropTypes.number,slideHeight:t.PropTypes.number,initialSlideIndex:t.PropTypes.number},getDefaultProps:function(){return{slideWidth:c}},closeModal:function(){var e;return m.close(),"function"==typeof(e=this.props).onClose?e.onClose():void 0},render:function(){return d({acceptButtonText:null,onDismiss:this.props.onClose,style:"clean",className:this.props.className,clickOutToClose:!1},_({initialSlideIndex:this.props.initialSlideIndex,width:this.props.slideWidth,height:this.props.slideHeight,onSlideEnd:this.closeModal},this.props.children))}})})}.call(this),define("modules/clean/react/open_in_app/banner",["require","exports","tslib","external/react","modules/clean/react/file_viewer/constants","modules/clean/react/css","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/actions"],function(e,t,n,i,o,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAppRedirect=function(){l.logUserAction(o.UserActionNames.OPEN_IN_APP,o.UserActionContextNames.OPEN_IN_APP_BANNER),s.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){s.cleanUp()},t.prototype.render=function(){return i.createElement("div",{className:"open-in-app-banner-container"},i.createElement("button",{className:"button-as-link open-in-app-banner-text",onClick:this.handleAppRedirect},this.state.showInstallAppText?a._("Get the Dropbox App"):a._("View In App")),i.createElement("button",{className:"button-as-link open-in-app-banner-close","aria-label":"Close",onClick:this.props.onClose}))},t})(i.Component),u=["/static/css/open_in_app/banner-vflZQkrls.css"];t.OpenInAppBanner=r(c,u)}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){s.logUserAction(a.UserActionNames.OPEN_IN_APP,a.UserActionContextNames.OPEN_IN_APP_BUTTON),o.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){o.cleanUp()},t.prototype.render=function(){return i.createElement("button",{className:"button-primary control__button open-in-app-button",onClick:this.handleClick},this.state.showInstallAppText?r._("Install app?"):r._("Open in app"))},t})(i.Component);t.OpenInAppButton=l}),define("modules/clean/react/previews/archive/actions",["require","exports","modules/clean/react/previews/archive/constants","modules/clean/flux/dispatcher","modules/clean/previews/util"],function(e,t,n,i,o){"use strict";function r(e){var t=o.generateDucId(64);i.dispatch({type:n.ArchivePreviewAction.InitializePreview,data:{duc_id:t,fileId:e}})}function s(e){i.dispatch({type:n.ArchivePreviewAction.UpdateFolderPath,data:{entries:e}})}function a(){i.dispatch({type:n.ArchivePreviewAction.Unload})}Object.defineProperty(t,"__esModule",{value:!0}),t.initializePreview=r,t.updateFolderPath=s,t.unloadPreview=a}),define("modules/clean/react/previews/archive/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivePreviewAction={InitializePreview:"InitializePreview",Unload:"Unload",UpdateFolderPath:"UpdateFolderPath"}}),define("modules/clean/react/previews/archive/file_row",["require","exports","external/react","external/spectrum/media_table","modules/clean/display_format","modules/clean/react/icon/icon_helper","modules/clean/react/file_icon_view"],function(e,t,n,i,o,r,s){"use strict";function a(e){var t=e.entry,a=e.topOffset,l=n.createElement(s.FileIconView,{icon:r.file_icon(t.name,{size:r.ICON_SIZES.LARGE})});return n.createElement(i.CulledMediaRow,{topOffset:a,doubleLine:!0},function(){return[n.createElement(i.MediaCell,{key:"filecell",title:t.name,icon:l}),n.createElement(i.MediaCell,{key:"filesize",title:o.format_bytes(t.size)})]})}Object.defineProperty(t,"__esModule",{value:!0}),t.FileRow=a}),define("modules/clean/react/previews/archive/folder_row",["require","exports","external/react","external/spectrum/media_table","modules/clean/react/icon/icon_helper","modules/clean/react/file_icon_view"],function(e,t,n,i,o,r){"use strict";function s(e){var t=e.entry,s=e.topOffset,a=e.onClick,l=n.createElement(r.FileIconView,{icon:o.folder_icon()});return a?n.createElement(i.CulledMediaRow,{topOffset:s,onClick:a,doubleLine:!0},function(e){var o=e.isHovered;return[n.createElement(i.MediaCell,{key:"foldercell",title:t.name,icon:l,highlight:o})]}):n.createElement(i.CulledMediaRow,{topOffset:s,doubleLine:!0},function(){return[n.createElement(i.MediaCell,{key:"foldercell",title:t.name,icon:l})]})}Object.defineProperty(t,"__esModule",{value:!0}),t.FolderRow=s}),define("modules/clean/react/previews/archive/preview_archive",["require","exports","tslib","external/react","external/spectrum/media_table_skeleton","external/spectrum/table","modules/clean/loggers/file_preview_logger","modules/clean/previews/actions","modules/clean/previews/util","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/breadcrumb/trail","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/archive/file_row","modules/clean/react/previews/archive/folder_row","modules/clean/react/previews/archive/actions","modules/clean/react/previews/archive/store","modules/clean/react/previews/archive/types","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(e){function t(t){var n=e.call(this,t)||this;return n.onUpdateFromStore=function(){n.setState(_.archivePreviewStore.getState())},n.onClickNavigateFolder=function(e,t){e.preventDefault(),f.updateFolderPath(n.state.entries.concat([t]))},n.renderEntryRow=function(e,t,o){if(e.isDir){var r=void 0;return r=n.props.navigationEnabled?function(t){return n.onClickNavigateFolder(t,e)}:void 0,i.createElement(h.FolderRow,{entry:e,topOffset:o,onClick:r})}return i.createElement(m.FileRow,{entry:e,topOffset:o})},n.navigateUp=function(e,t,i){e.preventDefault();var o=n.state.entries.slice(0,i+1);f.updateFolderPath(o)},n.state={duc_id:void 0,entries:[],isLoaded:!1},n}return n.__extends(t,e),t.prototype.fetchArchiveContents=function(){var e=this;this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var t=new XMLHttpRequest;t.open("GET",this.getArchivePreviewUrl()),t.withCredentials=!0,t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?e.onFetchSuccess(t.response):e.onFetchFailure())},t.send()},t.prototype.onFetchSuccess=function(e){this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED);var t=this.parseServerResponse(e);f.updateFolderPath([t]),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED)},t.prototype.parseServerResponse=function(e){var t=JSON.parse(e);if(!t.children){var n=new v.ArchiveEntry("/",0,!0);return this.convertToTree(t,n),n}return t},t.prototype.convertToTree=function(e,t){for(var n=0,i=e[t.name];n<i.length;n++){var o=i[n],r=new v.ArchiveEntry(o.filename,o.bytes,o.is_dir);t.children.push(r),r.isDir&&this.convertToTree(e,r),r.name=o.filename.split("/").pop()}},t.prototype.onFetchFailure=function(){this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),f.unloadPreview(),this.props.onError&&this.props.onError()},t.prototype.getArchivePreviewUrl=function(){var e=E.parse(this.props.file.preview_url.toString());e.updateQuery({duc_id:this.state.duc_id});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.componentDidMount=function(){this.unsubscribe=_.archivePreviewStore.addListener(this.onUpdateFromStore),this.setUpLogger(),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.markWebTiming(),setTimeout(a.broadcastRenderSucceeded,0),f.initializePreview(this.props.file.file_id)},t.prototype.componentDidUpdate=function(e,t){this.state.duc_id!==t.duc_id&&this.fetchArchiveContents()},t.prototype.componentWillUnmount=function(){f.unloadPreview(),this.unsubscribe(),this.teardownLogger()},t.prototype.setUpLogger=function(){this.logger&&this.teardownLogger(),this.logger=new s.FilePreviewArchiveLogger,this.logger.listenTo(c.filePreviewEventEmitter)},t.prototype.teardownLogger=function(){this.logger.unlistenTo(c.filePreviewEventEmitter),delete this.logger},t.prototype.logFilePreviewTimeline=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.logFilePreviewEvent=function(e){c.filePreviewEventEmitter.emit(e,this.props.filePreviewSession,{preview_type:this.props.file.preview_type})},t.prototype.markWebTiming=function(){g.mark_time_to_view(),g.mark_time_to_interactive()},t.prototype.render=function(){var e,t,n=this;if(this.state.isLoaded){if(this.props.navigationEnabled){var s=this.state.entries.map(function(e){if("/"===e.name){var t=y._("%(file)s").format({file:l.get_filename(n.props.file)});return 1===n.state.entries.length&&(t=y._("Viewing the contents of %(file)s").format({file:t})),{label:t,href:"#"}}return{label:e.name,href:"#"}});e=i.createElement("div",{className:"preview-archive__breadcrumbs clearfix"},i.createElement(u.BreadcrumbTrail,{crumbs:s,onChange:this.navigateUp,overflowDropdownPosition:u.BreadcrumbOverflowPositions.BOTTOM_ALIGN_LEFT}))}var a=this.state.entries[this.state.entries.length-1].children;t=i.createElement("div",{className:"preview-archive__table"},i.createElement(r.Table,null,i.createElement(r.FixedTableHead,null,i.createElement(r.TableHeadCell,null,y._("Name")),i.createElement(r.TableHeadCell,null,y._("Size"))),i.createElement(r.CulledTableBody,{items:a,listItemHeight:72,renderRow:this.renderEntryRow})))}else t=i.createElement(o.MediaTableSkeleton,{numRows:10});return i.createElement("div",{className:"preview-archive"},i.createElement("div",{className:"preview-archive__content"},e,t))},t})(i.Component),b=p(w,["/static/css/preview_archive-vflUMeaLl.css"]);t.PreviewArchive=b}),define("modules/clean/react/previews/archive/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/react/previews/archive/constants","modules/clean/flux/dispatcher"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewStates={},n.previewStates={},n}return n.__extends(t,e),t.prototype.getState=function(){return this.previewStates[this.currentFileId]},t.prototype.handleInitializePreview=function(e){this.currentFileId=e.fileId;var t=e.fileId in this.previewStates?this.previewStates[e.fileId].duc_id:e.duc_id,n={duc_id:t,entries:[],isLoaded:!1};this.previewStates[e.fileId]=n,this.__emitChange()},t.prototype.handleUpdateFolderPath=function(e){if(this.previewStates[this.currentFileId].entries=e.entries.slice(),this.previewStates[this.currentFileId].isLoaded===!1){var t=e.entries.slice()[0],n=t.children[0];1===t.children.length&&n.isDir===!0&&0!==n.children.length&&(this.previewStates[this.currentFileId].entries=[t,n])}this.previewStates[this.currentFileId].isLoaded=!0,this.__emitChange()},t.prototype.handleUnload=function(){this.previewStates[this.currentFileId].entries=[],this.previewStates[this.currentFileId].isLoaded=!1,this.currentFileId=void 0,this.__emitChange()},t.prototype.__onDispatch=function(e){switch(e.action.type){case o.ArchivePreviewAction.InitializePreview:this.handleInitializePreview(e.action.data);break;case o.ArchivePreviewAction.Unload:this.handleUnload();break;case o.ArchivePreviewAction.UpdateFolderPath:this.handleUpdateFolderPath(e.action.data)}},t})(i);t.archivePreviewStore=new s(r)}),define("modules/clean/react/previews/archive/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){this.name=e,this.size=t,this.isDir=n,this.children=[]}return e})();t.ArchiveEntry=n}),define("modules/clean/react/previews/audio/preview_audio",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/previews/actions","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/utils","modules/clean/react/previews/loading_indicator","modules/core/browser","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={time:0,duration:0,bufferedLength:0,isPlaying:!1,isReady:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1},t.setAudioRef=function(e){t.audio=e},t.setAudioWrapperRef=function(e){t.audioWrapper=e},t.setReady=s.once(function(){t.props.filePreviewSession&&t.props.filePreviewSession.markPrimaryEvent(),v.mark_time_to_view(),v.mark_time_to_interactive(),t.setState({isReady:!0}),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(a.broadcastRenderSucceeded,0),setTimeout(t.setContainer,500),t.props.bytes<7e7&&t.sendWaveFormRequest()}),t.setContainer=function(){t.setState({isContainerSet:!0})},t.updateProgress=function(){var e=t.getBufferProgress();t.setState({bufferedLength:e})},t.updateTime=function(){t.setState({time:t.getAudioNode().currentTime})},t.updateTimeTo=function(e){t.getAudioNode().currentTime=e,t.setState({time:e})},t.updateDuration=function(){var e=t.getBufferProgress();t.setState({duration:t.getAudioNode().duration,bufferedLength:e})},t.playOrPause=function(){t.state.isPlaying?t.pauseFile():t.playFile()},t.pauseFile=function(){t.getAudioNode().pause(),t.setState({isPlaying:!1})},t.toggleMute=function(){var e=t.state.isMuted?t.state.volumeLevel||.1:0;t.getAudioNode().volume=e;var n={isMuted:!t.state.isMuted};0===t.state.volumeLevel&&(n.volumeLevel=e),t.setState(n)},t.changeVolumeTo=function(e){t.getAudioNode().volume=e,t.setState({volumeLevel:e,isMuted:!e})},t.throwError=function(){E.error(y._("An audio error occurred")),g.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:g.SEVERITY.NONCRITICAL}),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.props.onError()},t.updateWaveformState=function(e){t.isRendered&&t.setState({rawWaveformHeights:e})},t.checkIfRendered=function(){return t.isRendered},t.parseWaveFormBuffer=function(e){return t.setWaveformWidth(),h.PreviewAudioWaveformHelpers.buildFromBuffer(e,1e3,100,t.checkIfRendered,t.updateWaveformState)},t.generateWaveform=function(){var e=Math.floor((t.state.waveformWidth-1)/3);return h.PreviewAudioWaveformHelpers.returnWaveform(t.state.rawWaveformHeights,e,.85)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.isRendered=!0,this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var e=this.getAudioNode();e.addEventListener("timeupdate",this.updateTime),e.addEventListener("durationchange",this.updateDuration),e.addEventListener("ended",this.pauseFile),e.addEventListener("canplay",this.setReady),e.addEventListener("progress",this.updateProgress),e.addEventListener("error",this.throwError),this.setWaveformWidth(),window.addEventListener("resize",this.getDebouncedWaveformWidthFunction())},t.prototype.componentWillUnmount=function(){this.isRendered=!1;var e=this.getAudioNode();e.removeEventListener("timeupdate",this.updateTime),e.removeEventListener("durationchange",this.updateDuration),e.removeEventListener("ended",this.pauseFile),e.removeEventListener("canplay",this.setReady),e.removeEventListener("progress",this.updateProgress),e.removeEventListener("error",this.throwError),window.removeEventListener("resize",this.getDebouncedWaveformWidthFunction()),null!=this.audioContext&&null!=this.audioContext.close&&this.audioContext.close()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.getAudioNode=function(){return r.findDOMNode(this.audio)},t.prototype.getDebouncedWaveformWidthFunction=function(){return this.debouncedWaveformWidthFunction||(this.debouncedWaveformWidthFunction=s.debounce(this.setWaveformWidth,100)),this.debouncedWaveformWidthFunction},t.prototype.setWaveformWidth=function(){this.isRendered&&this.setState({waveformWidth:r.findDOMNode(this.audioWrapper).offsetWidth})},t.prototype.getSrcUrl=function(){var e=w.parse(this.props.src);e.updateQuery({duc_id:"dropbox_duc_id"});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.getBufferProgress=function(){var e=this.getAudioNode();return e.duration&&e.buffered&&e.buffered.length?e.buffered.end(e.buffered.length-1):0},t.prototype.playFile=function(){this.getAudioNode().play(),this.setState({isPlaying:!0})},t.prototype.sendWaveFormRequest=function(){var e=this;if(this.setAudioContext(),null==this.audioContext)this.logFailedWaveformGeneration();else{if(_.is_mobile_or_tablet())return void this.setReady();var t=new XMLHttpRequest;t.open("GET",this.getSrcUrl()),t.responseType="arraybuffer",t.withCredentials=!0,t.onreadystatechange=function(){4===t.readyState&&e.isRendered&&(200===t.status?e.audioContext.decodeAudioData(t.response,e.parseWaveFormBuffer,e.logFailedWaveformGeneration):e.logFailedWaveformGeneration())},t.send()}},t.prototype.logFailedWaveformGeneration=function(){g.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:g.SEVERITY.NONCRITICAL})},t.prototype.setAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)},t.prototype.renderAudioTag=function(){return o.createElement("audio",{src:this.getSrcUrl(),preload:"auto",ref:this.setAudioRef})},t.prototype.renderRadio=function(){var e=0!==this.state.rawWaveformHeights.length,t=i({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isReady||e});return o.createElement("div",{className:t},h.PreviewAudioHelpers.getRadioImage())},t.prototype.renderWaveForm=function(){return o.createElement(d.PreviewAudioVisuals,{generateWaveform:this.generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,updateTime:this.updateTimeTo,barWidth:2,barSpacing:1,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isPlayerReady:this.state.isReady,isContainerSet:this.state.isContainerSet,key:1})},t.prototype.renderToolbar=function(){return o.createElement("div",{className:"toolbar",key:2},this.renderPlayButton(),this.renderDetails(),this.renderVolume())},t.prototype.renderPlayButton=function(){return o.createElement(p.PreviewAudioPlayButton,{isPlaying:this.state.isPlaying,onChange:this.playOrPause})},t.prototype.renderDetails=function(){return o.createElement(u.PreviewAudioDetails,{time:this.state.time,duration:this.state.duration})},t.prototype.renderVolume=function(){return _.iOS?null:o.createElement(m.PreviewAudioVolume,{isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this.changeVolumeTo,onMuteToggle:this.toggleMute})},t.prototype.render=function(){var e=i({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isReady});return o.createElement("div",{className:"flex-preview-container"},o.createElement("div",{className:"preview-audio preview-content preview-content--center"},o.createElement("div",{className:"preview-audio__wrapper",ref:this.setAudioWrapperRef},o.createElement("div",{className:"preview-audio__aspect-container"},o.createElement("div",{className:e},this.renderAudioTag(),this.renderRadio(),this.state.isReady?[this.renderWaveForm(),this.renderToolbar()]:o.createElement(f.LoadingIndicator,{className:"preview-audio__load-indicator"}))))))},t})(o.Component);t.PreviewAudioWithoutCss=b,t.PreviewAudio=l(b,["/static/css/preview_audio-vfl4_jxxR.css"])}),define("modules/clean/react/previews/audio/preview_audio_details",["require","exports","tslib","external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.formatString=function(e){return r._("%(time)s").format({time:o.formatAudioTime(e)})},t.prototype.getDisplayString=function(){return i.createElement("span",{className:"toolbar-details__time"},this.formatString(this.props.time)+" / "+this.formatString(this.props.duration))},t.prototype.render=function(){return i.createElement("div",{className:"toolbar-details vertical-align"},i.createElement("div",{className:"toolbar-details__string vertical-align__child"},this.getDisplayString()))},t})(i.Component);t.PreviewAudioDetails=s}),define("modules/clean/react/previews/audio/preview_audio_play_button",["require","exports","tslib","external/react","modules/clean/react/previews/audio/utils"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getIconString=function(){return this.props.isPlaying?"pause":"play"},t.prototype.renderButtonImage=function(){return o.PreviewAudioHelpers.getSprite(this.getIconString())},t.prototype.render=function(){return i.createElement("button",{className:"toolbar-controller vertical-align",onClick:this.props.onChange,title:this.getIconString()},i.createElement("div",{className:"toolbar-controller__button vertical-align__child"},this.renderButtonImage()))},t})(i.Component);t.PreviewAudioPlayButton=r}),define("modules/clean/react/previews/audio/preview_audio_visuals",["require","exports","tslib","external/classnames","external/react","external/react-dom"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrubPercentage:0,isMouseDown:!1},t.setWaveformRef=function(e){t.waveform=e},t.scrubTime=function(e){var n=t.getSeekPercentageFromEvent(e);t.updateWaveformScrubToPercentage(n),t.state.isMouseDown&&t.updateTime(e)},t.resetScrub=function(){t.updateWaveformScrubToPercentage(0),t.setMouseUp()},t.updateTime=function(e){var n=t.getSeekPercentageFromEvent(e),i=n*t.props.duration;t.props.updateTime(i)},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t}return n.__extends(t,e),t.prototype.getSeekPercentageFromEvent=function(e){var t=r.findDOMNode(this.waveform).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getProgress=function(){return this.props.time/(this.props.duration||1)},t.prototype.getBuffered=function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},t.prototype.getWidthObject=function(e){return{width:e+"%"}},t.prototype.updateWaveformScrubToPercentage=function(e){this.setState({scrubPercentage:e})},t.prototype.getScrubObject=function(e){return{onClick:this.updateTime,onMouseMove:this.scrubTime,onMouseLeave:this.resetScrub,onMouseDown:this.setMouseDown,onMouseUp:this.setMouseUp,className:e}},t.prototype.getWavebarClasses=function(e){return i({wavebar__single:!0,"wavebar__single--scrubbed":e})},t.prototype.renderWaveBar=function(e,t){var n,i=1-e,r={top:100*i+"%",height:100*e+"%"},s=this.props.waveformWidth,a=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth;if(this.state.scrubPercentage>0){var l=this.state.scrubPercentage*s;n=this.getWavebarClasses(a<l)}else{var c=this.getProgress()*s;n=this.getWavebarClasses(a<c)}return[o.createElement("div",{className:"wavebar__single wavebar__space",key:1}),o.createElement("div",{className:n,style:r,key:2})]},t.prototype.renderWaveBars=function(){var e,t=this,r=i({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady});return e=this.props.isWaveformReady?this.getScrubObject(r):{className:r},o.createElement("div",n.__assign({},e),this.props.generateWaveform().map(function(e,n){return t.renderWaveBar(e,n)}))},t.prototype.renderWaveForm=function(){var e;return e=this.props.isWaveformReady?this.getWidthObject(100*this.state.scrubPercentage):this.getWidthObject(0),o.createElement("div",{className:"waveform"},o.createElement("div",{className:"waveform__scrub",style:e}),this.renderWaveBars())},t.prototype.renderProgressBar=function(){var e=100*this.getProgress(),t=100*this.getBuffered(),r=i({"audio-progress-bar__done":!0,"audio-progress-bar__showing":!!e});return o.createElement("div",n.__assign({},this.getScrubObject("audio-progress-bar")),o.createElement("div",{className:"audio-progress-bar__buffered",style:this.getWidthObject(t)}),o.createElement("div",{className:r,style:this.getWidthObject(e)}))},t.prototype.render=function(){return o.createElement("div",{className:"visuals",ref:this.setWaveformRef},this.renderWaveForm(),this.renderProgressBar())},t})(o.Component);t.PreviewAudioVisuals=s}),define("modules/clean/react/previews/audio/preview_audio_volume",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/previews/audio/utils"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMouseDown:!1},t.setVolumeBarRef=function(e){t.volumeBar=e},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t.safeChangeVolume=function(e){if(t.state.isMouseDown)return t.changeVolume(e)},t.changeVolume=function(e){var n=t.getVolumePercentageFromEvent(e);t.props.onVolumeChange(n)},t}return n.__extends(t,e),t.prototype.getVolumePercentageFromEvent=function(e){var t=o.findDOMNode(this.volumeBar).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getIconString=function(){return this.props.isMuted?"volumeMuted":"volume"},t.prototype.renderVolumeImage=function(){var e=r.PreviewAudioHelpers.getSprite(this.getIconString());return i.createElement("div",{className:"toolbar-volume__button vertical-align__child"},i.createElement("button",{onClick:this.props.onMuteToggle},e))},t.prototype.renderVolumeBar=function(){var e=this.props.isMuted?0:100*this.props.volumeLevel,t={width:e+"%"};return i.createElement("div",{className:"volume-bar vertical-align__child",onMouseUp:this.setMouseUp,onMouseDown:this.setMouseDown,onMouseLeave:this.setMouseUp,onMouseMove:this.safeChangeVolume,onClick:this.changeVolume},i.createElement("div",{className:"volume-bar__container",ref:this.setVolumeBarRef},i.createElement("div",{className:"volume-bar__selected",style:t})))},t.prototype.render=function(){return i.createElement("div",{className:"toolbar-volume vertical-align"},this.renderVolumeImage(),this.renderVolumeBar())},t})(i.Component);t.PreviewAudioVolume=s}),define("modules/clean/react/previews/audio/utils",["require","exports","external/react","modules/clean/average_counter","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,s,a){"use strict";function l(e){var t=a._("%(state)s").format({state:e});return n.createElement(r,{group:"web",name:e,alt:t})}function c(){return n.createElement(o,{src:s.static_url("/static/images/icons/waveformEmpty-vflZHW9X-.png"),srcHiRes:s.static_url("/static/images/icons/waveformEmpty@2x-vflZvenXO.png")})}function u(e,t,n,o,r){function s(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*a.length/t),p=Math.ceil((e+1)*a.length/t),d=p-u;if(d>n)for(var m=0;m<n;m++){var h=Math.floor(Math.random()*d)+u;c.push(Math.abs(a[h]))}else for(var m=u;m<p;m++){var f=Math.floor(Math.abs(a[m]));c.push(f)}var _=new i.AverageCounter
;_.addArray(c),l[e]=_.getAverage(),o()&&setTimeout(s(e+1),0)}}var a=e.getChannelData(0),l=new Array(t);setTimeout(s(0),0)}function p(e,t,n){void 0===n&&(n=1);var o=[];if(0===e.length||t<=0)return o;for(var r=[],s=0;s<t;s++)r.push(new i.AverageCounter);for(var a=0,l=0,s=0;s<e.length;s++){var c=e[s],u=Math.floor(s*t/e.length),p=r[u];p.add(c),o[u]=p.getAverage(),u!==l&&(a=Math.max(a,o[l]),l=u)}return a=Math.max(a,o[t-1]),o.map(function(e){return e*n/a})}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioHelpers={getRadioImage:c,getSprite:l},t.PreviewAudioWaveformHelpers={buildFromBuffer:u,returnWaveform:p}}),define("modules/clean/react/previews/constants",["require","exports"],function(e,t){"use strict";function n(e){return a[e]}function i(e){return l[e]}function o(e){return u[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={LOAD_ERROR:"LOAD_ERROR",SUPPORT_ERROR:"SUPPORT_ERROR",EXTENSION_ERROR:"EXTENSION_ERROR",NEED_FLASH_ERROR:"NEED_FLASH_ERROR",FILE_SIZE_ERROR:"FILE_SIZE_ERROR",PASSWORD_PROTECTED_ERROR:"PASSWORD_PROTECTED_ERROR",PENDING_UPLOAD_ERROR:"PENDING_UPLOAD_ERROR",EMPTY_FILE_ERROR:"EMPTY_FILE_ERROR"};var r;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SHARED_LINK_FILE=1]="SHARED_LINK_FILE",e[e.SHARED_LINK_FOLDER=2]="SHARED_LINK_FOLDER",e[e.SHARED_LINK_COLLECTION=3]="SHARED_LINK_COLLECTION",e[e.VERSION_HISTORY=4]="VERSION_HISTORY",e[e.FILE_VIEWER=5]="FILE_VIEWER",e[e.DESKTOP=6]="DESKTOP",e[e.EMBEDDED_SHARED_LINK_FILE=7]="EMBEDDED_SHARED_LINK_FILE"})(r=t.PreviewSourceContext||(t.PreviewSourceContext={}));var s;(function(e){e[e.VISIT=0]="VISIT",e[e.CLICK=1]="CLICK"})(s=t.PreviewSourceAction||(t.PreviewSourceAction={}));var a=[];a[r.BROWSE]="browse",a[r.SHARED_LINK_FILE]="sl_file",a[r.SHARED_LINK_FOLDER]="sl_folder",a[r.SHARED_LINK_COLLECTION]="sl_collection",a[r.VERSION_HISTORY]="version_history",a[r.FILE_VIEWER]="file_viewer",a[r.DESKTOP]="desktop",a[r.EMBEDDED_SHARED_LINK_FILE]="embedded_sl_file",t.getPreviewSourceContextKey=n;var l=[];l[s.VISIT]="visit",l[s.CLICK]="click",t.getPreviewSourceActionKey=i;var c;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NEW_FILE=1]="NEW_FILE",e[e.BEFORE_UNLOAD=2]="BEFORE_UNLOAD",e[e.UNMOUNT=3]="UNMOUNT"})(c=t.PreviewSessionEndReasons||(t.PreviewSessionEndReasons={})),t.RivieraPreviewResponseTypes={UNKNOWN:0,OK:1,CONVERSION_FAILURE:2,TEMPORARY_FAILURE:3,INTERNAL_FAILURE:4,UNSUPPORTED_FORMAT:5,TIMEOUT:6,TOO_BIG:7,INVALID_METADATA:8,SOURCE_CORRUPT:9,TIME_BUDGET_EXCEEDED:10,NOT_FOUND:11,PASSWORD_PROTECTED:12};var u=[];u[c.UNKNOWN]="unknown",u[c.NEW_FILE]="new_file",u[c.BEFORE_UNLOAD]="before_unload",u[c.UNMOUNT]="unmount",t.getSessionEndReasonLoggingKey=o}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-doc.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","dl-doc.dropboxusercontent.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),e.call(this,n)||this}return n.__extends(t,e),t})(i.FrameMessengerHost);t.PreviewFrameMessengerHost=o}),define("modules/clean/react/previews/image_helpers",["require","exports","modules/constants/python","modules/clean/photos/thumbnail_url_util"],function(e,t,n,i){"use strict";function o(e,t){var o;return o=t?a.filter(function(e){var n=e[0],i=e[1];return n<=t[0]&&i<=t[1]}):a,o.map(function(t){var o=t[0],r=t[1];return i.thumbnailUrlForSize(e,o,r,n.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+o+"w"}).join(", ")}function r(e){return i.thumbnailUrlForSize(e,800,600,3)}function s(e){return new Promise(function(n,i){var s=Date.now(),a=new Image;a.onload=function(){n({started:s,completed:Date.now()})},a.onerror=function(){i({started:s,failed:Date.now()})},a.srcset=o(e),a.sizes=t.IMG_SIZES_ATTR,a.src=r(e)})}Object.defineProperty(t,"__esModule",{value:!0});var a=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=o,t.getFallbackSrc=r,t.preloadImage=s}),define("modules/clean/react/previews/loading_indicator",["require","exports","external/classnames","external/react"],function(e,t,n,i){"use strict";function o(e){return i.createElement("div",{className:n("c-loader",e.className)})}Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingIndicator=o}),define("modules/clean/react/previews/pdf_thumbnail_image",["require","exports","tslib","external/react","modules/clean/react/previews/responsive_image"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onLoad=function(e){if(t.props.firstPageWidth){var n=e.target;t.setState({naturalWidth:n.naturalWidth})}if(t.props.onLoad)return t.props.onLoad()},t}return n.__extends(t,e),t.prototype.render=function(){var e={};return this.state.naturalWidth&&(e.width="calc((100% - 32px) * "+this.state.naturalWidth/this.props.firstPageWidth+")"),i.createElement("div",{className:"thumbnail__image-border",style:e},i.createElement(o.ResponsiveImage,{fileName:"pdfPage",thumbnailUrlTmpl:this.props.src,className:this.props.className,onLoad:this.onLoad,onError:this.props.onError,refCallback:this.props.refCallback,shouldLoadLowResImg:this.props.shouldLoadLowResImg}))},t})(i.PureComponent);t.PdfThumbnailImage=r}),define("modules/clean/react/previews/pdf_viewer/annotation_creation_layer",["require","exports","tslib","external/keymaster","external/underscore","external/react","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/transform","modules/clean/annotations/annotation_controller"],function(e,t,n,i,o,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={draftAnnotationVersion:0,postedAnnotationKey:""},t.resetDraftAnnotation=function(e){void 0===e&&(e=""),t.setState({draftAnnotationVersion:t.state.draftAnnotationVersion+1,postedAnnotationKey:e})},t.onResize=o.debounce(t.resetDraftAnnotation,1e3,!0),t.onUpdateAnnotations=function(e){var n=e.annotations.filter(function(e){return"POSTING"===e.commentActivity.status});if(n.length>0){var i=n[0].commentActivity.activity_key;i!==t.state.postedAnnotationKey&&t.resetDraftAnnotation(i)}},t.onAnnotationHiddenCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-hidden")},t.onAnnotationPlacedCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-placed",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationStartDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-start-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEndDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-end-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScrollCallback=function(e){e&&t.props.frameMessenger.postMessageToParent("scroll",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScaleChangeCallback=function(e){t.props.frameMessenger.postMessageToParent("scale-change",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-enter",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-leave",{annotation:t.finalizeAnnotation(e)})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){s.eventEmitter.on("resize",this.onResize),s.eventEmitter.on("update-annotations",this.onUpdateAnnotations),i("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.componentWillUnmount=function(){s.eventEmitter.off("resize",this.onResize),s.eventEmitter.off("update-annotations",this.onUpdateAnnotations),i.unbind("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.finalizeAnnotation=function(e){return e.pdf_coordinates=a.transformViewportCoordinates(this.props.pageNumber,this.props.parentOffset.left,this.props.parentOffset.top,this.props.width,this.props.height,this.props.scaleFactor,e.viewportCoordinates),e.pdf_page={rotate:0,view:{}},e},t.prototype.render=function(){return r.createElement("div",{className:"db-annotation-creation-layer"},r.createElement(l,{parentContainerOffset:this.props.parentOffset,controllerEventHandlers:this.props.delegate,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,draftAnnotationVersion:this.state.draftAnnotationVersion}))},t.defaultProps={scaleFactor:1},t})(r.Component);t.AnnotationCreationLayer=c}),define("modules/clean/react/previews/pdf_viewer/annotation_view_layer",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_region_ui","modules/clean/react/previews/pdf_viewer/transform","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/css"],function(e,t,n,i,o,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderedAnnotations={},t.onAnnotationClickCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-click",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-enter",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-leave",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onHighlightAnnotation=function(e){if(t.renderedAnnotations[e.activity_key]){var n=!1,o=t.renderedAnnotations[e.activity_key],r=i(".page-container"),s=i(o.firstChild);n=!1,t.isElementVisible(s,r)||(n=!0,r.animate({scrollTop:r.scrollTop()+s.offset().top-300+"px"},300)),o.classList.remove("start-highlight-animation"),o.classList.remove("start-highlight-animation--delay"),requestAnimationFrame(function(){o.classList.add("start-highlight-animation"),n&&o.classList.add("start-highlight-animation--delay")})}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){u.eventEmitter.on("highlight-annotation",this.onHighlightAnnotation)},t.prototype.componentWillUnmount=function(){u.eventEmitter.off("highlight-annotation",this.onHighlightAnnotation)},t.prototype.isElementVisible=function(e,t){var n=e.offset().top;return 0<n&&n<t.height()},t.prototype.render=function(){var e=this,t=null;return this.props.annotations&&(t=this.props.annotations.map(function(t,i){var u=s.Annotation.createAnnotationFromDict(t.annotation);u.viewportCoordinates=c.transformPdfCoordinates(0,e.props.height,t.annotation.pdf_coordinates);var p={key:t.commentActivity.activity_key,annotation:u,scaleFactor:e.props.scaleFactor,commentActivity:t.commentActivity,options:t.options,onAnnotationClickCallback:e.onAnnotationClickCallback,onAnnotationEnterCallback:e.onAnnotationEnterCallback,onAnnotationLeaveCallback:e.onAnnotationLeaveCallback,ref:function(n){return e.renderedAnnotations[t.commentActivity.activity_key]=r.findDOMNode(n)}};return u.type===s.AnnotationTypes.HIGHLIGHT?o.createElement(a,n.__assign({},p)):u.type===s.AnnotationTypes.REGION?o.createElement(l,n.__assign({},p)):null})),o.createElement("div",{className:"db-annotation-layer db-annotation-view-layer"},t)},t.defaultProps={scaleFactor:1},t})(o.PureComponent),m=["/static/css/comments_annotations-vflT6HX_-.css"],h=p(d,m);t.AnnotationViewLayer=h}),define("modules/clean/react/previews/pdf_viewer/app",["require","exports","tslib","external/keymaster","external/react","modules/clean/react/file_viewer/constants","modules/clean/react/modal","modules/clean/react/previews/constants","modules/clean/react/previews/pdf_viewer/connection_pool","modules/clean/react/previews/pdf_viewer/font","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/viewer","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/password_modal","modules/clean/react/previews/pdf_viewer/utils","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=["pdf"],g=(function(e){function t(t){var i=e.call(this,t)||this;return i.isFirstPasswordAttempt=!0,i.inProgressPages={},i.downloadSucceedLogged=!1,i.renderSucceededLogged=!1,i.submitPassword=function(e){i.refreshBlob(e)},i.dismissPassword=function(){i.props.onError&&i.props.onError(a.ErrorTypes.PASSWORD_PROTECTED_ERROR)},i.onScrollToAnnotation=function(e){var t=function(n,i){i===e.page-1&&(d.eventEmitter.off("page-set-to",t),d.eventEmitter.emit("highlight-annotation",e.commentActivity))};d.eventEmitter.on("page-set-to",t),d.eventEmitter.emit("set-current-page",e.page-1)},i.onScrollToPage=function(e){return n.__awaiter(i,void 0,void 0,function(){var t,i,o;return n.__generator(this,function(n){switch(n.label){case 0:this.props.frameMessenger.postMessageToParent("page-change",{current_page:e+1,pages_count:this.state.metadata?this.state.metadata.page_count:0,doc_type:h.docTypeFromExtension(this.props.fileExtension)}),t=50*Math.floor(e/50),t+50-e<15&&(t+=50),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(t)];case 2:return i=n.sent(),i&&this.setState({text:this.addPdfgenText(i.text,this.state.text),links:i.text&&(i.text.links||void 0)}),[3,4];case 3:return o=n.sent(),d.eventEmitter.emit("error",_._("Failed to load PDF")),[3,4];case 4:return[2]}})})},i.onFileFeedbackUIReady=function(){i.props.frameMessenger.postMessageToParent("page-rendered")},i.onUpdateAnnotations=function(e){var t=e.annotations.reduce(function(e,t,n,i){var o=t.annotation.pdf_coordinates[0].page,r=o-1;return e[r]=e[r]||[],e[r].push(t),e},[]);i.setState({annotations:t})},i.onRemoveAllAnnotations=function(){i.setState({annotations:[]})},i.onEnableAnnotationCreation=function(){i.setState({isAnnotationCreationEnabled:!0})},i.onDisableAnnotationCreation=function(){i.setState({isAnnotationCreationEnabled:!1})},i.onEnableRegionCreation=function(){i.setState({isAnnotationRegionEnabled:!0})},i.onDisableRegionCreation=function(){i.setState({isAnnotationRegionEnabled:!1})},i.onSetAttributions=function(e){var t=e.attributions.reduce(function(e,t){var n=t.page;return e[n]=e[n]||[],e[n].push(t),e},[]),n=e.accounts.reduce(function(e,t){return e[t.accountId]=t,e},{});i.setState({attributionProps:{attributions:t,accounts:n}})},i.onPageRenderComplete=function(e,t,n){i.props.filePreviewSession&&(i.props.filePreviewSession.logSSREvent("any_page_rendered"),e<5&&(i.props.filePreviewSession.ssrTiming["page_"+e+"_render"]=t.duration())),!i.renderSucceededLogged&&i.props.timelineCallbacks.onFirstRenderSucceeded&&(i.renderSucceededLogged=!0,i.props.timelineCallbacks.onFirstRenderSucceeded(),i.props.frameMessenger.postMessageToParent("page-rendered"))},i.onPageImageLoad=function(e,t,n){i.props.filePreviewSession&&(i.props.filePreviewSession.logSSREvent("any_page_image_loaded"),e<5&&(i.props.filePreviewSession.ssrTiming["page_"+e+"_image_load"]=t.duration())),!i.downloadSucceedLogged&&i.props.timelineCallbacks.onDownloadSucceeded&&(i.downloadSucceedLogged=!0,i.props.timelineCallbacks.onDownloadSucceeded())},i.onPrintKeyPressed=function(){d.eventEmitter.emit("print",{context:r.UserActionContextNames.KEYBOARD})},i.state={urls:t.urls,isAnnotationHighlightEnabled:!0},t.previewThumbnailUrl?i.placeholderImageUrl=t.previewThumbnailUrl:i.placeholderImageUrl=i.state.urls.imageUrl(0,0),i}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.connectionPool=new l.ConnectionPool({maxConnections:3}),this.props.timelineCallbacks.onDownloadAttempted&&this.props.timelineCallbacks.onDownloadAttempted(),this.requestMetadata(),this.refreshIntervalId=window.setInterval(function(){e.refreshBlob()},108e5)},t.prototype.addPdfgenText=function(e,t){if(void 0===t&&(t={}),!e||!e.pages)return t;var n=e.fonts?e.fonts.map(c.renderFont):[];for(var i in e.pages)e.pages.hasOwnProperty(i)&&(t[i]=(e.pages[i]||[]).map(function(e){return{d:e.d,t:e.t,r:e.r,h:e.h,font:n[e.f]?n[e.f]:void 0}}));return t},t.prototype.requestMetadata=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,i,r;return n.__generator(this,function(n){switch(n.label){case 0:e=u.makeTimer().time(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(0)];case 2:return t=n.sent(),[3,4];case 3:return i=n.sent(),401===i.jqXHR.status&&(v.indexOf(this.props.fileExtension)>-1?(r=o.createElement(m.PasswordModal,{onSubmit:this.submitPassword,onDismiss:this.dismissPassword,isFirstAttempt:this.isFirstPasswordAttempt}),s.Modal.showInstance(r),this.isFirstPasswordAttempt=!1):this.props.onError&&this.props.onError(a.ErrorTypes.PASSWORD_PROTECTED_ERROR)),[2];case 4:return t&&t.metadata&&t.metadata.page_count>0?(this.props.filePreviewSession&&(this.props.filePreviewSession.markSecondaryEvent(),this.props.filePreviewSession.logSSREvent("metadata_succeeded"),this.props.filePreviewSession.ssrTiming.metadata=e.timeEnd().duration()),this.onMetadataLoad(t.metadata),this.setState({metadata:t.metadata,text:this.addPdfgenText(t.text),links:t.text&&(t.text.links||void 0)}),this.props.onLoad&&this.props.onLoad()):this.props.onError&&this.props.onError(a.ErrorTypes.LOAD_ERROR),[2]}})})},t.prototype.componentDidMount=function(){d.eventEmitter.on("scrolled-to-page",this.onScrollToPage),d.eventEmitter.on("file-feedback-ui-ready",this.onFileFeedbackUIReady),d.eventEmitter.on("scroll-to-annotation",this.onScrollToAnnotation),d.eventEmitter.on("update-annotations",this.onUpdateAnnotations),d.eventEmitter.on("remove-all-annotations",this.onRemoveAllAnnotations),d.eventEmitter.on("enable-annotation-creation",this.onEnableAnnotationCreation),d.eventEmitter.on("disable-annotation-creation",this.onDisableAnnotationCreation),d.eventEmitter.on("enable-region-creation",this.onEnableRegionCreation),d.eventEmitter.on("disable-region-creation",this.onDisableRegionCreation),d.eventEmitter.on("set-attributions",this.onSetAttributions),i("p","fileviewer",this.onPrintKeyPressed)},t.prototype.componentWillUnmount=function(){d.eventEmitter.off("scrolled-to-page",this.onScrollToPage),d.eventEmitter.off("file-feedback-ui-ready",this.onFileFeedbackUIReady),d.eventEmitter.off("scroll-to-annotation",this.onScrollToAnnotation),d.eventEmitter.off("update-annotations",this.onUpdateAnnotations),d.eventEmitter.off("remove-all-annotations",this.onRemoveAllAnnotations),d.eventEmitter.off("enable-annotation-creation",this.onEnableAnnotationCreation),d.eventEmitter.off("disable-annotation-creation",this.onDisableAnnotationCreation),d.eventEmitter.off("enable-region-creation",this.onEnableRegionCreation),d.eventEmitter.off("disable-region-creation",this.onDisableRegionCreation),d.eventEmitter.off("set-attributions",this.onSetAttributions),i.unbind("p","fileviewer",this.onPrintKeyPressed),this.connectionPool.shutdown(),window.clearInterval(this.refreshIntervalId)},t.prototype.fetchDataForPage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,i,o,r,s,a=this;return n.__generator(this,function(n){switch(n.label){case 0:if(e%50!==0)throw new Error("invalid page lower bound");if(this.state.metadata&&this.state.metadata.page_count<=e)return[2,void 0];if(t=e+50,this.state.text&&this.state.text[e])return[3,4];i=this.state.urls.textUrl(0===e,e,t),n.label=1;case 1:return n.trys.push([1,3,,4]),o={dataType:"json",type:"GET",url:i,xhrFields:{withCredentials:!0}},[4,this.connectionPool.request(o,function(t){a.inProgressPages[e]?t():a.inProgressPages[e]=!0})];case 2:return r=n.sent(),delete this.inProgressPages[e],[2,r];case 3:if(s=n.sent(),delete this.inProgressPages[e],f.PW_PROTECTED_PDFSSR_ENABLED&&401===s.jqXHR.status)throw s;return[3,4];case 4:return[2,void 0]}})})},t.prototype.refreshBlob=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,i,o,r,s=this;return n.__generator(this,function(n){switch(n.label){case 0:return(t=this.state.urls.refreshUrl())?(i={},o=function(){},void 0!==e&&(i={password:e},o=function(){return s.requestMetadata()}),[4,this.connectionPool.request({url:t,dataType:"json",type:"POST",data:i})]):[3,2];case 1:r=n.sent(),this.setState({urls:this.state.urls.newSetWithBlob(r.old_blob,r.new_blob)},o),n.label=2;case 2:return[2]}})})},t.prototype.onMetadataLoad=function(e){var t={page:1,pages:e.page_count},n=h.docTypeFromExtension(this.props.fileExtension);this.props.frameMessenger.postMessageToParent("pagerendered",{current_page:t.page,pages_count:t.pages,doc_type:n,attributes:t})},t.prototype.render=function(){var e={annotations:this.state.annotations||[],isAnnotationCreationEnabled:!!this.state.isAnnotationCreationEnabled,isAnnotationRegionEnabled:!!this.state.isAnnotationRegionEnabled,isAnnotationHighlightEnabled:!!this.state.isAnnotationHighlightEnabled,frameMessenger:this.props.frameMessenger};return o.createElement(p.Viewer,{fileExtension:this.props.fileExtension,placeholderImageUrl:this.placeholderImageUrl,urls:this.state.urls,metadata:this.state.metadata,text:this.state.text,links:this.state.links,onPageRenderComplete:this.onPageRenderComplete,onPageImageLoad:this.onPageImageLoad,onPlaceholderImageLoad:this.props.timelineCallbacks.onPlaceholderImageLoad,annotationProps:e,attributionProps:this.state.attributionProps,isFullscreen:this.props.isFullscreen,isToolbarVisible:this.props.isToolbarVisible,onExitFullscreen:this.props.onExitFullscreen,shouldLoadLowResImg:this.props.shouldLoadLowResImg,printProps:this.props.printProps})},t})(o.PureComponent);t.App=g}),define("modules/clean/react/previews/pdf_viewer/connection_pool",["require","exports","tslib","modules/clean/ajax"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e){this.inflightConnections=0,this.waitingConnections=[],this.maxConnections=e.maxConnections}return e.prototype.request=function(e,t){var n=this;return new Promise(function(i,o){n.waitingConnections.push({request:e,onBeforeExecute:t,resolve:i,reject:o}),n.maybeSendRequest()})},e.prototype.shutdown=function(){this.waitingConnections=[]},e.prototype.maybeSendRequest=function(){var e=this;if(0!==this.waitingConnections.length)for(var t=function(){var t=o.waitingConnections.pop();if(!t)return{value:void 0};if(t.onBeforeExecute){var r=!1,s=function(){return r=!0};if(t.onBeforeExecute(s),r)return"continue"}o.inflightConnections++,i.SilentBackgroundRequest(n.__assign({},t.request,{success:function(e){return t.resolve(e)},error:function(e,n,i){return t.reject({error:i,jqXHR:e})},complete:function(){e.inflightConnections--,e.maybeSendRequest()}}))},o=this;this.inflightConnections<this.maxConnections;){var r=t();if("object"==typeof r)return r.value}},e})();t.ConnectionPool=o}),define("modules/clean/react/previews/pdf_viewer/error_snackbar",["require","exports","tslib","external/react"],function(e,t,n,i){"use strict";function o(e){return i.createElement("svg",{width:"32px",height:"32px",viewBox:"0 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},i.createElement("defs",null),i.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.createElement("g",null,i.createElement("ellipse",{fill:"#F22322",cx:"16",cy:"16",rx:"8",ry:"8"}),i.createElement("rect",{fill:"#FFFFFF",x:"13",y:"15.7",width:"6",height:"1.6"}))))}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.onClick()},t}return n.__extends(t,e),t.prototype.render=function(){return i.createElement("div",{className:"pdf-snackbar"+(this.props.isToolbarVisible?" pdf-snackbar__toolbar-visible":"")},i.createElement("div",{className:"c-snackbar-fail o-snackbar-large"},i.createElement("div",{className:"c-snackbar-container o-snackbar-large o-snackbar-icon"},i.createElement("div",{className:"c-snackbar-icon"},i.createElement(o,null)),i.createElement("p",null,this.props.text),i.createElement("a",{href:"#",className:"c-snackbar-actions",onClick:this.onClick},this.props.buttonText))))},t})(i.Component);t.ErrorSnackbar=r}),define("modules/clean/react/previews/pdf_viewer/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventEmitter=new n}),define("modules/clean/react/previews/pdf_viewer/font",["require","exports"],function(e,t){"use strict";function n(e){var t=e.n.lastIndexOf(",");return{fontFamily:'"'+(t>-1?e.n.substr(0,t):e.n)+'", '+(1&e.f?"monospace":"serif"),isBold:(e.f&1<<18)>0,isItalic:(64&e.f)>0}}Object.defineProperty(t,"__esModule",{value:!0});t.renderFont=n}),define("modules/clean/react/previews/pdf_viewer/frame_messenger_shims",["require","exports","tslib","external/eventemitter3","modules/clean/frame_messenger/frame_messenger_client","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,i,o,r){"use strict";function s(){return{parentEmitter:new i,childEmitter:new i}}Object.defineProperty(t,"__esModule",{value:!0});t.makeChannel=s;var a=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){this.handler=t,this.validActions=n},t.prototype.startListening=function(){this.channel.childEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.childEmitter.off("message",this.eventListener)},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={}),this.channel.parentEmitter.emit("message",{action:e,parameters:t})},t})(r.FrameMessengerHost);t.FrameMessengerHostShim=a;var l=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this.validActions=t,this.handler=e},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={}),this.channel.childEmitter.emit("message",{action:e,parameters:t})},t.prototype.startListening=function(){this.channel.parentEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.parentEmitter.off("message",this.eventListener)},t})(o.FrameMessengerClient);t.FrameMessengerClientShim=l}),define("modules/clean/react/previews/pdf_viewer/keyboard_bindings",["require","exports","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode"],function(e,t,n,i){"use strict";function o(e,n,i){var o=e?t.getLeftRightKeyboardBindings(n,i):[];return t.getPageUpPageDownKeyboardBindings(n,i).concat(t.getUpDownKeyboardBindings(n,i),o)}function r(e,o,r){var s=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:i.KeyCode.UP},callback:o}),a=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:i.KeyCode.DOWN},callback:r}),l=e?t.getUpDownKeyboardBindings(o,r).concat(t.getLeftRightKeyboardBindings(o,r)):[];return[s,a].concat(t.getPageUpPageDownKeyboardBindings(o,r),l)}function s(e,t,o){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.F},callback:o})].concat(n.getEqualsKeyBindings(e),n.getMinusKeyBindings(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getLeftRightKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.LEFT},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.RIGHT},callback:t})]},t.getUpDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.DOWN},callback:t})]},t.getPageUpPageDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.PAGE_UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:i.KeyCode.PAGE_DOWN},callback:t})]},t.getPPTKeyboardBindings=o,t.getPDFKeyboardBindings=r,t.getViewerKeyboardBindings=s}),define("modules/clean/react/previews/pdf_viewer/links_layer",["require","exports","tslib","external/react","modules/clean/referrer_cleansing_redirect","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";function s(e){return!!e.ur}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.links.map(function(e,t){var n=e.a,a=e.r,l=a[0],c=a[1],u=a[2],p=a[3];p<0&&(c+=p,p=-p),u<0&&(l+=u,u=-u);var d={position:"absolute",bottom:c,left:l,width:u,height:p};return s(n)?i.createElement("a",{key:t,style:d,href:o.get_redirect_uri(n.ur).toString(),target:"_blank",rel:"noreferrer noopener","aria-label":r._("External Link")}):i.createElement("a",{key:t,style:d,href:"#pageContainer"+(n.pn+1),"aria-label":r._("Internal Link")})});return i.createElement("div",{className:"links-layer-inner"},e)},t})(i.PureComponent),l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return i.createElement("div",{className:"links-layer",style:{position:"absolute",bottom:0,left:0,width:0,height:0,transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"}},i.createElement(a,{links:this.props.links}))},t})(i.PureComponent);t.LinksLayer=l}),define("modules/clean/react/previews/pdf_viewer/page",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/gutter_attributions/container","modules/clean/react/previews/pdf_viewer/annotation_creation_layer","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/links_layer","modules/clean/react/previews/pdf_viewer/annotation_view_layer","modules/clean/react/previews/pdf_viewer/text_box","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/zoom"],function(e,t,n,i,o,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTextboxRender=function(){t.numTextboxes--,0===t.numTextboxes&&t.props.onRender()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){0===this.props.textboxes.length&&this.props.onRender()},t.prototype.render=function(){var e=this,t=this.props.textboxes;this.numTextboxes=t.length;var n=t.map(function(t,n){var o=t.t,r=t.r,s=t.d,a=r[0],l=r[1],c=r[2],p=r[3];return i.createElement(u.TextBox,{key:n,text:o,x:a,y:l,width:c,height:p,rotation:s,font:t.font,fontSize:t.h,onRender:e.onTextboxRender})});return i.createElement("div",{className:"text-layer-inner"},n)},t})(i.PureComponent),h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e={position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,
transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"};return i.createElement("div",{className:"textLayer",style:e},i.createElement(m,{textboxes:this.props.textboxes,onRender:this.props.onRender}))},t})(i.PureComponent);t.TextLayer=h;var f=(function(){function e(){this.imageLoad=new p.TimingStat,this.pageRender=new p.TimingStat}return e})(),_=(function(e){function t(t){var n=e.call(this,t)||this;return n.timingStats=new f,n.imageLoaded=!1,n.textRendered=!1,n.hasError=!1,n.imageElRef=function(e){return n.imageEl=e},n.onMouseDown=function(e){e.persist(),n.updateOffset(),n.annotationCreationDelegate.onMouseDownCallback(e)},n.onMouseMove=function(e){e.persist(),n.annotationCreationDelegate.onMouseMoveCallback(e)},n.onMouseUp=function(e){e.persist(),n.annotationCreationDelegate.onMouseUpCallback(e)},n.updateOffset=function(){var e=o.findDOMNode(n),t=e.getBoundingClientRect(),i=document.body,r=document.documentElement,s=window.pageYOffset||r.scrollTop||i.scrollTop,a=window.pageXOffset||r.scrollLeft||i.scrollLeft,l=r.clientTop||i.clientTop||0,c=r.clientLeft||i.clientLeft||0,u=t.top+s-l,p=t.left+a-c,d=t.right-t.left,m=t.bottom-t.top;n.setState({offset:{top:u,left:p,bottom:u+m,right:p+d}})},n.onScroll=function(){n.updateOffset(),n.annotationCreationDelegate.onScrollCallback()},n.onImageLoaded=function(){n.imageLoaded||(n.imageLoaded=!0,n.timingStats.imageLoad.timeEnd(),n.props.onImageLoad&&n.props.onImageLoad(n.props.pageIndex,n.timingStats.imageLoad),n.onTimingEventCompleted())},n.onTextRendered=function(){n.textRendered||(n.textRendered=!0,n.onTimingEventCompleted())},n.shouldMarkTimingEventCompleted=function(){return n.imageLoaded&&(n.props.loadImageOnly||n.textRendered)},n.onTimingEventCompleted=function(){n.shouldMarkTimingEventCompleted()&&(n.timingStats.pageRender.timeEnd(),n.props.onRenderComplete&&n.props.onRenderComplete(n.props.pageIndex,n.timingStats.pageRender))},n.onError=function(){n.hasError=!0,n.props.onImageError&&n.props.onImageError(n.props.pageIndex)},n.state={},n.annotationCreationDelegate={onMouseDownCallback:function(e){},onMouseMoveCallback:function(e){},onMouseUpCallback:function(e){},onScrollCallback:function(){}},n}return n.__extends(t,e),t.prototype.startTiming=function(){this.timingStats=new f,this.timingStats.imageLoad.time(),this.timingStats.pageRender.time()},t.prototype.componentWillMount=function(){this.startTiming()},t.prototype.componentDidMount=function(){a.eventEmitter.on("scroll",this.onScroll),this.updateOffset(),this.imageEl&&this.imageEl.complete&&!this.hasError&&this.onImageLoaded()},t.prototype.componentWillUnmount=function(){a.eventEmitter.off("scroll",this.onScroll)},t.prototype.componentWillUpdate=function(e,t){this.props.pageIndex!==e.pageIndex&&(this.imageLoaded=!1,this.textRendered=!1,this.hasError=!1,this.startTiming())},t.prototype.render=function(){var e=null,t=null,n=null,o=null,a=null,u=null,p=null,m="";p=this.props.pageIndex+1,m="pageContainer"+p;var f="pageImage"+p,_=d.calculatedFetchedScaleFactor(this.props.clientScaleFactor,this.props);if(n=i.createElement("div",{className:"page-image-wrapper"},i.createElement("img",{ref:this.imageElRef,alt:"",key:f,width:"100%","aria-hidden":"true",src:this.props.urls.imageUrl(this.props.pageIndex,100*_),onLoad:this.onImageLoaded,onError:this.onError})),this.props.loadImageOnly||(e=i.createElement(h,{width:this.props.originalWidth,height:this.props.originalHeight,textboxes:this.props.textboxes||[],clientScaleFactor:this.props.clientScaleFactor,onRender:this.onTextRendered}),t=i.createElement(l.LinksLayer,{width:this.props.originalWidth,height:this.props.originalHeight,links:this.props.links||[],clientScaleFactor:this.props.clientScaleFactor})),this.props.annotationProps){var v=this.props.annotationProps;o=i.createElement(c.AnnotationViewLayer,{annotations:v.annotations||[],page:p,width:this.props.originalWidth,height:this.props.originalHeight,scaleFactor:this.props.clientScaleFactor,frameMessenger:v.frameMessenger});var g=v.isAnnotationCreationEnabled;this.props.annotationProps.isAnnotationCreationEnabled&&(a=i.createElement(s.AnnotationCreationLayer,{pageNumber:p,width:this.props.originalWidth,height:this.props.originalHeight,scaleFactor:this.props.clientScaleFactor,parentOffset:this.state.offset,delegate:this.annotationCreationDelegate,frameMessenger:v.frameMessenger,isAnnotationCreationEnabled:g,isAnnotationHighlightEnabled:v.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:v.isAnnotationRegionEnabled}))}this.props.attributionProps&&(u=i.createElement(r.GutterAttributionsContainer,{attributions:this.props.attributionProps.attributions,accounts:this.props.attributionProps.accounts}));var y=i.createElement("div",{className:"c-loader"}),E={width:this.props.originalWidth*this.props.clientScaleFactor,height:this.props.originalHeight*this.props.clientScaleFactor};return i.createElement("div",{id:m,className:"page","data-page-number":p,style:E,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp},y,a,o,n,e,t,u)},t})(i.PureComponent);t.Page=_}),define("modules/clean/react/previews/pdf_viewer/password_modal",["require","exports","tslib","external/classnames","external/react","modules/clean/react/input","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=function(e){n.setState({password:e.target.value})},n.onClickSubmit=function(){n.props.onSubmit(n.state.password)},n.onFormSubmit=function(e){e.preventDefault(),n.onClickSubmit()},n.state={password:""},n}return n.__extends(t,e),t.prototype.getMessage=function(){return this.props.isFirstAttempt?a._("Enter the password to open this file."):a._("The password you entered is incorrect, please try again.")},t.prototype.render=function(){var e=i({"db-modal-message":!0,"wrong-password":!this.props.isFirstAttempt});return o.createElement(s.Modal,{className:"password-modal",title:a._("This file is password protected"),acceptButtonText:a._("Submit"),dismissButtonText:a._("Cancel"),onAccept:this.onClickSubmit,onDismiss:this.props.onDismiss,style:"default-maestro"},o.createElement("form",{method:"post",onSubmit:this.onFormSubmit},o.createElement("div",{className:e},this.getMessage(),o.createElement(r.password,{value:this.state.password,placeholder:a._("Password"),onChange:this.onChange}),o.createElement("input",{type:"submit",style:{display:"none"}}))))},t})(o.PureComponent);t.PasswordModal=l}),define("modules/clean/react/previews/pdf_viewer/pdf_viewer",["require","exports","tslib","external/react","external/underscore","external/classnames","modules/core/browser","modules/core/browser","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.pageContainerRef=function(e){return n.pageContainerDOM=e},n.updateTextLayerPageIndex=function(){n.setState({textLayerPage:n.state.currentPage})},n.debouncedUpdateTextLayerPageIndex=o.debounce(n.updateTextLayerPageIndex,200),n.onScrollTopChange=function(e){if(void 0===e&&(e=function(e){}),n.props.metadata&&n.props.clientScaleFactor){c.eventEmitter.emit("scroll"),n.props.annotationProps&&n.props.annotationProps.frameMessenger.postMessageToParent("scroll");for(var t=n.pageContainerDOM.scrollTop+n.pageContainerDOM.clientHeight/2,i=0,o=n.props.clientScaleFactor,r=0,s=n.props.metadata.dimensions;r<s.length;r++){var a=s[r],l=(a[0],a[1]),u=a[2],p=(l*o+18)*u;if(!(t>p)){i+=Math.floor((t+1)/(l*o+18));break}t-=p,i+=u}i!==n.state.currentPage?n.onPageNumberUpdated(i,function(){return e(i)}):e(i)}},n.throttledOnScrollTopChange=o.throttle(n.onScrollTopChange,100),n.debouncedOnScrollTopChange=o.debounce(n.onScrollTopChange,200),n.maxScrollSpeed=100,n.onScroll=function(){var e=n.checkScrollSpeed();if(Math.abs(e)>n.maxScrollSpeed)return void n.debouncedOnScrollTopChange();n.throttledOnScrollTopChange(),n.debouncedUpdateTextLayerPageIndex()},n.lastPos=null,n.checkScrollSpeed=function(){var e=0,t=n.pageContainerDOM.scrollTop;return null!==n.lastPos&&(e=t-n.lastPos),n.lastPos=t,e},n.pageDown=function(){n.setPage(n.state.currentPage+1)},n.pageUp=function(){n.setPage(n.state.currentPage-1)},n.onSetCurrentPage=function(e){n.setPage(e,function(t){c.eventEmitter.emit("page-set-to",t,e)})},n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPage)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPage)},n.onPageUp=m.withPreventDefault(n.pageUp),n.onPageDown=m.withPreventDefault(n.pageDown),n.fullScreenKeyboardBindings=d.getPDFKeyboardBindings(!0,n.onPageUp,n.onPageDown),n.keyboardBindings=d.getPDFKeyboardBindings(!1,n.onPageUp,n.onPageDown),n.state={currentPage:0,textLayerPage:0,fetchedImageScaleFactor:0},n.isMobileOrTablet=s.is_mobile_or_tablet(),n.backwardBatchSize=n.isMobileOrTablet?1:3,n.forwardBatchSize=n.isMobileOrTablet?2:4,n}return n.__extends(t,e),t.prototype.onPageNumberUpdated=function(e,t){void 0===t&&(t=function(){}),this.setState({currentPage:e},t),c.eventEmitter.emit("scrolled-to-page",e)},t.prototype.setPage=function(e,t){if(void 0===t&&(t=function(e){}),!(e<0||e>=this.props.metadata.page_count)&&this.props.clientScaleFactor){for(var n=0,i=this.props.clientScaleFactor,o=0,r=this.props.metadata.dimensions;o<r.length;o++){var s=r[o],a=(s[0],s[1]),l=s[2];if(!(e>=l)){n+=(18+a*i)*e;break}n+=(18+a*i)*l,e-=l}this.pageContainerDOM.scrollTop=n,this.onScrollTopChange(t),this.updateTextLayerPageIndex()}},t.prototype.getStartPage=function(e){return Math.max(0,e-this.backwardBatchSize)},t.prototype.getEndPage=function(e){return Math.min(this.props.metadata.page_count,e+this.forwardBatchSize)},t.prototype.componentDidMount=function(){c.eventEmitter.on("page-down",this.pageDown),c.eventEmitter.on("page-up",this.pageUp),c.eventEmitter.on("set-current-page",this.onSetCurrentPage)},t.prototype.componentWillReceiveProps=function(e){e.clientScaleFactor!==this.props.clientScaleFactor&&this.props.annotationProps&&u.resetAnnotationState(this.props.annotationProps.frameMessenger,this.pageContainerDOM)},t.prototype.componentDidUpdate=function(e,t){if(this.pageContainerDOM&&this.props.clientScaleFactor&&e.clientScaleFactor&&this.props.clientScaleFactor!==e.clientScaleFactor){var n=this.pageContainerDOM.scrollTop,i=this.pageContainerDOM.scrollLeft,o=18*(this.state.currentPage+1),r=this.props.clientScaleFactor/e.clientScaleFactor;n>o&&(this.pageContainerDOM.scrollTop=(n-o)*r+o),i>18&&(this.pageContainerDOM.scrollLeft=(i-18)*r+18),this.maxScrollSpeed*=e.clientScaleFactor/this.props.clientScaleFactor}},t.prototype.componentWillUnmount=function(){c.eventEmitter.off("page-down",this.pageDown),c.eventEmitter.off("page-up",this.pageUp),c.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.render=function(){if(!this.props.clientScaleFactor)return null;for(var e=this.props,t=e.clientScaleFactor,n=e.metadata,o=this.getStartPage(this.state.currentPage),s=this.getEndPage(this.state.currentPage),c=this.getStartPage(this.state.textLayerPage),d=this.getEndPage(this.state.textLayerPage),m=u.expandDimensions(n.dimensions),h=[],f=o;f<s;f++){var _=m[f],v=_[0],g=_[1],y=f>=c&&f<d?this.props.text[f]:[],E=f>=c&&f<d?(this.props.links||{})[f]||[]:[];h.push(i.createElement(l.Page,{key:f,originalWidth:v,originalHeight:g,urls:this.props.urls,pageIndex:f,clientScaleFactor:t,loadImageOnly:this.isMobileOrTablet,textboxes:y,links:E,annotationProps:u.annotationsAtPage(this.props.annotationProps,f),attributionProps:u.attributionAtPage(this.props.attributionProps,f),onRenderComplete:this.onPageRenderComplete,onImageLoad:this.onPageImageLoad,onImageError:this.props.onImageError}))}var w=o>0?u.getTotalSize(m.slice(0,o),t,18)[1]+18:0,b=u.getTotalSize(m,t,18)[1],P={height:b},C={top:w};return i.createElement("div",{className:r({"page-container":!0,"ios-enable-inertial-scroll":a.iOS}),onScroll:this.onScroll,ref:this.pageContainerRef},i.createElement(p.KeyboardBindingConnector,{keyboardBindings:this.props.isFullscreen?this.fullScreenKeyboardBindings:this.keyboardBindings}),i.createElement("div",{style:P},i.createElement("div",{className:"page-container-inner",style:C},h)))},t})(i.PureComponent);t.PdfViewer=h}),define("modules/clean/react/previews/pdf_viewer/ppt_viewer",["require","exports","tslib","jquery","external/react","external/underscore","modules/core/browser","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/pdf_viewer/keyboard_bindings","external/jquery.mousewheel"],function(e,t,n,i,o,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.slideContainerRef=function(e){return n.slideContainerDOM=e},n.onSetCurrentPage=function(e){n.setPage(e,function(){a.eventEmitter.emit("page-set-to",e,e)})},n.pageDown=function(){n.props.annotationProps&&c.resetAnnotationState(n.props.annotationProps.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex+1)},n.pageUp=function(){n.props.annotationProps&&c.resetAnnotationState(n.props.annotationProps.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex-1)},n.debouncedPageDown=r.debounce(n.pageDown,40,!0),n.debouncedPageUp=r.debounce(n.pageUp,40,!0),n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPageIndex)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPageIndex)},n.fullScreenKeyboardBindings=d.getPPTKeyboardBindings(!0,n.pageUp,n.pageDown),n.keyboardBindings=d.getPPTKeyboardBindings(!1,n.pageUp,n.pageDown),n.state={currentPageIndex:0},n}return n.__extends(t,e),t.fileSupported=function(e){return c.docTypeFromExtension(e)===t.DOC_TYPE},t.deviceSupported=function(){return!s.is_mobile_or_tablet()},t.prototype.componentDidMount=function(){a.eventEmitter.on("page-down",this.pageDown),a.eventEmitter.on("page-up",this.pageUp),a.eventEmitter.on("set-current-page",this.onSetCurrentPage),this.addListeners(),this.prefetchImageAroundPage(this.state.currentPageIndex)},t.prototype.componentWillUnmount=function(){a.eventEmitter.off("page-down",this.pageDown),a.eventEmitter.off("page-up",this.pageUp),a.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.addListeners=function(){var e=this;i(this.slideContainerDOM).on("mousewheel",function(t){t.deltaY<0?e.debouncedPageDown():t.deltaY>0&&e.debouncedPageUp()})},t.prototype.prefetchImageAroundPage=function(e){for(var t=e+1;t<Math.min(e+5+1,this.props.metadata.page_count);t++){var n=this.pageDimension(t);c.prefetchImage(this.props.urls.imageUrl(t,100*u.calculatedFetchedScaleFactor(this.props.clientScaleFactor||0,{originalWidth:n[0],originalHeight:n[1]})))}},t.prototype.setPage=function(e,t){void 0===t&&(t=function(){}),e<0||e>=this.props.metadata.page_count||(this.setState({currentPageIndex:e},t),a.eventEmitter.emit("scrolled-to-page",e),this.prefetchImageAroundPage(e))},t.prototype.pageDimension=function(e){return c.expandDimensions(this.props.metadata.dimensions)[e]},t.prototype.render=function(){if(!this.props.clientScaleFactor)return null;var e=this.pageDimension(this.state.currentPageIndex),t=e[0],n=e[1],i=this.state.currentPageIndex;return o.createElement("div",{className:"slide-container",ref:this.slideContainerRef},o.createElement(p.KeyboardBindingConnector,{keyboardBindings:this.props.isFullscreen?this.fullScreenKeyboardBindings:this.keyboardBindings}),o.createElement(l.Page,{key:this.state.currentPageIndex,pageIndex:i,textboxes:this.props.text[i],links:(this.props.links||{})[i]||[],urls:this.props.urls,originalWidth:t,originalHeight:n,clientScaleFactor:this.props.clientScaleFactor,onRenderComplete:this.onPageRenderComplete,onImageLoad:this.onPageImageLoad,loadImageOnly:!1,attributionProps:c.attributionAtPage(this.props.attributionProps,i),annotationProps:c.annotationsAtPage(this.props.annotationProps,i),onImageError:this.props.onImageError}))},t.DOC_TYPE="spp",t})(o.PureComponent);t.PowerPointViewer=m}),define("modules/clean/react/previews/pdf_viewer/print_modal",["require","exports","tslib","external/react","external/spectrum/modal","modules/clean/previews/actions","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/printable","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isAttempting:!1,context:""},t.onPrint=function(e){var n=t.props.printProps,i=n.canPrint,o=n.isSharedLink,s=n.fileBlockServerUrl,a=n.fileHref;if(i){r.nativePrint(o,s,a,e)||t.setState({isAttempting:!0,context:e})}},t.dismiss=function(){t.setState({isAttempting:!1})},t.webPrint=function(){c.print(t.props.metadata,t.props.urls),t.setState({isAttempting:!1}),s.logUserAction(a.UserActionNames.PRINT,t.state.context)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;l.eventEmitter.on("print",function(t){e.onPrint(t.context)})},t.prototype.componentWillUnmount=function(){var e=this;l.eventEmitter.off("print",function(t){e.onPrint(t.context)})},t.prototype.render=function(){return this.state.isAttempting?i.createElement(o.UtilityModal,{primaryAction:u._("Dismiss"),secondaryAction:u._("Print Anyways"),title:u._("Low Quality Printing"),ariaLabel:"print",open:!0,onPrimaryAction:this.dismiss,onSecondaryAction:this.webPrint,overlayClassName:"preview-pdf-modal-overlay"},u._("Printing in this browser may result in lower quality. For higher quality printing, use Chrome, or download the file to print.")):null},t})(i.PureComponent);t.PrintModal=p}),define("modules/clean/react/previews/pdf_viewer/printable",["require","exports","tslib","external/react","external/react-dom","external/underscore","modules/clean/react/previews/pdf_viewer/progress_bar","modules/clean/react/previews/pdf_viewer/utils","modules/core/exception"],function(e,t,n,i,o,r,s,a,l){"use strict";function c(e,t){var n=window.open("about:blank"),s=r.max(e.dimensions,function(e){return e[2]}),a=s[0]/72,l=s[1]/72;window.setTimeout(function(){var r=n.document.createElement("style");r.innerHTML="\n      @page { margin: 0; size: "+a+"in "+l+"in; }\n      img { width: 100%; }\n      .print-progress { height: 8px; background-color: #0070E0; float: left; }\n    ",n.document.head.appendChild(r);var s=n.document.createElement("div");n.document.body.appendChild(s);var c=function(){n.print()};o.render(i.createElement(u,{metadata:e,document:n.document,onLoad:c,urls:t}),s)},50)}Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.imagesLoaded={},t.state={numImagesLoaded:0},t.onImageResolve=function(e){return function(){t.state.numImagesLoaded<t.props.metadata.page_count&&!t.imagesLoaded[e]&&(t.imagesLoaded[e]=!0,t.setState(function(e,t){return{numImagesLoaded:e.numImagesLoaded+1}}))}},t}return n.__extends(t,e),t.prototype.printIfReady=function(){if(l.assert(this.state.numImagesLoaded<=this.props.metadata.page_count),this.state.numImagesLoaded===this.props.metadata.page_count&&this.props.onLoad)return void this.props.onLoad()},t.prototype.componentDidMount=function(){for(var e=0,t=this.props.document.getElementsByTagName("img"),n=0;n<t.length;n++)t[n].complete&&e++;this.setState({numImagesLoaded:e})},t.prototype.componentDidUpdate=function(e,t){this.printIfReady()},t.prototype.render=function(){var e=this,t={pageBreakInside:"avoid",pageBreakAfter:"always"};return i.createElement("div",null,i.createElement(s.ProgressBar,{totalImages:this.props.metadata.page_count,numImagesLoaded:this.state.numImagesLoaded}),a.mapPages(this.props.metadata.dimensions,function(n,o,r){return i.createElement("img",{key:n,src:e.props.urls.imageUrl(n),style:t,onLoad:e.onImageResolve(n),onError:e.onImageResolve(n),alt:""+(n+1)})}))},t})(i.Component);t.Printable=u,t.print=c}),define("modules/clean/react/previews/pdf_viewer/progress_bar",["require","exports","tslib","external/react"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.calculatePercentComplete=function(){return this.props.numImagesLoaded/this.props.totalImages*100},t.prototype.render=function(){var e={width:this.calculatePercentComplete()+"%"};return i.createElement("div",{className:"print-progress",style:e})},t})(i.PureComponent);t.ProgressBar=o}),define("modules/clean/react/previews/pdf_viewer/text/bidi",["require","exports"],function(e,t){"use strict";function n(e){return 0!==(1&e)}function i(e){return 0===(1&e)}function o(e,t,n){for(var i=t,o=e.length;i<o;++i)if(e[i]!==n)return i;return i}function r(e,t,n,i){for(var o=t;o<n;++o)e[o]=i}function s(e,t,n){for(var i=t,o=n-1;i<o;++i,--o){var r=e[i];e[i]=e[o],e[o]=r}}function a(e,t,n){return{str:e,dir:n?"ttb":t?"ltr":"rtl"}}function l(e,t,l){var m=!0,h=e.length;if(0===h||l)return a(e,m,l);p.length=h,d.length=h;var f,_,v=0;for(f=0;f<h;++f){p[f]=e.charAt(f);var g=e.charCodeAt(f),y="L";g<=255?y=c[g]:1424<=g&&g<=1524?y="R":1536<=g&&g<=1791?y=u[255&g]:1792<=g&&g<=2220&&(y="AL"),"R"!==y&&"AL"!==y&&"AN"!==y||v++,d[f]=y}if(0===v)return m=!0,a(e,m);t===-1&&(v/h<.3?(m=!0,t=0):(m=!1,t=1));var E=[];for(f=0;f<h;++f)E[f]=t;var w=n(t)?"R":"L",b=w,P=b,C=b;for(f=0;f<h;++f)"NSM"===d[f]?d[f]=C:C=d[f];C=b;var A;for(f=0;f<h;++f)A=d[f],"EN"===A?d[f]="AL"===C?"AN":"EN":"R"!==A&&"L"!==A&&"AL"!==A||(C=A);for(f=0;f<h;++f)A=d[f],"AL"===A&&(d[f]="R");for(f=1;f<h-1;++f)"ES"===d[f]&&"EN"===d[f-1]&&"EN"===d[f+1]&&(d[f]="EN"),"CS"!==d[f]||"EN"!==d[f-1]&&"AN"!==d[f-1]||d[f+1]!==d[f-1]||(d[f]=d[f-1]);for(f=0;f<h;++f)if("EN"===d[f]){var S;for(S=f-1;S>=0&&"ET"===d[S];--S)d[S]="EN";for(S=f+1;S<h&&"ET"===d[S];++S)d[S]="EN"}for(f=0;f<h;++f)A=d[f],"WS"!==A&&"ES"!==A&&"ET"!==A&&"CS"!==A||(d[f]="ON");for(C=b,f=0;f<h;++f)A=d[f],"EN"===A?d[f]="L"===C?"L":"EN":"R"!==A&&"L"!==A||(C=A);for(f=0;f<h;++f)if("ON"===d[f]){var T=o(d,f+1,"ON"),I=b;f>0&&(I=d[f-1]);var O=P;T+1<h&&(O=d[T+1]),"L"!==I&&(I="R"),"L"!==O&&(O="R"),I===O&&r(d,f,T,I),f=T-1}for(f=0;f<h;++f)"ON"===d[f]&&(d[f]=w);for(f=0;f<h;++f)A=d[f],i(E[f])?"R"===A?E[f]+=1:"AN"!==A&&"EN"!==A||(E[f]+=2):"L"!==A&&"AN"!==A&&"EN"!==A||(E[f]+=1);var R,L=-1,N=99;for(f=0,_=E.length;f<_;++f)R=E[f],L<R&&(L=R),N>R&&n(R)&&(N=R);for(R=L;R>=N;--R){var x=-1;for(f=0,_=E.length;f<_;++f)E[f]<R?x>=0&&(s(p,x,f),x=-1):x<0&&(x=f);x>=0&&s(p,x,E.length)}for(f=0,_=p.length;f<_;++f){var F=p[f];"<"!==F&&">"!==F||(p[f]="")}return a(p.join(""),m)}Object.defineProperty(t,"__esModule",{value:!0});var c=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],u=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"],p=[],d=[];t.bidi=l}),define("modules/clean/react/previews/pdf_viewer/text/unicode",["require","exports"],function(e,t){"use strict";function n(e){var t;return function(){return e&&(t=Object.create(null),e(t),e=null),t}}function i(e){var t=r[13];return e>=t.begin&&e<t.end||(t=r[11],e>=t.begin&&e<t.end)}function o(e){var t=e.length;if(t<=1||!i(e.charCodeAt(0)))return e;for(var n="",o=t-1;o>=0;o--)n+=e[o];return n}Object.defineProperty(t,"__esModule",{value:!0});var r=(n(function(e){e[63721]=169,e[63193]=169,e[63720]=174,e[63194]=174,e[63722]=8482,e[63195]=8482,e[63729]=9127,e[63730]=9128,e[63731]=9129,e[63740]=9131,e[63741]=9132,e[63742]=9133,e[63726]=9121,e[63727]=9122,e[63728]=9123,e[63737]=9124,e[63738]=9125,e[63739]=9126,e[63723]=9115,e[63724]=9116,e[63725]=9117,e[63734]=9118,e[63735]=9119,e[63736]=9120}),[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}]);t.getNormalizedUnicodes=n(function(e){e["¨"]=" ̈",e["¯"]=" ̄",e["´"]=" ́",e["µ"]="μ",e["¸"]=" ̧",e["Ĳ"]="IJ",e["ĳ"]="ij",e["Ŀ"]="L·",e["ŀ"]="l·",e["ŉ"]="ʼn",e["ſ"]="s",e["Ǆ"]="DŽ",e["ǅ"]="Dž",e["ǆ"]="dž",e["Ǉ"]="LJ",e["ǈ"]="Lj",e["ǉ"]="lj",e["Ǌ"]="NJ",e["ǋ"]="Nj",e["ǌ"]="nj",e["Ǳ"]="DZ",e["ǲ"]="Dz",e["ǳ"]="dz",e["˘"]=" ̆",e["˙"]=" ̇",e["˚"]=" ̊",e["˛"]=" ̨",e["˜"]=" ̃",e["˝"]=" ̋",e["ͺ"]=" ͅ",e["΄"]=" ́",e["ϐ"]="β",e["ϑ"]="θ",e["ϒ"]="Υ",e["ϕ"]="φ",e["ϖ"]="π",e["ϰ"]="κ",e["ϱ"]="ρ",e["ϲ"]="ς",e["ϴ"]="Θ",e["ϵ"]="ε",e["Ϲ"]="Σ",e["և"]="եւ",e["ٵ"]="اٴ",e["ٶ"]="وٴ",e["ٷ"]="ۇٴ",e["ٸ"]="يٴ",e["ำ"]="ํา",e["ຳ"]="ໍາ",e["ໜ"]="ຫນ",e["ໝ"]="ຫມ",e["ཷ"]="ྲཱྀ",e["ཹ"]="ླཱྀ",e["ẚ"]="aʾ",e["᾽"]=" ̓",e["᾿"]=" ̓",e["῀"]=" ͂",e["῾"]=" ̔",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e["‗"]=" ̳",e["․"]=".",e["‥"]="..",e["…"]="...",e["″"]="′′",e["‴"]="′′′",e["‶"]="‵‵",e["‷"]="‵‵‵",e["‼"]="!!",e["‾"]=" ̅",e["⁇"]="??",e["⁈"]="?!",e["⁉"]="!?",e["⁗"]="′′′′",e[" "]=" ",e["₨"]="Rs",e["℀"]="a/c",e["℁"]="a/s",e["℃"]="°C",e["℅"]="c/o",e["℆"]="c/u",e["ℇ"]="Ɛ",e["℉"]="°F",e["№"]="No",e["℡"]="TEL",e["ℵ"]="א",e["ℶ"]="ב",e["ℷ"]="ג",e["ℸ"]="ד",e["℻"]="FAX",e["Ⅰ"]="I",e["Ⅱ"]="II",e["Ⅲ"]="III",e["Ⅳ"]="IV",e["Ⅴ"]="V",e["Ⅵ"]="VI",e["Ⅶ"]="VII",e["Ⅷ"]="VIII",e["Ⅸ"]="IX",e["Ⅹ"]="X",e["Ⅺ"]="XI",e["Ⅻ"]="XII",e["Ⅼ"]="L",e["Ⅽ"]="C",e["Ⅾ"]="D",e["Ⅿ"]="M",e["ⅰ"]="i",e["ⅱ"]="ii",e["ⅲ"]="iii",e["ⅳ"]="iv",e["ⅴ"]="v",e["ⅵ"]="vi",e["ⅶ"]="vii",e["ⅷ"]="viii",e["ⅸ"]="ix",e["ⅹ"]="x",e["ⅺ"]="xi",e["ⅻ"]="xii",e["ⅼ"]="l",e["ⅽ"]="c",e["ⅾ"]="d",e["ⅿ"]="m",e["∬"]="∫∫",e["∭"]="∫∫∫",e["∯"]="∮∮",e["∰"]="∮∮∮",e["⑴"]="(1)",e["⑵"]="(2)",e["⑶"]="(3)",e["⑷"]="(4)",e["⑸"]="(5)",e["⑹"]="(6)",e["⑺"]="(7)",e["⑻"]="(8)",e["⑼"]="(9)",e["⑽"]="(10)",e["⑾"]="(11)",e["⑿"]="(12)",e["⒀"]="(13)",e["⒁"]="(14)",e["⒂"]="(15)",e["⒃"]="(16)",e["⒄"]="(17)",e["⒅"]="(18)",e["⒆"]="(19)",e["⒇"]="(20)",e["⒈"]="1.",e["⒉"]="2.",e["⒊"]="3.",e["⒋"]="4.",e["⒌"]="5.",e["⒍"]="6.",e["⒎"]="7.",e["⒏"]="8.",e["⒐"]="9.",e["⒑"]="10.",e["⒒"]="11.",e["⒓"]="12.",e["⒔"]="13.",e["⒕"]="14.",e["⒖"]="15.",e["⒗"]="16.",e["⒘"]="17.",e["⒙"]="18.",e["⒚"]="19.",e["⒛"]="20.",e["⒜"]="(a)",e["⒝"]="(b)",e["⒞"]="(c)",e["⒟"]="(d)",e["⒠"]="(e)",e["⒡"]="(f)",e["⒢"]="(g)",e["⒣"]="(h)",e["⒤"]="(i)",e["⒥"]="(j)",e["⒦"]="(k)",e["⒧"]="(l)",e["⒨"]="(m)",e["⒩"]="(n)",e["⒪"]="(o)",e["⒫"]="(p)",e["⒬"]="(q)",e["⒭"]="(r)",
e["⒮"]="(s)",e["⒯"]="(t)",e["⒰"]="(u)",e["⒱"]="(v)",e["⒲"]="(w)",e["⒳"]="(x)",e["⒴"]="(y)",e["⒵"]="(z)",e["⨌"]="∫∫∫∫",e["⩴"]="::=";e["⩵"]="==",e["⩶"]="===",e["⺟"]="母",e["⻳"]="龟",e["⼀"]="一",e["⼁"]="丨",e["⼂"]="丶",e["⼃"]="丿",e["⼄"]="乙",e["⼅"]="亅",e["⼆"]="二",e["⼇"]="亠",e["⼈"]="人",e["⼉"]="儿",e["⼊"]="入",e["⼋"]="八",e["⼌"]="冂",e["⼍"]="冖",e["⼎"]="冫",e["⼏"]="几",e["⼐"]="凵",e["⼑"]="刀",e["⼒"]="力",e["⼓"]="勹",e["⼔"]="匕",e["⼕"]="匚",e["⼖"]="匸",e["⼗"]="十",e["⼘"]="卜",e["⼙"]="卩",e["⼚"]="厂",e["⼛"]="厶",e["⼜"]="又",e["⼝"]="口",e["⼞"]="囗",e["⼟"]="土",e["⼠"]="士",e["⼡"]="夂",e["⼢"]="夊",e["⼣"]="夕",e["⼤"]="大",e["⼥"]="女",e["⼦"]="子",e["⼧"]="宀",e["⼨"]="寸",e["⼩"]="小",e["⼪"]="尢",e["⼫"]="尸",e["⼬"]="屮",e["⼭"]="山",e["⼮"]="巛",e["⼯"]="工",e["⼰"]="己",e["⼱"]="巾",e["⼲"]="干",e["⼳"]="幺",e["⼴"]="广",e["⼵"]="廴",e["⼶"]="廾",e["⼷"]="弋",e["⼸"]="弓",e["⼹"]="彐",e["⼺"]="彡",e["⼻"]="彳",e["⼼"]="心",e["⼽"]="戈",e["⼾"]="戶",e["⼿"]="手",e["⽀"]="支",e["⽁"]="攴",e["⽂"]="文",e["⽃"]="斗",e["⽄"]="斤",e["⽅"]="方",e["⽆"]="无",e["⽇"]="日",e["⽈"]="曰",e["⽉"]="月",e["⽊"]="木",e["⽋"]="欠",e["⽌"]="止",e["⽍"]="歹",e["⽎"]="殳",e["⽏"]="毋",e["⽐"]="比",e["⽑"]="毛",e["⽒"]="氏",e["⽓"]="气",e["⽔"]="水",e["⽕"]="火",e["⽖"]="爪",e["⽗"]="父",e["⽘"]="爻",e["⽙"]="爿",e["⽚"]="片",e["⽛"]="牙",e["⽜"]="牛",e["⽝"]="犬",e["⽞"]="玄",e["⽟"]="玉",e["⽠"]="瓜",e["⽡"]="瓦",e["⽢"]="甘",e["⽣"]="生",e["⽤"]="用",e["⽥"]="田",e["⽦"]="疋",e["⽧"]="疒",e["⽨"]="癶",e["⽩"]="白",e["⽪"]="皮",e["⽫"]="皿",e["⽬"]="目",e["⽭"]="矛",e["⽮"]="矢",e["⽯"]="石",e["⽰"]="示",e["⽱"]="禸",e["⽲"]="禾",e["⽳"]="穴",e["⽴"]="立",e["⽵"]="竹",e["⽶"]="米",e["⽷"]="糸",e["⽸"]="缶",e["⽹"]="网",e["⽺"]="羊",e["⽻"]="羽",e["⽼"]="老",e["⽽"]="而",e["⽾"]="耒",e["⽿"]="耳",e["⾀"]="聿",e["⾁"]="肉",e["⾂"]="臣",e["⾃"]="自",e["⾄"]="至",e["⾅"]="臼",e["⾆"]="舌",e["⾇"]="舛",e["⾈"]="舟",e["⾉"]="艮",e["⾊"]="色",e["⾋"]="艸",e["⾌"]="虍",e["⾍"]="虫",e["⾎"]="血",e["⾏"]="行",e["⾐"]="衣",e["⾑"]="襾",e["⾒"]="見",e["⾓"]="角",e["⾔"]="言",e["⾕"]="谷",e["⾖"]="豆",e["⾗"]="豕",e["⾘"]="豸",e["⾙"]="貝",e["⾚"]="赤",e["⾛"]="走",e["⾜"]="足",e["⾝"]="身",e["⾞"]="車",e["⾟"]="辛",e["⾠"]="辰",e["⾡"]="辵",e["⾢"]="邑",e["⾣"]="酉",e["⾤"]="釆",e["⾥"]="里",e["⾦"]="金",e["⾧"]="長",e["⾨"]="門",e["⾩"]="阜",e["⾪"]="隶",e["⾫"]="隹",e["⾬"]="雨",e["⾭"]="靑",e["⾮"]="非",e["⾯"]="面",e["⾰"]="革",e["⾱"]="韋",e["⾲"]="韭",e["⾳"]="音",e["⾴"]="頁",e["⾵"]="風",e["⾶"]="飛",e["⾷"]="食",e["⾸"]="首",e["⾹"]="香",e["⾺"]="馬",e["⾻"]="骨",e["⾼"]="高",e["⾽"]="髟",e["⾾"]="鬥",e["⾿"]="鬯",e["⿀"]="鬲",e["⿁"]="鬼",e["⿂"]="魚",e["⿃"]="鳥";e["⿄"]="鹵",e["⿅"]="鹿",e["⿆"]="麥",e["⿇"]="麻",e["⿈"]="黃",e["⿉"]="黍",e["⿊"]="黑",e["⿋"]="黹",e["⿌"]="黽",e["⿍"]="鼎",e["⿎"]="鼓",e["⿏"]="鼠",e["⿐"]="鼻",e["⿑"]="齊",e["⿒"]="齒",e["⿓"]="龍",e["⿔"]="龜",e["⿕"]="龠",e["〶"]="〒",e["〸"]="十",e["〹"]="卄",e["〺"]="卅",e["゛"]=" ゙",e["゜"]=" ゚",e["ㄱ"]="ᄀ",e["ㄲ"]="ᄁ",e["ㄳ"]="ᆪ",e["ㄴ"]="ᄂ",e["ㄵ"]="ᆬ",e["ㄶ"]="ᆭ",e["ㄷ"]="ᄃ",e["ㄸ"]="ᄄ",e["ㄹ"]="ᄅ",e["ㄺ"]="ᆰ",e["ㄻ"]="ᆱ",e["ㄼ"]="ᆲ",e["ㄽ"]="ᆳ",e["ㄾ"]="ᆴ",e["ㄿ"]="ᆵ",e["ㅀ"]="ᄚ",e["ㅁ"]="ᄆ",e["ㅂ"]="ᄇ",e["ㅃ"]="ᄈ",e["ㅄ"]="ᄡ",e["ㅅ"]="ᄉ",e["ㅆ"]="ᄊ",e["ㅇ"]="ᄋ",e["ㅈ"]="ᄌ",e["ㅉ"]="ᄍ",e["ㅊ"]="ᄎ",e["ㅋ"]="ᄏ",e["ㅌ"]="ᄐ",e["ㅍ"]="ᄑ",e["ㅎ"]="ᄒ",e["ㅏ"]="ᅡ",e["ㅐ"]="ᅢ",e["ㅑ"]="ᅣ",e["ㅒ"]="ᅤ",e["ㅓ"]="ᅥ",e["ㅔ"]="ᅦ",e["ㅕ"]="ᅧ",e["ㅖ"]="ᅨ",e["ㅗ"]="ᅩ",e["ㅘ"]="ᅪ",e["ㅙ"]="ᅫ",e["ㅚ"]="ᅬ",e["ㅛ"]="ᅭ",e["ㅜ"]="ᅮ",e["ㅝ"]="ᅯ",e["ㅞ"]="ᅰ",e["ㅟ"]="ᅱ",e["ㅠ"]="ᅲ",e["ㅡ"]="ᅳ",e["ㅢ"]="ᅴ",e["ㅣ"]="ᅵ",e["ㅤ"]="ᅠ",e["ㅥ"]="ᄔ",e["ㅦ"]="ᄕ",e["ㅧ"]="ᇇ",e["ㅨ"]="ᇈ",e["ㅩ"]="ᇌ",e["ㅪ"]="ᇎ",e["ㅫ"]="ᇓ",e["ㅬ"]="ᇗ",e["ㅭ"]="ᇙ",e["ㅮ"]="ᄜ",e["ㅯ"]="ᇝ",e["ㅰ"]="ᇟ",e["ㅱ"]="ᄝ",e["ㅲ"]="ᄞ",e["ㅳ"]="ᄠ",e["ㅴ"]="ᄢ",e["ㅵ"]="ᄣ",e["ㅶ"]="ᄧ",e["ㅷ"]="ᄩ",e["ㅸ"]="ᄫ",e["ㅹ"]="ᄬ",e["ㅺ"]="ᄭ",e["ㅻ"]="ᄮ",e["ㅼ"]="ᄯ",e["ㅽ"]="ᄲ",e["ㅾ"]="ᄶ",e["ㅿ"]="ᅀ",e["ㆀ"]="ᅇ",e["ㆁ"]="ᅌ",e["ㆂ"]="ᇱ",e["ㆃ"]="ᇲ",e["ㆄ"]="ᅗ",e["ㆅ"]="ᅘ",e["ㆆ"]="ᅙ",e["ㆇ"]="ᆄ",e["ㆈ"]="ᆅ",e["ㆉ"]="ᆈ",e["ㆊ"]="ᆑ",e["ㆋ"]="ᆒ",e["ㆌ"]="ᆔ",e["ㆍ"]="ᆞ",e["ㆎ"]="ᆡ",e["㈀"]="(ᄀ)",e["㈁"]="(ᄂ)",e["㈂"]="(ᄃ)",e["㈃"]="(ᄅ)",e["㈄"]="(ᄆ)",e["㈅"]="(ᄇ)",e["㈆"]="(ᄉ)",e["㈇"]="(ᄋ)",e["㈈"]="(ᄌ)",e["㈉"]="(ᄎ)",e["㈊"]="(ᄏ)",e["㈋"]="(ᄐ)",e["㈌"]="(ᄑ)",e["㈍"]="(ᄒ)",e["㈎"]="(가)",e["㈏"]="(나)",e["㈐"]="(다)",e["㈑"]="(라)",e["㈒"]="(마)",e["㈓"]="(바)",e["㈔"]="(사)",e["㈕"]="(아)",e["㈖"]="(자)",e["㈗"]="(차)",e["㈘"]="(카)",e["㈙"]="(타)",e["㈚"]="(파)",e["㈛"]="(하)",e["㈜"]="(주)",e["㈝"]="(오전)",e["㈞"]="(오후)",e["㈠"]="(一)",e["㈡"]="(二)",e["㈢"]="(三)",e["㈣"]="(四)",e["㈤"]="(五)",e["㈥"]="(六)",e["㈦"]="(七)",e["㈧"]="(八)",e["㈨"]="(九)",e["㈩"]="(十)",e["㈪"]="(月)",e["㈫"]="(火)",e["㈬"]="(水)",e["㈭"]="(木)",e["㈮"]="(金)",e["㈯"]="(土)",e["㈰"]="(日)",e["㈱"]="(株)",e["㈲"]="(有)",e["㈳"]="(社)",e["㈴"]="(名)",e["㈵"]="(特)",e["㈶"]="(財)",e["㈷"]="(祝)",e["㈸"]="(労)",e["㈹"]="(代)",e["㈺"]="(呼)",e["㈻"]="(学)",e["㈼"]="(監)",e["㈽"]="(企)",e["㈾"]="(資)",e["㈿"]="(協)",e["㉀"]="(祭)",e["㉁"]="(休)",e["㉂"]="(自)",e["㉃"]="(至)",e["㋀"]="1月",e["㋁"]="2月",e["㋂"]="3月",e["㋃"]="4月",e["㋄"]="5月",e["㋅"]="6月",e["㋆"]="7月",e["㋇"]="8月",e["㋈"]="9月",e["㋉"]="10月",e["㋊"]="11月",e["㋋"]="12月",e["㍘"]="0点",e["㍙"]="1点",e["㍚"]="2点";e["㍛"]="3点",e["㍜"]="4点",e["㍝"]="5点",e["㍞"]="6点",e["㍟"]="7点",e["㍠"]="8点",e["㍡"]="9点",e["㍢"]="10点",e["㍣"]="11点",e["㍤"]="12点",e["㍥"]="13点",e["㍦"]="14点",e["㍧"]="15点",e["㍨"]="16点",e["㍩"]="17点",e["㍪"]="18点",e["㍫"]="19点",e["㍬"]="20点",e["㍭"]="21点",e["㍮"]="22点",e["㍯"]="23点",e["㍰"]="24点",e["㏠"]="1日",e["㏡"]="2日",e["㏢"]="3日",e["㏣"]="4日",e["㏤"]="5日",e["㏥"]="6日",e["㏦"]="7日",e["㏧"]="8日",e["㏨"]="9日",e["㏩"]="10日",e["㏪"]="11日",e["㏫"]="12日",e["㏬"]="13日",e["㏭"]="14日",e["㏮"]="15日",e["㏯"]="16日",e["㏰"]="17日",e["㏱"]="18日",e["㏲"]="19日",e["㏳"]="20日",e["㏴"]="21日",e["㏵"]="22日",e["㏶"]="23日",e["㏷"]="24日",e["㏸"]="25日",e["㏹"]="26日",e["㏺"]="27日",e["㏻"]="28日",e["㏼"]="29日",e["㏽"]="30日",e["㏾"]="31日",e["ﬀ"]="ff",e["ﬁ"]="fi",e["ﬂ"]="fl",e["ﬃ"]="ffi",e["ﬄ"]="ffl",e["ﬅ"]="ſt",e["ﬆ"]="st",e["ﬓ"]="մն",e["ﬔ"]="մե",e["ﬕ"]="մի",e["ﬖ"]="վն",e["ﬗ"]="մխ",e["ﭏ"]="אל",e["ﭐ"]="ٱ",e["ﭑ"]="ٱ",e["ﭒ"]="ٻ",e["ﭓ"]="ٻ",e["ﭔ"]="ٻ",e["ﭕ"]="ٻ",e["ﭖ"]="پ",e["ﭗ"]="پ",e["ﭘ"]="پ",e["ﭙ"]="پ",e["ﭚ"]="ڀ",e["ﭛ"]="ڀ",e["ﭜ"]="ڀ",e["ﭝ"]="ڀ",e["ﭞ"]="ٺ",e["ﭟ"]="ٺ",e["ﭠ"]="ٺ",e["ﭡ"]="ٺ",e["ﭢ"]="ٿ",e["ﭣ"]="ٿ",e["ﭤ"]="ٿ",e["ﭥ"]="ٿ",e["ﭦ"]="ٹ",e["ﭧ"]="ٹ",e["ﭨ"]="ٹ",e["ﭩ"]="ٹ",e["ﭪ"]="ڤ",e["ﭫ"]="ڤ",e["ﭬ"]="ڤ",e["ﭭ"]="ڤ",e["ﭮ"]="ڦ",e["ﭯ"]="ڦ",e["ﭰ"]="ڦ",e["ﭱ"]="ڦ",e["ﭲ"]="ڄ",e["ﭳ"]="ڄ",e["ﭴ"]="ڄ",e["ﭵ"]="ڄ",e["ﭶ"]="ڃ",e["ﭷ"]="ڃ",e["ﭸ"]="ڃ",e["ﭹ"]="ڃ",e["ﭺ"]="چ",e["ﭻ"]="چ",e["ﭼ"]="چ",e["ﭽ"]="چ",e["ﭾ"]="ڇ",e["ﭿ"]="ڇ",e["ﮀ"]="ڇ",e["ﮁ"]="ڇ",e["ﮂ"]="ڍ",e["ﮃ"]="ڍ",e["ﮄ"]="ڌ",e["ﮅ"]="ڌ",e["ﮆ"]="ڎ",e["ﮇ"]="ڎ",e["ﮈ"]="ڈ",e["ﮉ"]="ڈ",e["ﮊ"]="ژ",e["ﮋ"]="ژ",e["ﮌ"]="ڑ",e["ﮍ"]="ڑ",e["ﮎ"]="ک",e["ﮏ"]="ک",e["ﮐ"]="ک",e["ﮑ"]="ک",e["ﮒ"]="گ",e["ﮓ"]="گ",e["ﮔ"]="گ",e["ﮕ"]="گ",e["ﮖ"]="ڳ",e["ﮗ"]="ڳ",e["ﮘ"]="ڳ",e["ﮙ"]="ڳ",e["ﮚ"]="ڱ",e["ﮛ"]="ڱ",e["ﮜ"]="ڱ",e["ﮝ"]="ڱ",e["ﮞ"]="ں",e["ﮟ"]="ں",e["ﮠ"]="ڻ",e["ﮡ"]="ڻ",e["ﮢ"]="ڻ",e["ﮣ"]="ڻ",e["ﮤ"]="ۀ",e["ﮥ"]="ۀ",e["ﮦ"]="ہ",e["ﮧ"]="ہ",e["ﮨ"]="ہ",e["ﮩ"]="ہ",e["ﮪ"]="ھ",e["ﮫ"]="ھ",e["ﮬ"]="ھ",e["ﮭ"]="ھ",e["ﮮ"]="ے",e["ﮯ"]="ے",e["ﮰ"]="ۓ",e["ﮱ"]="ۓ",e["ﯓ"]="ڭ",e["ﯔ"]="ڭ",e["ﯕ"]="ڭ",e["ﯖ"]="ڭ",e["ﯗ"]="ۇ",e["ﯘ"]="ۇ",e["ﯙ"]="ۆ",e["ﯚ"]="ۆ",e["ﯛ"]="ۈ",e["ﯜ"]="ۈ",e["ﯝ"]="ٷ",e["ﯞ"]="ۋ",e["ﯟ"]="ۋ",e["ﯠ"]="ۅ",e["ﯡ"]="ۅ",e["ﯢ"]="ۉ",e["ﯣ"]="ۉ",e["ﯤ"]="ې",e["ﯥ"]="ې",e["ﯦ"]="ې",e["ﯧ"]="ې",e["ﯨ"]="ى",e["ﯩ"]="ى",e["ﯪ"]="ئا",e["ﯫ"]="ئا",e["ﯬ"]="ئە",e["ﯭ"]="ئە",e["ﯮ"]="ئو",e["ﯯ"]="ئو",e["ﯰ"]="ئۇ",e["ﯱ"]="ئۇ",e["ﯲ"]="ئۆ",e["ﯳ"]="ئۆ",e["ﯴ"]="ئۈ",e["ﯵ"]="ئۈ",e["ﯶ"]="ئې";e["ﯷ"]="ئې",e["ﯸ"]="ئې",e["ﯹ"]="ئى",e["ﯺ"]="ئى",e["ﯻ"]="ئى",e["ﯼ"]="ی",e["ﯽ"]="ی",e["ﯾ"]="ی",e["ﯿ"]="ی",e["ﰀ"]="ئج",e["ﰁ"]="ئح",e["ﰂ"]="ئم",e["ﰃ"]="ئى",e["ﰄ"]="ئي",e["ﰅ"]="بج",e["ﰆ"]="بح",e["ﰇ"]="بخ",e["ﰈ"]="بم",e["ﰉ"]="بى",e["ﰊ"]="بي",e["ﰋ"]="تج",e["ﰌ"]="تح",e["ﰍ"]="تخ",e["ﰎ"]="تم",e["ﰏ"]="تى",e["ﰐ"]="تي",e["ﰑ"]="ثج",e["ﰒ"]="ثم",e["ﰓ"]="ثى",e["ﰔ"]="ثي",e["ﰕ"]="جح",e["ﰖ"]="جم",e["ﰗ"]="حج",e["ﰘ"]="حم",e["ﰙ"]="خج",e["ﰚ"]="خح",e["ﰛ"]="خم",e["ﰜ"]="سج",e["ﰝ"]="سح",e["ﰞ"]="سخ",e["ﰟ"]="سم",e["ﰠ"]="صح",e["ﰡ"]="صم",e["ﰢ"]="ضج",e["ﰣ"]="ضح",e["ﰤ"]="ضخ",e["ﰥ"]="ضم",e["ﰦ"]="طح",e["ﰧ"]="طم",e["ﰨ"]="ظم",e["ﰩ"]="عج",e["ﰪ"]="عم",e["ﰫ"]="غج",e["ﰬ"]="غم",e["ﰭ"]="فج",e["ﰮ"]="فح",e["ﰯ"]="فخ",e["ﰰ"]="فم",e["ﰱ"]="فى",e["ﰲ"]="في",e["ﰳ"]="قح",e["ﰴ"]="قم",e["ﰵ"]="قى",e["ﰶ"]="قي",e["ﰷ"]="كا",e["ﰸ"]="كج",e["ﰹ"]="كح",e["ﰺ"]="كخ",e["ﰻ"]="كل",e["ﰼ"]="كم",e["ﰽ"]="كى",e["ﰾ"]="كي",e["ﰿ"]="لج",e["ﱀ"]="لح",e["ﱁ"]="لخ",e["ﱂ"]="لم",e["ﱃ"]="لى",e["ﱄ"]="لي",e["ﱅ"]="مج",e["ﱆ"]="مح",e["ﱇ"]="مخ",e["ﱈ"]="مم",e["ﱉ"]="مى",e["ﱊ"]="مي",e["ﱋ"]="نج",e["ﱌ"]="نح",e["ﱍ"]="نخ",e["ﱎ"]="نم",e["ﱏ"]="نى",e["ﱐ"]="ني",e["ﱑ"]="هج",e["ﱒ"]="هم",e["ﱓ"]="هى",e["ﱔ"]="هي",e["ﱕ"]="يج",e["ﱖ"]="يح",e["ﱗ"]="يخ",e["ﱘ"]="يم",e["ﱙ"]="يى",e["ﱚ"]="يي",e["ﱛ"]="ذٰ",e["ﱜ"]="رٰ",e["ﱝ"]="ىٰ",e["ﱞ"]=" ٌّ",e["ﱟ"]=" ٍّ",e["ﱠ"]=" َّ",e["ﱡ"]=" ُّ",e["ﱢ"]=" ِّ",e["ﱣ"]=" ّٰ",e["ﱤ"]="ئر",e["ﱥ"]="ئز",e["ﱦ"]="ئم",e["ﱧ"]="ئن",e["ﱨ"]="ئى",e["ﱩ"]="ئي",e["ﱪ"]="بر",e["ﱫ"]="بز",e["ﱬ"]="بم",e["ﱭ"]="بن",e["ﱮ"]="بى",e["ﱯ"]="بي",e["ﱰ"]="تر",e["ﱱ"]="تز",e["ﱲ"]="تم",e["ﱳ"]="تن",e["ﱴ"]="تى",e["ﱵ"]="تي",e["ﱶ"]="ثر",e["ﱷ"]="ثز",e["ﱸ"]="ثم",e["ﱹ"]="ثن",e["ﱺ"]="ثى",e["ﱻ"]="ثي",e["ﱼ"]="فى",e["ﱽ"]="في",e["ﱾ"]="قى",e["ﱿ"]="قي",e["ﲀ"]="كا",e["ﲁ"]="كل",e["ﲂ"]="كم",e["ﲃ"]="كى",e["ﲄ"]="كي",e["ﲅ"]="لم",e["ﲆ"]="لى",e["ﲇ"]="لي",e["ﲈ"]="ما",e["ﲉ"]="مم",e["ﲊ"]="نر",e["ﲋ"]="نز",e["ﲌ"]="نم",e["ﲍ"]="نن",e["ﲎ"]="نى",e["ﲏ"]="ني",e["ﲐ"]="ىٰ",e["ﲑ"]="ير",e["ﲒ"]="يز",e["ﲓ"]="يم",e["ﲔ"]="ين",e["ﲕ"]="يى",e["ﲖ"]="يي",e["ﲗ"]="ئج",e["ﲘ"]="ئح",e["ﲙ"]="ئخ",e["ﲚ"]="ئم",e["ﲛ"]="ئه",e["ﲜ"]="بج",e["ﲝ"]="بح",e["ﲞ"]="بخ",e["ﲟ"]="بم",e["ﲠ"]="به",e["ﲡ"]="تج",e["ﲢ"]="تح",e["ﲣ"]="تخ",e["ﲤ"]="تم",e["ﲥ"]="ته",e["ﲦ"]="ثم",e["ﲧ"]="جح",e["ﲨ"]="جم",e["ﲩ"]="حج",e["ﲪ"]="حم",e["ﲫ"]="خج",e["ﲬ"]="خم",e["ﲭ"]="سج",e["ﲮ"]="سح",e["ﲯ"]="سخ",e["ﲰ"]="سم",e["ﲱ"]="صح",e["ﲲ"]="صخ",e["ﲳ"]="صم",e["ﲴ"]="ضج",e["ﲵ"]="ضح",e["ﲶ"]="ضخ",e["ﲷ"]="ضم",e["ﲸ"]="طح",e["ﲹ"]="ظم",e["ﲺ"]="عج",e["ﲻ"]="عم",e["ﲼ"]="غج",e["ﲽ"]="غم",e["ﲾ"]="فج";e["ﲿ"]="فح",e["ﳀ"]="فخ",e["ﳁ"]="فم",e["ﳂ"]="قح",e["ﳃ"]="قم",e["ﳄ"]="كج",e["ﳅ"]="كح",e["ﳆ"]="كخ",e["ﳇ"]="كل",e["ﳈ"]="كم",e["ﳉ"]="لج",e["ﳊ"]="لح",e["ﳋ"]="لخ",e["ﳌ"]="لم",e["ﳍ"]="له",e["ﳎ"]="مج",e["ﳏ"]="مح",e["ﳐ"]="مخ",e["ﳑ"]="مم",e["ﳒ"]="نج",e["ﳓ"]="نح",e["ﳔ"]="نخ",e["ﳕ"]="نم",e["ﳖ"]="نه",e["ﳗ"]="هج",e["ﳘ"]="هم",e["ﳙ"]="هٰ",e["ﳚ"]="يج",e["ﳛ"]="يح",e["ﳜ"]="يخ",e["ﳝ"]="يم",e["ﳞ"]="يه",e["ﳟ"]="ئم",e["ﳠ"]="ئه",e["ﳡ"]="بم",e["ﳢ"]="به",e["ﳣ"]="تم",e["ﳤ"]="ته",e["ﳥ"]="ثم",e["ﳦ"]="ثه",e["ﳧ"]="سم",e["ﳨ"]="سه",e["ﳩ"]="شم",e["ﳪ"]="شه",e["ﳫ"]="كل",e["ﳬ"]="كم",e["ﳭ"]="لم",e["ﳮ"]="نم",e["ﳯ"]="نه",e["ﳰ"]="يم",e["ﳱ"]="يه",e["ﳲ"]="ـَّ",e["ﳳ"]="ـُّ",e["ﳴ"]="ـِّ",e["ﳵ"]="طى",e["ﳶ"]="طي",e["ﳷ"]="عى",e["ﳸ"]="عي",e["ﳹ"]="غى",e["ﳺ"]="غي",e["ﳻ"]="سى",e["ﳼ"]="سي",e["ﳽ"]="شى",e["ﳾ"]="شي",e["ﳿ"]="حى",e["ﴀ"]="حي",e["ﴁ"]="جى",e["ﴂ"]="جي",e["ﴃ"]="خى",e["ﴄ"]="خي",e["ﴅ"]="صى",e["ﴆ"]="صي",e["ﴇ"]="ضى",e["ﴈ"]="ضي",e["ﴉ"]="شج",e["ﴊ"]="شح",e["ﴋ"]="شخ",e["ﴌ"]="شم",e["ﴍ"]="شر",e["ﴎ"]="سر",e["ﴏ"]="صر",e["ﴐ"]="ضر",e["ﴑ"]="طى",e["ﴒ"]="طي",e["ﴓ"]="عى",e["ﴔ"]="عي",e["ﴕ"]="غى",e["ﴖ"]="غي",e["ﴗ"]="سى",e["ﴘ"]="سي",e["ﴙ"]="شى",e["ﴚ"]="شي",e["ﴛ"]="حى",e["ﴜ"]="حي",e["ﴝ"]="جى",e["ﴞ"]="جي",e["ﴟ"]="خى",e["ﴠ"]="خي",e["ﴡ"]="صى",e["ﴢ"]="صي",e["ﴣ"]="ضى",e["ﴤ"]="ضي",e["ﴥ"]="شج",e["ﴦ"]="شح",e["ﴧ"]="شخ",e["ﴨ"]="شم",e["ﴩ"]="شر",e["ﴪ"]="سر",e["ﴫ"]="صر",e["ﴬ"]="ضر",e["ﴭ"]="شج",e["ﴮ"]="شح",e["ﴯ"]="شخ",e["ﴰ"]="شم",e["ﴱ"]="سه",e["ﴲ"]="شه",e["ﴳ"]="طم",e["ﴴ"]="سج",e["ﴵ"]="سح",e["ﴶ"]="سخ",e["ﴷ"]="شج",e["ﴸ"]="شح",e["ﴹ"]="شخ",e["ﴺ"]="طم",e["ﴻ"]="ظم",e["ﴼ"]="اً",e["ﴽ"]="اً",e["ﵐ"]="تجم",e["ﵑ"]="تحج",e["ﵒ"]="تحج",e["ﵓ"]="تحم",e["ﵔ"]="تخم",e["ﵕ"]="تمج",e["ﵖ"]="تمح",e["ﵗ"]="تمخ",e["ﵘ"]="جمح",e["ﵙ"]="جمح",e["ﵚ"]="حمي",e["ﵛ"]="حمى",e["ﵜ"]="سحج",e["ﵝ"]="سجح",e["ﵞ"]="سجى",e["ﵟ"]="سمح",e["ﵠ"]="سمح",e["ﵡ"]="سمج",e["ﵢ"]="سمم",e["ﵣ"]="سمم",e["ﵤ"]="صحح",e["ﵥ"]="صحح",e["ﵦ"]="صمم",e["ﵧ"]="شحم",e["ﵨ"]="شحم",e["ﵩ"]="شجي",e["ﵪ"]="شمخ",e["ﵫ"]="شمخ",e["ﵬ"]="شمم",e["ﵭ"]="شمم",e["ﵮ"]="ضحى",e["ﵯ"]="ضخم",e["ﵰ"]="ضخم",e["ﵱ"]="طمح",e["ﵲ"]="طمح",e["ﵳ"]="طمم",e["ﵴ"]="طمي",e["ﵵ"]="عجم",e["ﵶ"]="عمم",e["ﵷ"]="عمم",e["ﵸ"]="عمى",e["ﵹ"]="غمم",e["ﵺ"]="غمي",e["ﵻ"]="غمى",e["ﵼ"]="فخم",e["ﵽ"]="فخم",e["ﵾ"]="قمح",e["ﵿ"]="قمم",e["ﶀ"]="لحم",e["ﶁ"]="لحي",e["ﶂ"]="لحى",e["ﶃ"]="لجج",e["ﶄ"]="لجج",e["ﶅ"]="لخم",e["ﶆ"]="لخم",e["ﶇ"]="لمح",e["ﶈ"]="لمح",e["ﶉ"]="محج",e["ﶊ"]="محم",e["ﶋ"]="محي",e["ﶌ"]="مجح",e["ﶍ"]="مجم",e["ﶎ"]="مخج",e["ﶏ"]="مخم",e["ﶒ"]="مجخ",e["ﶓ"]="همج",e["ﶔ"]="همم",e["ﶕ"]="نحم",e["ﶖ"]="نحى",e["ﶗ"]="نجم",e["ﶘ"]="نجم",e["ﶙ"]="نجى",e["ﶚ"]="نمي";e["ﶛ"]="نمى",e["ﶜ"]="يمم",e["ﶝ"]="يمم",e["ﶞ"]="بخي",e["ﶟ"]="تجي",e["ﶠ"]="تجى",e["ﶡ"]="تخي",e["ﶢ"]="تخى",e["ﶣ"]="تمي",e["ﶤ"]="تمى",e["ﶥ"]="جمي",e["ﶦ"]="جحى",e["ﶧ"]="جمى",e["ﶨ"]="سخى",e["ﶩ"]="صحي",e["ﶪ"]="شحي",e["ﶫ"]="ضحي",e["ﶬ"]="لجي",e["ﶭ"]="لمي",e["ﶮ"]="يحي",e["ﶯ"]="يجي",e["ﶰ"]="يمي",e["ﶱ"]="ممي",e["ﶲ"]="قمي",e["ﶳ"]="نحي",e["ﶴ"]="قمح",e["ﶵ"]="لحم",e["ﶶ"]="عمي",e["ﶷ"]="كمي",e["ﶸ"]="نجح",e["ﶹ"]="مخي",e["ﶺ"]="لجم",e["ﶻ"]="كمم",e["ﶼ"]="لجم",e["ﶽ"]="نجح",e["ﶾ"]="جحي",e["ﶿ"]="حجي",e["ﷀ"]="مجي",e["ﷁ"]="فمي",e["ﷂ"]="بحي",e["ﷃ"]="كمم",e["ﷄ"]="عجم",e["ﷅ"]="صمم",e["ﷆ"]="سخي",e["ﷇ"]="نجي",e["﹉"]="‾",e["﹊"]="‾",e["﹋"]="‾",e["﹌"]="‾",e["﹍"]="_",e["﹎"]="_",e["﹏"]="_",e["ﺀ"]="ء",e["ﺁ"]="آ",e["ﺂ"]="آ",e["ﺃ"]="أ",e["ﺄ"]="أ",e["ﺅ"]="ؤ",e["ﺆ"]="ؤ",e["ﺇ"]="إ",e["ﺈ"]="إ",e["ﺉ"]="ئ",e["ﺊ"]="ئ",e["ﺋ"]="ئ",e["ﺌ"]="ئ",e["ﺍ"]="ا",e["ﺎ"]="ا",e["ﺏ"]="ب",e["ﺐ"]="ب",e["ﺑ"]="ب",e["ﺒ"]="ب",e["ﺓ"]="ة",e["ﺔ"]="ة",e["ﺕ"]="ت",e["ﺖ"]="ت",e["ﺗ"]="ت",e["ﺘ"]="ت",e["ﺙ"]="ث",e["ﺚ"]="ث",e["ﺛ"]="ث",e["ﺜ"]="ث",e["ﺝ"]="ج",e["ﺞ"]="ج",e["ﺟ"]="ج",e["ﺠ"]="ج",e["ﺡ"]="ح",e["ﺢ"]="ح",e["ﺣ"]="ح",e["ﺤ"]="ح",e["ﺥ"]="خ",e["ﺦ"]="خ",e["ﺧ"]="خ",e["ﺨ"]="خ",e["ﺩ"]="د",e["ﺪ"]="د",e["ﺫ"]="ذ",e["ﺬ"]="ذ",e["ﺭ"]="ر",e["ﺮ"]="ر",e["ﺯ"]="ز",e["ﺰ"]="ز",e["ﺱ"]="س",e["ﺲ"]="س",e["ﺳ"]="س",e["ﺴ"]="س",e["ﺵ"]="ش",e["ﺶ"]="ش",e["ﺷ"]="ش",e["ﺸ"]="ش",e["ﺹ"]="ص",e["ﺺ"]="ص",e["ﺻ"]="ص",e["ﺼ"]="ص",e["ﺽ"]="ض",e["ﺾ"]="ض",e["ﺿ"]="ض",e["ﻀ"]="ض",e["ﻁ"]="ط",e["ﻂ"]="ط",e["ﻃ"]="ط",e["ﻄ"]="ط",e["ﻅ"]="ظ",e["ﻆ"]="ظ",e["ﻇ"]="ظ",e["ﻈ"]="ظ",e["ﻉ"]="ع",e["ﻊ"]="ع",e["ﻋ"]="ع",e["ﻌ"]="ع",e["ﻍ"]="غ",e["ﻎ"]="غ",e["ﻏ"]="غ",e["ﻐ"]="غ",e["ﻑ"]="ف",e["ﻒ"]="ف",e["ﻓ"]="ف",e["ﻔ"]="ف",e["ﻕ"]="ق",e["ﻖ"]="ق",e["ﻗ"]="ق",e["ﻘ"]="ق",e["ﻙ"]="ك",e["ﻚ"]="ك",e["ﻛ"]="ك",e["ﻜ"]="ك",e["ﻝ"]="ل",e["ﻞ"]="ل",e["ﻟ"]="ل",e["ﻠ"]="ل",e["ﻡ"]="م",e["ﻢ"]="م",e["ﻣ"]="م",e["ﻤ"]="م",e["ﻥ"]="ن",e["ﻦ"]="ن",e["ﻧ"]="ن",e["ﻨ"]="ن",e["ﻩ"]="ه",e["ﻪ"]="ه",e["ﻫ"]="ه",e["ﻬ"]="ه",e["ﻭ"]="و",e["ﻮ"]="و",e["ﻯ"]="ى",e["ﻰ"]="ى",e["ﻱ"]="ي",e["ﻲ"]="ي",e["ﻳ"]="ي",e["ﻴ"]="ي",e["ﻵ"]="لآ",e["ﻶ"]="لآ",e["ﻷ"]="لأ",e["ﻸ"]="لأ",e["ﻹ"]="لإ",e["ﻺ"]="لإ",e["ﻻ"]="لا",e["ﻼ"]="لا"}),t.reverseIfRtl=o}),define("modules/clean/react/previews/pdf_viewer/text_box",["require","exports","tslib","external/react","modules/clean/react/previews/pdf_viewer/text/bidi","modules/clean/react/previews/pdf_viewer/text/unicode","modules/clean/referrer_cleansing_redirect"],function(e,t,n,i,o,r,s){"use strict";function a(e,t){t.length>0&&e.push(t)}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.createAnchor=function(e){var t=s.get_redirect_uri("http"===e.substr(0,4)?e:"http://"+e).toString();return i.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener"},e)},t.prototype.render=function(){var e=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;if("string"==typeof this.props.children){for(var t=this.props.children,n=[],o=void 0,r=0;o=e.exec(t);){var s=o[0];a(n,t.slice(r,e.lastIndex-s.length)),n.push(this.createAnchor(s)),r=e.lastIndex}return a(n,t.slice(r)),i.createElement.apply(i,["span",{}].concat(n))}return null},t})(i.PureComponent);t.LinkedText=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={xScale:1,yScale:1},t.ref=function(e){t.textElement=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(this.textElement){var e=this.props,t=e.text,n=e.width,i=e.height,o=e.fontSize;this.setState(this.scaleText(t,n,i,o),this.props.onRender)}},t.prototype.measureText=function(e,t){return e!==this.cachedText&&(this.cachedText=e,this.cachedTextWidth=t.clientWidth,this.cachedTextHeight=t.clientHeight),{textWidth:this.cachedTextWidth,textHeight:this.cachedTextHeight}},t.prototype.scaleText=function(e,t,n,i){var o=!0;if(e.length<=1)o=!1;else if(2===e.length){var r=e.charCodeAt(0),s=e.charCodeAt(1);r>=55296&&r<=56319&&s>=56320&&s<=57343&&(o=!1)}if(o){var a=this.measureText(e,this.textElement),l=a.textWidth,c=a.textHeight;return{xScale:t/l,yScale:i?1:n/c}}return{xScale:1,yScale:1}},t.prototype.componentWillReceiveProps=function(e){var t=e.text,n=e.width,i=e.height,o=e.fontSize;this.setState(this.scaleText(t,n,i,o))},t.prototype.render=function(){var e=this.props,t=e.text,n=e.x,s=e.y,a=e.rotation,c={left:n,bottom:s,transform:"rotate("+-a+"rad) scale("+this.state.xScale+", "+this.state.yScale+")"};this.props.font&&(c.fontFamily=this.props.font.fontFamily,this.props.font.isBold&&(c.fontWeight="bold"),this.props.font.isItalic&&(c.fontStyle="italic")),this.props.fontSize&&(c.fontSize=this.props.fontSize+"px");for(var u=r.getNormalizedUnicodes(),p="",d=0;d<t.length;d++){var m=t.charAt(d);void 0!==u[m]&&(m=u[m]),m=r.reverseIfRtl(m),"\t"===m&&(m=" "),p+=m}var h=o.bidi(p,-1,!1),f=h.str,_=h.dir;return i.createElement("p",{className:"textbox",style:c,ref:this.ref,dir:_},i.createElement(l,null,f))},t})(i.PureComponent);t.TextBox=c}),define("modules/clean/react/previews/pdf_viewer/timing",["require","exports"],function(e,t){"use strict";function n(){return o?window.performance.now():Date.now()}function i(){return new r}Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.OVERALL=0]="OVERALL",e[e.REQUEST=1]="REQUEST",e[e.RENDER=2]="RENDER"})(t.TimingEventType||(t.TimingEventType={}));var o=!(!window.performance||!window.performance.now),r=(function(){function e(){}return e.prototype.time=function(){return this.start=n(),this},e.prototype.timeEnd=function(){return void 0===this.end&&(this.end=n()),this},e.prototype.duration=function(){return this.end-this.start},e})();t.TimingStat=r,t.makeTimer=i}),define("modules/clean/react/previews/pdf_viewer/transform",["require","exports"],function(e,t){"use strict";function n(e,t,n){return n.map(function(e){return e.coordinates.map(function(e){return{x:e.x,y:t-e.y}})})}function i(e,t,n,i,o,r,s){return s.map(function(s){return{coordinates:s.map(function(e){return{x:(e.x-t)/r,y:o-(e.y-n)/r}}),page:e,page_size:{width:i,height:o}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.transformPdfCoordinates=n,t.transformViewportCoordinates=i}),define("modules/clean/react/previews/pdf_viewer/urls",["require","exports","modules/core/uri"],function(e,t,n){"use strict";function i(e,t){return n.parse(e).updateQuery(t).toString()}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e){var t=e.imageUrl,n=e.textUrl,i=e.refreshUrl;this.useCanned=!1,this.imageUrlTmpl=t,this.textUrlTmpl=n,this.refreshUrlString=i}return e.prototype.setUseCannedFile=function(){this.useCanned=!0},e.prototype.imageUrl=function(e,t){void 0===t&&(t=0);var n=i(this.imageUrlTmpl,{page:e.toString(),scale_percent:t.toString()});return this.useCanned&&(n=i(n,{canned_file_name:"spdf/audi.pdf."+e+".png"})),n},e.prototype.textUrl=function(e,t,n){var o=this.textUrlTmpl;return e&&(o=i(o,{metadata:"1"})),void 0!==t&&(o=i(o,{text:"1",page_start:""+t,page_end:""+n})),this.useCanned&&(o=i(o,{canned_file_name:"spdf/audi.pdf.json"})),o},e.prototype.refreshUrl=function(){return this.refreshUrlString},e.prototype.newSetWithBlob=function(t,n){return new e({imageUrl:this.imageUrlTmpl.replace(t,n),textUrl:this.textUrlTmpl.replace(t,n),refreshUrl:this.refreshUrlString?this.refreshUrlString.replace(t,n):void 0})},e})();t.SsrUrlSet=o,t.updateQueryParam=i}),define("modules/clean/react/previews/pdf_viewer/utils",["require","exports","tslib","modules/clean/react/previews/pdf_viewer/event_emitter"],function(e,t,n,i){"use strict";function o(e){return d.indexOf(e)!==-1?"spp":"default"}function r(e){if(m===e)return h;for(var t=[],n=0,i=e;n<i.length;n++)for(var o=i[n],r=o[0],s=o[1],a=o[2],l=0;l<a;l++)t.push([r,s]);return m=e,h=t,t}function s(e,t,n){return e.map(function(e){return[e[0]*t,e[1]*t]}).reduce(function(e,t){var i=e[0],o=e[1],r=t[0],s=t[1];return[Math.max(i,r),o+n+s]},[0,0])}function a(e,t){for(var n=r(e),i=[],o=0;o<n.length;o++){var s=n[o],a=s[0],l=s[1];i.push(t(o,a,l))}return i}function l(e){(new Image).src=e}function c(e,t){if(e.postMessageToParent("annotation-hidden"),i.eventEmitter.emit("resize"),t){var n=document,o=window.getSelection?window.getSelection():n.selection;if(o){var r=o.anchorNode,s=o.focusNode;t.contains(r)&&t.contains(s)&&(window.getSelection?window.getSelection().removeAllRanges():n.selection&&n.selection.empty())}}}function u(e,t){if(e)return{attributions:e.attributions[t]||[],accounts:e.accounts}}function p(e,t){if(e)return n.__assign({},e,{annotations:e.annotations[t]||[]})}Object.defineProperty(t,"__esModule",{value:!0});var d=["ppt","pptx"];t.docTypeFromExtension=o;var m,h;t.expandDimensions=r,t.getTotalSize=s,t.mapPages=a,t.prefetchImage=l,t.resetAnnotationState=c,t.attributionAtPage=u,t.annotationsAtPage=p}),define("modules/clean/react/previews/pdf_viewer/viewer",["require","exports","tslib","external/classnames","external/react","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/pdf_viewer/error_snackbar","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/responsive_image","modules/clean/react/previews/pdf_viewer/pdf_viewer","modules/clean/react/previews/pdf_viewer/ppt_viewer","modules/clean/react/previews/pdf_viewer/print_modal","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(function(e){function t(t){var n=e.call(this,t)||this;return n.viewerRef=function(e){return n.viewer=e},n.iframeRef=function(e){e&&e.contentWindow&&(e.contentWindow.addEventListener("load",n.onResize),e.contentWindow.addEventListener("resize",n.onResize))},n.onResize=function(){void 0===n.resizeRequestID&&(n.resizeRequestID=window.requestAnimationFrame(n.onResizeNextFrame))},n.onResizeNextFrame=function(){n.props.metadata&&n.viewer&&(n.props.annotationProps&&h.resetAnnotationState(n.props.annotationProps.frameMessenger,n.viewer),n.fitToContainer(n.props.metadata.dimensions,n.viewer,n.state.fittingMode),n.resizeRequestID=void 0)},n.zoomIn=function(){var e=Math.min(1.1*n.state.clientScaleFactor,10);n.setState({clientScaleFactor:e}),n.setFittingMode(f.FittingMode.NONE)},n.zoomOut=function(){var e=Math.max(n.state.clientScaleFactor/1.1,.1);n.setState({clientScaleFactor:e}),n.setFittingMode(f.FittingMode.NONE)},n.enterFullscreen=function(){n.props.isFullscreen||s.enterFullScreen(!0,r.UserActionContextNames.KEYBOARD)},n.onFirstPageError=function(){n.setState({firstPageFailed:!0})},n.onError=function(e){n.setState({error:e})},n.onImageError=function(){n.setState({error:g._("Some pages failed to load")})},n.onDismissError=function(){n.setState({error:void 0})},n.onPageRenderComplete=function(e,t,i){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,i),n.setState({pageRendered:!0})},n.state={fittingMode:n.props.isFullscreen?f.fullscreenFittingMode():f.defaultFittingMode(t.fileExtension)},n.keyboardBindings=_.getViewerKeyboardBindings(n.zoomIn,n.zoomOut,n.enterFullscreen),n}return n.__extends(t,e),t.prototype.setFittingMode=function(e){this.setState({fittingMode:e})},t.prototype.fitToContainer=function(e,t,n){if(n!==f.FittingMode.NONE){var i=this.viewer.clientHeight,o=this.viewer.clientWidth;this.setState({clientScaleFactor:f.computeClientScaleFactor(n,e,i-32,o-32)})}},t.prototype.componentDidMount=function(){l.eventEmitter.on("zoom-in",this.zoomIn),l.eventEmitter.on("zoom-out",this.zoomOut),l.eventEmitter.on("error",this.onError),this.props.metadata&&this.viewer&&this.fitToContainer(this.props.metadata.dimensions,this.viewer,this.state.fittingMode)},t.prototype.componentWillUnmount=function(){l.eventEmitter.off("zoom-in",this.zoomIn),l.eventEmitter.off("zoom-out",this.zoomOut),l.eventEmitter.off("error",this.onError)},t.prototype.componentWillReceiveProps=function(e){var t=this.state.fittingMode;this.props.isFullscreen!==e.isFullscreen&&(t=e.isFullscreen?f.fullscreenFittingMode():f.defaultFittingMode(e.fileExtension),this.setState({fittingMode:t})),!this.state.clientScaleFactor&&e.metadata&&this.viewer&&this.fitToContainer(e.metadata.dimensions,this.viewer,t)},t.prototype.renderViewer=function(){if(this.props.metadata&&this.props.text){var e={metadata:this.props.metadata,text:this.props.text,links:this.props.links||{},urls:this.props.urls,isFullscreen:this.props.isFullscreen,onPageRenderComplete:this.onPageRenderComplete,onPageImageLoad:this.props.onPageImageLoad,annotationProps:this.props.annotationProps,attributionProps:this.props.attributionProps,clientScaleFactor:this.state.clientScaleFactor,onImageError:this.onImageError};return d.PowerPointViewer.fileSupported(this.props.fileExtension)&&d.PowerPointViewer.deviceSupported()?o.createElement(d.PowerPointViewer,n.__assign({},e)):o.createElement(p.PdfViewer,n.__assign({},e))}return null},t.prototype.renderErrorSnackbar=function(){return this.state.error?o.createElement(a.ErrorSnackbar,{text:this.state.error,buttonText:g._("Close"),onClick:this.onDismissError,isToolbarVisible:!!this.props.isToolbarVisible}):null},t.prototype.renderCloseFullscreenButton=function(){return this.props.isFullscreen?o.createElement("div",{className:"close-x"},o.createElement("button",{onClick:this.props.onExitFullscreen,className:"close-x-button","aria-label":g._("Close")},"✕")):null},t.prototype.renderPlaceholder=function(){return this.state.pageRendered||!this.props.placeholderImageUrl||this.state.firstPageFailed?null:o.createElement("div",{className:"placeholder-image-wrapper"},o.createElement("div",{className:"placeholder-image-wrapper__border"},o.createElement(u.ResponsiveImage,{className:"placeholder-image",fileName:g._("Loading"),thumbnailUrlTmpl:this.props.placeholderImageUrl,onError:this.onFirstPageError,onLoad:this.props.onPlaceholderImageLoad,shouldLoadLowResImg:this.props.shouldLoadLowResImg})))},t.prototype.render=function(){var e=this.renderViewer(),t=this.renderCloseFullscreenButton(),n=this.renderErrorSnackbar(),r={"preview-ssr-viewer":!0,"region-creation":this.props.annotationProps&&this.props.annotationProps.isAnnotationRegionEnabled,"fit-page":this.state.fittingMode===f.FittingMode.FIT_PAGE,"fit-to-width":this.state.fittingMode===f.FittingMode.FIT_TO_WIDTH,"single-page-scroll":f.defaultScrollMode(this.props.fileExtension)===f.ScrollMode.SINGLE_PAGE,"continuous-scroll":f.defaultScrollMode(this.props.fileExtension)===f.ScrollMode.CONTINUOUS,fullscreen:this.props.isFullscreen},s=null,a=this.renderPlaceholder(),l=this.state.pageRendered?null:o.createElement(c.LoadingIndicator,{className:"loading-indicator-ssr"}),u=this.props.metadata&&this.props.printProps?o.createElement(m.PrintModal,{urls:this.props.urls,metadata:this.props.metadata,printProps:this.props.printProps}):null;return e&&(s=o.createElement("iframe",{"aria-hidden":"true",ref:this.iframeRef,style:{position:"absolute",left:0,bottom:0,top:0,width:"100%",zIndex:-1e3,opacity:0}})),o.createElement("div",{className:i(r)},l,a,s,t,o.createElement(v.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),o.createElement("div",{className:"viewer-container",style:{visibility:this.state.pageRendered?"visible":"hidden"},ref:this.viewerRef},e),n,u)},t})(o.PureComponent);t.Viewer=y}),define("modules/clean/react/previews/pdf_viewer/zoom",["require","exports","modules/clean/react/previews/pdf_viewer/utils","modules/core/browser"],function(e,t,n,i){"use strict";function o(e){switch(n.docTypeFromExtension(e)){case"spp":return u.FIT_PAGE;case"default":return u.FIT_TO_WIDTH}return u.NONE}function r(){return u.FIT_PAGE}function s(e){return"spp"!==n.docTypeFromExtension(e)||i.is_mobile_or_tablet()?m.CONTINUOUS:m.SINGLE_PAGE}function a(e,t,n,i){var o=1;if(e===u.FIT_PAGE){for(var r=0,s=0,a=0,l=t;a<l.length;a++){var c=l[a],p=c[0],m=c[1];s=Math.max(p,s),r=Math.max(m,r)}o=Math.min(n/r,i/s)}else e===u.FIT_TO_WIDTH&&(o=i/t[0][0]);return Math.min(o,d)}function l(e,t){var n=Math.max(e,t);return n<=2048?1:2048/n}function c(e,t){if(t){var n=t.originalHeight;if(l(t.originalWidth,n)>=e)return 0}for(var i=0,o=p;i<o.length;i++){var r=o[i];if(r>=e)return r}return d}Object.defineProperty(t,"__esModule",{value:!0});var u,p=[1,2,4],d=Math.max.apply(Math,p);(function(e){e[e.NONE=0]="NONE",e[e.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",e[e.FIT_PAGE=2]="FIT_PAGE"})(u=t.FittingMode||(t.FittingMode={}));var m;(function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.SINGLE_PAGE=1]="SINGLE_PAGE"})(m=t.ScrollMode||(t.ScrollMode={})),t.defaultFittingMode=o,t.fullscreenFittingMode=r,t.defaultScrollMode=s,t.computeClientScaleFactor=a,t.calculatedFetchedScaleFactor=c}),define("modules/clean/react/previews/preview_error",["require","exports","tslib","external/classnames","external/react","modules/constants/rebrand","modules/core/i18n","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/display_format","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/previews/util","modules/clean/react/css","modules/clean/react_format","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button","modules/clean/react/open_in_app/button","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/react/share_download/button","modules/clean/static_urls","modules/clean/web_timing_logger"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(w.set_tti_exclusion_flow("failed previews not included"),w.mark_time_to_view(),w.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===g.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.shareToken){new u.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}},Object.defineProperty(t.prototype,"isSharedFile",{get:function(){return this.props.sharedLinkInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.renderActionable=function(){return this.props.areActionablesEnabled||null==this.props.areActionablesEnabled?this.isSharedFile?this.allowOpenInApp?o.createElement(_.OpenInAppButton,{urls:this.props.file.open_in_app_data}):o.createElement(y.ShareDownloadButton,{downloadOnly:!!this.props.isMobileUserAgent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file,justifyRight:!1,location:h.FileViewerPane.PREVIEW_CONTENT,importance:"primary",user:this.props.user}):o.createElement(f.OpenButton,{file:this.props.file,user:this.props.user,justifyRight:!1,location:h.FileViewerPane.PREVIEW_CONTENT,importance:"primary"}):o.createElement("div",null)},t.prototype.renderFileInfo=function(){var e=p.get_filename(this.props.file);return this.props.errorType===g.ErrorTypes.PENDING_UPLOAD_ERROR||this.props.file.is_dir?o.createElement("div",{className:"preview-error__info"},c.em_snippet(e,this.props.maxFilenameEmLength)):o.createElement("div",{className:"preview-error__info"},c.em_snippet(e,this.props.maxFilenameEmLength),o.createElement("span",{className:"bottom-dot"}," · "),l.format_bytes(this.props.file.bytes))},t.prototype.renderErrorInfo=function(e,t){return o.createElement("div",null,o.createElement("div",{className:"u-mar-bottom-s"},e),o.createElement("div",{className:"preview-error__message"},t))},t.prototype.getBadFiletypeErrorImage=function(){return r.REBRAND_M1_IS_ON?o.createElement(v,{
src:E.static_url("/static/images/previews/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:E.static_url("/static/images/previews/error/filetype_not_supported_2x-vflE8HW8X.png")}):o.createElement(v,{src:E.static_url("/static/images/previews/error/filetypeNA_1x-vflfrlFzF.png"),srcHiRes:E.static_url("/static/images/previews/error/filetypeNA_2x-vflXCCBSQ.png")})},t.prototype.getTooBigErrorImage=function(){return r.REBRAND_M1_IS_ON?o.createElement(v,{src:E.static_url("/static/images/previews/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:E.static_url("/static/images/previews/error/file_too_large_2x-vfl-r0UPt.png")}):o.createElement(v,{src:E.static_url("/static/images/previews/error/large_1x-vflkPYeXF.png"),srcHiRes:E.static_url("/static/images/previews/error/large_2x-vflueyc5P.png")})},t.prototype.getPasswordProtectedErrorImage=function(){return r.REBRAND_M1_IS_ON?o.createElement(v,{src:E.static_url("/static/images/previews/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:E.static_url("/static/images/previews/error/password_protected_2x-vflnBXZ1k.png")}):o.createElement(v,{src:E.static_url("/static/images/previews/error/password_1x-vflYknWoW.png"),srcHiRes:E.static_url("/static/images/previews/error/password_2x-vflJBbjf_.png")})},t.prototype.getNoPreviewErrorImage=function(){return r.REBRAND_M1_IS_ON?o.createElement(v,{src:E.static_url("/static/images/previews/error/unavailable_1x-vflIaiVs3.png"),srcHiRes:E.static_url("/static/images/previews/error/unavailable_2x-vflxjL73V.png")}):o.createElement(v,{src:E.static_url("/static/images/previews/error/previewNA_1x-vflTFvhxk.png"),srcHiRes:E.static_url("/static/images/previews/error/previewNA_2x-vflMDSiZI.png")})},t.prototype.getPendingUploadErrorImage=function(){return r.REBRAND_M1_IS_ON?o.createElement(v,{src:E.static_url("/static/images/previews/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:E.static_url("/static/images/previews/error/file_uploading_2x-vflKOdrWj.png")}):o.createElement(v,{className:"icon",src:E.static_url("/static/images/previews/error/FileUploading_1x-vflSMveQj.png"),srcHiRes:E.static_url("/static/images/previews/error/FileUploading_2x-vflG2sw4y.png")})},t.prototype.getPendingUploadSyncImage=function(){return r.REBRAND_M1_IS_ON?null:o.createElement(v,{className:"sync-image",src:E.static_url("/static/images/previews/error/fileUploading_justbadge_1x-vflmyKG2f.png"),srcHiRes:E.static_url("/static/images/previews/error/fileUploading_justbadge_2x-vfl3T4urj.png")})},t.prototype.renderAnnotationsToolbar=function(){if(this.props.shouldDisplayAnnotationsToolbar)return o.createElement("div",{className:"preview-toolbar-container"},o.createElement(a,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},t.prototype.getDisplayErrorType=function(){var e=this.props.errorType;return e===g.ErrorTypes.EXTENSION_ERROR&&p.extensionSupported(this.props.file)?g.ErrorTypes.LOAD_ERROR:e},t.prototype.renderError=function(){if(this.props.message)return this.renderErrorInfo(this.getNoPreviewErrorImage(),this.props.message);switch(this.getDisplayErrorType()){case g.ErrorTypes.PENDING_UPLOAD_ERROR:var e=s._("File is uploading...");return o.createElement("div",{ref:"errorInfo"},o.createElement("div",{className:"u-mar-bottom-s"},this.getPendingUploadErrorImage(),this.getPendingUploadSyncImage()),o.createElement("div",{className:"preview-error__message u-mar-xs"},e));case g.ErrorTypes.EMPTY_FILE_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),s._("Empty files can’t be previewed"));case g.ErrorTypes.EXTENSION_ERROR:var t=p.get_extension(this.props.file);if(t){var n=o.createElement("span",null,m.reactFormat(s._("<span>.%(extension)s</span> files can’t be previewed",{comment:"Like '.exe files can’t be previewed'"}),{span:o.createElement("span",{className:"preview-error__message--bold"}),extension:t}));return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n)}var n=s._("Extensionless files can’t be previewed");return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n);case g.ErrorTypes.FILE_SIZE_ERROR:return this.renderErrorInfo(this.getTooBigErrorImage(),s._("This file is too big to preview"));case g.ErrorTypes.PASSWORD_PROTECTED_ERROR:return this.renderErrorInfo(this.getPasswordProtectedErrorImage(),s._("This file is password-protected"));case g.ErrorTypes.NEED_FLASH_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),m.reactFormat(s._("Install <a>Adobe Flash Player</a> to preview this video."),{a:o.createElement("a",{href:"https://get.adobe.com/flashplayer/"})}));case g.ErrorTypes.LOAD_ERROR:default:return this.renderErrorInfo(this.getNoPreviewErrorImage(),s._("This file can’t be previewed"))}},t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==g.ErrorTypes.LOAD_ERROR&&this.props.errorType!==g.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(h.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,{errorType:this.props.errorType})},t.prototype.render=function(){var e=i({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar});return o.createElement("div",{className:e},o.createElement("div",{className:"preview-error__wrapper"},o.createElement("div",{className:"preview-error__content"},this.renderError(),this.renderFileInfo(),this.renderActionable()),this.renderAnnotationsToolbar()))},t})(o.Component);t.PreviewErrorWithoutCss=b,t.PreviewError=d(b,["/static/css/preview_error-vfl3y7QDG.css"])}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","external/react","external/react-dom","modules/clean/previews/actions","modules/clean/react/previews/constants","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=["failed","viewer-ready"],v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_RENDER_FAILED);var n=s.RivieraPreviewResponseTypes.UNKNOWN;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(a.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(r.broadcastRenderSucceeded,0),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height")}},t.handleIframeLoad=function(){t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED))},t.handleIframeError=function(){t.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED)},t.setRefIframe=function(e){t.iframe=e},t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=f.parse(this.props.src);return"excel"===this.props.previewType&&(m.FORCE_TEST_EXCEL_HTML?e.updateQuery({canned_file_name:l.CannedTestFilenames.EXCEL_HTML}):"password_protected"===m.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===m.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return"excel"===this.props.previewType&&h.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(l.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.props.usesFrameMessenger&&(this.frameMessenger=new c.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,_),this.frameMessenger.startListening());var e=o.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.renderToolbarContainer=function(){var e={fileExtension:this.props.fileExtension,fileHref:this.props.src,filePreviewType:this.props.previewType,isFullscreen:this.props.isFullscreen,isHidden:this.props.sizeClass===p.SizeClass.Small,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,sizeClass:this.props.sizeClass};return i.createElement(u.PreviewToolbarContainer,{elevateToolbar:"excel"===this.props.previewType,previewToolbarProps:e,commentsActionCreators:this.props.commentsActionCreators,shouldUseImageToolbar:!1})},t.prototype.render=function(){var e=this.getIframeProps(),t={};return h.iOS&&(t=a.iOSIframeScrollStyles()),i.createElement("div",{className:"preview-content",style:t},i.createElement("iframe",n.__assign({},e)),this.renderToolbarContainer())},t.defaultProps={usesFrameMessenger:!0},t})(i.Component);t.PreviewHTML=v}),define("modules/clean/react/previews/preview_image_with_annotations",["require","exports","tslib","external/underscore","modules/clean/react/file_viewer/actions","modules/constants/file_viewer","modules/clean/image_annotations","modules/clean/image_preview_util","modules/clean/previews/actions","external/react","external/react-dom","modules/clean/web_timing_logger","external/classnames","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/analytics","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/responsive_image","modules/clean/react/size_class/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/photos/thumbnail_url_util","modules/clean/react/file_viewer/utils"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var P=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={width:"",height:"",zoomPercent:0,minimumZoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1},t.onImageLoad=function(){t.props.filePreviewSession&&(t.props.filePreviewSession.markPrimaryEvent(),t.props.filePreviewSession.markSecondaryEvent()),p.mark_time_to_view(),p.mark_time_to_interactive(),t.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),t.setState({shouldLoadFullSizeImage:!!t.props.supportsAnnotations}),setTimeout(l.broadcastRenderSucceeded,0),t.props.supportsAnnotations&&t.imageAnnotations.onImageLoad(t.onResizeImage),null!=t.props.onLoad&&t.props.onLoad()},t.onImageClick=function(){t.shouldDisableZoom()||t.openFullscreen()},t.openFullscreen=function(){null!=t.props.isFullscreen?(E.enterFullScreen(!1),o.openFullscreen()):_.PreviewImageZoom.open(t.props["preview-url"],t.props["file-extension"],t.props.onContextMenu,t.props.fileName)},t.onImageError=function(){t.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),null!=t.props.onError&&t.props.onError()},t.onFullSizeLoad=function(){var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})},t.onResizeImage=function(){if(""===t.state.width&&""===t.state.height){var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})}},t.onZoom=function(e,n,i){if(void 0===i&&(i=void 0),e+"px"!==t.state.width){if(void 0===i&&(i=t.calculateZoomPercent(n)),i<t.state.minimumZoomPercent)return void t.onZoomFit();if(i>16){if(null!=u.findDOMNode(t.previewImageFullSize)){var o=16*u.findDOMNode(t.previewImageFullSize).naturalWidth,r=16*u.findDOMNode(t.previewImageFullSize).naturalHeight;t.onZoom(o,r,16)}}else{var s=t.getImageDOMNode().width,l=e/s,c=a.getPreviewImageWrapper(),p=c.scrollLeft(),d=c.scrollTop(),m=c.width(),h=c.height(),f=m*(l-1)/2+p*l,_=h*(l-1)/2+d*l,v=n>=h?"0":"auto",g=e>=m?"0":"auto",y=v+" "+g;t.setState({shouldDisplayFullSizeImage:null!=t.previewImageFullSize,width:e+"px",height:n+"px",margin:y,zoomPercent:i,zoomFit:!1},function(){c.scrollLeft(f),c.scrollTop(_),t.imageAnnotations.onResize(!1)})}}},t.onZoomIn=function(){t.zoomWithMultiplier(1.25)},t.onZoomOut=function(){t.zoomWithMultiplier(.8)},t.onZoomOriginalOrFit=function(){1===t.state.zoomPercent?t.onZoomFit():t.onZoomOriginal()},t.onZoomOriginal=function(){if(null!=u.findDOMNode(t.previewImageFullSize)){var e=u.findDOMNode(t.previewImageFullSize).naturalWidth,n=u.findDOMNode(t.previewImageFullSize).naturalHeight;t.onZoom(e,n)}},t.onZoomFit=function(){""!==t.state.width&&t.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){t.imageAnnotations.onResize(!1);var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})})},t.setPreviewImageRef=function(e){t.previewImage=e},t.setPreviewImageFullSizeRef=function(e){t.previewImageFullSize=e},t}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){null==this.props.isFullscreen&&_.PreviewImageZoom.close(),null!=this.imageAnnotations&&this.imageAnnotations.reset()},t.prototype.componentWillMount=function(){this.imageAnnotations=new s,this.props.filePreviewSession&&(this.props.filePreviewSession.quipVariant=r.QUIP_VARIANT)},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.logOpen();var e=this.getImageDOMNode();if(null!=e&&e.complete){var t=this.props.nsId+"_"+this.props.sjId,n=window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[t];r.DETECT_SSR_IMAGE_ERROR&&n?this.onImageError():this.onImageLoad()}},t.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this.logOpen(),this.props.supportsAnnotations&&(this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1}))}},t.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},t.prototype.logOpen=function(){f.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},t.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.supportsAnnotations||t===y.SizeClass.Small},t.prototype.getImageDOMNode=function(){return this.state.shouldDisplayFullSizeImage?u.findDOMNode(this.previewImageFullSize):u.findDOMNode(this.previewImage)},t.prototype.zoomWithMultiplier=function(e){if(1!==e){var t=this.getImageDOMNode().width,n=this.getImageDOMNode().height,i=this.calculateZoomPercent(n),o=.05*Math.round(i*e/.05);if(Math.abs(o-i)<.05&&(e>1?o+=.05:o-=.05),!(o<0)){var r=o/i,s=Math.round(t*r),a=Math.round(n*r);this.onZoom(s,a,o)}}},t.prototype.calculateZoomPercent=function(e){if(null==this.previewImageFullSize)return 0;var t=u.findDOMNode(this.previewImageFullSize).naturalHeight;return e&&t?e/t:0},t.prototype.renderToolbarContainer=function(){return this.props.supportsAnnotations?c.createElement(v.PreviewToolbarContainer,{previewToolbarProps:{index:this.props.index,count:this.props.count,zoomPercent:this.state.zoomPercent,minimumZoomPercent:this.state.minimumZoomPercent,maximumZoomPercent:16,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onFullscreen:this.openFullscreen,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,onZoomOriginalOrFit:this.onZoomOriginalOrFit},shouldUseImageToolbar:!0,commentsActionCreators:this.props.commentsActionCreators}):null},t.prototype.renderFullSizeImage=function(e){if(this.state.shouldLoadFullSizeImage){var t={"absolute-center":!0};t[""+a.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,t=d(t);var n=i.extend({},e);return this.state.shouldDisplayFullSizeImage||(n=i.extend(n,{visibility:"hidden"})),c.createElement("img",{alt:this.props.fileName,ref:this.setPreviewImageFullSizeRef,src:w.fullSizeUrl(this.props["preview-url"]),className:t,style:n,onLoad:this.onFullSizeLoad,onClick:this.onImageClick})}},t.prototype.renderSmallImage=function(e){if(!this.state.shouldDisplayFullSizeImage){var t=b.quipLowResThumbEnabled();return c.createElement(g.ResponsiveImage,{refCallback:this.setPreviewImageRef,thumbnailUrlTmpl:this.props["preview-url"],className:a.PREVIEW_IMAGE+" absolute-center",style:e,onLoad:this.onImageLoad,onError:this.onImageError,onClick:this.onImageClick,onContextMenu:this.props.onContextMenu,fileName:this.props.fileName,shouldLoadLowResImg:t})}},t.prototype.render=function(){var e={};this.state.width&&this.state.height&&this.props.supportsAnnotations&&(e={maxWidth:this.state.width,maxHeight:this.state.height,width:this.state.width,height:this.state.height,margin:this.state.margin});var t={"flex-preview-container":!0,"image-visible":!0,"annotations-visible":!0,"zoom-disabled":this.shouldDisableZoom(),"has-annotations-toolbar":this.props.supportsAnnotations,"zoom-fit":this.state.zoomFit};return t[""+a.PREVIEW_IMAGE_CONTAINER]=!0,t=d(t),c.createElement("div",{className:t},c.createElement("div",{className:a.PREVIEW_IMAGE_WRAPPER+" preview-content"},this.renderFullSizeImage(e),this.renderSmallImage(e)),this.renderToolbarContainer())},t})(c.Component);t.PreviewImageWithAnnotationsWithoutCss=P,t.PreviewImageWithAnnotations=m(P,["/static/css/preview_image_with_annotations-vflex8M7t.css"])}),define("modules/clean/react/previews/preview_image_zoom",["require","exports","tslib","jquery","modules/core/browser","modules/constants/file_viewer","modules/clean/react/image","modules/clean/previews/actions","external/react","external/react-dom","external/jquery.fs.zoomer","modules/core/i18n","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/photos/thumbnail_url_util","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/responsive_image","modules/clean/static_urls","external/jquery.mousewheel"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={loadedFullResolutionImageUrl:null,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0,isMounted:!0},t.onFullResolutionImageLoaded=function(){t.state.isMounted&&(t.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),t.setState({loadedFullResolutionImageUrl:t.fullResolutionImage.src},t.bindZoomer),setTimeout(a.broadcastRenderSucceeded,0))},t.onFullResolutionImageError=function(){t.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED)},t.onZoomCallback=function(e){t.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},t.zoomToFit=function(){i(c.findDOMNode(t.zoomContainerRef.refs.zoomControlZoomOut)).trigger("zoomout")},t.unmount=function(){if(t.props.isFlippable)m.exitFullScreen();else{var e=c.findDOMNode(t).parentNode;c.unmountComponentAtNode(e),i(e).remove()}},t.onImageDoubleClick=function(e){if(!i(e.target).hasClass("zoomer"))if(t.getZoomPercent()<100){var n=e.target.getBoundingClientRect();t.zoom100(e.pageX-n.left,e.pageY-n.top)}else t.zoomToFit()},t.setZoomContainerRef=function(e){t.zoomContainerRef=e},t}return n.__extends(t,e),t.open=function(e,n,o,r){void 0===o&&(o=void 0);var s=i("<div />",{id:"preview-image-zoomzoom-wrapper"});i(document.body).append(s);var a=l.createElement(t,{thumbnailUrlTmpl:e,fileExtension:n,isFlippable:!1,onContextMenu:o,fileName:r});return c.render(a,s.get(0))},t.close=function(){var e=document.getElementById("preview-image-zoomzoom-wrapper");e&&c.unmountComponentAtNode(e)},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.delayedSetupImage(this.props.thumbnailUrlTmpl)},t.prototype.componentWillReceiveProps=function(e){if(e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl){var t=e.filePreviewSession;this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this.setState({loadedFullResolutionImageUrl:null}),this.destroyZoomer(),this.delayedSetupImage(e.thumbnailUrlTmpl)}},t.prototype.componentWillMount=function(){this.props.filePreviewSession&&(this.props.filePreviewSession.quipVariant=r.QUIP_VARIANT)},t.prototype.componentWillUnmount=function(){this.destroyZoomer(),i(window).off("resize.zommer"),this.setState({isMounted:!1})},t.prototype.delayedSetupImage=function(e){var n=this;setTimeout(function(){n.state.isMounted&&n.props.thumbnailUrlTmpl===e&&n.setupImage(e)},t.SETUP_IMAGE_WAIT_TIME)},t.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},t.prototype.setupImage=function(e){var t=this;this.fullResolutionImage=document.createElement("img"),this.fullResolutionImage.onload=function(){t.props.thumbnailUrlTmpl===e&&t.onFullResolutionImageLoaded()},this.fullResolutionImage.onerror=this.onFullResolutionImageError,this.fullResolutionImage.src=h.fullSizeUrl(e)},t.prototype.bindZoomer=function(){var e=this;if(null!=this.state.loadedFullResolutionImageUrl){var t=i(".preview-zoom").width(),n=this.getPreviewZoomerElement();u(n,{controls:{zoomIn:i(c.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomIn)),zoomOut:i(c.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomOut)),zoomLabel:i(c.findDOMNode(this.zoomContainerRef.refs.zoomLabel)),zoomLabelContainer:i(c.findDOMNode(this.zoomContainerRef.refs.zoomLabelContainer))},customClass:"preview-zoomer-style",retina:!1,onZoomCallback:this.onZoomCallback,startWidth:t,onContextMenu:this.props.onContextMenu}),null==this.fitToZoom&&(this.fitToZoom=this.getZoomPercent()),i(window).off("resize.zoomer").on("resize.zoomer",function(){u(n,"resize"),e.fitToZoom=e.getZoomPercent()}),n.off("mousewheel.zoom").on("mousewheel.zoom",function(t,n){t.preventDefault(),e.zoomScroll(n*t.deltaFactor)})}},t.prototype.destroyZoomer=function(){u(this.getPreviewZoomerElement(),"destroy")},t.prototype.getPreviewZoomerElement=function(){return i(".preview-zoomer")},t.prototype.getZoomPercent=function(){return parseFloat(i(c.findDOMNode(this.zoomContainerRef.refs.zoomLabel)).text())},t.prototype.zoom100=function(e,t){u(this.getPreviewZoomerElement(),"zoom100",e,t)},t.prototype.zoomScroll=function(e){u(this.getPreviewZoomerElement(),"zoomScroll",e)},t.prototype.renderFullResolution=function(){return null!=this.state.loadedFullResolutionImageUrl?l.createElement("img",{alt:this.props.fileName,className:"preview-zoom",src:this.state.loadedFullResolutionImageUrl,style:{maxHeight:i(".preview-zoom").height(),maxWidth:i(".preview-zoom").width()},onContextMenu:this.props.onContextMenu}):l.createElement(_.ResponsiveImage,{thumbnailUrlTmpl:this.props.thumbnailUrlTmpl,className:"preview-zoom",onContextMenu:this.props.onContextMenu,fileName:this.props.fileName})},t.prototype.renderImage=function(){return l.createElement("div",{ref:"previewZoomer",className:"preview-zoomer",style:{textAlign:"center"},onDoubleClick:null!=this.state.loadedFullResolutionImageUrl?this.onImageDoubleClick:void 0},this.renderFullResolution())},t.prototype.renderLoading=function(){return l.createElement("div",{className:"preview-zoomer-loading"},l.createElement(s,{alt:p._("Loading..."),src:v.static_url("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:v.static_url("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}))},t.prototype.renderPreview=function(){return null!=o.mozilla&&null==this.state.loadedFullResolutionImageUrl?this.renderLoading():this.renderImage()},t.prototype.render=function(){var e="preview-zoom";return null!=this.state.loadedFullResolutionImageUrl?e="zoomer-image":null!=o.mozilla&&(e="preview-zoomer-loading"),l.createElement(f.PreviewZoomContainer,{isFlippable:this.props.isFlippable||!1,renderZoomControls:null!=this.state.loadedFullResolutionImageUrl,onClose:this.unmount,containerClass:e,zoomOutCallback:this.zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:this.setZoomContainerRef},this.renderPreview())},t.SETUP_IMAGE_WAIT_TIME=100,t})(l.Component);t.PreviewImageZoom=g}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/actions","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logEvent("requestlinkdata",!0),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},s.SilentBackgroundRequest(n)):s.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logEvent("displaylinkdata",!0,e.uri),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(c.broadcastRenderSucceeded,0)},t.handleLinkDataError=function(){t.logEvent("displaylinkerror",!1),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.markWebTiming(),t.state.isMounted&&t.setState({description:h._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){t.logEvent("navlink",!0,t.state.link);var n=p.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logEvent=function(e,t,n,i){void 0===i&&(i={});var o=null;null!=n&&(o=f.parse(n).getAuthority()),r.LinkfileActivityLogger.log(e,l.file_extension(this.props.filename),o,t,this.props.source,i)},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1,this.logEvent("destroy",!0,this.state.link)},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",s="";null!=this.props.filename&&(r=l.filename_without_extension(this.props.filename),s=l.file_extension(this.props.filename),""!==s&&(s="."+s));var c=t.MAX_DISPLAYED_FILENAME_CHARS-s.length,u=a.em_snippet(r,c),p="-";null!=this.state.description&&(p=this.state.description);var d={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},f=m.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return o.createElement("div",{className:"flex-preview-container"},o.createElement("div",{className:"preview-content preview-content--center"},o.createElement("div",{className:"preview-linkfile-box"},o.createElement("div",{className:i(e)},o.createElement("div",{className:"preview-linkfile-icon"},o.createElement("img",{src:f,alt:""})),o.createElement("div",{className:"preview-linkfile-title"},o.createElement("span",{className:"preview-linkfile-filebase"},u),o.createElement("span",{className:"preview-linkfile-fileext"},s)),o.createElement("div",{className:"preview-linkfile-info"},o.createElement("div",{className:i(d)},p),o.createElement("button",{className:i(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},h._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(o.Component);t.PreviewLinkfile=_}),define("modules/clean/react/previews/preview_pdf",["require","exports","tslib","external/react","external/underscore","modules/constants/file_viewer","modules/core/browser","modules/core/uri","modules/core/i18n","modules/clean/previews/pdf_loader","modules/clean/previews/actions","modules/clean/react/previews/preview_toolbar_container","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_thumbnail_image","modules/clean/web_timing_logger"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INFINITE_SCROLL_ACTIVE_ZONE=1;var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={numThumbnails:1,thumbnailPage:-1,pagesRendered:[],maxThumbnails:1/0,lastPageLoaded:0},n.onDownloadAttempted=function(){n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},n.onDownloadFailed=function(e){n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED);var t;null!=e&&(t=e.rivieraStatus),null!=n.props.onError&&n.props.onError(d.mapRivieraStatusToErrorType(t))},n.onDownloadSucceeded=function(e){null!=n.props.filePreviewSession&&(n.props.filePreviewSession.previewSize=e.size,n.props.filePreviewSession.pageCount=e.pageCount),n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},n.onRenderFailed=function(){n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_RENDER_FAILED),null!=n.props.onError&&n.props.onError(),f.mark_time_to_view(),f.mark_time_to_interactive()},n.onFirstRenderSucceeded=function(e){n.props.filePreviewSession&&(n.props.filePreviewSession.markPrimaryEvent(),n.props.filePreviewSession.markSecondaryEvent(),e&&(n.props.filePreviewSession.firstPageRendered=e.pageRendered)),f.mark_time_to_view(),f.mark_time_to_interactive(),n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(u.broadcastRenderSucceeded,0),n.pdfLoader.repositionFile(n.getThumbnailScrollPosition())},n.onPageRendered=function(e){var t=e.page,i=e.pagesRendered,o=Date.now();null==n.props.filePreviewSession||n.props.filePreviewSession.pagesRendered[t]||(n.props.filePreviewSession.pagesRendered[t]=o),i&&n.setState({pagesRendered:i}),
n.hideThumbnailsIfPageRendered()},n.onZoom=function(e){null!=n.props.filePreviewSession&&(n.props.filePreviewSession.zoomScales=o.union(n.props.filePreviewSession.zoomScales,[e.zoomScale]))},n.onPasswordNeeded=function(){n.hideThumbnails(),f.mark_time_to_view(),f.mark_time_to_interactive(),n.logPasswordNeeded(),n.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},n.onPageRepositioned=function(e){var t=e.page;n.setState({thumbnailPage:t}),n.hideThumbnailsIfPageRendered()},n.onFirstThumbnailLoad=function(){n.props.filePreviewSession&&(n.props.filePreviewSession.markPrimaryEvent(),n.props.filePreviewSession.markSecondaryEvent()),f.mark_time_to_view(),f.mark_time_to_interactive();var e=n.firstPageThumbnailDOM;e&&n.setFirstPageWidth(e.naturalWidth)},n.onSubsequentThumbnailLoad=function(e){n.setState({lastPageLoaded:Math.max(e,n.state.lastPageLoaded+1)})},n.setThumbnailDOM=function(e){n.firstPageThumbnailDOM=e},n.setThumbnailRef=function(e){return n.thumbnailRef=e},n.hideThumbnails=n.hideThumbnails.bind(n),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.props.filePreviewSession&&(this.props.filePreviewSession.quipVariant=r.QUIP_VARIANT)},t.prototype.componentDidMount=function(){this.setUpPdfLoader(),this.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.loadPdf(),this.checkIfFirstThumbnailLoaded()},t.prototype.componentDidUpdate=function(){this.loadPdf()},t.prototype.componentWillUnmount=function(){null!=this.pdfLoader&&this.pdfLoader.stopListening()},t.prototype.setUpPdfLoader=function(){this.pdfLoader=new c.PdfLoader,this.pdfLoader.setIsFullscreen(this.props.isFullscreen),this.pdfLoader.setOnDownloadAttempted(this.onDownloadAttempted),this.pdfLoader.setOnDownloadFailed(this.onDownloadFailed),this.pdfLoader.setOnDownloadSucceeded(this.onDownloadSucceeded),this.pdfLoader.setOnRenderFailed(this.onRenderFailed),this.pdfLoader.setOnFirstRenderSucceeded(this.onFirstRenderSucceeded),this.pdfLoader.setOnPageRendered(this.onPageRendered),this.pdfLoader.setOnPageRepositioned(this.onPageRepositioned),this.pdfLoader.setOnPasswordNeeded(this.onPasswordNeeded),this.pdfLoader.setOnZoom(this.onZoom),this.pdfLoader.startListening()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.logPasswordNeeded=function(){null!=this.props.filePreviewSession&&(this.props.filePreviewSession.passwordNeeded=!0)},t.prototype.hideThumbnails=function(){this.setState({numThumbnails:0})},t.prototype.onThumbnailError=function(e){this.setState({numThumbnails:Math.min(e,this.state.numThumbnails),maxThumbnails:Math.min(e,this.state.maxThumbnails)})},t.prototype.hideThumbnailsIfPageRendered=function(){this.state.pagesRendered.indexOf(this.state.thumbnailPage)!==-1&&this.hideThumbnails()},t.prototype.setFirstPageWidth=function(e){this.setState({firstPageWidth:e})},t.prototype.checkIfFirstThumbnailLoaded=function(){var e=this.firstPageThumbnailDOM;e&&e.complete&&(e.naturalWidth>0?this.onFirstThumbnailLoad():this.hideThumbnails())},t.prototype.getIframeUrl=function(){var e=d.get_pdf_js_url(this.getNormalizedExtension());return e=d.update_url_with_user_id(e,this.props.userId),e=d.update_url_for_annotation(e),e.toString()},t.prototype.getNormalizedExtension=function(){return d.normalize_extension(this.props.fileExtension)},t.prototype.getThumbnailScrollPosition=function(){return null!=this.thumbnailRef&&"none"!==this.thumbnailRef.style.display?this.thumbnailRef.scrollTop:null},t.prototype.loadPdf=function(){if(null!=this.pdfLoader){var e=!s.is_mobile_or_tablet()&&"ppt"===this.getNormalizedExtension();this.pdfLoader.openFile(this.props.previewUrl,{presentationMode:e})}},t.prototype.renderPreview=function(){return i.createElement("iframe",{key:"RenderPreviewIFrame",name:"preview-content",type:"application/pdf",className:"pdfjs",id:"pdf-embed-iframe",src:this.getIframeUrl()})},t.prototype.renderLoadingIndicator=function(){if(this.state.numThumbnails>0&&this.props.thumbnailUrl)return i.createElement("div",{className:"loading-indicator",key:"LoadingIndicator"},i.createElement("div",{className:"loading-indicator__content"},l._("Loading...")))},t.prototype.renderThumbnails=function(){if(this.state.numThumbnails>0&&this.props.thumbnailUrl){for(var e=[],t=a.parse(this.props.thumbnailUrl),n=0;n<this.state.numThumbnails;++n){var o=void 0;if(n>0){if(!this.state.firstPageWidth)continue;t.updateQuery({page:""+n,size_mode:"5"});var r=t.toString();o=i.createElement(h.PdfThumbnailImage,{firstPageWidth:this.state.firstPageWidth,src:r,className:"thumbnail__image",onLoad:this.onSubsequentThumbnailLoad.bind(this,n),onError:this.onThumbnailError.bind(this,n)})}else{t.updateQuery({size_mode:"5"});var r=t.toString();o=i.createElement(h.PdfThumbnailImage,{refCallback:this.setThumbnailDOM,src:r,className:"thumbnail__image",onLoad:this.onFirstThumbnailLoad,onError:this.hideThumbnails})}e.push(i.createElement("div",{className:"thumbnail__image-wrapper",key:n},o))}return i.createElement("div",{className:"thumbnail",ref:this.setThumbnailRef},e)}},t.prototype.renderToolbarContainer=function(){var e={afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileHref:this.props.fileHref,fileBlockServerUrl:this.props.src,filePreviewType:this.props.previewType,isFullscreen:this.props.isFullscreen,isSharedLink:this.props.isSharedLink,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,sizeClass:this.props.sizeClass};return i.createElement(p.PreviewToolbarContainer,{key:"PreviewToolbarContainer",previewToolbarProps:e,commentsActionCreators:this.props.commentsActionCreators,shouldUseImageToolbar:!1})},t.prototype.render=function(){return i.createElement("div",{className:"preview-content preview-pdf"},this.renderThumbnails(),this.renderLoadingIndicator(),this.renderToolbarContainer(),this.renderPreview())},t})(i.Component);t.PreviewPDF=_}),define("modules/clean/react/previews/preview_pdf_ssr",["require","exports","tslib","external/underscore","external/react","modules/clean/web_timing_logger","modules/clean/react/previews/pdf_viewer/app","modules/clean/react/previews/pdf_viewer/frame_messenger_shims","modules/constants/file_viewer","modules/clean/react/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_viewer_interface_controller","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/pdf_viewer/urls","modules/clean/previews/actions","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(t){var n=e.call(this,t)||this;return n.onError=function(e){e===c.ErrorTypes.LOAD_ERROR&&n.onDownloadFailed(),n.props.onError&&n.props.onError(e)},n.onDownloadAttempted=function(){n.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},n.onDownloadSucceeded=function(){n.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},n.onDownloadFailed=function(){n.props.isErrorRecoverable||n.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED)},n.onFirstRenderSucceeded=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.markSecondaryEvent(),n.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),h.broadcastRenderSucceeded()},n.onPlaceholderImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("placeholder_loaded")},n.sendIdleMouse=i.debounce(function(){n.frameMessengerClient.postMessageToParent("idle-mouse")},1500),n.onMouseMove=i.throttle(function(){n.frameMessengerClient.postMessageToParent("active-mouse"),n.sendIdleMouse()},16),n.onToolbarShow=function(){n.setState({isToolbarVisible:!0})},n.onToolbarHide=function(){n.setState({isToolbarVisible:!1})},n.onLoad=function(){n.frameMessengerClient.postMessageToParent("viewer-ready")},n.state={isToolbarVisible:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.props.filePreviewSession&&(this.props.filePreviewSession.isSSR=!0),this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.frameMessengerChannel=a.makeChannel(),this.frameMessengerHost=new a.FrameMessengerHostShim(this.frameMessengerChannel),this.frameMessengerClient=new a.FrameMessengerClientShim(this.frameMessengerChannel),this.frameMessengerClient.configureParentMessaging(function(e){return f.eventEmitter.emit(e.action,e.parameters)},["open-file","page-up","page-down","file-feedback-ui-ready","update-annotations","enable-annotation-creation","disable-annotation-creation","enable-region-creation","disable-region-creation","set-attributions","zoom-in","zoom-out","print","remove-all-annotations","scroll-to-annotation"]),this.frameMessengerClient.startListening(),p.FileViewerInterfaceController.setFrameMessengerFactory(function(){return new a.FrameMessengerHostShim(e.frameMessengerChannel)})},t.prototype.componentWillUnmount=function(){p.FileViewerInterfaceController.setFrameMessengerFactory(void 0)},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markPrimaryEvent=function(){r.mark_time_to_view(),r.mark_time_to_interactive(),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent()},t.prototype.renderToolbar=function(){var e={afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileHref:this.props.fileHref,fileBlockServerUrl:this.props.src,filePreviewType:this.props.previewType,isFullscreen:this.props.isFullscreen,isSharedLink:this.props.isSharedLink,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,frameMessenger:this.frameMessengerHost,onToolbarShow:this.onToolbarShow,onToolbarHide:this.onToolbarHide,sizeClass:this.props.sizeClass};return o.createElement(d.PreviewToolbarContainer,{commentsActionCreators:this.props.commentsActionCreators,previewToolbarProps:e,shouldUseImageToolbar:!1})},t.prototype.canPrint=function(){return!(this.props.sharePermissions&&this.props.sharePermissions.canPrintRoles&&0===this.props.sharePermissions.canPrintRoles.length)},t.prototype.getPrintProps=function(){return{canPrint:this.canPrint(),isSharedLink:this.props.isSharedLink||!1,fileBlockServerUrl:this.props.src,fileHref:this.props.fileHref||null}},t.prototype.renderPreviewContent=function(){var e=new m.SsrUrlSet({imageUrl:this.props.imageUrl,textUrl:this.props.textUrl,refreshUrl:this.props.refreshUrl});l.DOCPREVIEW_DEBUG_FORCE_TEST_PDF&&e.setUseCannedFile();var t=v.quipLowResThumbEnabled();return o.createElement(s.App,{key:e.refreshUrl(),fileExtension:this.props.fileExtension,filePreviewSession:this.props.filePreviewSession,frameMessenger:this.frameMessengerClient,urls:e,onLoad:this.onLoad,onError:this.onError,onExitFullscreen:_.exitFullScreen,timelineCallbacks:{onDownloadAttempted:this.onDownloadAttempted,onDownloadSucceeded:this.onDownloadSucceeded,onFirstRenderSucceeded:this.onFirstRenderSucceeded,onPlaceholderImageLoad:this.onPlaceholderImageLoad},isFullscreen:this.props.isFullscreen,isToolbarVisible:this.state.isToolbarVisible,previewThumbnailUrl:this.props.previewThumbnailUrl,shouldLoadLowResImg:t,printProps:this.getPrintProps()})},t.prototype.render=function(){return o.createElement("div",{className:"preview-content preview-pdf preview-pdf-ssr",onMouseMove:this.onMouseMove,onTouchStart:this.onMouseMove,onTouchMove:this.onMouseMove},this.renderPreviewContent(),this.renderToolbar())},t})(o.PureComponent);t.PreviewPdfSSR=g}),define("modules/clean/react/previews/preview_toolbar",["require","exports","tslib","external/keymaster","external/react","jquery","modules/clean/analytics","modules/clean/keycode","modules/clean/react/file_viewer/actions","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/size_class/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n","modules/clean/react/keyboard_binding/keyboard_binding_connector"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g){"use strict";function y(e){var t=e.className+" toolbar-button-entry",n=e.disabled;return o.createElement("div",{className:t,onMouseUp:e.onClick},o.createElement("div",{className:"toolbar-tooltip"},o.createElement("div",{className:"toolbar-tooltip-container"},o.createElement("div",{className:"toolbar-tooltip-pointer-border"})),o.createElement("div",{className:"toolbar-tooltip-container"},o.createElement("div",{className:"toolbar-tooltip-body"},e.tooltip)),o.createElement("div",{className:"toolbar-tooltip-container"},o.createElement("div",{className:"toolbar-tooltip-pointer"}))),o.createElement("button",{alt:e.tooltip},o.createElement(h,{group:e.spriteGroup,name:e.spriteName,className:n?"disabled":"",alt:e.tooltip})))}function E(e){var n=e.currentPage,i=e.docType,r=e.pagesCount,s=e.sizeClass;if(!n||!r)return null;var a="";a=s===d.SizeClass.Small?v._("%(current_page)s of %(pages_count)s"):i===t.PreviewToolbarDocType_SPP?v._("Slide %(current_page)s of %(pages_count)s"):v._("Page %(current_page)s of %(pages_count)s");var l=a.format({current_page:n,pages_count:r});return o.createElement("div",{className:b.PAGE_INDICATOR},l)}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarDocType_DEFAULT="default",t.PreviewToolbarDocType_SPP="spp",t.PreviewToolbarDocType_SPREADSHEET="spreadsheet",t.PreviewToolbarDocType_HTML="html";var w={};w[a.KeyCode.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},w[70]={altKey:!1,ctrlKey:!0,metaKey:!0},w[80]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},w[a.KeyCode.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0};var b={PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",PRINT:"print",ENABLE_REGION_CREATION:"enable-region-creation"},P={default:["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print","enable-region-creation"],spp:["page-indicator","page-up","page-down","fullscreen","print","enable-region-creation"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},C={default:["page-indicator"],spp:["page-indicator"],spreadsheet:[],html:[]},A={ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up",ENABLE_REGION_CREATION:"enable-region-creation"};t.PreviewToolbarButton=y;var S=(function(e){function h(){var n=null!==e&&e.apply(this,arguments)||this;return n.previewOpen=!1,n.state={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,disabledButtons:{},docType:t.PreviewToolbarDocType_DEFAULT},n.onMouseEnterToolbar=function(){n.frameMessenger.postMessageToChildren(A.CLEAR_MOUSE_TRACKING),n.setState({hovering:!0}),n.clearIdleTimeout()},n.onMouseLeaveToolbar=function(){n.setState({hovering:!1})},n.onKeydown=function(e){var o=!1;if(n.frameMessenger.childIsValidated()&&"dbmodal"!==i.getScope()&&!f.focus_in_input()&&!f.is_input(e.target)){if(null!=e.target){var s=r("#file-comments");if(1!==s.length&&(s=r("#photo-comments")),1===s.length&&(e.target===s[0]||r.contains(s[0],e.currentTarget)))return}var l={input_method:"keydown",file_ext:n.props.fileExtension,extra:JSON.stringify({keycode:e.keyCode})},c={context:u.UserActionContextNames.KEYBOARD},p=e.keyCode;return n.state.docType!==t.PreviewToolbarDocType_SPP&&[a.KeyCode.EQUALS,a.KeyCode.PLUS_EQUALS_FF,a.KeyCode.PLUS_CHROME,a.KeyCode.PLUS_EQUALS_FF_GERMAN].indexOf(p)>-1?(n.zoomIn(c),o=!0):n.state.docType!==t.PreviewToolbarDocType_SPP&&[a.KeyCode.MINUS_FF_MAC,a.KeyCode.MINUS_FF,a.KeyCode.MINUS_CHROME].indexOf(p)>-1?(n.zoomOut(c),o=!0):p===a.KeyCode.LEFT?(n.scrollLeft(l),o=!0):p===a.KeyCode.RIGHT?(n.scrollRight(l),o=!0):p===a.KeyCode.PAGE_UP?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageUp(l):n.screenUp(l),o=!0):[a.KeyCode.SPACE,a.KeyCode.PAGE_DOWN].indexOf(p)>-1?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageDown(l):n.screenDown(l),o=!0):p===a.KeyCode.UP?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageUp(l):n.scrollUp(l),o=!0):p===a.KeyCode.DOWN?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageDown(l):n.scrollDown(l),o=!0):70!==p||e.ctrlKey||e.metaKey?70===p&&(e.ctrlKey||e.metaKey)?n.searchInline(c):80===p?(n.printDocument(c),o=!0):p===a.KeyCode.ESC&&(n.isViewerFullscreen()?n.exitFullscreen(c):n.props.afterFileViewerExit&&!n.isAnnotationBubbleShown()&&n.exitPreview(l),o=!0):(n.isViewerFullscreen()?n.exitFullscreen(c):n.enterFullscreen(c),o=!0),o&&null!=e.preventDefault&&e.preventDefault(),!o}},n.pageUp=function(e){n.logAndPostMessage(A.PAGE_UP,"page-up",e)},n.pageDown=function(e){n.logAndPostMessage(A.PAGE_DOWN,"page-down",e)},n.screenUp=function(e){n.logAndPostMessage(A.SCREEN_UP,"screen-up",e)},n.screenDown=function(e){n.logAndPostMessage(A.SCREEN_DOWN,"screen-down",e)},n.scrollUp=function(e){n.logAndPostMessage(A.SCROLL_UP,"scroll-up",e)},n.scrollDown=function(e){n.logAndPostMessage(A.SCROLL_DOWN,"scroll-down",e)},n.scrollRight=function(e){n.logAndPostMessage(A.SCROLL_RIGHT,"scroll-right",e)},n.scrollLeft=function(e){n.logAndPostMessage(A.SCROLL_LEFT,"scroll-left",e)},n}return n.__extends(h,e),h.prototype.reset=function(){this.clearAllTimeouts(),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,disabledButtons:{},docType:t.PreviewToolbarDocType_DEFAULT})},h.prototype.setFullScreen=function(e,t){e?p.enterFullScreen(!0,t.context):p.exitFullScreen(t.context)},h.prototype.isViewerFullscreen=function(){return this.props.isFullscreen||p.isBrowserFullscreen()},h.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:w})},h.prototype.handleMessageFromChild=function(e){var t=this,n={input_method:"child-message",file_ext:this.props.fileExtension},i={context:u.UserActionContextNames.UNKNOWN},o=e.parameters;switch(e.action){case"page-change":case"pagerendered":var r=this.isToolbarReadyToShow(),a=this.sanitizePageNumber(o.current_page||o.attributes.page),l=this.sanitizePageNumber(o.pages_count||o.attributes.pages);if(a<=0||l<=0)break;null!=o.doc_type&&this.setState({docType:o.doc_type});var c={pageUp:a<=1,pageDown:a>=l,print:!this.canPrint()};this.setState({currentPage:a,pagesCount:l,disabledButtons:c},function(){!r&&t.isToolbarReadyToShow()&&(t.fadeIn(),t.startIdleTimeout())});break;case"idle-mouse":this.state.hovering||this.fadeOut(),s.PreviewActivityLogger.log("idle-mouse",n);break;case"active-mouse":this.fadeIn();break;case"exit-parent-fullscreen":this.setFullScreen(!1,i);break;case"keydown":null!=o&&this.onKeydown(o);break;case"get-keydown-keys-handled-by-parent":this.postKeysHandledByParent()}},h.prototype.onPreviewOpen=function(){return!!this.previewOpen||(r(document).on("keydown",this.onKeydown),this.previewOpen=!0,!0)},h.prototype.onPreviewClose=function(){return!this.previewOpen||(r(document).off("keydown",this.onKeydown),this.reset(),this.frameMessenger.resetOriginsForPosting(),this.previewOpen=!1,!0)},h.prototype.componentDidMount=function(){this.props.frameMessenger?this.frameMessenger=this.props.frameMessenger:this.frameMessenger=new m.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging(c.getIframeQuery(),this.handleMessageFromChild.bind(this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","pagerendered"]),this.frameMessenger.startListening(),this.postKeysHandledByParent(),this.onPreviewOpen()},h.prototype.componentWillUnmount=function(){this.clearAllTimeouts(),this.onPreviewClose(),this.frameMessenger.stopListening()},h.prototype.canPrint=function(){return!(this.props.sharePermissions&&this.props.sharePermissions.canPrintRoles&&0===this.props.sharePermissions.canPrintRoles.length)},h.prototype.showButton=function(e){return this.props.sizeClass===d.SizeClass.Small?C[this.state.docType].includes(e):P[this.state.docType].includes(e)},h.prototype.render=function(){var e,i=this,r="preview-toolbar-overlay-container ";this.state.visible&&!this.props.isHidden||(r+="hide "),this.state.fadingOut&&(r+="fadeout ");var s={className:r},a=this.state.docType===t.PreviewToolbarDocType_SPP?v._("Previous slide"):v._("Page up"),l=this.state.docType===t.PreviewToolbarDocType_SPP?v._("Next slide"):v._("Page down");e=this.canPrint()?v._("Print"):v._("Printing is turned off for this file.");var c={input_method:"click",file_ext:this.props.fileExtension},p={context:u.UserActionContextNames.TOOLBAR},d=function(e){return function(){e(),i.frameMessenger.postMessageToChildren(A.CLEAR_MOUSE_TRACKING)}};return o.createElement("div",n.__assign({},s),o.createElement(g.KeyboardBindingConnector,{allKeyCallback:this.onKeydown}),o.createElement("div",{className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar,onMouseLeave:this.onMouseLeaveToolbar},o.createElement("div",{className:"preview-toolbar-content"},this.showButton("page-indicator")?o.createElement(E,{currentPage:this.state.currentPage,docType:this.state.docType,pagesCount:this.state.pagesCount,sizeClass:this.props.sizeClass}):null,this.showButton("zoom-out")?o.createElement(y,{className:b.ZOOM_OUT,spriteGroup:"web",spriteName:"zoomout",tooltip:v._("Zoom out"),onClick:d(function(){return i.zoomOut(p)})}):null,this.showButton("zoom-in")?o.createElement(y,{className:b.ZOOM_IN,spriteGroup:"web",spriteName:"zoom",tooltip:v._("Zoom in"),onClick:d(function(){return i.zoomIn(p)})}):null,this.showButton("page-up")?o.createElement(y,{disabled:this.state.disabledButtons.pageUp,className:b.PAGE_UP,spriteGroup:"web",spriteName:"up",tooltip:a,onClick:d(function(){return i.pageUp(c)})}):null,this.showButton("page-down")?o.createElement(y,{disabled:this.state.disabledButtons.pageDown,className:b.PAGE_DOWN,spriteGroup:"web",spriteName:"down",tooltip:l,onClick:d(function(){return i.pageDown(c)})}):null,this.showButton("fullscreen")?o.createElement(y,{className:b.FULLSCREEN,spriteGroup:"web",spriteName:"fullscreen",tooltip:v._("Fullscreen"),onClick:d(function(){return i.toggleFullscreen(p)})}):null,this.showButton("print")?o.createElement(y,{disabled:this.state.disabledButtons.print,className:b.PRINT,spriteGroup:"web",spriteName:"print",tooltip:e,onClick:d(function(){return i.printDocument(p)})}):null,this.showButton("enable-region-creation")&&this.props.shouldDisplayRegionCreationButton?o.createElement(y,{className:b.ENABLE_REGION_CREATION,spriteGroup:"web",spriteName:"ic_comment_area_large",tooltip:v._("Comment on specific areas"),onClick:d(function(){return i.onRegionCreationClick()})}):null)))},h.prototype.sanitizePageNumber=function(e){if(null==e)return 0;var t=parseInt(e,10);return isNaN(t)?0:t},h.prototype.fadeOut=function(){this.state.fadingOut||this.clearFadeTimeout(),this.setState({fadingOut:!0,tooltipClass:void 0}),this.props.onToolbarHide&&this.props.onToolbarHide(),this.startFadeTimeout()},h.prototype.fadeIn=function(){this.clearIdleTimeout(),this.isViewerFullscreen()||this.isToolbarReadyToShow()&&(this.clearFadeTimeout(),this.setState({visible:!0,fadingOut:!1}),this.props.onToolbarShow&&this.props.onToolbarShow())},h.prototype.isAnnotationBubbleShown=function(){return r(".annotation-bubble-container .bubble-dropdown").length>0},h.prototype.startFadeTimeout=function(){var e=this;this.fadeTimeout=setTimeout(function(){e.fadeTimeout=void 0,e.setState({visible:!1,fadingOut:!1})},400)},h.prototype.clearFadeTimeout=function(){this.fadeTimeout&&(clearTimeout(this.fadeTimeout),this.fadeTimeout=void 0)},h.prototype.onIdleTimeout=function(){this.clearIdleTimeout(),this.fadeOut()},h.prototype.startIdleTimeout=function(){this.clearIdleTimeout(),this.idleTimeout=setTimeout(this.onIdleTimeout.bind(this),1500)},h.prototype.clearIdleTimeout=function(){null!=this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=void 0)},h.prototype.clearAllTimeouts=function(){this.clearFadeTimeout(),this.clearIdleTimeout()},h.prototype.isToolbarReadyToShow=function(){return!!this.state.currentPage&&!!this.state.pagesCount},h.prototype.logData=function(e,t){return"string"==typeof t.input_method?s.PreviewActivityLogger.log(e,t):_.assert(!1,"logData not correctly formed"),"string"==typeof t.input_method},h.prototype.logUserAction=function(e,t){l.logUserAction(e,t)},h.prototype.logAndPostMessage=function(e,t,n){this.logData(t,n)&&this.frameMessenger.postMessageToChildren(e)},h.prototype.zoomIn=function(e){this.frameMessenger.postMessageToChildren(A.ZOOM_IN),this.logUserAction(u.UserActionNames.ZOOM_IN,e.context)},h.prototype.zoomOut=function(e){this.frameMessenger.postMessageToChildren(A.ZOOM_OUT),this.logUserAction(u.UserActionNames.ZOOM_OUT,e.context)},h.prototype.toggleFullscreen=function(e){this.isViewerFullscreen()?this.exitFullscreen(e):this.enterFullscreen(e)},h.prototype.enterFullscreen=function(e){this.setFullScreen(!0,e)},h.prototype.exitFullscreen=function(e){this.setFullScreen(!1,e)},h.prototype.exitPreview=function(e){if(this.logData("exit-preview",e))return"function"==typeof this.props.afterFileViewerExit?this.props.afterFileViewerExit():void 0},h.prototype.printDocument=function(e){this.frameMessenger.postMessageToChildren(A.PRINT,{context:e.context})},h.prototype.searchInline=function(e){this.logUserAction(u.UserActionNames.INLINE_SEARCH,e.context)},h.prototype.onRegionCreationClick=function(){this.props.onRegionCreationClick&&this.props.onRegionCreationClick()},h})(o.Component);t.PreviewToolbar=S,t.PageIndicator=E}),define("modules/clean/react/previews/preview_toolbar_container",["require","exports","tslib","external/classnames","external/react","external/react-redux","modules/clean/react/file_viewer/data/selectors","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/comments/constants","modules/clean/comments/logging","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/preview_toolbar_region_creation","modules/clean/previews/preview_toolbar_store","modules/constants/comments_panel"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getComponentState=function(){return{canAnnotate:p.canAnnotate(t.props.isFullscreen),regionCreationEnabled:u.state.regionCreationEnabled,hideToolbar:h.PreviewToolbarStore.state.hideToolbar}},t.state=t.getComponentState(),t.onStateChange=function(){return t.setState(t.getComponentState())},t.logRegionCreationClick=function(e){c.logEvent(e,l.FileActivityLogClientOriginType.ANNOTATION_MODE_BUTTON_IN_TOOLBAR)},t.onRegionCreationClick=function(){t.logRegionCreationClick(l.FileActivityLogEventType.CLIENT_ANNOTATION_MODE_ENABLED),t.props.commentsActionCreators.setRegionCreationEnabled(!0)},t.onRegionCreationDoneClick=function(){t.logRegionCreationClick(l.FileActivityLogEventType.CLIENT_ANNOTATION_MODE_DISABLED),t.props.commentsActionCreators.setRegionCreationEnabled(!1)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.unsubscribeCommentsStore=u.listen(this.onStateChange),this.unsubscribePreviewToolbarStore=h.PreviewToolbarStore.listen(this.onStateChange)},t.prototype.componentWillUnmount=function(){this.unsubscribeCommentsStore(),this.unsubscribePreviewToolbarStore(),this.state.regionCreationEnabled&&this.props.commentsActionCreators.setRegionCreationEnabled(!1)},t.prototype.render=function(){var e=this.state.regionCreationEnabled&&this.state.canAnnotate,t=f.ALLOW_VIEW_ANNOTATE_MODES&&this.state.canAnnotate,r=null;if(this.props.shouldUseImageToolbar)e||(r=o.createElement(a,n.__assign({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this.onRegionCreationClick,canEnableRegionCreation:t})));else{var s=!!this.props.previewToolbarProps.isHidden||e||this.state.hideToolbar;r=o.createElement(d.PreviewToolbar,n.__assign({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this.onRegionCreationClick,isHidden:s,shouldDisplayRegionCreationButton:t}))}var l=null;e&&(l=o.createElement(m.PreviewToolbarRegionCreation,{onRegionCreationDoneClick:this.onRegionCreationDoneClick}));var c=i({"preview-toolbar-container":!0,"preview-toolbar-container--elevated":!!this.props.elevateToolbar});return o.createElement("div",{className:c},r,l)},t})(o.Component);t.PreviewToolbarContainerInternal=_,t.PreviewToolbarContainer=r.connect(function(e){return{isFullscreen:s.getIsFullScreen(e)}},void 0,void 0,{withRef:!0})(_)}),define("modules/clean/react/previews/preview_toolbar_region_creation",["require","exports","external/react","modules/core/i18n"],function(e,t,n,i){"use strict";function o(e){return n.createElement("div",{className:"preview-toolbar-overlay-container"},n.createElement("div",{className:"preview-toolbar-overlay"},n.createElement("div",{className:"region-creation-toolbar-content"},n.createElement("div",{className:"region-creation-hint"},i._("Click and drag to comment on areas")),n.createElement("div",{className:"done-button",onMouseUp:e.onRegionCreationDoneClick},i._("Done")))))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarRegionCreation=o}),define("modules/clean/react/previews/preview_video",["require","exports","tslib","external/classnames","external/react","external/react-dom","jquery","modules/core/browser","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_size","modules/clean/loggers/file_preview_logger","modules/clean/previews/actions","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/previews/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/web_timing_logger","modules/core/uri","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/keycode"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var A=(function(t){function m(e){var n=t.call(this,e)||this;return n.lastPlaybackRate=1,n.setRefPreviewVideoPlayer=function(e){n.previewVideoPlayer=e},n.onEmbed=function(){n.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),n.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),n.resolveEmbedCompleted()},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(){n.props.shouldFocusOnReady&&setTimeout(n.setFocus,0),
n.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),E.mark_time_to_view()},n.onPlay=function(){n.markRenderSucceeded(),s(".vjs-poster").hide(),s(".vjs-big-play-button").hide()},n.onEnd=function(){s(".vjs-poster").show(),s(".vjs-big-play-button").show(),s(".vjs-loading-spinner").hide()},n.onWaiting=function(){null!=n.props.filePreviewSession&&n.props.filePreviewSession.recordEvent(f.EventTypes.FILE_PREVIEW_VIDEO_STALLED,{playback_rate:n.player.playbackRate().toString()})},n.onUserInactive=function(){var e=n.player.playbackRate();e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction("playback_rate_changed",{playback_rate:e}))},n.onError=function(e){if(n.rejectEmbedCompleted(e),"needflash"===e)return n.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_SUPPORT_DENIED),void("function"==typeof n.props.onError&&n.props.onError(g.ErrorTypes.NEED_FLASH_ERROR));n.shutdown(),n.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),E.mark_time_to_view(),E.mark_time_to_interactive(),n.props.onError&&n.props.onError(g.ErrorTypes.LOAD_ERROR)},n.handleKeyPress=function(e){return e.keyCode===C.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:b.generateUnmodifiedKeyboardEventCriteria(C.KeyCode.SPACE),callback:n.handleKeyPress}],n.embedCompleted=new Promise(function(e,t){n.resolveEmbedCompleted=e,n.rejectEmbedCompleted=t}),n}return n.__extends(m,t),m.prototype.setUpLogger=function(){this.logger&&this.teardownLogger(),this.logger=new u.FilePreviewUserActionLogger,this.logger.listenTo(_.filePreviewEventEmitter)},m.prototype.teardownLogger=function(){this.logger.unlistenTo(_.filePreviewEventEmitter),delete this.logger},m.prototype.logFilePreviewTimelineEvent=function(e){null!==this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},m.prototype.logUserAction=function(e,t){_.filePreviewEventEmitter.emit(f.EventTypes.FILE_PREVIEW_USER_ACTION,this.props.filePreviewSession,e,f.UserActionContextNames.VIDEO_PLAYER,t)},m.prototype.getSizedImageUrl=function(){return w.parse(this.props.thumbnailUrlTmpl).updateQuery({size:c.imageBestFitSize(s(window).width(),s(window).height()),size_mode:"2"}).toString()},m.prototype.shutdown=function(){if(s(".vjs-big-play-button").blur(),this.player){try{this.player.trigger("shutdown"),this.player.dispose()}catch(e){}delete this.player}},m.prototype.markRenderSucceeded=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),E.mark_time_to_interactive(),this.logFilePreviewTimelineEvent(f.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(p.broadcastRenderSucceeded,0)},m.prototype.setFocus=function(){s(".vjs-poster").show(),s(".vjs-big-play-button").show(),s(".vjs-big-play-button").focus()},m.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},m.prototype.onTruncated=function(){_.filePreviewEventEmitter.emit(f.EventTypes.FILE_PREVIEW_VIDEO_TRUNCATED)},m.prototype.embedVideoLoader=function(){var t=this,n=this.props,i=n.previewUrl,o=n.sourceContext,a=n.videoMetadataUrl,l=n.videoContainer,c=s(r.findDOMNode(this.previewVideoPlayer)),u=d.video_type(l),p=o!==g.PreviewSourceContext.EMBEDDED_SHARED_LINK_FILE;e(["modules/clean/video_loader"],function(e){t.player=e.embed(c,{src:i,type:u,useFlash:u===d.FLV_CONTAINER,controls:!0,playbackRates:t.getPlaybackRates(),preload:"auto",poster:t.getSizedImageUrl(),metadata_link:a,onEmbed:t.onEmbed,onCanPlay:t.onCanPlay,onEnd:t.onEnd,onError:t.onError,onReady:t.onReady,onPlay:t.onPlay,onTruncated:t.onTruncated,onWaiting:t.onWaiting,onUserInactive:t.onUserInactive,showTruncationMessage:p})})},m.prototype.componentDidMount=function(){this.embedVideoLoader(),this.setUpLogger()},m.prototype.componentWillUpdate=function(e){e.previewUrl!==this.props.previewUrl&&this.shutdown()},m.prototype.componentDidUpdate=function(e){e.previewUrl!==this.props.previewUrl&&this.embedVideoLoader()},m.prototype.componentWillUnmount=function(){this.shutdown(),this.teardownLogger()},m.prototype.shouldComponentUpdate=function(e,t){return v.compareStateAndProps(e,t)},m.prototype.renderAnnotationsToolbar=function(){if(this.props.shouldDisplayAnnotationsToolbar&&this.props.count>1)return o.createElement("div",{className:"preview-toolbar-container"},o.createElement(l,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},m.prototype.renderPlayer=function(){return o.createElement("div",{ref:this.setRefPreviewVideoPlayer,className:"video-player"})},m.prototype.togglePlayback=function(){this.player&&(this.player.paused()?this.player.play():this.player.pause())},m.prototype.render=function(){return this.props.isFullscreen?o.createElement(y.PreviewZoomContainer,{isFlippable:!0,renderZoomControls:!1,onClose:h.closeFullscreen,containerClass:"video-player"},o.createElement(P.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),this.renderPlayer()):o.createElement("div",{className:i({"flex-preview-container":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar,"touch-device":a.is_mobile_or_tablet()}),ref:"previewVideoContainer"},o.createElement(P.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),o.createElement("div",{className:"preview-content preview-video"},o.createElement("div",{className:"preview-video__wrapper"},o.createElement("div",{className:"preview-video__aspect-container"},o.createElement("div",{className:"preview-video__container"},this.renderPlayer())))),this.renderAnnotationsToolbar())},m})(o.Component);t.PreviewVideoWithoutCss=A,t.PreviewVideo=m(A,["/static/css/preview_video-vfl8h2Vm-.css","/static/css/video-js-5-custom-vfl4FbZY0.css"])}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","external/react","external/underscore","jquery","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/store","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f="",_="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContextNames.LIGHTBOX_TOOLBAR),l.flipNext(),l.logUserAction(c.UserActionNames.FLIP_NEXT,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContextNames.LIGHTBOX_TOOLBAR),l.flipPrevious(),l.logUserAction(c.UserActionNames.FLIP_PREV,e)},t.onClick=function(e){var n="."+t.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close";a(e.target).is(n)||0!==a(e.target).parents(n).length||(e.preventDefault(),t.onCloseFactory({},c.UserActionContextNames.LIGHTBOX_FRAME))},t.onMouseMove=function(e){0===a(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContextNames.LIGHTBOX_CLOSE_BUTTON),l.logUserAction(c.UserActionNames.TOGGLE_FULLSCREEN_OFF,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=s.throttle(this.flipNext,100),this.flipPrevious=s.throttle(this.flipPrevious,100),i("esc",_,function(){e.onCloseFactory({},c.UserActionContextNames.KEYBOARD)}),null!=this.props.zoomOutCallback&&i("space",_,this.props.zoomOutCallback),this.props.isFlippable&&(i("left",_,function(){e.startControlsTimer(),e.flipPrevious(c.UserActionContextNames.KEYBOARD)}),i("right",_,function(){e.startControlsTimer(),e.flipNext(c.UserActionContextNames.KEYBOARD)})),f=i.getScope(),i.setScope(_),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){i.setScope(_)},t.prototype.componentWillUnmount=function(){i.clearScope(_),i.setScope(f),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.isFlippable?r.createElement(u.FlippableControls,{index:""+(p.FileViewerStore.instance.getCurrentIndex()+1),numFlippableFiles:p.FileViewerStore.instance.getFiles().length,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props.renderZoomControls,t=o({"preview-toolbar-container":!0,hidden:this.state.controlsHidden});return r.createElement("div",{className:t,ref:"previewZoomerToolbarContainer"},r.createElement("div",{className:"preview-toolbar-overlay-container"},r.createElement("div",{className:"preview-toolbar-overlay"},r.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?r.createElement("div",{className:o({"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled}),ref:"zoomControlZoomOut"},r.createElement(d,{alt:h._("Zoom out"),group:"web",name:"zoomout"})):null,e?r.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer"},r.createElement(m,{content:h._("View actual size"),position:m.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.createElement("span",{className:"zoom-label",ref:"zoomLabel"}))):null,e?r.createElement("div",{className:o({"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled}),ref:"zoomControlZoomIn"},r.createElement(d,{alt:h._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=o({"preview-zoomer-close":!0,hidden:this.state.controlsHidden});return r.createElement("span",null,r.createElement("button",{"aria-label":h._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},r.createElement(d,{alt:h._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=o({"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled});return r.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(r.Component);t.PreviewZoomContainer=v}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return o[e]}Object.defineProperty(t,"__esModule",{value:!0});var i;(function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"})(i=t.QualityPopupStage||(t.QualityPopupStage={}));var o=[];o[i.POPUP]="popup",o[i.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}}),define("modules/clean/react/previews/quality_popup/feedback_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react_format","modules/core/i18n","modules/clean/react/modal","modules/clean/react/icon","modules/clean/react/icon/icon_helper"],function(e,t,n,i,o,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isFileSelected:t.props.allowFileDonation,feedback:""},t.onDone=function(){t.props.onDone(t.state.isFileSelected,t.state.feedback),l.Modal.close()},t.onDismiss=function(){t.props.onDismiss(),l.Modal.close()},t.checkboxChange=function(e){t.setState({isFileSelected:e.target.checked})},t}return n.__extends(t,e),t.showInstance=function(e){l.Modal.showInstance(e)},t.prototype.renderFileDonation=function(){if(!this.props.allowFileDonation)return null;var e=o.em_snippet(r.filename(this.props.filename),32);return i.createElement("label",{className:"file_selection"},i.createElement("div",{className:"file_check"},i.createElement("input",{type:"checkbox",checked:this.state.isFileSelected,"aria-checked":this.state.isFileSelected,onClick:this.checkboxChange,id:"file_selection_checkbox"})),i.createElement("div",{className:"file_image"},i.createElement(c.FileIcon,{filename:this.props.filename,size:u.ICON_SIZES.SMALL})),i.createElement("div",{className:"file_desc"},i.createElement("div",{className:"file_desc_container"},i.createElement("div",{className:"main"},s.reactFormat(a._("Include <b>%(filename)s</b>"),{filename:e,b:i.createElement("b",null)})),i.createElement("div",{className:"disclaimer"},a._("The Dropbox team will review your document. It will only be used to help improve previews.")))))},t.prototype.render=function(){var e=this;return i.createElement(l.Modal,{title:a._("Tell us what’s wrong"),acceptButtonText:a._("Send feedback"),dismissButtonText:a._("Cancel"),autoClose:!1,showX:!0,onAccept:this.onDone,onDismiss:this.onDismiss},i.createElement("div",{className:"send_feedback_modal_content"},i.createElement("textarea",{className:"feedback",name:"feedback",id:"feedback",maxLength:255,readOnly:!1,placeholder:a._("My document doesn’t look right because..."),value:this.state.feedback,onChange:function(t){return e.setState({feedback:t.target.value})}}),this.renderFileDonation()))},t})(i.Component);t.PreviewFeedbackModal=p}),define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/loggers/file_preview_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/react/previews/quality_popup/feedback_modal","modules/clean/previews/util","modules/clean/react/sprite","modules/clean/react/file_viewer/file_preview_event_emitter","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.handleDismissPopup=function(){t.recordDismissed(c.QualityPopupStage.POPUP),t.hidePopup()},t.handleAnswerYes=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.YES),t.feedbackReceived()},t.handleAnswerNo=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.NO),u.shouldShowFeedbackModal(t.state.question)?t.showFeedbackModal():t.feedbackReceived()},t.handleModalDone=function(e,n){var i={};i[u.Questions.FEEDBACK]=n||"",i[u.Questions.DONATE]=e?c.BooleanAnswers.YES:c.BooleanAnswers.NO;var o={};e&&(o._file_nsid=t.props.file.ns_id,o._file_sjid=t.props.file.sjid),t.recordMultipleAnswers(i,o),t.feedbackReceived()},t.handleModalDismiss=function(){t.recordDismissed(c.QualityPopupStage.FEEDBACK_MODAL)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.file,t=o.file_extension(o.filename(e.fq_path));this.popupLogger=new r.FilePreviewQualityPopupLogger,this.popupLogger.listenTo(h.filePreviewEventEmitter),this.handlePreviewOpen(t)},t.prototype.componentWillUnmount=function(){this.popupLogger.unlistenTo(h.filePreviewEventEmitter)},t.prototype.recordQuestions=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.FilePreviewSession.currentSession;h.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,n,e)},t.prototype.recordAnswer=function(e,t){var n={};n[e]=t,this.recordMultipleAnswers(n)},t.prototype.recordMultipleAnswers=function(e,t){void 0===t&&(t={});var n=l.FilePreviewSession.currentSession;h.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,n,e,t)},t.prototype.recordDismissed=function(e){var t=l.FilePreviewSession.currentSession;h.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t,e)},t.prototype.showFeedbackModal=function(){var e=i.createElement(p.PreviewFeedbackModal,{filename:o.filename(this.props.file.fq_path),allowFileDonation:this.props.allowFileDonation,onDone:this.handleModalDone,onDismiss:this.handleModalDismiss});this.recordQuestions(u.Questions.FEEDBACK,u.Questions.DONATE),p.PreviewFeedbackModal.showInstance(e)},t.prototype.feedbackReceived=function(){_.success(f._("Thanks! Your feedback will help improve Dropbox."),3),this.hidePopup()},t.prototype.hidePopup=function(){this.setState({question:void 0}),s.closePreviewQualityPopup()},t.prototype.randomNum=function(e,t){return void 0===t&&(t=0),Math.random()*(e-t)+t},t.prototype.handlePreviewOpen=function(e){if(!(this.randomNum(100)>this.props.showProbability)){var t=u.getQuestionToAsk(e);null!==t&&(this.setState({question:t}),this.recordQuestions(t))}},t.prototype.render=function(){return void 0===this.state.question?null:i.createElement("div",{id:"preview-quality-popup",className:"preview-quality-bar fadeout"},i.createElement("div",{className:"container"},i.createElement("div",{className:"title"},u.getQuestionWording(this.state.question,d.get_extension(this.props.file)),i.createElement("div",{className:"resolution"},i.createElement("button",{className:"button-as-link looks-good-link",onClick:this.handleAnswerYes},f._("Yes")),i.createElement("span",{className:""},f._("•")),i.createElement("button",{className:"button-as-link something-wrong-link",onClick:this.handleAnswerNo},f._("No")))),i.createElement("div",{className:"hide_button"},i.createElement("button",{className:"button-as-link dismiss-link",onClick:this.handleDismissPopup},i.createElement(m,{group:"web",name:"x",alt:f._("Close")})))),i.createElement("hr",{className:"separator"}))},t})(i.Component);t.PreviewQualityPopup=v}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,i){"use strict";function o(e,t){var n=h[e];return"ALL_EXTENSIONS"===n||n.indexOf(t)>-1}function r(e){var t=i.PREVIEW_QUALITY_POPUP_QUESTION;if(!m.hasOwnProperty(t))return null;var n=m[t];return o(n,e)?n:null}function s(e){return!!f[e]}function a(e,t){return _[e][t]||_[e].ALL_EXTENSIONS}function l(e){return C[e]}Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.FEEDBACK=2]="FEEDBACK",e[e.DONATE=3]="DONATE"})(c=t.Questions||(t.Questions={}));var u=["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpg","mpeg","mts","oggtheora","ogv","rm","ts","vob","webm","wmv"],p=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"],d=["flac","oga","m4a","mp3","wma","aac","wav"],m={};m.LOOK_GOOD=c.LOOK_GOOD,m.LOAD_QUICKLY=c.LOAD_QUICKLY;var h={};h[c.LOOK_GOOD]="ALL_EXTENSIONS",h[c.LOAD_QUICKLY]="ALL_EXTENSIONS";var f=[];f[c.LOOK_GOOD]=!0;var _=[];_[c.LOOK_GOOD]={};for(var v=0,g=d;v<g.length;v++){var y=g[v];_[c.LOOK_GOOD][y]=n._("Does this audio preview sound okay?")}for(var E=0,w=u;E<w.length;E++){var y=w[E];_[c.LOOK_GOOD][y]=n._("Does this video preview look okay?")}for(var b=0,P=p;b<P.length;b++){var y=P[b];_[c.LOOK_GOOD][y]=n._("Does this image preview look okay?")}_[c.LOOK_GOOD].ALL_EXTENSIONS=n._("Does this file preview look okay?"),_[c.LOAD_QUICKLY]={},_[c.LOAD_QUICKLY].ALL_EXTENSIONS=n._("Did this preview load quickly?");var C=[];C[c.LOOK_GOOD]="look_good",C[c.LOAD_QUICKLY]="load_quickly",C[c.FEEDBACK]="feedback",C[c.DONATE]="donate",t.isQuestionAllowed=o,t.getQuestionToAsk=r,t.shouldShowFeedbackModal=s,t.getQuestionWording=a,t.getQuestionLoggerKey=l}),define("modules/clean/react/previews/responsive_image",["require","exports","tslib","modules/clean/react/previews/image_helpers","external/react","external/classnames","external/underscore"],function(e,t,n,i,o,r,s){"use strict";function a(e){return o.createElement("img",{alt:e.fileName,srcSet:e.srcSet,sizes:e.sizes,src:e.src,className:e.className,style:e.style,onLoad:e.onLoad,onError:e.onError,onClick:e.onClick,onContextMenu:e.onContextMenu,ref:e.refCallback})}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={origResImgHasLoaded:!1},t.onImageLoad=function(e){t.props.onLoad&&t.props.onLoad(e)},t.handleImgLoad=s.once(t.onImageLoad),t.handleOrigImgLoad=function(e){t.setState({origResImgHasLoaded:!0}),t.handleImgLoad(e)},t}return n.__extends(t,e),t.prototype.componentWillUpdate=function(){this.handleImgLoad=s.once(this.onImageLoad)},t.prototype.getMaxResolution=function(){return this.props.shouldLoadLowResImg?this.props.maxResolution:void 0},t.prototype.getOrigResImgStyle=function(){return this.state.origResImgHasLoaded?this.props.style:n.__assign({},this.props.style,{display:"none"})},t.prototype.renderLowResImg=function(e){return o.createElement(a,n.__assign({},this.props,{className:e,onLoad:this.handleImgLoad,sizes:i.IMG_SIZES_ATTR,src:i.getFallbackSrc(this.props.thumbnailUrlTmpl),srcSet:i.getSrcSet(this.props.thumbnailUrlTmpl,this.getMaxResolution())}))},t.prototype.renderOrigResImg=function(e){return o.createElement(a,n.__assign({},this.props,{className:e,onLoad:this.handleOrigImgLoad,sizes:i.IMG_SIZES_ATTR,src:i.getFallbackSrc(this.props.thumbnailUrlTmpl),srcSet:i.getSrcSet(this.props.thumbnailUrlTmpl),style:this.getOrigResImgStyle()}))},t.prototype.render=function(){var e=r(this.props.className,{"disabled-context-menu":!!this.props.onContextMenu});return o.createElement("div",null,this.props.shouldLoadLowResImg&&!this.state.origResImgHasLoaded?this.renderLowResImg(e):void 0,this.renderOrigResImg(e))},t.defaultProps={maxResolution:[1280,960]},t})(o.Component);t.ResponsiveImage=l}),define("modules/clean/react/share_download/actions",["require","exports","external/react","modules/clean/ajax","modules/clean/downloads","modules/clean/multiaccount_login","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/sharing/signup_modal_proxy","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m,h){"use strict";return new((function(){function e(){}return e.prototype.direct=function(e){var t=function(){var t=function(){var t=function(){m.error(d._("Failed to download."))},n=function(t){if(t===e.url){var n=h.parse(e.url).updateQuery({dl:"1"}).toString();o.get({url:n,__do_not_use_expected_domain:"dl.dropboxusercontent.com"})}else o.get({url:t})},r=e.url;i.SilentBackgroundRequest({url:"/sharing/fetch_user_content_link",data:{url:r},success:n,error:t})};if(!e.downloadTestUrl)return void t();var n=function(){m.error(d._("Failed to download zip file."))},r=function(e){"OK"===e?t():0===e.indexOf("err:")?m.error(d._("The zip file is too large.")):n()};i.SilentBackgroundRequest({url:e.downloadTestUrl,success:r,error:n})};return l.signupForDirectDownload().then(t)},e.prototype.toDropbox=function(e,t,i,o){var d,m;if("anonymous"===i)d=l.signup(),m=u.reload;else{var h=o?o.id:-1;p.assert(h!==-1,"role isn't anonymous => user cannot be null or undefined!"),d=new Promise(function(e){c.get_viewer().is_user_signed_in(o)?e(h):r.show_modal({role:i,on_success:function(){e(h)}})})}d.then(function(o){var r=n.createElement(s.CopyToDropboxModal,{shareToken:e,fileOrFolder:t,userId:o,role:i,onDismiss:m});a.Modal.showInstance(r)})},e})())}),define("modules/clean/react/share_download/button",["require","exports","tslib","external/classnames","external/react","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react_format","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/share_download/models","modules/clean/react/share_download/util","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c,u,p,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={isDisabled:!0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({isDisabled:this.props.isDisabled})},t.prototype.render=function(){var e={"c-btn":!0,"download-button":!0,control__button:!0};return e["button-"+this.props.importance]=!0,e["c-btn--"+this.props.importance]=!0,this.props.className&&(e[this.props.className]=!0),o.createElement("button",{id:"download-menu-button",className:i(e),style:{display:"-webkit-box"},disabled:this.state.isDisabled,onClick:this.props.onClick},this.props.children)},t.defaultProps={isDisabled:!1,importance:"secondary"},t})(o.Component),f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=function(t){t.preventDefault(),e.props.onClick&&e.props.onClick(e.props.option),e.props.option.handler(),l.logUserAction(e.props.option.userActionName,u.getSplitButtonUserActionContext(c.SplitButtonActionLocation.MAIN,e.props.location))};return o.createElement(h,{isDisabled:this.props.isDisabled,onClick:t,importance:this.props.importance},this.props.targetText)},t})(o.Component);t.DownloadSimpleButton=f;var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.onClickProxy=function(e,t){return function(i){n.props.onClick&&n.props.onClick(),e.handler&&e.handler(),l.logUserAction(e.userActionName,u.getSplitButtonUserActionContext(t,n.props.location))}},n.state={isDisabled:!0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({isDisabled:this.props.isDisabled})},t.prototype.renderDropdownButton=function(){var e={"c-btn":!0,"download-button":!0,control__button:!0,disabled:this.state.isDisabled};return e["button-"+this.props.importance]=!0,e["c-btn--"+this.props.importance]=!0,o.createElement("button",{className:i(e)},this.props.targetText)},t.prototype.renderMenu=function(e){var t=this,n=this.props.options.map(function(e){return o.createElement(s.BubbleMenuItem,{onClick:t.onClickProxy(e,c.SplitButtonActionLocation.SPLIT),disabled:e.isDisabled},e.text)}),i=this.props.justifyRight?s.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT:s.BubbleMenu.POSITIONS.BOTTOM;return o.createElement(s.BubbleMenu,{targetButton:e,position:i,verticalDisplacement:4,className:"react-file-viewer-dropdown",items:n})},t.prototype.render=function(){return this.props.isDisabled?o.createElement(h,{isDisabled:!0,importance:this.props.importance},this.props.targetText):this.renderMenu(this.renderDropdownButton())},t.defaultProps={justifyRight:!0,importance:"secondary"},t})(o.Component),v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isDownloadAllowed=function(){return this.props.sharePermissions.canDownloadRoles.length>0},t.prototype.getTargetText=function(e){if(this.isDownloadAllowed())return e>1?m._("Download ▾"):m._("Download");if(this.props.user&&this.props.user.is_cdm_member){var t=r.filename(this.props.user.cdm_tmf_path);return t.length>25?m._("Add to my member folder"):a.reactFormat(m._("Add to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:t,strong:o.createElement("strong",{style:{fontWeight:800}})})}return m._("Add to Dropbox")},t.prototype.getTooltipLabel=function(){return this.props.fileOrFolder&&null===this.props.fileOrFolder.ns_id?m._("Download is unavailable while file is uploading."):m._("The owner turned off the option to download.")},t.prototype.render=function(){var e=d.getDownloadOptions(this.props.sharePermissions,this.props.sharedLinkInfo,this.props.shareToken,this.props.fileOrFolder);if(this.props.downloadOnly){var t=new p.ShareDownloadActionOption({isDisabled:!0}),n=!0;return this.isDownloadAllowed()&&(t=p.ShareDownloadActionOption.buildDirectOption(this.props.sharedLinkInfo),n=!1),o.createElement(f,{isDisabled:n,targetText:m._("Download"),option:t,onClick:this.props.onClick,location:this.props.location,importance:this.props.importance})}return 0===e.length?o.createElement(_,{targetText:m._("Download"),isDisabled:!0,options:[new p.ShareDownloadActionOption({isDisabled:!0})],justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,title:this.getTooltipLabel(),importance:this.props.importance}):1===e.length?o.createElement(f,{isDisabled:!1,targetText:this.getTargetText(e.length),option:e[0],onClick:this.props.onClick,location:this.props.location,importance:this.props.importance}):o.createElement(_,{targetText:this.getTargetText(e.length),options:e,justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,isDisabled:!1,importance:this.props.importance})},t})(o.Component);t.ShareDownloadButton=v}),define("modules/clean/react/share_download/models",["require","exports","tslib","external/immutable","external/react","modules/clean/filepath","modules/clean/react/file_viewer/constants","modules/clean/react_format","modules/clean/react/share_download/actions","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u={text:void 0,handler:void 0,spriteName:void 0,isDisabled:void 0,userActionName:void 0},p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.buildDirectOption=function(e){return new t({text:c._("Direct download"),handler:function(){l.direct(e)},spriteName:"download_arrow",userActionName:s.UserActionNames.DOWNLOAD})},t.buildToDropboxOption=function(e,n,i,u,p,d){void 0===d&&(d=!1);var m=c._("Save to my Dropbox"),h="dropbox",f=s.UserActionNames.SAVE_TO_DROPBOX;if(u&&u.is_cdm_member){var _=r.filename(u.cdm_tmf_path);m=_.length>12?c._("Save to my member folder"):a.reactFormat(c._("Save to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:_,strong:o.createElement("strong",null)}),i.is_paired&&(h="s_briefcase",f=s.UserActionNames.SAVE_TO_DROPBOX_WORK)}else if(i.is_paired)switch(p){case"personal":m=c._("Save to personal Dropbox"),h="s_house",f=s.UserActionNames.SAVE_TO_DROPBOX_PERSONAL;break;case"work":m=c._("Save to %(team_name)s Dropbox").format({team_name:i.team_name}),h="s_briefcase",f=s.UserActionNames.SAVE_TO_DROPBOX_WORK}return new t({text:m,handler:function(){l.toDropbox(e,n,p,u)},spriteName:h,isDisabled:d,userActionName:f})},t})(i.Record(u));t.ShareDownloadActionOption=p}),define("modules/clean/react/share_download/util",["require","exports","modules/clean/react/share_download/models","modules/clean/viewer"],function(e,t,n,i){"use strict";function o(e,t,o,r){var s=e.canDownloadRoles,a=e.canCopyToDropboxRoles,l=n.ShareDownloadActionOption.buildDirectOption,c=n.ShareDownloadActionOption.buildToDropboxOption,u=[];if(r&&null===r.ns_id)return u;if(s.length>0&&u.push(l(t)),a.length>0){var p=i.get_viewer(),d=p.get_users(!0),m=function(e,t){var n=a.indexOf(t)===-1;u.push(c(o,r,p,e,t,n))};d.forEach(function(e){m(e,e.role)}),a.indexOf("anonymous")>-1&&m(void 0,"anonymous")}return u}Object.defineProperty(t,"__esModule",{value:!0}),t.getDownloadOptions=o}),define("modules/clean/react/size_class/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"})(t.SizeClass||(t.SizeClass={})),t.MEDIA_SIZE_CLASS_MEDIUM="screen and (min-width: 736px) and (max-width: 1023px)",t.MEDIA_SIZE_CLASS_LARGE="screen and (min-width: 1024px)"}),define("modules/clean/react/size_class/size_class",["require","exports","tslib","external/react","external/classnames","external/hoist-non-react-statics","external/spectrum/match","modules/clean/react/size_class/constants","modules/clean/react/size_class/utils","modules/clean/react/size_class/utils"],function(e,t,n,i,o,r,s,a,l,c){"use strict";function u(e,t){return void 0===t&&(t={}),r((function(r){function u(){var t=null!==r&&r.apply(this,arguments)||this;return t.displayName="WithSizeClass("+c.getDisplayName(e),
t.state={},t.getHandleMatch=function(e,n){return function(){t.setState((i={},i[e]=n,i));var i}},t.onMatchMedium=t.getHandleMatch("matchSizeClassMedium",!0),t.onUnmatchMedium=t.getHandleMatch("matchSizeClassMedium",!1),t.onMatchLarge=t.getHandleMatch("matchSizeClassLarge",!0),t.onUnmatchLarge=t.getHandleMatch("matchSizeClassLarge",!1),t}return n.__extends(u,r),u.prototype.render=function(){var r=t.isResponsiveEnabled,c=t.responsiveClassName,u=void 0===c?"":c;return i.createElement("div",{className:o((p={},p[u]=!r||r(),p))},i.createElement(s.Match,{media:a.MEDIA_SIZE_CLASS_MEDIUM,onMatch:this.onMatchMedium,onUnmatch:this.onUnmatchMedium}),i.createElement(s.Match,{media:a.MEDIA_SIZE_CLASS_LARGE,onMatch:this.onMatchLarge,onUnmatch:this.onUnmatchLarge}),i.createElement(e,n.__assign({},this.props,{sizeClass:l.getSizeClass(this.state.matchSizeClassMedium,this.state.matchSizeClassLarge,r)})));var p},u})(i.Component),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.withSizeClass=u}),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],function(e,t,n){"use strict";function i(e,t,i){return i&&!i()?n.SizeClass.Large:t?n.SizeClass.Large:e?n.SizeClass.Medium:n.SizeClass.Small}function o(e){return e.displayName||e.name||"Component"}Object.defineProperty(t,"__esModule",{value:!0}),t.getSizeClass=i,t.getDisplayName=o}),function(){define("modules/clean/react/slider",["external/classnames","external/react","modules/clean/css"],function(e,t,n){var i,o,r,s,a,l;return l=n.require_css,a=t.DOM,i=t.createClass({displayName:"IndicatorGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,currentSlideIndex:t.PropTypes.number.isRequired,slideCount:t.PropTypes.number.isRequired,onIndicatorClick:t.PropTypes.func},render:function(){var t;return a.ul({className:e("c-slider__indicator-group",this.props.className)},function(){t=[];for(var e=0,n=this.props.slideCount;0<=n?e<n:e>n;0<=n?e++:e--)t.push(e);return t}.apply(this).map((function(t){return function(n){return a.li({key:"indicator-"+n,className:e({"c-slider__indicator":!0,"is-active":n===t.props.currentSlideIndex}),onClick:function(){var e;return"function"==typeof(e=t.props).onIndicatorClick?e.onIndicatorClick(n):void 0}})}})(this)))}}),o=t.createClass({displayName:"NavButtonGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},render:function(){return a.div({className:e("c-slider__nav-button-group",this.props.className)},this.props.children)}}),s=t.createClass({displayName:"Slides",mixins:[t.addons.PureRenderMixin],propTypes:{currentSlideIndex:t.PropTypes.number.isRequired,width:t.PropTypes.number.isRequired,height:t.PropTypes.number},getSlideCount:function(){return t.Children.count(this.props.children)},render:function(){var n;return a.div({className:"c-slider__window",style:{width:this.props.width+"px",height:null!=(n=this.props.height)?n:"auto"}},a.div({className:"c-slider__slides"},t.Children.map(this.props.children,(function(t){return function(n,i){return a.div({className:e({"c-slider__slide":"c-slider__slide","is-active":t.props.currentSlideIndex===i}),style:{width:t.props.width+"px",transform:"translateX("+100*-t.props.currentSlideIndex+"%)"}},n)}})(this))))}}),r=t.createClass({displayName:"Slider",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},componentWillMount:function(){return l("/static/css/legacy_packages/components-vflfWNhxV.css")},render:function(){return a.div({className:e("c-slider",this.props.className)},this.props.children)}}),{NavButtonGroup:o,Slider:r,IndicatorGroup:i,Slides:s}})}.call(this),define("modules/clean/redux/devtools",["require","exports","external/redux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeEnhancersWithDevTools=n.compose}),define("modules/clean/redux/store",["require","exports","tslib","external/redux","external/redux-thunk","modules/clean/redux/devtools"],function(e,t,n,i,o,r){"use strict";function s(e){p=e;var t=i.combineReducers(e);return i.createStore(t,r.composeEnhancersWithDevTools(i.applyMiddleware(o)))}function a(e){for(var t=[],n={},i=0,o=Object.keys(e);i<o.length;i++){var r=o[i],s=p[r],a=e[r];null!=s?s!==a&&t.push(r):n[r]=a}if(t.length)throw new Error("Attempted to register new reducer for allocated keys "+JSON.stringify(t));return n}function l(e){var t=a(e);p=n.__assign({},p,t),u.replaceReducer(i.combineReducers(p))}function c(e){return null!=u?(l(e),u):u=s(e)}Object.defineProperty(t,"__esModule",{value:!0});var u,p={};t.getStoreAndRegisterReducers=c}),define("modules/clean/revisions/file_revisions_iterator",["require","exports","modules/clean/ajax","modules/clean/react/browse/models"],function(e,t,n,i){"use strict";function o(e){return new r({file:i.File.fromServerObject(e.preview_info),author:e.author,action_description:e.action_description,device_name:e.device_name,is_primary_revision:e.is_primary_revision,when_mses:e.ts})}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e){var t=e.file,n=e.action_description,i=e.is_primary_revision,o=e.author,r=e.device_name,s=e.when_mses;this.file=t,this.action_description=n,this.is_primary_revision=i,this.author=o,this.device_name=r,this.when_mses=s}return e})(),s=(function(){function e(e,t,n){void 0===n&&(n={}),this.fqPath=e,this.userId=t,this.cursor=n.initialCursor||null,this.deserializer=n.deserializer||o}return e.prototype.next=function(e){var t=this;void 0===e&&(e=50);var i={path:this.fqPath,limit:e,cursor:this.cursor};return new Promise(function(e,o){n.WebRequest({url:"/file_revisions",type:"GET",subject_user:t.userId,data:i,success:function(n){var i=JSON.parse(n);t.cursor=i.cursor,e({revisions:i.revisions.map(function(e){return t.deserializer(e)}),hasMore:i.more})},error:function(e){o({errorText:e.error_text})}})})},e})();t.FileRevisionsIterator=s}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/signup_modal_proxy",[],function(){return new((function(){function t(){this.signup=e(this.signup,this),this._defaultModalSignupPromiseResolver=e(this._defaultModalSignupPromiseResolver,this),this.signupForDirectDownload=e(this.signupForDirectDownload,this),this._directDownloadSignupPromiseResolver=e(this._directDownloadSignupPromiseResolver,this),this.disconnectModal=e(this.disconnectModal,this),this.connectModal=e(this.connectModal,this),this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null}return t.prototype.connectModal=function(e){return this._signupModal=e},t.prototype.disconnectModal=function(){return this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null},t.prototype._directDownloadSignupPromiseResolver=function(e,t){var n,i;return i=(function(t){return function(){return t._directDownloadPromise=null,e()}})(this),n=(function(e){return function(){return e._directDownloadPromise=null,t()}})(this),this._signupModal.handle_direct_download(i),this._signupModal.handle_direct_download_cancel(n)},t.prototype.signupForDirectDownload=function(){var e;return null==this._signupModal?Promise.resolve():(null==this._directDownloadPromise&&(this._directDownloadPromise=new Promise(this._directDownloadSignupPromiseResolver)),e=this._directDownloadPromise,this._signupModal.on_request_direct_download(),e)},t.prototype._defaultModalSignupPromiseResolver=function(e,t){var n,i;return n=function(t){return e(t)},i=(function(e){return function(){return e._defaultModalPromise=null,t()}})(this),this._signupModal.handle_default_modal_authenticate(n),this._signupModal.handle_default_modal_cancel(i),this._signupModal.on_request_default_signup()},t.prototype.signup=function(){return null==this._signupModal?Promise.reject():(null==this._defaultModalPromise&&(this._defaultModalPromise=new Promise(this._defaultModalSignupPromiseResolver)),this._defaultModalPromise)},t})())})}.call(this),function(){define("modules/clean/sharing/views/hover_close_button",["external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o){var r,s,a;return r=o.i18n_default_project("sharing")._,s=t.createElement,a=t.DOM,t.createClass({displayName:"HoverCloseButton",propTypes:{className:t.PropTypes.string},getInitialState:function(){return{hover:!1}},render:function(){var t;return t={className:e("c-borderless-button",this.props.className),onMouseOver:(function(e){return function(){return e.setState({hover:!0})}})(this),onMouseOut:(function(e){return function(){return e.setState({hover:!1})}})(this)},a.button(n.extend(t,n.omit(this.props,Object.keys(t))),s(i,{group:"web",name:this.state.hover?"xclose":"xclose_light_gray",alt:r("Close Modal")}))}})})}.call(this),function(){define("modules/clean/teams/team_assume_user_personal_locked_modal",["external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n){var i,o,r,s,a;return r=t._,o=n.Modal,a=e.DOM,s=e.createElement,i=e.createClass({displayName:"AssumePersonalLockedModal",statics:{show:function(e){return o.showInstance(s(i,e))}},propTypes:{displayName:e.PropTypes.string,teamName:e.PropTypes.string},_close:function(e){return e.preventDefault(),o.close()},_getModalProps:function(){return{title:r("Personal account not accessible"),acceptButtonText:r("Close"),dismissButtonText:null,onAccept:this._close}},render:function(){return s(o,this._getModalProps(),a.div({className:"team-assume-user-modal"},r("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))}}),{AssumePersonalLockedModal:i}})}.call(this),function(){define("modules/clean/uuid",["modules/clean/crypto"],function(e){var t,n,i,o,r,s,a,l,c;return n=/generator isn't seeded/,o={},t=(function(){var e,t;for(t=[],a=e=0;e<=255;a=++e)t.push((a+256).toString(16).substr(1));return t})(),i=function(e){var n,i;return i=(function(){var i,o,r;for(r=[],i=0,o=e.length;i<o;i++)n=e[i],r.push(t[n]);return r})(),i.join("")},l=function(e){return 255&e},c=function(e){var t,n;return t=[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)],n=(function(){var n,o,r;for(r=[],n=0,o=t.length;n<o;n++)e=t[n],r.push(i(e));return r})(),n.join("-")},s=function(t){var i,o,s;null==t&&(t={}),s=new Array(16);try{e.getRandomValues(s)}catch(e){if(i=e,!i.message.match(n)||!t.allowInsecure)throw i;r(s)}return(function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)o=s[e],n.push(l(o));return n})()},r=function(e){var t,n,i;for(i=Math.pow(2,8),a=t=0,n=e.length;0<=n?t<n:t>n;a=0<=n?++t:--t)e[a]=Math.floor(Math.random()*i);return e},o.v4=function(e){var t;return null==e&&(e={}),t=s({allowInsecure:e.allowInsecure}),t[6]=15&t[6]|64,t[8]=63&t[8]|128,c(t)},o})}.call(this),define("modules/core/cancelable_promise",["require","exports"],function(e,t){"use strict";function n(e){var t=!1,n=new Promise(function(n,i){e.then(function(e){return t?i({isCanceled:!0}):n(e)},function(e){return i(t?{isCanceled:!0}:e)})});return n.cancel=function(){t=!0},n}Object.defineProperty(t,"__esModule",{value:!0}),t.makeCancelable=n}),function(){"use strict";define("modules/core/type",["external/underscore"],function(e){var t,n,i,o,r,s,a;return o={},o.Type=t=(function(){function t(t,n){if(!e.isString(t)&&!e.isFunction(t))throw new TypeError("First parameter needs to be a string identifying the type");if(!e.isFunction(n))throw new TypeError("Second parameter needs to be a predicate defining the type");e.isFunction(t)?this.getTypeString=t:this.getTypeString=function(){return t},this.predicate=n}return t})(),i=function(n){var o,r;if(a(n))return!0;if(n instanceof t)return!0;if(e.isFunction(n))return!0;if(e.isArray(n)){if(1!==n.length)return!1;if(!i(n[0]))return!1}else{if(!(e.isObject(n)&&null==n.prototype&&n.constructor===Object&&e.keys(n).length>0))return!1;for(o in n)if(r=n[o],!i(r))return!1}return!0},n=(function(){var n,o,r,s,a,l,c;return c=new t("undefined",e.isUndefined),o=new t("null",e.isNull),n=new t("Boolean",e.isBoolean),r=new t("Number",e.isNumber),a=new t("String",e.isString),s=new t("Object",function(t){return e.isObject(t)&&!e.isFunction(t)&&!e.isArray(t)}),l=new t("Type",i),function(e){return void 0===e?c:null===e?o:e===Boolean?n:e===Number?r:e===String?a:e===Object?s:e===t?l:void 0}})(),o.isBasicType=a=function(e){return null!=n(e)},o.firstFailingKeypath=r=function(i,o,s){var l,c,u,p,d,m,h,f,_,v,g,y,E;if(null==s&&(s=[]),a(i)){if(!n(i).predicate(o))return s}else if(i instanceof t){if(!i.predicate(o))return s}else if(e.isFunction(i)){if(!(o instanceof i))return s}else if(e.isArray(i)){if(r(Array,o,s))return s;for(c=u=0,m=o.length;u<m;c=++u){if(l=o[c],s.push(c),r(i[0],l,s))return s;s.pop()}}else{if(r(Object,o,s))return s;for(y=e.keys(i),E=e.keys(o),v=e.difference(y,E),d=0,h=v.length;d<h;d++)if(p=v[d],r(i[p],void 0,s))return s;for(g=e.intersection(E,y),_=0,f=g.length;_<f;_++){if(p=g[_],s.push(p),r(i[p],o[p],s))return s;s.pop()}}},o.checkType=function(e,t){return null==r(e,t)},o.getTypeString=s=function(i){var o,r,l;if(a(i))return n(i).getTypeString();if(i instanceof t)return i.getTypeString();if(e.isFunction(i))return i.name;if(e.isArray(i))return"["+s(i[0])+"]";r=[];for(o in i)l=i[o],r.push(o+": "+s(l));return"{"+r.join(", ")+"}"},o})}.call(this),function(){"use strict";var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},i=[].slice;define("modules/core/types",["external/underscore","modules/constants/page_load","modules/core/type"],function(t,o,r){var s,a,l,c,u,p,d,m,h,f,_,v,g,y,E,w,b,P,C;return f=r.Type,_=r.checkType,E=r.getTypeString,y=r.firstFailingKeypath,w=r.isBasicType,d=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),h=(function(t){function n(e){n.__super__.constructor.call(this,E.bind(null,e),_.bind(null,e))}return e(n,t),n})(f),c=(function(i){function o(e,n){null!=o.names?o.names.set(this,e):this.__name,null!=n&&t.extend(this,n)}e(o,i);try{o.names=new WeakMap}catch(e){o.names=null}return o.prototype.getTypeString=function(){return null!=o.names?o.names.get(this):this.__name},o.prototype.predicate=function(e){return n.call(t.values(this),e)>=0},o})(f),a=(function(t){function n(e){this.valType=e}return e(n,t),n.prototype.getTypeString=function(){return"Dict[string -> "+E(this.valType)+"]"},n.prototype.predicate=function(e){var t,n;return function(){var i;i=[];for(t in e)n=e[t],i.push(_(this.valType,n));return i}.call(this).every(function(e){return e})},n})(f),v=function(e,n){var o,r,s,a,l,c,u,p;if(w(e));else if(e instanceof f)null!=e.parameter_types&&t.isFunction(n)&&!n.isTypeChecked&&(n=C.apply(null,i.call(e.parameter_types).concat([n])));else if(t.isFunction(e));else if(t.isArray(e))for(s=a=0,c=n.length;a<c;s=++a)o=n[s],r=v(e[0],o),r!==o&&(n=n.slice(),n[s]=r);else for(l in e)u=e[l],p=v(u,n[l]),p!==n[l]&&(n=t.clone(n),n[l]=p);return n},b=function(e,n,i,o){var r,s,a,l;for(r=0,l=n.length;r<l;r++)s=n[r],o=o[s],i=t.isArray(i)?i[0]:i[s];return n.length>0&&(a=", key "+n.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(o,null,"  ")+" doesn't match type "+E(i)},C=function(){var e,n,o,r;return r=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],o=function(){var n,o,s,a,l,c,u,p,d,m,f,_;for(o=1<=arguments.length?i.call(arguments,0):[],n=r,p=t.find(r,function(e){return e instanceof h}),null!=p&&(d=t.indexOf(n,p),m=Math.max(o.length-n.length+1,0),f=[d,1],t.times(m,function(){return f.push(p)}),n=n.slice(),n.splice.apply(n,f)),a=l=0,c=n.length;l<c;a=++l){if(_=n[a],s=y(_,o[a]),null!=s)throw u=b(a,s,_,o[a]),new TypeError(u);o[a]=v(_,o[a])}return e.apply(this,o)},o.isTypeChecked=!0,o},P=function(e,t){var n;return n=function(){var n,o,r,s;if(n=1<=arguments.length?i.call(arguments,0):[],s=t.apply(this,n),o=y(e,s),null!=o)throw r=b(0,o,e,s),new TypeError(r);return s},t.isTypeChecked&&(n.isTypeChecked=!0),n},l=function(e,t){var n,i;return n=function(){return"("+E(e)+"|"+E(t)+")"},i=function(n){return _(e,n)||_(t,n)},new f(n,i)},p=function(e){var t,n,i;return e instanceof f&&e.isOptional||e instanceof h?e:(t=function(){return"?"+E(e)},n=function(t){return null==t||_(e,t)},i=new f(t,n),e instanceof f&&null!=e.parameter_types&&(i.parameter_types=e.parameter_types),i.isOptional=!0,i)},u=function(){var e,n,o,r;return r=1<=arguments.length?i.call(arguments,0):[],e=function(){return"function("+r.map(E).join(", ")+")"},n=t.isFunction,o=new f(e,n),o.parameter_types=r,o},m=function(e){return new h(e)},s=function(e){return new a(e)},g={},g.takes=P(Function,C(m(f),Function,C)),g.returns=P(Function,C(f,Function,P)),g.Type=f,g.Enum=c,g.Dict=P(f,C(f,s)),g.Either=P(f,C(f,f,l)),g.Maybe=P(f,C(f,p)),g.Splat=P(f,C(f,m)),g.Any=new f("Any",function(e){return!0}),g.Func=P(f,C(m(f),u)),g.inject=P(Object,C(Object,function(e){return t.extend(e,t.omit(g,"inject"))})),d||(g.takes=function(){var e;return 2<=arguments.length?i.call(arguments,0,e=arguments.length-1):(e=0,[]),arguments[e++]},g.returns=function(){var e;return 2<=arguments.length?i.call(arguments,0,e=arguments.length-1):(e=0,[]),arguments[e++]}),g})}.call(this);
//# sourceMappingURL=pkg-file_viewer.min.js-vflBozX9B.map