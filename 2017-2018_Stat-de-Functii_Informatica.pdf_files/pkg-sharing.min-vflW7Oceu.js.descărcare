define("external/spectrum/icon_status",["external/tslib","external/spectrum/classnames","external/react"],function(e,t,n){return(function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)})({0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=n(4),o=n(55),i=n(56);t.ICONS=i.ICONS,t.IconStatus=function(e){var t=e.name,n=i.ICONS[t],a=n.attrs,l=n.innerHtml,c=r.createElement("svg",s.__assign({},a,{dangerouslySetInnerHTML:{__html:l}}));return r.createElement(o.Component,s.__assign({icon:c},e))},t.IconStatus.displayName="IconStatus"},2:function(t,n){t.exports=e},3:function(e,n){e.exports=t},4:function(e,t){e.exports=n},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=n(3),o=n(4);t.Component=function(e){var t=(e.name,e.icon),n=e.className,i=e.rotating,a=s.__rest(e,["name","icon","className","rotating"]),l=r("mc-icon-template-status",{"mc-icon-template-status-rotating":i},n);return o.cloneElement(t,s.__assign({className:l},a))},t.Component.displayName="IconTemplateStatus"},56:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS={"complete-small":{attrs:{width:"16",height:"16",viewBox:"0 0 16 16"},innerHtml:'<title>status-complete-small</title><g fill="none" fill-rule="evenodd"><g><circle fill="#FFF" cx="8" cy="8" r="8"></circle><path d="M6.996 9.17L5.48 7.653l-.91.909 1.97 1.97.455.454 4.849-4.848-.91-.91-3.94 3.94zM8 14A6 6 0 1 1 8 2a6 6 0 0 1 0 12z" fill="#3DCC5E"></path></g></g>'},complete:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<title>status-complete</title><g fill="none" fill-rule="evenodd"><g transform="translate(3 3)"><circle fill="#FFF" cx="9" cy="9" r="9"></circle><path d="M7.828 10.364L6.061 8.596 5 9.656l2.298 2.299.53.53 5.657-5.657-1.06-1.06-4.597 4.596zM9 16A7 7 0 1 1 9 2a7 7 0 0 1 0 14z" fill="#3DCC5E"></path></g></g>'},fail:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<title>status-fail</title><g fill="none" fill-rule="evenodd"><g transform="translate(3 3)"><circle fill="#FFF" cx="9" cy="9" r="9"></circle><path d="M10.06 9l2.298-2.298-1.061-1.06-2.298 2.297L6.7 5.641 5.64 6.701 7.938 9 5.64 11.298l1.06 1.06L9 10.062l2.298 2.298 1.06-1.06L10.06 9zM9 16A7 7 0 1 1 9 2a7 7 0 0 1 0 14z" fill="#DB2E16"></path></g></g>'},sync:{attrs:{width:"32",height:"32",viewBox:"0 0 32 32"},innerHtml:'<title>icon-sync</title><g fill="none" fill-rule="evenodd"><circle fill="#0070E0" cx="16" cy="16" r="8"></circle><path d="M16 21v1.5l-2.5-2 2.5-2V20a4 4 0 0 0 2.898-6.758l.57-.844A5 5 0 0 1 16 21zm0-10V9.5l2.5 2-2.5 2V12a4 4 0 0 0-3.089 6.541l-.578.858A5 5 0 0 1 16 11z" fill="#F8FAFB"></path></g>'},warn:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},innerHtml:'<title>status-warn</title><g fill="none" fill-rule="evenodd"><path d="M6 20.938h11.358a4 4 0 0 0 3.473-5.984l-5.679-9.938a4 4 0 0 0-6.946 0l-5.678 9.938A4 4 0 0 0 6 20.938z" fill="#FFF"></path><path d="M16.503 19.15c2.206 0 3.135-1.568 2.067-3.515l-5.03-9.168c-1.064-1.94-2.802-1.961-3.889-.03l-5.195 9.228c-1.083 1.925-.17 3.485 2.034 3.485h10.013z" fill="#FFC726"></path><path d="M10.5 17.006V15h2v2.006h-2zm0-3.006V9h2v5h-2z" fill="#FFF"></path></g>'}}}})}),define("external/spectrum/snackbar",["external/tslib","external/spectrum/classnames","external/react","external/spectrum/button","external/spectrum/icon_status"],function(e,t,n,s,r){return(function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)})({0:function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(174))},2:function(t,n){t.exports=e},3:function(e,n){e.exports=t},4:function(e,t){e.exports=n},23:function(e,t){e.exports=s},174:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=n(3),o=n(4),i=n(23),a=n(175);t.SnackbarAction=function(e){var t=e.className,n=s.__rest(e,["className"]);return t=r("mc-snackbar-actions",t),o.createElement(i.Button,s.__assign({variant:"styleless",className:t},n))},t.SnackbarAction.displayName="SnackbarAction",t.Snackbar=function(e){var t,n,s=e.children,i=e.disablePositioningAndBackdrop,l=void 0!==i&&i,c=e.progress,u=void 0===c?0:c,d=e.title,p=e.variant,h=void 0===p?"generic":p;"sync"===h&&(n=!0,t=o.createElement("div",{className:"mc-progress-bar-bg"},o.createElement("div",{className:"mc-progress-bar-fg",style:{width:u+"%"}})));var m,_;"generic"!==h&&(m=!0,_=o.createElement("div",{className:"mc-snackbar-icon"},o.createElement(a.IconStatus,{name:h,rotating:n})));var f=r("mc-snackbar-container",{"mc-snackbar-container--snackbar-icon":m}),g=o.createElement("div",{className:"mc-snackbar"},o.createElement("div",{className:f},_,o.createElement("p",{className:"mc-snackbar-title"},d),s),t);return l?g:o.createElement("div",{className:"mc-snackbar-holder-backdrop"},g)},t.Snackbar.displayName="Snackbar"},175:function(e,t){e.exports=r}})}),define("modules/clean/api_v2/root_aware_client",["require","exports","tslib","external/underscore","modules/clean/api_v2/client","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.rpc=function(t,n,r,i){var a={},l=o.get_viewer().get_user_by_id(t);return l&&l.root_ns_id&&(a["X-Dropbox-Path-Root"]=String(l.root_ns_id)),s.extend(a,i),e.prototype.rpc.call(this,t,n,r,a)},t})(r.ApiV2Client);t.ApiV2RootAwareClient=l;var c=(function(){function e(){this.client=new l}return e.prototype.rpc=function(e,t,n,s,r){return void 0===s&&(s=!1),this.client.rpc(e,t,n,r).catch(function(e){return s&&a.error(e.message||i._("There was a problem completing this request.")),Promise.reject(e)})},e})();t.UserActionsRootAwareClient=c}),define("modules/clean/api_v2/types",["require","exports","tslib","modules/clean/datetime"],function(e,t,n,s){"use strict";function r(e){return s.format_date_utc(e,"yyyy-MM-ddTHH:mm:ssZ")}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t,n){this.type=e,this.value=t,this.isScalar=n}return e.parse=function(e){var t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new i(t,e[t]):new a(t,e)},e})();t.Union=o;var i=(function(e){function t(t,n){return void 0===n&&(n=null),e.call(this,t,n,!0)||this}return n.__extends(t,e),t.prototype.toJSON=function(){var e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e},t})(o);t.UnionScalar=i;var a=(function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n,!1)||this}return n.__extends(t,e),t.prototype.toJSON=function(){return n.__assign({".tag":this.type},this.value)},t})(o);t.UnionStruct=a;t.formatTimestamp=r}),function(){define("modules/clean/avatar/contact_avatar",["external/react","modules/core/i18n","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t,n,s,r,o,i,a){var l,c,u,d,p;return d=t._,l=o.AVATAR_DIMENSION_BY_SIZE,u=o.VALID_AVATAR_DIMENSIONS,c=i.Contact,p=e.createElement,e.createClass({displayName:"ContactAvatar",propTypes:{dimension:e.PropTypes.oneOf(u).isRequired,contact:e.PropTypes.instanceOf(c).isRequired,optionalClass:e.PropTypes.string},render:function(){var e,t,o,i,c,u,h;return o=this.props.contact,c=o.name||o.email,u=o.photo_url,o.type===a.FB&&(u="https://graph.facebook.com/"+o.fb_id+"/picture"),i="",this.props.dimension!==l.XSMALL&&(i=n.getInitials(c)),o.type===a.NEW_STYLE_GROUP?(e=d("Group"),h="SQUARE"):(e=d("User"),h="CIRCLE"),t={alt:e,dimension:this.props.dimension,photoUrl:u,shape:h,optionalClass:this.props.optionalClass,defaultAvatar:p(r,{alt:e,dimension:this.props.dimension,name:c,initials:i,shape:h,optionalClass:this.props.optionalClass})},p(s,t)}})})}.call(this),function(){define("modules/clean/avatar/list",["external/classnames","external/react","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css"],function(e,t,n,s,r){var o,i,a,l;return i=s.VALID_AVATAR_DIMENSIONS,a=t.createElement,l=t.DOM,o=t.createClass({displayName:"HorizontalAvatarList",propTypes:{avatars:t.PropTypes.array.isRequired,avatarDimension:t.PropTypes.oneOf(i).isRequired,maxVisible:t.PropTypes.number.isRequired,undisplayableCount:t.PropTypes.number.isRequired,onOverflowCountClick:t.PropTypes.func,overflowCountRenderer:t.PropTypes.func,animation:t.PropTypes.bool,className:t.PropTypes.string},getDefaultProps:function(){return{className:""}},_defaultRenderOverflowCount:function(e){return a(n,{count:e,dimension:this.props.avatarDimension,key:"overflow_pill:"+e,onClick:this.props.onOverflowCountClick})},render:function(){var t,n,s,r,o;return t=this.props.avatars,n=this.props.maxVisible,s=0,this.props.undisplayableCount&&(s+=this.props.undisplayableCount),(this.props.undisplayableCount||t.length>n)&&(n--,s+=t.length-n,t=t.slice(0,n)),s&&(o=null!=(r=this.props.overflowCountRenderer)?r:this._defaultRenderOverflowCount,t.push(o(s))),l.div({className:e({"c-facepile":!0})},[l.div({className:this.getClassName(),key:"facepile"},t)])},getClassName:function(){return e(["horizontal-avatar-list",this.props.className,this.props.animation?["animation","is-animated"]:null])}}),o=r(o,["/static/css/avatar_list-vflqHc0nR.css"])})}.call(this),function(){define("modules/clean/avatar/overflow_count_pill",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/core/i18n"],function(e,t,n,s,r){var o,i,a,l;return o=t.VALID_AVATAR_DIMENSIONS,a=n.getClassName,l=r.ungettext,i=e.DOM,e.createClass({displayName:"OverflowCountPill",propTypes:{dimension:e.PropTypes.oneOf(o).isRequired,count:e.PropTypes.number.isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return s.require_css("/static/css/scooter/scooter-scoped-vflhQ6850.css")},render:function(){var e,t;return t=" +"+this.props.count+" ",e=l("%(count)s more member","%(count)s more members",this.props.count).format({count:this.props.count}),null!=this.props.onClick?i.button({className:a(this.props.dimension,["overflow-pill c-avatar--meta u-unbutton"]),onClick:this.props.onClick},i.span({"aria-hidden":!0},t),i.span({className:"ax-visually-hidden"},e)):i.div({className:a(this.props.dimension,["overflow-pill c-avatar--meta"])},i.span({"aria-hidden":!0},t),i.span({className:"ax-visually-hidden"},e))}})})}.call(this),function(){define("modules/clean/avatar/shared_link_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,s,r,o){var i,a,l,c,u;return i=t.VALID_AVATAR_DIMENSIONS,c=n.getClassName,u=r.static_url,a=o._,l=e.DOM,e.createClass({displayName:"SharedLinkAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(i).isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},componentDidMount:function(){return s.require_css("/static/css/scooter/scooter-scoped-vflhQ6850.css")},render:function(){var e,t,n;return n=l.img({src:u("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||a("Shared link"),width:12,className:"u-mar-horizontal-xs"}),e=["c-avatar--meta"],null!=this.props.optionalClass&&e.push(this.props.optionalClass),null!=this.props.onClick&&e.push("u-unbutton"),t=c(this.props.dimension,e),null!=this.props.onClick?l.button({className:t,onClick:this.props.onClick},n):l.div({className:t,onClick:this.props.onClick},n)}})})}.call(this),function(){define("modules/clean/avatar/triple_avatars",["external/react","modules/clean/ajax","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,s,r,o,i,a,l){var c,u,d,p,h;return c=o.AVATAR_DIMENSION_BY_SIZE,p=e.createElement,h=e.DOM,d=e.createClass({displayName:"TripleAvatars",getPropTypes:function(){return{contacts:e.PropTypes.arrayOf(e.PropTypes.shape({email:e.PropTypes.string,display_name:e.PropTypes.string,photo_url:e.PropTypes.string})),count:e.PropTypes.integer}},getAvatar:function(e){return p(n,{dimension:c.XLARGE,photoUrl:e.photo_url,defaultAvatar:p(s,{dimension:c.XLARGE,shape:"CIRCLE",initials:l.getInitials(e.display_name),name:e.display_name})})},render:function(){var e;return this.props.contacts&&0!==this.props.contacts.length?(e=this.props.contacts.length,this.props.count&&this.props.count>this.props.contacts.length&&(e=this.props.count),h.div({className:"triple-avatars-section"},this.getAvatar(this.props.contacts[0]),this.props.contacts.length>1?this.getAvatar(this.props.contacts[1]):void 0,3===e?this.getAvatar(this.props.contacts[2]):e>3?p(r,{dimension:c.XLARGE,count:e-2}):void 0)):h.div({})}}),u=i(d,["/static/css/scooter/scooter-scoped-vflhQ6850.css"]),{TripleAvatars:u}})}.call(this),function(){var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/beacon",["external/underscore","jquery","modules/clean/beacon_nodeps","modules/clean/bolt_nodeps","modules/core/exception"],function(t,n,s,r,o){var i,a;return a=(function(s){function r(e,s,i){this._token=e,this._authn_cb=s,this._authz_cb=i,r.__super__.constructor.call(this,this._token,this._authn_cb,this._authz_cb,"beacon.dropbox.com",n.ajax,t,o)}return e(r,s),r})(s.Transmitter),i=(function(s){function i(e,s,a){i.__super__.constructor.call(this,e,s,a,r,"thunder.dropbox.com",n.ajax,t,o)}return e(i,s),i})(s.Receiver),{Agent:s.Agent,AgentStatus:s.AgentStatus,Platforms:s.Platforms,PresenceParams:s.PresenceParams,PresenceType:s.PresenceType,Receiver:i,Source:s.Source,Transmitter:a,UserAppPresence:s.UserAppPresence,UserContextPresence:s.UserContextPresence}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/beacon_nodeps",[],function(){var t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I;return r=5e3,o=12e4,c=6e4,u="invalid_agent",t="authorization_error",d=32,f=256,p=64,_=32,h=128,m=32,i="-",a="|",g={WEB:0,IOS:1,ANDROID:2,DESKTOP:3},E=(function(){function e(e,t,n){var s,r,o,i;this.platform=e,this.surface=t,this.identifier=null!=n?n:null,r=!1;for(s in g)if(i=g[s],this.platform===i){r=!0;break}if(!r)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>_||0===this.surface.length)throw new Error("surface must be populated and <= "+_+" chars.");if((null!=(o=this.identifier)?o.length:void 0)>h)throw new Error("identifier must be <= "+h+" chars.");null===this.identifier&&(this.identifier="")}return e.from_json=function(t){return new e(t.platform,t.surface,t.identifier)},e})(),n=(function(){function e(e,t,n,s){if(this.user_id=e,this.app=t,this.context=n,this.source=s,this.user_id.length>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>d||0===this.app.length)throw new Error("app must be populated and <= "+d+" chars.");if(this.context.length>p||0===this.context.length)throw new Error("context must be populated and <= "+p+" chars.")}return e.from_json=function(t){var n;return n=E.from_json(t.source),new e(t.user_id,t.app,t.context,n)},e})(),s=(function(){function e(e,t,n){if(this.agent=e,this.status=t,this.auth_key=null!=n?n:null,this.status.length>m)throw new Error("status must be <= "+m+" chars")}return e.from_json=function(t){return new e(n.from_json(t.agent),t.status)},e})(),S={UserContext:"UserContext",UserApp:"UserApp",Context:"Context"},y=(function(){function e(e,t,n,s,r){var o,i;if(this.type=e,this.user_id=t,this.app=n,this.context=s,this.token=r,this.type!==S.UserContext&&this.type!==S.UserApp&&this.type!==S.Context)throw new Error("Unsupported type: "+this.type+".");if((null!=(o=this.user_id)?o.length:void 0)>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>d)throw new Error("app must be <= "+d+" chars.");if((null!=(i=this.context)?i.length:void 0)>p)throw new Error("context must be <= "+p+" chars.")}return e})(),I=(function(){function e(e,t){this.presence_params=e,this.agents=t}return e})(),C=(function(){function e(e,t){this.presence_params=e,this.status=t}return e.Status={Offline:1,Online:2},e})(),l=(function(){function e(e,t,n){this.presence_params=e,this.snapshot=t,this.delta=n}return e})(),b=(function(){function s(t,n,s,r,o,i,a){this._token=t,this._authn_cb=n,this._authz_cb=s,this._beacon_server=r,this._ajax=o,this._u=i,this._exclog=null!=a?a:null,this._handle_heartbeat_error=e(this._handle_heartbeat_error,this),this._handle_heartbeat_success=e(this._handle_heartbeat_success,this),this._heartbeat=e(this._heartbeat,this),this._started=!1,this._heartbeat_xhr=null,this._timeout_id=null,this._presence_data=[],this._offline_agents=[],this._has_changes=!1}return s.prototype.start=function(){if(!this._started)return this._backoff_window=r,this._started=!0,this._has_changes=!1,this._heartbeat()},s.prototype.stop=function(){return this._started=!1,this._heartbeat_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},s.prototype.add_or_update_agents=function(e){var t,n,s;for(n=0,s=e.length;n<s;n++)t=e[n],this._has_changes|=this._add_or_update_agent(t);if(!this._heartbeat_xhr&&this._started)return window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0)},s.prototype.update_token=function(e){this._token=e},s.prototype._add_or_update_agent=function(e){var t,n,s,r,o;for(o=this._presence_data,n=t=0,s=o.length;t<s;n=++t)if(r=o[n],this._u.isEqual(r.agent,e.agent))return(r.status!==e.status||r.auth_key!==e.auth_key)&&(this._presence_data[n]=e,!0);return this._presence_data.push(e),!0},s.prototype._heartbeat=function(){if(this._started&&0!==this._presence_data.length)return this._offline_agents=this._presence_data.filter(function(e){return""!==e.status}).map(function(e){return e.agent}),this._has_changes=!1,this._heartbeat_xhr=this._ajax({url:"https://"+this._beacon_server+"/1/update",type:"POST",data:JSON.stringify({token:this._token,updates:this._presence_data}),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5e3,success:this._handle_heartbeat_success,error:this._handle_heartbeat_error,xhrFields:{withCredentials:!0}})},s.prototype._handle_heartbeat_success=function(e,s,o){var i,a,l,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T,w;if(this._heartbeat_xhr=null,this._started){for(d=[],C=e.agent_errors||[],_=0,S=C.length;_<S;_++)a=C[_],h=a.error,i=n.from_json(a.agent),h===t?d.push(i):h===u&&null!=(I=this._exclog)&&I.reportStack("Input error: "+a),this._presence_data=this._presence_data.filter((function(e){return function(t){return!e._u.isEqual(t.agent,i)}})(this));for(d.length&&(p=this._authz_cb,window.setTimeout((function(e){return function(){return p(d)}})(this),0)),T=this._offline_agents,g=0,v=T.length;g<v;g++)for(b=T[g],w=this._presence_data,f=y=0,E=w.length;y<E;f=++y)if(l=w[f],this._u.isEqual(l.agent,b)&&""===l.status){this._presence_data.splice(f,1);break}return m=this._has_changes?0:c,this._backoff_window=r,this._timeout_id=window.setTimeout(this._heartbeat,m)}},s.prototype._handle_heartbeat_error=function(e,t,n){var s,r;if(this._heartbeat_xhr=null,this._started){if(e.status>=400&&e.status<500){if(401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();400===e.status&&null!=(r=this._exclog)&&r.reportStack("Bad request: "+e.responseText)}return s=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,o),this._timeout_id=window.setTimeout(this._heartbeat,s)}},s})(),v=(function(){function t(t,n,s,r,o,i,a,l){var c,u;this._presence_params=t,this._update_callback=n,this._refresh_callback=s,this._bolt=r,this._thunder_hostname=o,this._ajax=i,this._u=a,this._exclog=null!=l?l:null,this._on_refresh=e(this._on_refresh,this),this._on_update=e(this._on_update,this),this._compact_context_updates=e(this._compact_context_updates,this),c=function(){var e,t,n,s;for(n=this._presence_params,s=[],e=0,t=n.length;e<t;e++)u=n[e],s.push(this._presence_params_to_bolt_channel(u));return s}.call(this),this._thunder_client=new this._bolt.ThunderClient(c,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog)}return t.prototype.start=function(){return this._thunder_client.start()},t.prototype.stop=function(){return this._thunder_client.unsubscribe()},t.prototype.add_presence_params=function(e){var t,n,s;return s=this._presence_params.length,this._presence_params=this._u.union(e,this._presence_params),this._presence_params.length!==s&&(this._thunder_client.unsubscribe(),t=function(){var e,t,s,r;for(s=this._presence_params,r=[],e=0,t=s.length;e<t;e++)n=s[e],r.push(this._presence_params_to_bolt_channel(n));return r}.call(this),this._thunder_client=new this._bolt.ThunderClient(t,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog),this._thunder_client.start(),!0)},t.prototype._presence_params_to_bolt_channel=function(e){switch(e.type){case S.UserContext:return new this._bolt.SignedChannelState("beacon_uc"+i+e.app,""+e.user_id+a+e.context,"0",e.token);case S.UserApp:return new this._bolt.SignedChannelState("beacon_ua"+i+e.app,e.user_id,"0",e.token);case S.Context:return new this._bolt.SignedChannelState("beacon_c"+i+e.app,e.context,"0",e.token);default:throw new Error("Unknown type: "+e.type)}},t.prototype._bolt_channel_to_presence_params=function(e){var t,n,s,r,o,l;if(n=e.app_id.split(i),o=e.unique_id.split(a),2!==n.length)throw new Error("Unexpected format of Bolt app_id: "+e.app_id+".");switch(t=n[1],l="",s="",n[0]){case"beacon_uc":if(2!==o.length)throw new Error("Unexpected format of beacon_uc: "+e.unique_id+".");r=S.UserContext,l=o[0],s=o[1];break;case"beacon_ua":if(1!==o.length)throw new Error("Unexpected format of beacon_ua: "+e.unique_id+".");r=S.UserApp,l=o[0];break;case"beacon_c":if(1!==o.length)throw new Error("Unexpected format of beacon_c: "+e.unique_id+".");r=S.Context,s=o[0];break;default:throw new Error("Unknown Bolt app_id: "+e.app_id+".")}return new y(r,l,t,s,null)},t.prototype._compact_context_updates=function(e,t){var n,s,r,o,i,a,c,u,d,p,h,m,_,f,g,y;for(a=!1,n=[],o=0,d=t.length;o<d;o++)if(y=t[o],null!=y.snapshot)a=!0,n=y.snapshot;else if(null!=y.delta)for(f=y.delta,c=0,p=f.length;c<p;c++){for(m=f[c],r=!1,i=u=0,h=n.length;u<h;i=++u)if(_=n[i],this._u.isEqual(_.agent,m.agent)){r=!0,n[i]=m;break}r||n.push(m)}return a?(g=n,s=null):(g=null,s=n),new l(e,g,s)},t.prototype._on_update=function(e){var t,r,o,i,a,l,c,u,d,p,h,m,_;for(_=[],c=0,d=e.length;c<d;c++)i=e[c],a=i.channel_state,o=new this._bolt.ChannelId(a.app_id,a.unique_id),u=this._bolt_channel_to_presence_params(o),_.push(function(){switch(u.type){case S.UserContext:return h=i.payloads.slice(-1)[0].payload,r=null!=h.agents?(function(){var e,n,r,o;for(r=h.agents,o=[],e=0,n=r.length;e<n;e++)t=r[e],o.push(s.from_json(t));return o})():[],new I(u,r);case S.UserApp:return h=i.payloads.slice(-1)[0].payload,new C(u,h.status);case S.Context:return l=function(e){var r;return r=E.from_json(e.source),t=new n(e.user_id,u.app,u.context,r),new s(t,e.status)},p=function(e){var t,n,s;return{snapshot:null!=(null!=(n=e.snapshot)?n.agents:void 0)?(function(){var n,s,r,o;for(r=e.snapshot.agents,o=[],n=0,s=r.length;n<s;n++)t=r[n],o.push(l(t));return o})():void 0,delta:null!=(null!=(s=e.delta)?s.agents:void 0)?(function(){var n,s,r,o;for(r=e.delta.agents,o=[],n=0,s=r.length;n<s;n++)t=r[n],o.push(l(t));return o})():void 0}},m=(function(){var e,t,n,s;for(n=i.payloads,s=[],e=0,t=n.length;e<t;e++)h=n[e],s.push(p(h.payload));return s})(),this._compact_context_updates(u,m)}}.call(this));return this._update_callback(_)},t.prototype._on_refresh=function(e){var t;return this._refresh_callback(function(){var n,s,r;for(r=[],n=0,s=e.length;n<s;n++)t=e[n],r.push(this._bolt_channel_to_presence_params(t));return r}.call(this))},t})(),{Agent:n,AgentStatus:s,Platforms:g,PresenceParams:y,PresenceType:S,Receiver:v,Source:E,Transmitter:b,UserAppPresence:C,UserContextPresence:I}})}.call(this),function(){define("modules/clean/clipboard",["jquery","modules/clean/static_urls","modules/core/dom","external/swfobject"],function(e,t,n,s){var r,o,i,a,l;return l=t.static_url,o=function(){var e,t;return e=(new Date).getTime(),t=("00000"+Math.floor(1e6*Math.random())).slice(-6),"swf_"+e+"_"+t},i=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},a=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e},r=function(t,r,c,u){var d,p,h;return null==c&&(c=null),null==u&&(u=null),u=u||e(document.body),h=o(),d=e("<div />",{id:"flash_copy_container"}).append(e("<div />",{id:h})).css({position:"absolute",zIndex:1}),i(d,r),u.append(d),n.clone_position(d,r,{}),p=a(h,c),window.copyLoaded=(function(n){return function(){var n;return n=e("#"+h)[0],n.setCopyText(t),n.setCallbackFunction(p)}})(this),s.embedSWF(l("/static/swf/copy_clipboard-vflvMcZTC.swf"),h,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),d},{clipboard_overlay:r}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/clipboard_v2",["jquery","external/flash_detect","external/react","modules/core/browser","modules/core/exception","modules/clean/clipboard"],function(t,n,s,r,o,i){return o.assert,(function(){function s(t,n,s,r){this.copyText=t,this.onSuccess=n,this.onError=s,this.clickHandler=r,this.do_copy=e(this.do_copy,this)}return s.prototype.setupCopy=function(e,n){var r,o,a;if(r=t(n),o=t(e),!s.is_flashless_clipboard_supported())return a=(function(e){return function(){return"function"==typeof e.onSuccess&&e.onSuccess(),"function"==typeof e.clickHandler?e.clickHandler():void 0}})(this),i.clipboard_overlay(this.copyText,o,a,r)},s.prototype.do_copy=function(){var e;if(s.is_supported())return s.is_flashless_clipboard_supported()?(e=document.execCommand("copy",!1),e?"function"==typeof this.onSuccess?this.onSuccess():void 0:"function"==typeof this.onError?this.onError():void 0):void 0},s.is_supported=function(){return s.is_flashless_clipboard_supported()||n.installed},s.is_flashless_clipboard_supported=function(){var e;return e=parseInt(r.version),r.chrome?e>=42:r.mozilla?e>=41:r.opera?e>=29:r.msie?e>=9:!!r.edge||!!r.safari&&e>=10},s})()})}.call(this),function(){define("modules/clean/components/title_bubble",["jquery","external/classnames","external/react","external/react-dom","modules/clean/react/css"],function(e,t,n,s,r){var o,i;return i=n.DOM,o=n.createClass({displayName:"TitleBubble",propTypes:{text:n.PropTypes.string.isRequired,direction:n.PropTypes.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:n.PropTypes.func,respectLineBreaks:n.PropTypes.bool,className:n.PropTypes.string},getInitialState:function(){return{isChildFocused:!1}},componentDidMount:function(){return e(s.findDOMNode(this)).on("focusin.title-bubble",(function(e){return function(t){return e.setState({isChildFocused:!0})}})(this)).on("focusout.title-bubble",(function(e){return function(t){return e.setState({isChildFocused:!1})}})(this)).on("mouseenter.title-bubble",(function(e){return function(){var t;return"function"==typeof(t=e.props).onMouseEnter?t.onMouseEnter():void 0}})(this))},componentWillUnmount:function(){return e(s.findDOMNode(this)).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")},render:function(){var e;return e={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks},e["c-title-bubble--"+this.props.direction.slice(0,1)]=!0,i.div({className:t([e,this.props.className]),"data-title":this.props.text,onClick:(function(e){return function(t){if(t.detail>0)return e.setState({isChildFocused:!1})}})(this)},this.props.children)}}),o=r(o,["/static/css/scooter/scooter-scoped-vflhQ6850.css"])})}.call(this),define("modules/clean/contacts/bloodhound_contacts_v2",["require","exports","external/bloodhound","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/core/cookies"],function(e,t,n,s,r,o,i,a){"use strict";function l(e,t){c(e,t.includeForUser(e.id).contacts)}function c(e,t){if(e.id in d){var n=d[e.id];t=t.filter(r.ContactCommon.is_valid),n.clearRemoteCache(),n.clear(),n.add(t)}}function u(e){var t=document.createElement("a");t.href=e;var n=t.hostname||window.location.hostname;if(n.indexOf(".dropbox.com",n.length-".dropbox.com".length)===-1)throw new Error("Cannot send the CSRF token to "+n);return e}Object.defineProperty(t,"__esModule",{value:!0});var d={};t.BloodhoundContactsV2={getOrCreateForUser:function(e){if(e.id in d)return d[e.id];var t,c=s.getSearchConfigForUser(e);if(c.remoteEndpoint){var p=String(e.id);t={url:u(c.remoteEndpoint),prepare:function(e,t){return t.type="POST",t.headers={"X-CSRF-Token":a.read("__Host-js_csrf"),"X-Dropbox-Uid":p},t.data={query:JSON.stringify(e)},t.data._subject_uid=p,t},rateLimitBy:"debounce",rateLimitWait:c.remoteDebounceWait}}var h=new n({datumTokenizer:r.ContactCommon.get_index_tokens,queryTokenizer:n.tokenizers.whitespace,identify:r.ContactCommon.get_key,sufficient:c.sufficientResults,sorter:r.ContactCommon.sorter,local:[],remote:t});if(d[e.id]=h,i.get_viewer().is_user_signed_in(e)){var m=c.localCacheStore.getOrCreateForUser(e);m.load_contacts(!1,function(t){l(e,t),m.register_for_updates("bloodhound_contacts_v2",function(t){l(e,t)})})}return o.LinkedProfileServices.get_linked_profile_services_for_user(e.id).register_for_service_changes("bloodhound_contacts_v2",function(e){h.clearRemoteCache()}),d[e.id]},search:function(e,n,r,o){var i=t.BloodhoundContactsV2.getOrCreateForUser(e),a=s.getSearchConfigForUser(e);if(!n)return r([]),void(o&&a.remoteEndpoint&&o([]));var l=a.localCacheStore.getOrCreateForUser(e);l.is_loaded()?i.search(n,r,o):l.load_contacts(!1,function(e){i.search(n,r,o)}),l.refresh_contacts(!1)}}}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t=function(e,t){return function(){return e.apply(t,arguments)}},n=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},s={}.hasOwnProperty;define("modules/clean/contacts/cache",["jquery","modules/core/browser","modules/core/exception","modules/clean/ajax","modules/clean/bolt","modules/clean/contacts/cache_type","modules/clean/contacts/list","modules/clean/profile_services/profile_services_constants","modules/clean/user","modules/clean/viewer","modules/constants/contacts"],function(s,r,o,i,a,l,c,u,d,p,h){var m,_,f,g,y,assert;return assert=o.assert,_=l.CONTACT_CACHE_TYPE_TO_CONFIG,f=l.ContactCacheType,1e3,g=(function(){function t(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}return t.MAX_REQUEST_PERF_RECORDS=20,t.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},t.prototype.unregister_for_updates=function(e){if(null!=this.callbacks[e])return delete this.callbacks[e]},t.prototype.get_contacts_count=function(){
return null!=this.cached_contacts?this.cached_contacts.length():0},t.prototype.get_downloaded_time=function(){var e,t;return e=null!=(t=r.performance())&&"function"==typeof t.getEntriesByName?t.getEntriesByName(this._get_contacts_downloaded_mark_name()):void 0,e&&e.length?e[0].startTime:null},t.prototype.get_request_perf_records=function(){return this.request_perf_records},t.prototype._is_contact_get_or_check_ajax_request=function(e){var t,n;return t=e.initiatorType,n=e.name,"xmlhttprequest"===t&&n.endsWith(this._config.getUrl)},t.prototype._find_last_perf_entry=function(e){var t,n,s,o,i;if(null==e&&(e=500),i=null!=(o=r.performance())&&"function"==typeof o.getEntriesByType?o.getEntriesByType("resource"):void 0,null!=i?i.length:void 0)for(s=Math.min(i.length-1,e),t=n=s;n>=0;t=n+=-1)if(this._is_contact_get_or_check_ajax_request(i[t]))return i[t];return null},t.prototype._record_perf_stats=function(e){var n;if(null==e&&(e={}),n=this._find_last_perf_entry(),n&&(e.ttfb=n.responseStart-n.requestStart,e.downloading_time=n.responseEnd-n.responseStart,e.duration=n.duration,this.request_perf_records.push(e),this.request_perf_records.length>t.MAX_REQUEST_PERF_RECORDS))return this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1)},t.prototype._fetch_contacts=function(){return i.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:(function(e){return function(t,n,s){var r;if(r=JSON.parse(t),e._contacts_loaded_callback(r),e._schedule_fetch)return e._schedule_fetch()}})(this)})},t.prototype._get_versioned_params=function(e,t){var n;return null==t&&(t=!0),n={version:e},t&&(n.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(n.digest=this.digest),null!=this.limit&&(n.limit=this.limit),n},t.prototype._get_contacts_downloaded_mark_name=function(){return this._cache_download_name+"-"+this.instance},t.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},t.prototype._add_one_time_callback=function(t){if(null!=t&&e.call(this.one_time_callbacks,t)<0)return this.one_time_callbacks.push(t)},t.prototype._invoke_all_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},t.prototype._invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},t.prototype._invoke_callbacks=function(e,t,n){var s,r,o,i,a;for(i=Object.keys(e),a=[],s=0,o=i.length;s<o;s++)r=i[s],e[r](t),n?a.push(delete e[r]):a.push(void 0);return a},t})(),m=(function(s){function o(e,n,s){this.cache_type=e,this.limit=null!=n?n:null,this.user_id=null!=s?s:null,this.bolt_refresh_callback=t(this.bolt_refresh_callback,this),this.bolt_update_callback=t(this.bolt_update_callback,this),o.__super__.constructor.call(this,"BoltContactsCache download"),this.instance=o.INSTANCE++,this.loading_state=o.BOLT_NEED_TO_SEND_REQUEST,this._config=_[f[this.cache_type]],this.current_bolt_states=null,this._notified_states={},this._bolt=null,this._last_refresh_ts=null}return n(o,s),o.INSTANCE=0,o.BOLT_NEED_TO_SEND_REQUEST=0,o.BOLT_REQUEST_SENT=1,o.REFRESH_THRESHOLD=36e5,o.prototype.load_contacts=function(e,t){if(p.get_viewer().is_signed_in)return this._add_one_time_callback(t),(this.loading_state===o.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=o.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()?this._invoke_one_time_callbacks(this.cached_contacts):void 0},o.prototype.refresh_contacts=function(e){var t,n;if(null==e&&(e=!1),t=null!=(n=r.performance())&&"function"==typeof n.now?n.now():void 0,this._last_refresh_ts||(e=!0),!(!e&&this._last_refresh_ts&&t-this._last_refresh_ts<o.REFRESH_THRESHOLD))return i.BackgroundRequest({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})}),this._last_refresh_ts=t},o.prototype.is_loaded=function(){return null!=this.cached_contacts},o.prototype.bolt_update_callback=function(t){var n,s,r,i;for(s=0,r=t.length;s<r;s++)n=t[s],i=n.unique_id,(e.call(this._notified_states,i)<0||+this._notified_states[n.unique_id].revision<+n.revision)&&(this._notified_states[n.unique_id]=n);return this._should_update_contacts()&&(this.loading_state=o.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()},o.prototype.bolt_refresh_callback=function(e){var t;if(null!=(t=this._bolt)&&t.unsubscribe(),this._bolt=null,this.loading_state=o.BOLT_NEED_TO_SEND_REQUEST,!this._is_page_hidden())return this.load_contacts()},o.prototype._contacts_loaded_callback=function(e){var t,n,s;if(!this._is_old_contacts(e.bolt_info)&&(t=this._is_new_contacts(e.bolt_info),this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),t&&(null!=(n=e.contacts)?n.length:void 0)))return this._record_perf_stats({num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),null!=(s=r.performance())&&"function"==typeof s.mark?s.mark(this._get_contacts_downloaded_mark_name()):void 0},o.prototype._create_contacts_list=function(e){return this.cached_contacts=c.create_contacts_list(e)},o.prototype._subscribe_to_bolt=function(){var e,t,n,s;t=[],n=this.current_bolt_states;for(s in n)e=n[s],t.push(new a.SignedChannelState(this._config.boltAppId,s.toString(),e.revision,e.token));return this._bolt=new a.BoltClient(t,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()},o.prototype._is_new_contacts=function(e){return this._first_contacts_are_newer(e,this.current_bolt_states)},o.prototype._is_old_contacts=function(e){return this._first_contacts_are_newer(this.current_bolt_states,e)},o.prototype._first_contacts_are_newer=function(e,t){var n,s,r,o;if(!t)return!0;for(r in t){o=t[r];for(n in e)if(s=e[n],n===r&&+o.revision<+s.revision)return!0}return!1},o.prototype._should_update_contacts=function(){return this._is_new_contacts(this._notified_states)},o.prototype._get_request_params=function(){return this._get_versioned_params(1)},o.prototype._get_request_url=function(){return this._config.getUrl},o.prototype._get_refresh_params=function(e){return null==e&&(e={}),e},o.prototype._get_refresh_url=function(){return this._config.refreshUrl},o})(g),y=(function(e){function t(e,n){this.cache_type=e,this.user=n,assert(null!=this.user.id),t.__super__.constructor.call(this,this.cache_type,null)}return n(t,e),t.prototype._get_request_params=function(){var e;return e=this._get_versioned_params(1),e._subject_uid=this.user.id,e},t.prototype._get_refresh_params=function(e){return null==e&&(e={}),e._subject_uid=this.user.id,e},t.prototype._create_contacts_list=function(e){return this.cached_contacts=c.create_per_user_contacts_list(e,this.user.id)},t})(m),{BoltContactsCache:m,ContactsCacheProto:g,PerUserBoltContactsCache:y}})}.call(this),define("modules/clean/contacts/cache_store",["require","exports","tslib","modules/clean/contacts/cache_type","modules/clean/contacts/cache","modules/constants/contacts","modules/clean/viewer"],function(e,t,n,s,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){this.cacheType=e}return e})();t.BoltContactsCacheStore=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){if(!i.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()},t.prototype.getOrCreateForViewer=function(){return null==this.contactsCache&&(this.contactsCache=new r.BoltContactsCache(this.cacheType)),this.contactsCache},t})(a);t.PerViewerBoltContactsCacheStore=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uidToContactsCache={},t}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new r.PerUserBoltContactsCache(this.cacheType,e)),this.uidToContactsCache[e.id]},t})(a);t.PerUserBoltContactsCacheStore=c,t.DefaultContactsCacheStore=new l(s.ContactCacheType.ALL);var u=t.DefaultContactsCacheStore;"OFF"!==o.LEGACY_CACHE_LIMIT&&(u=new l(s.ContactCacheType.ALL),u.contactsCache=new r.BoltContactsCache(s.ContactCacheType.ALL,+o.LEGACY_CACHE_LIMIT)),t.LegacyContactsCacheStore=u,t.IndividualContactsCacheStore=new c(s.ContactCacheType.INDIVIDUAL)}),define("modules/clean/contacts/cache_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"})(t.ContactCacheType||(t.ContactCacheType={})),t.CONTACT_CACHE_TYPE_TO_CONFIG={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}}}),define("modules/clean/contacts/config",["require","exports","modules/constants/contacts","modules/clean/contacts/cache_store"],function(e,t,n,s){"use strict";function r(e){return n.MERGE_SEARCH_ALLOWED[e.id]?i.INDIVIDUAL_LOCAL_TEAM_REMOTE:i.ALL_LOCAL}function o(e){return t.CONTACTS_SEARCH_MODE_TO_CONFIG[i[r(e)]]}Object.defineProperty(t,"__esModule",{value:!0});var i;(function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"})(i=t.ContactsSearchMode||(t.ContactsSearchMode={})),t.LOCAL_ONLY_SEARCH_MODES=[i.ALL_LOCAL],t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.CONTACTS_SEARCH_DEBOUNCE_WAIT=10,t.CONTACTS_SEARCH_MODE_TO_CONFIG={ALL_LOCAL:{localCacheStore:s.DefaultContactsCacheStore,sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:s.IndividualContactsCacheStore,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT}},t.getSearchModeForUser=r,t.getSearchConfigForUser=o}),define("modules/clean/contacts/contact",["require","exports","modules/clean/contacts/types","modules/core/exception"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){}return e.sorter=function(e,t){return t.domain_contact&&!e.domain_contact?-1:e.domain_contact&&!t.domain_contact?1:e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0},e.is_valid=function(e){return e.dbx_account_id?e.type===n.DBX_ID||e.type===n.EMAIL:e.group_id?e.type===n.NEW_STYLE_GROUP:!!e.email&&e.type===n.EMAIL},e.get_key=function(t){return s.assert(e.is_valid(t),"invalid contact: type: "+t.type),t.dbx_account_id?"DBX_USER-"+t.dbx_account_id:t.group_id?"DBX_GROUP-"+t.group_id:"CONTACT-"+t.type+"-"+t.email},e.get_index_tokens=function(e){var t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t},e})();t.ContactCommon=r;var o=(function(){function e(e){var t=e.dbx_account_id,n=e.type,s=e.name,r=e.email,o=e.fb_id,i=e.group_id,a=e.group_size,l=e.photo_url,c=e.members,u=e.avatar_url,d=e.invalid,p=e.on_team,h=e.domain_contact,m=e.dbx_team_id,_=e.nameMatch,f=e.emailMatch,g=e.pending,y=e.join_state,S=e.query;this.dbx_account_id=t,this.type=n,this.name=s,this.email=r,this.fb_id=o,this.group_id=i,this.group_size=a,this.photo_url=l,this.members=c,this.avatar_url=u,this.invalid=d,this.on_team=p,this.domain_contact=h,this.dbx_team_id=m,this.nameMatch=_,this.emailMatch=f,this.pending=g,this.join_state=y,this.query=S,this.unique_key=this.name+"-"+this.getContactID()+"-"+this.dbx_account_id,this.team=this.on_team}return e.prototype.getKey=function(){return r.get_key(this)},e.prototype.getContactID=function(){switch(this.type){case n.FB:return this.fb_id;case n.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e})();t.Contact=o}),define("modules/clean/contacts/contact_token_state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactTokenState={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"}}),define("modules/clean/contacts/data_v2",["require","exports","modules/clean/ajax","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/fuzzy"],function(e,t,n,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(e,t,n){void 0===n&&(n=!0),this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.excludeDomainContacts=n,this.searchConfig=r.getSearchConfigForUser(e),this.searchMode=r.getSearchModeForUser(e),this.searchModeName=r.ContactsSearchMode[this.searchMode],s.BloodhoundContactsV2.getOrCreateForUser(this.user)}return e.prototype.search=function(e,t,n){var r=this;if(e=this.normalizeQuery(e),""===e)return t([]),void(n&&n([]));var o=function(n){return r.processMatches(n,t,e)},i=function(t){return r.processMatches(t,n,e)};s.BloodhoundContactsV2.search(this.user,e,o,i)},e.prototype.searchBatch=function(e,t,n){var s=this,r=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(r.is_loaded())return this.searchBatchInternal(e,t,n);r.load_contacts(!0,function(r){return s.searchBatchInternal(e,t,n)})},e.prototype.searchBatchInternal=function(e,t,n){for(var r=this,i=e.map(this.normalizeQuery).filter(function(e){return e.length>0}),a={},l=function(e){var t=function(t){a[e]=r.processMatches(t)};s.BloodhoundContactsV2.search(c.user,e,t)},c=this,u=0,d=i;u<d.length;u++){l(d[u])}if(t(a),this.searchConfig.remoteBatchEndpoint){var p=function(e){if(n){var t={},s=function(n){if(e.hasOwnProperty(n)){var s=a[n].map(o.ContactCommon.get_key),i=e[n].filter(function(e){var t=o.ContactCommon.get_key(e);return s.every(function(e){return e!==t})});t[n]=r.processMatches(i)}};for(var i in e)s(i);n(t)}};this.searchRemoteBatch(i,p)}},e.prototype.normalizeQuery=function(e){return e.trim().toLowerCase()},e.prototype.isSearchLocalOnly=function(){return r.LOCAL_ONLY_SEARCH_MODES.indexOf(this.searchMode)!==-1},e.prototype.getStats=function(){var e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}},e.prototype.searchRemoteBatch=function(e,t){n.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user.id,dataType:"json",data:{queries:JSON.stringify(e)},success:t})},e.prototype.isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},e.prototype.processMatches=function(e,t,n){for(var s=[],r=0,l=e;r<l.length;r++){var c=l[r];n&&(c.nameMatch=a.match(n,c.name||""),c.emailMatch=a.match(n,c.email||"")),c.on_team=!(c.type===i.FB||!this.isTeamContact(c));var u=new o.Contact(c);u.pending=!1,this.excludeDomainContacts&&u.domain_contact||this.filterFunc&&!this.filterFunc(u)||s.push(u)}return t&&t(s),s},e})();t.ContactsDataSourceV2=l}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(n,s,r){return(function(){function n(t,n){var s;this.contacts=t,this.owningUserId=n,this._lowercaseContact=e(this._lowercaseContact,this),this._excludeType=e(this._excludeType,this),this.sortByTeamFirst=e(this.sortByTeamFirst,this),this.excludeSuspended=e(this.excludeSuspended,this),this.excludeNonTeamActive=e(this.excludeNonTeamActive,this),this.excludeNonTeam=e(this.excludeNonTeam,this),this.excludePairedUserDuplicates=e(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=e(this.excludeTeamMembers,this),this.excludeFacebook=e(this.excludeFacebook,this),this.excludeNewStyleGroups=e(this.excludeNewStyleGroups,this),this.excludeMe=e(this.excludeMe,this),this.excludeByEmail=e(this.excludeByEmail,this),this.includeForViewer=e(this.includeForViewer,this),this.includeForUser=e(this.includeForUser,this),this.slice=e(this.slice,this),this.length=e(this.length,this),this.filterContacts=e(this.filterContacts,this),this.lcontacts=function(){var e,t,n,r;for(n=this.contacts,r=[],e=0,t=n.length;e<t;e++)s=n[e],r.push(this._lowercaseContact(s));return r}.call(this)}return n.create_contacts_list=function(e){return new n(e,null)},n.create_per_user_contacts_list=function(e,t){return new n(e,t)},n.prototype.filterContacts=function(e){var t;return t=this.contacts.filter(e),new n(t,this.owningUserId)},n.prototype.length=function(){return this.contacts.length},n.prototype.slice=function(e,t){return new n(this.contacts.slice(e,t),this.owningUserId)},n.prototype.includeForUser=function(e){return null!=this.owningUserId?this.owningUserId===e?this:new n([],e):(this.owningUserId=e,this.filterContacts(function(t){return t.owning_user_id===e}))},n.prototype.includeForViewer=function(e){var n;return n=e.get_user_ids(),this.filterContacts(function(e){var s;return s=e.owning_user_id,t.call(n,s)>=0})},n.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},n.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},n.prototype.excludeNewStyleGroups=function(){return this._excludeType(r.NEW_STYLE_GROUP)},n.prototype.excludeFacebook=function(){return this._excludeType(r.FB)},n.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},n.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},n.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},n.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},n.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},n.prototype.sortByTeamFirst=function(){return new n(n.sortContactsByTeamFirst(this.contacts),this.owningUserId)},n.sortContactsByTeamFirst=function(e){var t,n,s,r,o;for(o=[],r=[],n=0,s=e.length;n<s;n++)t=e[n],t.team?o.push(t):r.push(t);return o.concat(r)},n.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},n.prototype._lowercaseContact=function(e){var t,n,s;n={};for(t in e)s=e[t],("string"==typeof s||s instanceof String)&&(s=s.toLowerCase()),n[t]=s;return n},n})()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/tokenizer",["external/classnames","external/react","external/underscore","modules/core/browser","modules/core/i18n","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/contact_token_state","modules/clean/contacts/data_v2","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/tokenizer","modules/clean/validators/validators","modules/constants/contacts","jquery"],function(t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y){var S,v,E,b,C,I,T,w,A,M,N,k,P,R,L,F,O;return k=o._,v=i.ContactSearchLogger,S=c.Contact,E=u.ContactTokenState,C=d.ContactsDataSourceV2,w=p.ContactsTypeaheadSelector,N=_.Tokenizer,P=n.createElement,R=n.DOM,M=16,A=100,O=f.check(f.create(["EmailValidator"])),I=n.createClass({displayName:"ContactsToken",propTypes:{customClass:n.PropTypes.string,className:n.PropTypes.string,contact:n.PropTypes.object.isRequired,onRemove:n.PropTypes.func,tabIndex:n.PropTypes.number,tokenState:n.PropTypes.oneOf((function(){var e;e=[];for(L in E)F=E[L],e.push(F);return e})()).isRequired},render:function(){var e,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===E.invalid,warned:this.props.tokenState===E.warn,pending:this.props.tokenState===E.pending},n[this.props.customClass]=null!=this.props.customClass,n[this.props.className]=null!=this.props.className,e=t(n),R.a(y.extend({tabIndex:-1},this.props,{className:e}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},_getTokenName:function(){switch(this.props.contact.type){case h.FB:return"fb_ids";case h.EMAIL:return"emails";case h.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case h.FB:return this.props.contact.fb_id;case h.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},_renderIcon:function(){return this.props.contact.type===h.FB?R.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):this.props.contact.type===h.NEW_STYLE_GROUP||this.props.contact.dbx_account_id?P(a,{dimension:M,contact:this.props.contact,optionalClass:"token-icon"}):""},_renderInput:function(){return R.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){var e,t;return e=22,t=this.props.contact.name||this.props.contact.email,m.em_snippet(t,e)},_makeCloseButton:function(){return this.props.onRemove?R.span({className:"tokenizer-token-close",onClick:(function(e){return function(){return e.props.onRemove(e.props.contact),!1}})(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),b={basic:function(e){var t;return t=e.name&&!e.invalid&&e.email!==e.name,{state:e.invalid?E.invalid:E.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?E.pending:e.on_team?E.ok:e.invalid?E.invalid:E.warn,msg:null}},forbid:function(e){return{state:e.pending?E.pending:e.on_team?E.ok:E.invalid,msg:null}}},T=n.createClass({displayName:"ContactsTokenizer",propTypes:{user:n.PropTypes.object.isRequired,context:n.PropTypes.string,customClass:n.PropTypes.string,customContactFilter:n.PropTypes.func,excludeDomainContacts:n.PropTypes.bool,customContactValidator:n.PropTypes.func,focusOnMount:n.PropTypes.bool,id:n.PropTypes.string,onContentsChange:n.PropTypes.func,placeholder:n.PropTypes.string,populatedInputData:n.PropTypes.shape({tokens:n.PropTypes.array,value:n.PropTypes.string}),tabIndex:n.PropTypes.number,showContactImport:n.PropTypes.bool,shouldLogContactSearch:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),tokenSpacing:n.PropTypes.number},getDefaultProps:function(){return{customContactFilter:function(e){return!0},customContactValidator:b.basic,excludeDomainContacts:!0,focusOnMount:!1,id:null,placeholder:k("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null}},_initContactsDataSource:function(e,t,n){return new C(e,t,n)},componentWillReceiveProps:function(e){var t;e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=this._initContactsDataSource(e.user,e.customContactFilter,e.excludeDomainContacts)),this._validateTokens(null!=(t=e.populatedInputData)?t.tokens:void 0)},componentWillMount:function(){var e;this.contactsDataSource=this._initContactsDataSource(this.props.user,this.props.customContactFilter,this.props.excludeDomainContacts),this._validateTokens(null!=(e=this.props.populatedInputData)?e.tokens:void 0,!0)},componentDidMount:function(){var e,t,n,s,r,o;if(this.props.shouldLogContactSearch&&(this.contact_search_logger=new v(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),(null!=(t=this.props.populatedInputData.tokens)?t.length:void 0)>0||(null!=(n=this.props.populatedInputData.value)?n.length:void 0)>0)return s=this.serializeInputData(),r=s.tokens,o=s.value,"function"==typeof(e=this.props).onContentsChange?e.onContentsChange(r,o):void 0},_validateTokens:function(e,t){var n,s,r,o;if(null==t&&(t=!1),(null!=e?e.length:void 0)>0){for(r=[],n=0,s=e.length;n<s;n++)o=e[n],o.type===h.EMAIL&&(o.invalid=!O(o.email)),t?(o.query=o.query||o.email||o.name,r.push(o.pending=!0)):r.push(void 0);return r}},finishLogging:function(e){var t;if(t=this.contactsDataSource.getStats().numLocalContacts,this._flush_unfinished_queries_cache(),this.props.shouldLogContactSearch)return this.contact_search_logger.log_records(this.props.user.id,e,t)},_logTokenChangeEvent:function(e,t,n){var s,o;if(null==t&&(t=!1),null==n&&(n={}),this.contact_search_logger){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());s={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:null!=(o=r.performance())&&"function"==typeof o.now?o.now():void 0};for(L in n)F=n[L],s[L]=F;return this.contact_search_logger.add_record(s)}},_logSearchComplete:function(e,t,n){var s,o,i,a;if(null==n&&(n=!0),this._shouldLogSearch()&&e&&(i=r.performance().now(),a=this.unfinished_contact_search_queries[e]))return s=a.begin_time,!("ttfr"in a)&&t>0&&(a.ttfr=Math.floor(i-s)),n?(a.local_duration=Math.floor(i-s),a.num_local_results=t):(a.remote_duration=Math.floor(i-s),a.num_additional_remote_results=t),a.num_results+=t,o=(function(e){return function(){return e.contactsDataSource.isSearchLocalOnly()&&n||!n}})(this),o()?(a=this._prepareSearchStatsForLogging(a,e,i,!0),this.contact_search_logger.add_timing_record(a),this.contact_search_logger.count_search(a.is_slow),delete this.unfinished_contact_search_queries[e]):void 0},_logSearchBegin:function(e){var t;if(this._shouldLogSearch()&&e)return t=r.performance().now(),this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},_shouldLogSearch:function(){var e;return this.props.shouldLogContactSearch&&null!=this.contact_search_logger&&null!=(null!=(e=r.performance())?e.now:void 0)},_flush_unfinished_queries_cache:function(e){var t,n,s;if(this._shouldLogSearch()){null==e&&(e=r.performance().now()),n=this.unfinished_contact_search_queries;for(t in n)s=n[t],e-s.begin_time<l.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(s.is_preempted=!0),s=this._prepareSearchStatsForLogging(s,t,e,!1),this.contact_search_logger.add_timing_record(s),this.contact_search_logger.count_search(s.is_slow);return this.unfinished_contact_search_queries={}}},_prepareSearchStatsForLogging:function(e,t,n,s){var r,o;return r=e.begin_time,e.duration=Math.floor(n-r),"ttfr"in e?e.is_slow=e.ttfr>A:s&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>A,o=this.contactsDataSource.getStats().localContactsDownloadedTime,e.started_before_download=null==o||r<o,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=s,e},_getLoggingContext:function(){var e;return e="react_tokenizer",null!=this.props.context&&(e+="_"+this.props.context),e},addExternalContacts:function(e){return this.refs.tokenizer.addExternalTokens(e)},render:function(){return P(N,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:(function(e){return function(){return P(w,{showContactImport:e.props.showContactImport,teamGroupInfo:e.props.teamGroupInfo,user:e.props.user})}})(this),renderInput:(function(e){return function(){return R.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})}})(this),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._queryTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent},this.props.children)},_renderToken:function(e){return P(I,{contact:e,tokenState:this.props.customContactValidator(e).state})},_renderTokenHover:function(e){return this.props.customContactValidator(e).msg},_autoSelectMatch:function(e,t){var n,s,r,o,i,a,l,c,u,d;if(!t||!e)return null;for(e=this.contactsDataSource.normalizeQuery(e),r={email:[],name:[]},o=0,a=t.length;o<a;o++)c=t[o],n=c.email?this.contactsDataSource.normalizeQuery(c.email):null,u=c.name?this.contactsDataSource.normalizeQuery(c.name):null,e===n?r.email.push(c):e===u&&r.name.push(c);for(d=["email","name"],i=0,l=d.length;i<l;i++)if(s=d[i],1===r[s].length)return r[s][0];return null},_queryTokens:function(t,n){var s,r,o,i,a,l;if(o=t.filter(function(e){return e.pending&&e.query}),o.length)return i=(function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)l=o[e],n.push(l.query);return n})(),r=(function(s){return function(r){var o,i,a,l,c,u,d,p;for(i=[],t=[],o=s.serializeInputData(n).tokens,a=0,l=o.length;a<l;a++)u=o[a],c=u,u.pending&&u.query&&(d=s.contactsDataSource.normalizeQuery(u.query),p=s._autoSelectMatch(d,r[d]),p&&(c=p)),L=c.getKey(),e.call(i,L)>=0||(i.push(L),t.push(c));return n.replaceTokens(t)}})(this),a=r,s=r,this.contactsDataSource.searchBatch(i,a,s)},tokenizeEmails:function(e,t){var n,s,r,o,i,a,l,c,u,d;for(null==t&&(t=!1),n=/[,|;\n]+/,s=/[,|;\n ]+/,a=e.split(s),2===a.length&&O(a[0]+a[1])?(c=[a[0]+a[1]],t=!0):c=2===a.length&&O(a[0])&&""===a[1]?a:e.split(n),d="",t||(d=c.pop()),u=[],r=0,o=c.length;r<o;r++)l=c[r],i=l.trim(),""!==i&&u.push(new S({name:i,email:i,type:h.EMAIL,invalid:!O(i),on_team:!1,pending:!0,query:i}));return{tokens:u,value:d}},serializeInputData:function(e){return e=e||this.refs.tokenizer,e.serializeInputData()},getContacts:function(){var e,t,n,s;return e=this.serializeInputData(),n=e.tokens,s=e.value,t=this.tokenizeEmails(s,!0),n.concat(t.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:T,ContactTokenValidator:b,ContactTokenState:E,SLOW_CONTACT_SEARCH_THRESHOLD:A}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/classnames","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/avatar/contact_avatar","modules/clean/contacts/util","modules/clean/css","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/contacts/types","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/clean/static_urls","modules/clean/typeahead","modules/clean/em_string"],function(t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b){var C,I,T,w,A,M,N,k,P,R,L,F,O,assert,x,D,U,B,H;return assert=o.assert,F=i._,O=d.addAuthCompleteListener,B=d.removeAuthCompleteListener,M=h.LinkedProfileServices,N=h.ProfileServicesLinkingHandler,H=v.static_url,L=E.TypeaheadSelectorMixin,D=s.DOM,x=s.createElement,U=function(e,t){return r.extend({},e,t)},k=32,I=U(L,{getOptions:function(){var e,t,n;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,n,s,r;for(s=p.importable_contact_services(),r=[],e=0,n=s.length;e<n;e++)t=s[e],r.push(new P({provider:t,connected:this.profile_services.service_is_connected(t)}));return r}.call(this):(e=this.props.queryOptions.slice(0),this.props.teamGroupInfo?e.push(c.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=(n=this.profile_services)?n.has_unconnected_services(!0):void 0)&&e.push(new w),e)},renderOption:function(e){return e instanceof w?x(A):e instanceof P?x(R,{import:e
}):this.props.renderQueryOption(e)},onSelect:function(t){var n,s;return t instanceof w?(this._changeSelectionIndex(0),this.setState({importsExpanded:!0})):t instanceof P?(assert((s=t.provider,e.call(p.importable_contact_services(),s)>=0),"invalid party contact provider "+t.provider),this.profile_services.service_is_connected(t.provider)?(n=F("You're already connected to %(service_name)s").format({service_name:p.to_name(t.provider)}),void a.success(n)):this.link_handler.auth_service_with_user(t.provider,this.props.user.id,(function(e){return function(e){return N.show_import_notifications(e)}})(this))):this.props.onSelect(t)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),C=s.createClass({displayName:"ContactsTypeaheadSelector",mixins:[I],propTypes:{customClass:s.PropTypes.string,onSelect:s.PropTypes.func.isRequired,queryOptions:s.PropTypes.array,renderQueryOption:s.PropTypes.func.isRequired,showContactImport:s.PropTypes.bool,teamGroupInfo:s.PropTypes.shape({id:s.PropTypes.string,name:s.PropTypes.string}),user:s.PropTypes.object.isRequired},componentWillMount:function(){if(this.link_handler=new N,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user)return this.profile_services=M.get_linked_profile_services_for_user(this.props.user.id)},componentWillReceiveProps:function(e){var t,n;return 0===(null!=(t=e.queryOptions)?t.length:void 0)?this._changeSelectionIndex(-1):(null!=(n=e.queryOptions)?n.length:void 0)>0&&this.state.selectionIndex===-1?this._changeSelectionIndex(0):void 0},shouldComponentUpdate:function(e,t){return!r.isEqual(e,this.props)||!r.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,teamGroupInfo:null,onSelect:function(e){},renderQueryOption:function(e){return x(T,{contact:e})}}},onSelectionIndexChange:function(e){var t;return null!=(t=this.refs.pagingList)?t.scrollAround(e):void 0},render:function(){var e;return u.require_css("/static/css/react/contacts_typeahead-vfl-C8Z8J.css"),this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,x(g,{customClass:n(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())):D.div({})}}),T=s.createClass({displayName:"ContactsTypeaheadSelectorOption",propTypes:{contact:s.PropTypes.object.isRequired,customClass:s.PropTypes.string},render:function(){var e,t,s,o,i;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0),s={primary:this._renderPrimary(),secondary:this._renderSecondary()},s=r.pick(s,function(e){return""!==e}),D.li(U(this.props,{className:n(e)}),x(_.Flag,{leftAttachment:this._renderIcon(),rightAttachment:this.props.contact.domain_contact?this._renderDomainTooltip():void 0},(function(){var a;a=[];for(o in s)i=s[o],e={"option-only":1===r.size(s)},e["option-"+o]=!0,a.push(t=D.div({className:n(e),key:"option-"+o},i));return a})()))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case m.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case m.FB:return F("Facebook message");case m.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,s,r,o,i,a,l,c,u,d,p,h;if(n=22,e&&(e=b.em_snippet(e,n)),!t)return e;for(d=e.indexOf("…"),a=0,u=[],p=t.highlighted,o=0,l=p.length;o<l;o++)h=p[o],i=h[0],c=h[1],i>a&&u.push(e.slice(a,i)),s=i+c,s>d&&d!==-1&&(s=d),r=e.slice(i,s),u.push(D.strong({key:"highlight-"+r+"-"+i},r)),a=s;return a<e.length&&u.push(e.slice(a)),u},_renderIcon:function(){return D.div({className:"u-pad-right-xs"},x(l,{dimension:k,contact:this.props.contact,optionalClass:"contact-icon"}))},_renderDomainTooltip:function(){return D.div({className:"u-pad-right-xs"},x(S,{content:F("Suggested contact from your domain"),position:S.POSITIONS.BOTTOM},x(y,{group:"web",name:"info",alt:F("Domain contact")})))}}),w=(function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e})(),A=s.createClass({displayName:"ExpandImportOption",render:function(){var e;return e={"expand-imports-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(U(this.props,{className:n(e)}),x(_.Flag,{leftAttachment:x(f,{className:"u-pad-right-xs",src:H("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:H("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},D.div({className:"option-primary option-only"},F("Import contacts"))))}}),P=(function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e})(),R=s.createClass({displayName:"ThirdPartyImportOption",getInitialState:function(){return{showSpinner:!1}},propTypes:{import:s.PropTypes.object.isRequired},componentDidMount:function(){return this.authCompleteListenerToken=O(this.show_contact_import_spinner)},componentWillUnmount:function(){return B(this.authCompleteListenerToken)},show_contact_import_spinner:function(e){if(this.props.import.provider===e.provider)return this.setState({showSpinner:!0})},render:function(){var e,t,s,r,o,i;return i=this.props.import,r=i.provider,t=i.connected,o=p.to_name(r),!t&&this.state.showSpinner&&(o=F("Importing %(service_name)s Contacts").format({service_name:o})),s=t?F("Connected"):"",e={"third-party-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(U(this.props,{className:n(e)}),!t&&this.state.showSpinner?D.div({className:"option-spinner"},D.img({src:"/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"})):void 0,x(_.Flag,{spacing:"xs",leftAttachment:x(f,{alt:"",src:H(p.to_img(r)[0]),srcHiRes:H(p.to_img(r)[1])})},D.div({className:n({"option-primary":!0,"option-only":!t})},o,t?D.div({className:"option-secondary u-font-meta"},s):void 0)))}}),{ContactsTypeaheadSelector:C,ContactsTypeaheadSelectorOption:T,ExpandImportOption:A,ThirdPartyImportOption:R}})}.call(this),function(){define("modules/clean/contacts/util",["modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t){var n;return n=e.Contact,(function(){function e(){}return e.activityUserToContact=function(e,n){return null==n&&(n=0),{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:t.DBX_ID,priority:n,photo_url:e.photo_circle_url}},e.teamGroupInfoToContact=function(e){return new n({group_id:e.id,group_size:e.group_size,type:t.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})},e})()})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/flux/store_listener",["external/react"],function(t){var n;return n=function(n,s,r){var o;return t.createClass({displayName:"StoreListener("+(null!=(o=n.displayName)?o:"Unknown")+")",getInitialState:function(){return{childProps:r(this.props,s)}},componentDidMount:function(){var t,n;for(n in s)e.call(s,n)&&(t=s[n],t.add_change_listener(this._handleStoreChanged));return this.setState({childProps:r(this.props,s)})},componentWillUnmount:function(){var t,n,r;t=[];for(r in s)e.call(s,r)&&(n=s[r],t.push(n.remove_change_listener(this._handleStoreChanged)));return t},render:function(){var s,r,o,i;s={ref:"wrapped"},o=this.state.childProps;for(r in o)e.call(o,r)&&(i=o[r],s[r]=i);return t.createElement(n,s,this.props.children)},getWrappedComponent:function(){return this.refs.wrapped},getStores:function(){return s},_handleStoreChanged:function(){var e;if(this.isMounted()&&(e=r(this.props,s),null!=e))return this.setState({childProps:e})}})},{listenToStores:n}})}.call(this),define("modules/clean/loggers/pass_facepile_logger",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/models","modules/clean/react/pass/constants","modules/clean/react/pass/action_timestamps"],function(e,t,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};i[r.EventTypes.PASS_SHOWN]="pass_shown",i[r.EventTypes.PASS_HOVER]="pass_hover",i[r.EventTypes.PASS_CLICK]="pass_click";var a=(function(){function e(){this.eventToHandlerStack={};for(var e=0,t=[r.EventTypes.PASS_SHOWN,r.EventTypes.PASS_HOVER,r.EventTypes.PASS_CLICK];e<t.length;e++){var n=t[e];this.eventToHandlerStack[n]=[]}}return e.prototype._log=function(e,t,r,a){var l=t?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE",c={};if(!t){var u=s.FilePreviewSession.currentSession;a.file_viewer_session_id=u.fileViewerSession.id,a.file_preview_session_id=u.id,c=o.ActionTimestampsTracker.get(u.id)}var d=new Date,p={event_name:i[e],file_ns_id:r.ns_id,file_sjid:r.sjid,origin:l,extra:JSON.stringify(a),action_timestamps:JSON.stringify(c),client_ts:d.getTime()/1e3};n.SilentBackgroundRequest({url:"/log/pass_facepile",data:p})},e.prototype.listenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._pushHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype.unlistenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._popHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype._unlistenToTopOfHandlersStack=function(e){for(var t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;var n=this.eventToHandlerStack[t].slice(-1)[0];e.removeListener(t,n)}},e.prototype._listenToTopOfHandlersStack=function(e){for(var t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;var n=this.eventToHandlerStack[t].slice(-1)[0];e.addListener(t,n)}},e.prototype._pushHandlers=function(){for(var e in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(e)){var t=this._createHandlerFn(e);this.eventToHandlerStack[e].push(t)}},e.prototype._popHandlers=function(){for(var e in this.eventToHandlerStack)this.eventToHandlerStack.hasOwnProperty(e)&&this.eventToHandlerStack[e].pop()},e.prototype._createHandlerFn=function(e){var t=this;return function(n,s,r){t._log(e,n,s,{num_accessors:r.numAccessors,num_current_viewers:r.numCurrentViewers,num_viewers:r.numViewers,num_guests:r.numGuests,num_in_team_editors:r.numInTeamEditors,num_in_team_viewers:r.numInTeamViewers,num_non_team_editors:r.numNonTeamEditors,num_non_team_viewers:r.numNonTeamViewers,can_see_viewer_history:r.canSeeViewerHistory})}},e})();t.passFacepileLogger=new a}),define("modules/clean/react/browse/shared_with",["require","exports","tslib","jquery","external/react","external/react-dom","external/underscore","modules/clean/ajax","modules/clean/avatar/size","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal_util","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/constants/sharing","modules/core/browser","modules/core/dom"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeWith=function(e){var t=e.path,n=e.files;return this._browseInitializeEverything(t,n)},t.prototype._init=function(){this._sharedFolderDataByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByContainingPath={}},t.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},t.prototype.clearSharedLinkDataCache=function(){this._filesWeHaveSharedLinkDataFor={}},t.prototype.getDataForFile=function(e){var t={};if(e&&!e.target_ns&&this._canBeSharedFile(e)){var n=this._sharedFileDataByFileId[e.file_id||e.fq_path]||{},s=this._sharedFolderDataByTargetNs[m.browseStore.context().currentNSID]||{};null!=n.joinedMembers&&n.joinedMembers.length||null!=n.groups&&n.groups.length||null!=n.invitations&&n.invitations.length||(t.audienceDescription=s.audienceDescription),t.groups=i.uniq(i.union(n.groups||[],s.groups||[]),!1,function(e){return e.gid}),t.invitations=i.uniq(i.union(n.invitations||[],s.invitations||[]),!1,function(e){return e.invitation_id}),t.joinedMembers=i.uniq(i.union(n.joinedMembers||[],s.joinedMembers||[]),!1,function(e){return e.user_id}),t.numUndisplayableUsersAndInvites=(n.numUndisplayableUsersAndInvites||0)+(s.numUndisplayableUsersAndInvites||0);var r=s.memberCount||0;r+=(null!=n.joinedMembers?n.joinedMembers.length:0)+(null!=n.invitations?n.invitations.length:0)+(n.numUndisplayableUsersAndInvites||0),null!=n.groups&&(r+=n.groups.map(function(e){return e.num_users||1}).reduce(function(e,t){return e+t},0)),t.memberCount=r}else t=e&&e.target_ns?this._sharedFolderDataByTargetNs[e.target_ns]:this._sharedFolderDataByTargetNs[m.browseStore.context().currentNSID];t=t||{};var o=this._getSharedLinkInfoByFile(e);return o?t.sharedLinkInfo=o:null!=t&&delete t.sharedLinkInfo,t.hasSharedDataLoaded=this._getHasSharedDataLoaded(),t},t.prototype._getSharedLinkInfoByFile=function(e){var t,n=m.browseStore.path(),s=this._sharedLinkDataMapsByFolderFQPath[n];return s&&e&&(t=s[this._sharedLinkKey(e)]),t},t.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case p.BrowseActionTypes.LOAD_PATH:return this._pathLoaded(t.data.path,t.data.files);case p.BrowseActionTypes.ADD_FILES:return this._filesAdded(t.data.path,t.data.files);case p.BrowseActionTypes.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(t.data.path,t.data.files);case p.BrowseActionTypes.CHANGE_FILES:return this._filesChanged(t.data.path,t.data.fileDeltas);case p.SharedWithActionTypes.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(t.data.fileIds);case p.SharedWithActionTypes.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(t.data.parentPath);case p.SharedWithActionTypes.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(t.data.parentPath,t.data.fileFqPaths);case p.SharedWithActionTypes.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(t.data.sharedFolderData,t.data.containingPath);case p.SharedWithActionTypes.SET_SHARED_LINK_DATA:return this._setSharedLinkData(t.data.parentPath,t.data.sharedLinkData);case p.SharedWithActionTypes.SET_SHARED_FILE_DATA:return this._setSharedFileData(t.data.sharedFileData);case p.SharedWithActionTypes.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(t.data.targetNs);case p.SharedWithActionTypes.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(t.data.parentPath,t.data.files)}},t.prototype._fillInMissingSharedLinkData=function(e){for(var t=e.parentPath,n=e.files,s=[],r=0,o=n;r<o.length;r++){var i=o[r];this.hasLinkDataForFile(i)||(this._filesWeHaveSharedLinkDataFor[i.fq_path]=!0,s.push(i))}return M.loadLinkDataForFiles({parentPath:t,fileFqPaths:s.map(function(e){return e.fq_path})}),M.loadLinkMetadata(s)},t.prototype._getHasSharedDataLoaded=function(){var e=m.browseStore.path();return e in this._hasSharedDataLoadedByContainingPath&&this._hasSharedDataLoadedByContainingPath[e]},t.prototype._setHasSharedDataLoaded=function(e){var t=m.browseStore.path();return this._hasSharedDataLoadedByContainingPath[t]=e},t.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},t.prototype._loadSharedFileData=function(e){void 0===e&&(e=!1),e&&(this._sharedFileDataByFileId={});for(var t=[],n=0,s=m.browseStore.files().toArray();n<s.length;n++){var r=s[n];!this._canBeSharedFile(r)||r.file_id in this._sharedFileDataByFileId||t.push(r.file_id)}return M.loadSharedFileDataForFiles({fileIds:t})},t.prototype._pathLoaded=function(e,t){return this._setHasSharedDataLoaded(!1),M.loadSFDataForPath({parentPath:e,abortCurrentRequest:!0}),this._loadSharedFileData(!0),this._filesAdded(e,t)},t.prototype._filesAdded=function(e,t){return this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData()},t.prototype._filesChanged=function(e,t){if(e===m.browseStore.path()&&null!=t&&t.length){u.waitFor([m.browseStore.dispatchToken]),M.loadSFDataForPath({parentPath:e}),this.clearSharedLinkDataCache();var n=m.browseStore.files().toArray();return this._fillInMissingSharedLinkData({parentPath:e,files:n}),this._loadSharedFileData(!0)}},t.prototype._signalSharedFileDataOutOfDate=function(e){return M.loadSharedFileDataForFiles({fileIds:e})},t.prototype._signalSharedFolderDataOutOfDate=function(e){return null==e&&(e=m.browseStore.path()),M.loadSFDataForPath({parentPath:e})},t.prototype._signalSharedLinkDataOutOfDate=function(e,t){return null==e&&(e=m.browseStore.path()),M.loadLinkDataForFiles({parentPath:e,fileFqPaths:t})},t.prototype._setNSSharedWithData=function(e,t){this._sharedFolderDataByTargetNs=e,this._hasSharedDataLoadedByContainingPath[t]=!0,this.emit_change()},t.prototype._setSharedLinkData=function(e,t){for(var n=this._sharedLinkDataMapsByFolderFQPath[e]||{},s=0,r=t;s<r.length;s++){var o=r[s],i=o.file,a=o.sharedLinkToken;n[this._sharedLinkKey(i)]=a}return this._sharedLinkDataMapsByFolderFQPath[e]=n,this.emit_change()},t.prototype._setSharedFileData=function(e){this._sharedFileDataByFileId=n.__assign({},this._sharedFileDataByFileId,e),this.emit_change()},t.prototype._clearSharedFolderDataForNs=function(e){return delete this._sharedFolderDataByTargetNs[e],this.emit_change()},t.prototype._browseInitializeEverything=function(e,t){return M.loadSFDataForPath({parentPath:e}),this._filesAdded(e,t)},t.prototype._removeSharedLinkData=function(e,t){for(var n=this._sharedLinkDataMapsByFolderFQPath[e]||{},s=0,r=t;s<r.length;s++){var o=r[s];delete n[this._sharedLinkKey(o)]}return this._sharedLinkDataMapsByFolderFQPath[e]=n,this.emit_change()},t})(c),A=new w;t.SharedWithStore=A,s(document).on(f.SharingApi.REQUEST_SUCCEEDED_EVENT,function(e,t){return t.request_url.indexOf("/share_ajax/leave")>-1?u.dispatch({type:p.SharedWithActionTypes.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):u.dispatch({type:p.SharedWithActionTypes.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:m.browseStore.path()}})});var M=(function(){function e(){}return e.loadLinkMetadata=function(e){var t=m.browseStore.user();if(t&&C.TRUELINK.TRUELINK_BROWSE_LINK_ICON[t.id]&&C.TRUELINK.TRUELINK_UI[t.id]){var n=e.filter(function(e){return e.is_dir}).map(function(e){return"ns:"+e.ns_id+e.ns_path}),s=function(){if(0!==n.length){var e=n.slice(0,5);return n=n.slice(5),_.SharingActions.loadFolderLinkMetadataBatch(t,e).then(s)}},r=e.filter(function(e){return!e.is_dir}).map(function(e){return e.file_id||e.fq_path}),o=function(){if(0!==r.length){var e=r.slice(0,5);r=r.slice(5),_.SharingActions.loadFileMetadataBatch(t,e).then(o)}};s(),o()}},e.loadSFDataForPath=function(t){var n=t.parentPath,s=t.abortCurrentRequest,r=void 0!==s&&s,o=m.browseStore.user();if(o){var i=m.browseStore.context().isNonUserRelativeContext;r&&null!=e._currentSFDataRequest&&e._currentSFDataRequest.abort(),e._currentSFDataRequest=a.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:o,data:{max_results:5,fq_path_prefix:n,include_inherited:!0,admin_console:i?"true":void 0,sort_by_name:!0},success:function(e){for(var t={},s=0,r=e;s<r.length;s++){var o=r[s];t[o.ns_id]={numUndisplayableUsersAndInvites:o.num_avatars_not_shown,groups:o.groups,invitations:o.invitations,joinedMembers:o.joined_members,audienceDescription:o.audience_description,memberCount:o.num_users_and_invites}}return u.dispatch({type:p.SharedWithActionTypes.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:t,containingPath:n}})},complete:function(){e._currentSFDataRequest=null}})}},e.loadSharedFileDataForFiles=function(e){var t=e.fileIds,n=m.browseStore.user();if(n&&n.is_email_verified){var s=new g.FileShareApiClient({userId:n.id}),r=function(e){if(!e||0!==e.length){var t=e.slice(0,100),n=e.slice(100);return s.listMembersBatch({contentIds:t,limit:5}).then(function(e){var t={};if(e.forEach(function(e,n){return t[n]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(b.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(b.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(b.apiUserMemberToAvatarInfo).toArray()}}),u.dispatch({type:p.SharedWithActionTypes.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),n)return r(n)})}};return r(t)}},e.loadLinkDataForFiles=function(e){var t=e.parentPath,n=e.fileFqPaths,s=m.browseStore.user();if(s&&!C.TRUELINK.TRUELINK_UI[s.id]){var r=function(e){if(0!==e.length){var n=e.slice(0,100),o=e.slice(100);a.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(n)},subject_user:s,success:function(e){for(var s,a=m.browseStore.filesMap(),l=[],c=0,d=e.shmodels;c<d.length;c++){var h=d[c];h.disabled||(s=a.get(h.path),s&&l.push({file:s,sharedLinkToken:h}))}l.length&&u.dispatch({type:p.SharedWithActionTypes.SET_SHARED_LINK_DATA,data:{parentPath:t,sharedLinkData:l}});for(var _,f=i.object(e.shmodels.map(function(e){return[e.path,!0]})),g=[],y=0,S=n;y<S.length;y++){var v=S[y];v in f||(_=a.get(v),_&&g.push(_))}if(g.length&&u.dispatch({type:p.SharedWithActionTypes.REMOVE_SHARED_LINK_DATA,data:{parentPath:t,files:g}}),o)return r(o)}})}};r(n)}},e._currentSFDataRequest=null,e})();t.SharedWithActions=M;var N=r.createClass({displayName:"SharedWithController",mixins:[d(A,E.sharingInfoStore,m.browseStore)],propTypes:{browseContext:r.PropTypes.instanceOf(h.BrowseContext).isRequired,file:r.PropTypes.instanceOf(h.File),isInAudienceBox:r.PropTypes.bool,inSelectMode:r.PropTypes.bool,tabIndex:r.PropTypes.oneOf([0,-1]),actionHandlers:r.PropTypes.object},_get_state_from_stores:function(e){var t=m.browseStore.user();if(t){var n=t.id,s=A.getDataForFile(e.file),r=E.sharingInfoStore.getSharingInfo(n,e.file&&e.file.fq_path),o=m.browseStore.loadingState()===p.LoadingStates.LOADING_FIRST_PAGE;return{audienceDescription:null!=s&&s.audienceDescription,numUndisplayableUsersAndInvites:null!=s?s.numUndisplayableUsersAndInvites:0,groups:null!=s?s.groups:[],hasSharedDataLoaded:null!=s&&s.hasSharedDataLoaded&&!o,invitations:null!=s?s.invitations:[],joinedMembers:null!=s?s.joinedMembers:[],memberCount:null!=s?s.memberCount:0,sharedLinkInfo:null!=s?s.sharedLinkInfo:null,linkMetadata:null!=r&&r.linkMetadata()}}},componentDidUpdate:function(){var e=this;if(null!=this.props.tabIndex){var t=T.getFocusableElementsIn(o.findDOMNode(this),!1);Array.prototype.forEach.call(t,function(t){return t.tabIndex=e.props.tabIndex})}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_handleMembershipClick:function(){if(this.props.file&&m.browseStore.context().isCurrentlyInRoot)return void I.open_tab("/team#members");if((!this.props.file||!h.File.isTeamMemberFolder(this.props.file))&&(!this.props.file||h.File.canViewFileMembers(this.props.file,m.browseStore.context()))){var e=m.browseStore.user();if(e){var t=this.props.file||m.browseStore.context();return this.props.browseContext.isNonUserRelativeContext&&null!=this.props.actionHandlers&&this.props.actionHandlers.onManage?null!=this.props.actionHandlers?this.props.actionHandlers.onManage(this.props.file):void 0:S.showShareModal(e,t,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})}}},handleOverflowCountClick:function(){return this._handleMembershipClick()},handleAvatarClick:function(){return this._handleMembershipClick()},handleSharedLinkClick:function(){var e=m.browseStore.user();if(e)return S.showShareModal(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})},render:function(){var e=m.browseStore.context(),t=m.browseStore.user();if(!t||e.isCurrentlyInRoot&&null==this.props.file&&!t.is_cdm_member)return null;var n=this.props.file?h.File.canViewFileMembers(this.props.file,e):e.canViewContainingNSMembers,s=t.is_cdm_member&&"/"===e.currentFQPath&&e.currentNSID===e.rootNSID;return r.createElement(v.SharedWithView,{user:t,file:this.props.file,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,memberCount:this.state.memberCount,parentFolderName:e.getNameOfTargetFolder(),animation:!1,avatarDimension:l.AVATAR_DIMENSION_BY_SIZE.MEDIUM,maxVisibleAvatars:5,sharedLinkInfo:this.state.sharedLinkInfo,onSharedLinkClick:this.handleSharedLinkClick,publicFolderSharing:this.props.file&&y.shouldUsePublicFolderSharing(this.props.browseContext||{},this.props.file.fq_path),isCdmRoot:s,inSelectMode:this.props.inSelectMode,isInAudienceBox:this.props.isInAudienceBox,audienceDescription:this.state.audienceDescription,hasSharedDataLoaded:this.state.hasSharedDataLoaded,canViewMembers:n&&!e.isInsideDeletedFolder,inContentManagerCdmRoot:!1,linkMetadata:this.state.linkMetadata})}});t.SharedWithController=N}),function(){define("modules/clean/react/bubble",["external/react","external/underscore","modules/clean/css"],function(e,t,n){var s,r;return r=e.DOM,s={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"},e.createClass({displayName:"Bubble",statics:{ARROW:s},propTypes:{arrow:e.PropTypes.oneOf(t.values(s)),className:e.PropTypes.string},getDefaultProps:function(){return{arrow:null,className:""}},componentWillMount:function(){if("undefined"!=typeof window&&null!==window)return n.require_css("/static/css/react/bubble_box-vflpfsqHZ.css")},render:function(){var e,n;return e=["react-bubble-box","react-bubble-box--arrow-"+this.props.arrow,this.props.className],n=t.extend({},t.omit(this.props,["arrow","className"]),{className:e.join(" ")}),r.div(n,this._renderArrow(),this.props.children)},_renderArrow:function(){return null!=this.props.arrow?[r.div({className:"react-bubble-box__arrow-border",key:"arrow-border"}),r.div({className:"react-bubble-box__arrow",key:"arrow"})]:[]}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/content_manager/api",["external/react","jquery","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/react_format","modules/clean/filepath","modules/clean/filetypes","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/browse/store","modules/clean/sharing/api/util/types","modules/clean/sharing/ui_util","modules/clean/teams/admin/api/admin_console_api_client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/viewer","require"],function(t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I){var T,w,A,M,N,k,P,R,L,F,O,x,D,U,B,H,q,V,G,W,j,K,Y,z,Q,X,J,Z,$,ee,te,ne,se,re,oe,ie,ae,le;return A=r.ContentManagerActionsLogger,ee=i.reactFormat,M=l.FileTypes,u.PaginationManager,d.LoadingStates,p.Config,p.BrowseContext,W=h.compare,G=m.browseStore,z=_.folderMetadataApiToRecord,N=f.GoldenGate,w=g.AdminConsoleApiClient,O=v._,oe=v.ungettext,x=function(e){return{fq_path:"/"+e.name,href:"/work/"+e.name,is_dir:!0,bytes:0,target_ns:e.team_folder_id,icon:B[e.status[".tag"]],team_folder_status:e.status[".tag"],type:M.TEAM_SHARED_FOLDER}},T="undefined"!=typeof window&&null!==window?n(window):null,F=180,R=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|<|>|\\"|\\|)'),k=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|\\"|\\|)'),L=new RegExp("[\\ufffe-\\uffff\\ud800-\\udfff]"),P=[".",".."],ae=function(t,n){return null==n&&(n=!1),""===t?"":t.length>255?O("The folder name should be under 255 characters"):n&&t.startsWith(".")?O("The folder name can’t start with a dot (.)"):t.endsWith(".")?O("The folder name can’t end with a dot (.)"):e.call(P,t)>=0?O("The names dot (.) and dot dot (..) are’t allowed"):R.test(t)?O("The following characters aren’t allowed: \\ / : ? * < > ” |"):L.test(t)?O("The folder name contains invalid characters"):null},ie=function(e){return""===e?"":e.length>255?O("The file name should be under 255 characters"):k.test(e)?O("The following characters aren’t allowed: \\ / : ? * ” |"):L.test(e)?O("The file name contains invalid characters"):null},D=function(e,t){var n,s,r,o;for(o=[],n=0,r=e.length;n<r;n++)s=e[n],o.push(s.fq_path="/"+t+s.fq_path);return o},U=function(){var e;return e=N.hasContentManagerCdm(G.user().id),new w(isCMforCDM=e,flashError=!1)},J=function(e){var t,n,r,i,a,l,c,u,d,p,h,m,_;return c=e.path,_=e.userId,h=e.sortFoldersFirst,r=e.includeDeletedFiles,i=e.nsId,l=e.onSuccess,a=e.onError,t=N.hasContentManagerCdm(_),n=U(),"/"!==c||t?(u=c.split("/"),d=u[1],p=t?1:2,m="/"+u.slice(p).join("/"),o.WebRequest({data:{show_deleted:r||"",admin_console:!0,ns_id:i,sort_folders_first:h},url:b({path:"/browse"+m}),subject_user:_,success:function(e){try{s.isString(e)&&(e=JSON.parse(e)),t||(e.paginated?D(e.first_page.items,d):D(e.file_info,d)),T.scrollTop(0),l({path:c,data:e})}catch(e){}},error:function(e,t,n){return"function"==typeof a?a(e,t,n):void 0}})):n.teamFoldersList().then(function(e){var t,n,s;return e.team_folders=e.team_folders.sort(function(e,t){return W(e.name.toUpperCase(),t.name.toUpperCase(),1)}),n=(function(){var t,n,r,o;for(r=e.team_folders,o=[],t=0,n=r.length;t<n;t++)s=r[t],o.push(x(s));return o})(),t={file_info:n,paginated:!1,inside_team_folder_root:!0,is_non_user_relative_context:!0},l({path:c,data:t})}).catch(function(e){if(!e.headers)throw e;return"function"==typeof a?a(e.headers,e.raw.status,e.raw.responseBody):void 0})},j=function(e,n){var s,r,o,i,a,l,c,u,d,p;return l=e.files,c=e.newPath,p=e.userId,u=e.onSuccess,null==n&&(n=!0),r=I("modules/clean/react/browse/actions").browseActions,s=I("modules/clean/react/modal").Modal,i=U(),a=G.context(),d=a.rootNSID,E.info(O("Copying files...",F)),o=n?{".tag":"check"}:null,i.bulkFileCopy(d,l,c,o).then(function(e){var t;return E.success(O("Copy completed.")),r.setPath({path:G.path(),nsId:a.rootNSID}),t=1===l.length?"copy":"copyBatch",H(t)}).catch(function(e){var n,r,o,i,a;return"cant_copy_shared_folder"===(null!=(r=e.error)?r[".tag"]:void 0)?E.error(O("Copying a shared folder isn’t supported for beta.")):"to"===(null!=(o=e.error)?o[".tag"]:void 0)&&"file_system_warnings"===(null!=(i=e.error)?i.to[".tag"]:void 0)?(E.clear(),n=null!=(a=e.error)?a.to.details[0]:void 0,n.blocking?E.error(O(n.text)):s.showInstance(t.createElement(s,{title:O(n.title),submitting:!1,acceptButtonText:O("Copy"),dismissButtonText:O("Cancel"),onAccept:function(){return j({files:l,newPath:c,userId:p,onSuccess:u},!1)},onDismiss:null},ee(O(n.text+". <learnMoreLink>Learn more</learnMoreLink>"),{learnMoreLink:t.DOM.a({target:"_blank",href:n.learn_more})})))):E.error(O("There was a problem completing this request."))})},Y=function(e){var t,n,s,r;return r=e.files,s=e.context,t=I("modules/clean/react/browse/actions").browseActions,n=U(),E.info(O("Deleting files...",F)),n.bulkFileDelete(r).then(function(e){var n;return n=oe("Deleted %d item.","Deleted %d items.",r.length).format(r.length),E.success(n),t.setPath({path:G.path(),nsId:s.rootNSID}),H(1===r.length?r[0].is_dir?"deleteFolder":"deleteFile":"deleteBatch")}).catch(function(e){
return E.error(O("There was a problem completing this request."))})},te=function(e){var t,n,s,r,o,i,a;return o=e.file,e.userId,e.onSuccess,a=e.onError,i=e.newName,t=I("modules/clean/react/browse/actions").browseActions,s=G.context(),(r=o.is_dir?ae(i):ie(i))?(E.error(r),void a()):(n=U(),n.fileRename(o.ns_id,o.ns_path,i).then(function(e){return o.is_dir?E.success(O("Folder renamed.")):E.success(O("File renamed.")),t.setPath({path:G.path(),nsId:s.rootNSID}),t.setFileRenameComplete({file:o}),H("rename")}).catch(function(e){return E.error(O("There was a problem completing this request."))}))},Z=function(e){var t,n,s,r,o,i;return e.path,r=e.files,o=e.newPath,e.userId,e.onSuccess,t=I("modules/clean/react/browse/actions").browseActions,n=U(),s=G.context(),i=s.rootNSID,E.info(O("Moving files...",F)),n.bulkFileMove(i,r,o).then(function(e){var n;return E.success(O("Move completed.")),t.setPath({path:G.path(),nsId:s.rootNSID}),n=1===r.length?"move":"moveBatch",H(n)}).catch(function(e){var t;return"cant_move_folder_into_itself"===(null!=(t=e.error)?t[".tag"]:void 0)?E.error(O("Moving a folder into itself isn’t allowed.")):E.error(O("There was a problem completing this request."))})},Q=function(e){throw e.path,e.userId,e.namespaceToJournalIdMap,e.includeDeletedFiles,e.onSuccess,new Error("Not Implemented")},K=function(e){var t,n,s,r,o,i,a,l;return l=e.pathName,r=e.folderName,o=e.nsId,e.userId,a=e.onSuccess,i=e.onError,t=I("modules/clean/react/browse/actions").browseActions,(s=ae(r))?(E.error(s),void i()):(n=U(),n.folderCreate(o,l,r).then(function(e){var n;return E.success(O("Folder created.")),n={fq_path:"/"+r},a({changesets:null,createdFolder:n}),t.setPath({path:G.path(),nsId:o}),H("createFolder")}).catch(function(e){var t,n,s,r;return i(),"path"===(null!=(t=e.error)?t[".tag"]:void 0)&&"disallowed_name"===(null!=(n=e.error.path)?n[".tag"]:void 0)?E.error(O("The folder name is invalid.")):"path"===(null!=(s=e.error)?s[".tag"]:void 0)&&"conflict"===(null!=(r=e.error.path)?r[".tag"]:void 0)?E.error(O("A folder with the same name exists.")):E.error(O("Failed to create the folder."))}))},re=function(e){var t,n,s,r,o;return n=e.nsId,s=e.nsPath,o=e.policyUpdate,r=e.onSuccess,e.onError,t=new U,t.shareFolder(n,s,o).then(z).then(r)},le=function(e){var t,n,s,r,o;return r=e.nsId,o=e.nsPath,t=e.actions,s=e.listMembersArg,H("validateFolderPath"),n=U(),n.validateFolderPath(r,o,t,s)},ne=function(e){var t,n,s;return t=e.files,s=e.onSuccess,n=t[0],n.is_dir||t.length>1?V(t,s):q(n.ns_id,n.ns_path,n.latest_rev,s)},q=function(e,t,n,s){var r;return r=U(),r.restoreFile(e,t,n).then(s)},V=function(e,t){var n;return n=U(),n.restorePaths(e).then(function(n){return 1===n.ignored_mounts.length&&0===n.count?E.error(O("Can’t restore “%(folder_name)s” here because it was moved").format({folder_name:a.filename(e[0].fq_path)})):n.ignored_mounts.length>0?E.warning(oe("“%(folder_name)s” restored, but an item inside it was previously moved","“%(folder_name)s” restored, but %(num)s items inside were previously moved",n.ignored_mounts.length).format({num:e.length,folder_name:a.filename(e[0].fq_path)})):t()}).catch(function(e){return E.error(O("There was a problem completing this request."))})},$=function(e,t,n){var s;return s=U(),s.permanentDeleteFile(e,t).then(n)},H=function(e){return A.log(G.context().rootNSID,e)},B={},se=function(e){return B=e},X=function(e){return"/"===e.path&&!N.hasContentManagerCdm(e.user.id)},{validateFolderName:ae,loadPath:J,renameFile:te,copyFiles:j,deleteFiles:Y,moveFiles:Z,getChangesForDirectory:Q,setIcons:se,createNewFolder:K,shareFolder:re,validateFolderPath:le,restoreFiles:ne,permanentDeleteFile:$,isInCMGoldenGateRoot:X}})}.call(this),define("modules/clean/react/file_modal_controller",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/react/overquota_modal","modules/clean/react/file_modals","modules/clean/react/modal","modules/clean/sharing/browse_exports"],function(e,t,n,s,r,o,i,a,l){"use strict";function c(){var e=s.createElement(o.OverquotaModal,null);a.Modal.showInstance(e)}function u(e,t,n){var r=s.createElement(i.RestoreFilesModal,{files:t,userId:e.id,onSuccess:n});a.Modal.showInstance(r)}function d(e,t,n){var r=s.createElement(i.PermanentlyDeleteModal,{files:t,userId:e.id,onSuccess:n});a.Modal.showInstance(r)}function p(e,t,n,o,l,c){void 0===l&&(l=!1),void 0===c&&(c=null);var u,d=r.filename(n.currentFQPath),p=n.isInsideSharedFolder;u=l?s.createElement(i.ExpOQDeleteFileModal,{files:t,user:e,parentSharedFolderName:p?d:null,onUndo:o,expSubgrowthBizWebClientOQDelete:l}):s.createElement(i.DeleteFileModal,{files:t,user:e,parentSharedFolderName:p?d:null,onUndo:o,onSuccess:c}),a.Modal.showInstance(u)}function h(e,t,n){var r=s.createElement(i.ContentManagerBridgeModal,{files:e,type:t,isLimitedTeam:n});a.Modal.showInstance(r)}function m(e,t,n){var o=s.createElement(i.NoAccessFolderModal,{folderName:r.filename(t.fq_path),folderPath:t.fq_path,userIsSameTeam:!!(e&&e.team_dbtid&&n.teamFolderOwnerTeamApiId&&e.team_dbtid===n.teamFolderOwnerTeamApiId),userIsSuperAdmin:!!e&&l.GoldenGate.hasContentManagerAndSuperAdmin(e.id)});a.Modal.showInstance(o)}function _(e){var t=s.createElement(i.ConfirmOwnershipTransferModal,{onAccept:e});a.Modal.showInstance(t)}function f(e){a.Modal.showInstance(s.createElement(i.FileSystemWarningsModal,n.__assign({},e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.showOverquota=c,t.showRestore=u,t.showPermanentlyDelete=d,t.showDelete=p,t.showContentManagerBridge=h,t.showNoAccess=m,t.showConfirmOwnershipTransferModal=_,t.showFileSystemWarningsModal=f}),define("modules/clean/react/file_modals",["require","exports","tslib","external/react","external/spectrum/button","external/spectrum/modal","modules/clean/browse_interface","modules/clean/em_string","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/api","modules/clean/react/browse/render_partials","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b){"use strict";function C(t,n,s){var r=function(){return w({files:n,userId:t,context:s})};e(["modules/clean/react/trash/trash_modal_util"],function(e){(0,e.openTrashModalFromBrowseFiles)(t,n,s,r)})}Object.defineProperty(t,"__esModule",{value:!0});var I=function(){},T=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePurged=function(){l.notifyPurgeSuccess(t.props.files.length),t.props.onSuccess()},t.handleAccept=function(){if(h.browseStore.context().isNonUserRelativeContext){var e=t.props.files[0];m.permanentDeleteFile(e.ns_id,e.ns_path,t.handlePurged)}else d.purgeFiles({files:t.props.files,userId:t.props.userId,onSuccess:t.handlePurged})},t}return n.__extends(t,e),t.prototype.isSingleSharedFolder=function(e){return 1===e.length&&e[0].type===u.FileTypes.SHARED_FOLDER},t.prototype.getTitle=function(e){var t=e.length;return this.isSingleSharedFolder(e)?E._("Remove access to folder?"):E.ungettext("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},t.prototype.renderContent=function(e){var t=e.length;if(1===t){var n=c.filename(e[0].fq_path);return this.isSingleSharedFolder(e)?g.reactFormat(E._("Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."),{strong:s.createElement("strong",null),filename:n}):g.reactFormat(E._("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?"),{strong:s.createElement("strong",null),filename:n})}return s.createElement("span",null,E.ungettext("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},t.prototype.render=function(){return s.createElement(f.Modal,{ref:"modal",title:this.getTitle(this.props.files),acceptButtonText:this.isSingleSharedFolder(this.props.files)?E._("Remove my access"):E._("Delete permanently"),dismissButtonText:E._("Cancel"),onAccept:this.handleAccept},this.renderContent(this.props.files))},t.defaultProps={onSuccess:I},t})(s.Component);t.PermanentlyDeleteModal=T;var w=function(e){var t=e.files,n=e.context,s=e.userId,r=e.onSuccess,o=function(){l.notifyRestoreSuccess(t),r&&r()};n.isNonUserRelativeContext?m.restoreFiles({files:t,onSuccess:o}):d.restoreFiles({files:t,userId:s,onSuccess:o})},A=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRestoreClick=function(e){e.preventDefault(),w({files:t.props.files,context:h.browseStore.context(),userId:t.props.userId,onSuccess:t.props.onSuccess}),t.refs.modal.close()},t.handleCancelClick=function(e){e.preventDefault(),t.refs.modal.close()},t}return n.__extends(t,e),t.prototype.getTitle=function(e,t){var n=e-1;return 0===n?E._("Restore %(name)s?").format({name:t}):E.ungettext("Restore %(name)s and %(num)s other item?","Restore %(name)s and %(num)s other items?",n).format({num:n,name:t})},t.prototype.renderSingleFileContent=function(e,t){var n=c.filename(e.fq_path);return[g.reactFormat(E._("The most recent version of <strong>%(filename)s</strong> will be restored."),{strong:s.createElement("strong",null),filename:n}),s.createElement("div",{className:"file-modal__single-file-row"},s.createElement(p.FileIcon,{file:e,className:"brws-file-name-cell-icon file-modal__single-file-row-icon"}),!h.browseStore.context().isNonUserRelativeContext&&t?s.createElement("a",{href:t,className:"file-modal__single-file-row-link"},n):n)]},t.prototype.renderSingleFolderContent=function(e){var t=c.filename(e.fq_path);return[g.reactFormat(E._("Restoring this folder will bring back any files and folders in it. If you’d like specific people to have access, add them once you’ve restored the folder.")),s.createElement("div",{className:"file-modal__single-file-row"},s.createElement(p.FileIcon,{file:e,className:"brws-file-name-cell-icon file-modal__single-file-row-icon"}),t)]},t.prototype.renderMultiFileContent=function(e){return s.createElement("span",null,h.browseStore.context().isNonUserRelativeContext?g.reactFormat(E._("Restoring these items will bring back any files and folders inside them. If you’d like specific people to have access, add them once you’ve restored the items.")):E.ungettext("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},t.prototype.renderButtons=function(e){return s.createElement("div",{className:"file-modal__buttons"},e?s.createElement("div",{className:"file-modal__buttons__alt",ref:"revisionButton"},s.createElement("a",{href:e},E._("View other versions"))):void 0,s.createElement("div",{className:"file-modal__buttons__main"},s.createElement("button",{className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},E._("Restore")),s.createElement("button",{className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},E._("Cancel"))))},t.prototype.render=function(){var e,t=this.props.files.length,n=null;return 1!==t||h.browseStore.context().isNonUserRelativeContext||(n=i.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId})),e=1===t?this.props.files[0].is_dir?this.renderSingleFolderContent(this.props.files[0]):this.renderSingleFileContent(this.props.files[0],n):this.renderMultiFileContent(this.props.files),s.createElement(f.Modal,{ref:"modal",title:this.getTitle(t,c.filename(this.props.files[0].fq_path)),buttonComponent:this.renderButtons(n)},e)},t.defaultProps={onSuccess:I},t})(s.Component);t.RestoreFilesModal=_(A,["/static/css/react/file_modal-vflWIGfEt.css"]),t.showUnifiedTrashModal=C;var M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSuccess=function(e){var n=e.changesets,s=e.rollbackHints;return l.notifyDeleteSuccess(t.props.files.length,t.props.user,n,s,t.props.onUndo),t.props.onSuccess(e)},t.handleAccept=function(){var e=h.browseStore.context();return e.isNonUserRelativeContext?m.deleteFiles({files:t.props.files,context:e}):d.deleteFiles({files:t.props.files,userId:t.props.user.id,onSuccess:t.handleSuccess})},t.isRemovingSharedFolder=function(){return 1===t.props.files.length&&t.props.files[0].target_ns},t.getTitle=function(){var e=t.props.files;return e.length<1?"":1===e.length?e[0].is_dir?E._("Delete folder?"):E._("Delete file?"):E.ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},t.getContents=function(){var e=t.props.files;if(e.length<1)return"";var n=c.filename(e[0].fq_path),r=e[0].target_ns;if(null!=t.props.parentSharedFolderName){var o=t.props.parentSharedFolderName;return 1===e.length?g.reactFormat(E._("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"),{filename:n,shared_folder_name:o,b:s.createElement("b",null)}):E.ungettext("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:o})}return 1===e.length&&r&&!h.browseStore.context().isNonUserRelativeContext?g.reactFormat(E._("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."),{filename:n,b:s.createElement("b",null)}):1===e.length?g.reactFormat(E._("Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"),{filename:n,b:s.createElement("b",null)}):E.ungettext("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length})},t}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(f.Modal,{ref:"modal",title:this.getTitle(),onAccept:this.handleAccept,acceptButtonText:this.isRemovingSharedFolder()&&!h.browseStore.context().isNonUserRelativeContext?E._("Remove"):E._("Delete"),dismissButtonText:E._("Cancel")},this.getContents())},t.defaultProps={onSuccess:I,parentSharedFolderName:null},t})(s.Component);t.DeleteFileModal=M;var N=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptAndCloseModal=function(){t.handleAccept(),f.Modal.close()},t.upgradeRedirect=function(){var e=new b({path:"/plans",query:{trigger:"nr",tk:"oq_delete_modal"}});v.redirect(e.toString())},t}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(f.Modal,{ref:"modal",title:this.getTitle(),onAccept:this.handleAccept,buttonComponent:this.renderButtons(),acceptButtonText:this.isRemovingSharedFolder()?E._("Remove"):E._("Delete"),dismissButtonText:E._("Cancel")},this.getContents(),this.renderAdditionalContent())},t.prototype.renderAdditionalContent=function(){var e=this.props.files;return null==(null!=e?e.length:void 0)||e.length<1?"":e[0].target_ns&&1===e.length&&!h.browseStore.context().isNonUserRelativeContext?s.createElement("div",{className:"u-mar-top-s"},E._("Or, get more space for your files when you upgrade your account.")):!e[0].target_ns||e.length>1?s.createElement("span",{className:"oq-delete-file-modal-upsell__additional-text"},E._("Instead, get more space for your files when you upgrade your account.")):void 0},t.prototype.renderButtons=function(){return s.createElement("div",{className:"oq-delete-file-modal-upsell__buttons"},s.createElement("button",{className:"button-primary db-modal-button",onClick:this.upgradeRedirect,ref:"primaryButton"},E._("Upgrade")),s.createElement("button",{className:"button-tertiary db-modal-button u-mar-left-s",onClick:this.handleAcceptAndCloseModal,ref:"secondaryButton"},this.isRemovingSharedFolder()?E._("Remove"):E._("Delete")))},t})(M);t.ExpOQDeleteFileModal=N;var k=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAccept=function(){var e=t.props.files[0].fq_path;y.asyncGoToContentManagerForPath({isLimitedTeam:t.props.isLimitedTeam,containingFolder:c.parent_dir(e),filenameToSelect:c.filename(e),isCDM:!1})},t}return n.__extends(t,e),t.prototype.getModalMessage=function(){return"archive"===this.props.type?E._("You can archive team folders in the Admin Console."):"rename"===this.props.type?E._("You can rename team folders in the Admin Console."):void 0},t.prototype.render=function(){return s.createElement(f.Modal,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:E._("Go to Admin Console"),altAction:s.createElement("a",{onClick:function(){return f.Modal.close()}},E._("Cancel")),width:350,showX:!1,className:"content-manager-bridge-modal"},this.getModalMessage())},t})(s.Component);t.ContentManagerBridgeModal=k;var P=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptClick=function(){t.props.userIsSuperAdmin&&t.props.userIsSameTeam&&y.asyncGoToContentManagerForPath({isLimitedTeam:!1,containingFolder:t.props.folderPath,isCDM:!0})},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.userIsSuperAdmin&&this.props.userIsSameTeam,t="";return t=e?E._("You aren’t a member of this folder. However, as an admin, you can access it via the content tab in the Admin Console."):this.props.userIsSameTeam?E._("You don’t have permission to open the folder “%(folder_name)s”. Contact your <admin_link>team admins</admin_link> to gain access."):E._("You don’t have permission to open the folder “%(folder_name)s”."),s.createElement(f.Modal,{ref:"modal",style:"default",acceptButtonText:e?E._("Go to the content tab"):E._("Done"),dismissButtonText:e?E._("Cancel"):null,onAccept:this.handleAcceptClick,title:E._("No access to the folder “%(folder_name)s”").format({folder_name:a.em_snippet(this.props.folderName,S.SNIPPET_SIZES.FILENAME)})},s.createElement("div",null,g.reactFormat(t,{folder_name:a.em_snippet(this.props.folderName,S.SNIPPET_SIZES.FILENAME),admin_link:s.createElement("a",{href:"/team?_tk=left_nav_team",target:"_blank",key:"admin_link",rel:"noopener noreferrer"})})))},t})(s.Component);t.NoAccessFolderModal=P;var R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptAndCloseModal=function(){t.props.onAccept(),f.Modal.close()},t}return n.__extends(t,e),t.prototype.render=function(){var e=E._("If you make this move, you'll no longer be the owner of some of the folders.");return s.createElement(f.Modal,{ref:"modal",style:"default",onAccept:this.handleAcceptAndCloseModal,acceptButtonText:E._("Move items anyways"),dismissButtonText:E._("Cancel"),title:E._("Move items?")},s.createElement("div",null,e))},t})(s.Component);t.ConfirmOwnershipTransferModal=R;var L=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAccept=function(){n.state.fswIndex+1===n.props.fsws.length?(n.getCurrentFSW().blocking||n.props.onFinalAccept(),n.setState({isModalOpen:!1})):n.setState({fswIndex:n.state.fswIndex+1})},n.handleCancel=function(){n.setState({isModalOpen:!1})},n.redirectToLearnMoreLink=function(){v.open_tab(n.getCurrentFSW().learn_more)},n.cancelButtonCreator=function(e){return n.getCurrentFSW().blocking?s.createElement("span",null):s.createElement(r.Button,{onClick:e,variant:"secondary"},E._("Cancel"))},n.state={isModalOpen:!0,fswIndex:0},n}return n.__extends(t,e),t.prototype.getCurrentFSW=function(){return this.props.fsws[this.state.fswIndex]},t.prototype.render=function(){if(this.state.fswIndex>this.props.fsws.length)return null;var e=this.getCurrentFSW();return s.createElement(o.UtilityModal,{ariaLabel:e.title,className:"fsw-modal",link:E._("Learn more"),onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleAccept,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,overlayClassName:"fsw-modal--overlay",primaryAction:e.blocking?E._("Okay"):this.props.confirmText,secondaryAction:this.cancelButtonCreator,title:e.title},e.text)},t})(s.Component);t.FileSystemWarningsModalWithoutCSS=L,t.FileSystemWarningsModal=_(L,["/static/css/react/file_modal-vflWIGfEt.css"])}),define("modules/clean/react/file_viewer/empty_seen_state_facepile",["require","exports","tslib","external/classnames","external/react","modules/clean/react/pass/constants"],function(e,t,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.facepileClassName=function(){return s((e={},e[o.FACEPILE_CLASSNAME]=!0,e[o.PRESENCE_RECEIVED_CLASSNAME]=this.props.hasPresence,e));var e},t.prototype.render=function(){return r.createElement("div",{className:this.facepileClassName()})},t.displayName="EmptySeenStateFacepile",t.defaultProps={hasPresence:!1},t})(r.Component);t.EmptySeenStateFacepile=i}),define("modules/clean/react/file_viewer/seen_state_coachmark",["require","exports","tslib","external/react","modules/clean/react/file_viewer/coach_mark","modules/clean/react/pass/data_helpers","modules/clean/react_format","modules/clean/zendesk_feedback","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.getCoachmarkCompletion=function(e){"none"!==e?n.setState({coachmarkType:e,showCoachmark:!0}):n.setState({showCoachmark:!1})},n.onCoachmarkButtonClick=function(){"feedback"===n.state.coachmarkType&&a.showPASSFeedbackForm(),n.setState({showCoachmark:!1}),o.SeenStateHelpers.logCoachmarkInteraction(n.props.userId,n.props.file.ns_id,n.props.file.sjid,n.props.url,n.state.coachmarkType,"accepted")},n.onCoachmarkClose=function(){n.setState({showCoachmark:!1}),o.SeenStateHelpers.logCoachmarkInteraction(n.props.userId,n.props.file.ns_id,n.props.file.sjid,n.props.url,n.state.coachmarkType,"dismissed")},n.onCoachmarkLearnMoreClick=function(){o.SeenStateHelpers.logCoachmarkInteraction(n.props.userId,n.props.file.ns_id,n.props.file.sjid,n.props.url,n.state.coachmarkType,"learn_more")},n.renderFeedbackCoachmark=function(){if(n.props.shouldShowFeedbackCoachmark){var e=l._("Help us improve Dropbox by answering a few questions.");return s.createElement("div",{className:"feedback-coach-mark"},s.createElement(r.CoachMark,{title:l._("Have a moment?"),buttonText:l._("Give feedback"),onButtonClick:n.onCoachmarkButtonClick,showClose:!0,arrowPosition:r.ARROW_POSITION.TOP,onCloseButtonClick:n.onCoachmarkClose},e))}return s.createElement("div",null)},n.renderPresenceCoachmark=function(){var e=i.reactFormat(l._("Get more visibility into shared files by seeing when collaborators view. <a>Learn more</a>"),{a:s.createElement("a",{className:"plain-link",href:"https://www.dropbox.com/help/9262",target:"_blank",rel:"noopener noreferrer",onClick:n.onCoachmarkLearnMoreClick})});return s.createElement("div",{className:"presence-coach-mark"},s.createElement(r.CoachMark,{title:l._("New! See who’s viewing this file"),buttonText:l._("Got it"),arrowPosition:r.ARROW_POSITION.TOP,onButtonClick:n.onCoachmarkButtonClick},e))},n.renderSeenStateCoachmark=function(){var e=i.reactFormat(l._("Get more visibility into shared files by seeing when collaborators view. <a>Learn more</a>"),{a:s.createElement("a",{className:"plain-link",href:"https://www.dropbox.com/help/9262",target:"_blank",rel:"noopener noreferrer",onClick:n.onCoachmarkLearnMoreClick})});return s.createElement("div",{className:"seen-state-coach-mark"},s.createElement(r.CoachMark,{title:l._("New! See who’s viewed this file"),buttonText:l._("Got it"),arrowPosition:r.ARROW_POSITION.TOP,onButtonClick:n.onCoachmarkButtonClick},e))},n.state={coachmarkType:"none",showCoachmark:!1},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){o.SeenStateHelpers.getCoachmark(this.props.userId,this.props.file.ns_id,this.props.file.sjid,this.props.url,this.getCoachmarkCompletion)},t.prototype.render=function(){if(!this.state.showCoachmark)return s.createElement("div",null);switch(this.state.coachmarkType){case"presence":return this.renderPresenceCoachmark();case"seen_state":return this.renderSeenStateCoachmark();case"feedback":return this.renderFeedbackCoachmark();default:return s.createElement("div",null)}},t.displayName="SeenStateCoachmark",t})(s.Component);t.SeenStateCoachmark=c}),define("modules/clean/react/file_viewer/seen_state_facepile",["require","exports","tslib","external/classnames","external/react","external/underscore","jquery","modules/clean/components/loading_indicator","modules/clean/loggers/pass_facepile_logger","modules/clean/react/css","modules/clean/react/file_viewer/empty_seen_state_facepile","modules/clean/react/file_viewer/seen_state_coachmark","modules/clean/react/file_viewer/share_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/pass/avatars","modules/clean/react/pass/constants","modules/clean/react/pass/event_emitter","modules/clean/react/pass/types","modules/clean/viewer","external/immutable","modules/clean/react/size_class/constants"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=(function(e){function t(t){var n=e.call(this,t)||this;return n.numUsersToLog=0,n.hasDisplayedAvatars=!1,n.hasPassShownBeenLogged=!1,n.state={hasHoveredOver:!1,loadedPhotoUrls:S.Set(),newPresentUserIds:[]},n.onAvatarHover=n.onAvatarHover.bind(n),n.onAvatarClick=n.onAvatarClick.bind(n),n.onAvatarImageLoad=n.onAvatarImageLoad.bind(n),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.resetLogging(),l.passFacepileLogger.listenTo(f.passEventEmitter)},t.prototype.componentDidMount=function(){this.logFacepileShownEvents()},t.prototype.componentWillReceiveProps=function(e){if(h.areFilesEqual(this.props.file,e.file)){if(null==e.presence||null==this.props.presence)return;var t=o.difference(e.presence,this.props.presence),n=o.difference(this.props.presence,e.presence);this.updateNewPresentUserIds(t,n)}else this.setState({newPresentUserIds:[]}),this.resetLogging()},t.prototype.componentDidUpdate=function(e){this.logFacepileShownEvents()},t.prototype.componentWillUnmount=function(){return l.passFacepileLogger.unlistenTo(f.passEventEmitter),i(window).off("resize.facepile")},t.prototype.updateNewPresentUserIds=function(e,t){var n=o.filter(this.state.newPresentUserIds,function(e){return t.indexOf(e)===-1});this.setState({newPresentUserIds:e.concat(n)})},t.prototype.computeOverflowBasis=function(e){if(!this.props.uniqueMemberCountInfo.data)return e.length;var t=this.props.uniqueMemberCountInfo.data;return e.forEach(function(e){e.incrementOverflowBasis&&++t}),Math.max(t,e.length)},t.prototype.resetLogging=function(){this.numUsersToLog=0,this.hasPassShownBeenLogged=!1,this.hasDisplayedAvatars=!1},t.prototype.logFacepileShownEvents=function(){if(this.props.presence&&this.hasDisplayedAvatars&&!this.hasPassShownBeenLogged){var e=_.EventTypes.PASS_SHOWN;this.logPassEvent(e),this.hasPassShownBeenLogged=!0}},t.prototype.logPassEvent=function(e){var t=null!=this.props.uniqueMemberCountInfo.data?Math.max(this.numUsersToLog,this.props.uniqueMemberCountInfo.data):this.numUsersToLog,n=this.props.passPermissions?this.props.passPermissions.canReadSeenState:null,s=this.props.anonymousPresenceInfo.length,r=this.getViewerCountByAccessLevel(),o=r.numViewers,i=r.numInTeamEditors,a=r.numInTeamViewers,l=r.numNonTeamEditors,c=r.numNonTeamViewers;return f.passEventEmitter.emit(e,this.props.fromBrowse,this.props.file,{numAccessors:t,numViewers:o,numCurrentViewers:this.getNumCurrentViewers(),canSeeViewerHistory:n,numGuests:s,numInTeamEditors:i,numInTeamViewers:a,numNonTeamEditors:l,numNonTeamViewers:c})},t.prototype.getViewerCountByAccessLevel=function(){var e,t,n=this,s=0,r=0,o=0,i=0;if(this.shouldHardcodeCurrentViewer()){t=this.seenStateDataWithViewerFiltered(this.getSeenStates());var a=this.getSeenStates().filter(function(e){return e.seen_state_user.user_id===n.props.user.account_id});if(a.length>0){e=0;var l=a[0];l.when_last_seen=1,t.push(l)}else e=1,s++}else e=0,t=this.getSeenStates();for(var c=0,u=t;c<u.length;c++){var d=u[c];if(null!=d.when_last_seen){e++;var p=d.seen_state_user;p.in_owners_team?p.sharing_access_type&&"edit_member_access"===p.sharing_access_type.type?s++:r++:p.sharing_access_type&&"edit_member_access"===p.sharing_access_type.type?o++:i++}}return{numViewers:e,numInTeamEditors:s,numInTeamViewers:r,numNonTeamEditors:o,numNonTeamViewers:i}},t.prototype.getNumCurrentViewers=function(){var e=this;if(!this.props.presence)return 0;if(this.shouldHardcodeCurrentViewer()){return 1+this.props.presence.filter(function(t){return t!==e.props.user.account_id}).map(function(e){return e}).length}return this.props.presence.length},t.prototype.userIsAnonymous=function(e){return o.map(this.props.anonymousPresenceInfo,function(e){return e.seen_state_user.user_id}).indexOf(e.user_id)>=0},t.prototype.userIsOnline=function(e){return null!=this.props.presence&&this.props.presence.indexOf(e.user_id)>=0},t.prototype.onAvatarHover=function(){var e=this,t=_.EventTypes.PASS_HOVER;setTimeout(function(){return e.setState({hasHoveredOver:!0})},1e3),this.setState({}),this.logPassEvent(t)},t.prototype.onAvatarClick=function(){var e=this.props.fromBrowse?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE",t=_.EventTypes.PASS_CLICK;this.logPassEvent(t),p.share(this.props.file,y.get_viewer().get_user_by_id(this.props.user.id),this.props.url||null,e)},t.prototype.onAvatarImageLoad=function(e){this.setState({loadedPhotoUrls:this.state.loadedPhotoUrls.add(e)})},t.prototype.buildUserInfo=function(e){var t=e.seen_state_user,n=e.when_last_seen,s=t.access_level,r=t.display_name,o=t.photo_circle_url,i=t.sharing_access_type,a=t.user_id,l=a||r,c=void 0!==i&&"link_only"===i.type;return new g.UserInfo(l,r,this.userIsOnline(t),!1,c,s,n,o,a)},t.prototype.seenStateDataWithViewerFiltered=function(e){var t=this;return o.filter(e,function(e){return e.seen_state_user.user_id!==t.props.user.account_id})},t.prototype.partitionUserInfoLists=function(e){for(var t=[],n=[],s=[],r=[],o=[],i={},a=0,l=e;a<l.length;a++){var c=l[a],u=this.buildUserInfo(c);this.userIsOnline(c.seen_state_user)?this.isNewPresentUser(u)?i[u.key]=u:this.userIsAnonymous(c.seen_state_user)?s.push(u):n.push(u):null!=c.when_last_seen?r.push(u):o.push(u)}for(var d=0,p=this.state.newPresentUserIds;d<p.length;d++){var h=p[d],u=i[h];u&&t.push(u)}return{newPresentUserInfoList:t,presentUserInfoList:n,anonymousUserInfoList:s,offlineUserInfoList:r,neverViewedUserInfoList:o}},t.prototype.getUserInfoList=function(){var e,t=[],n=this.getMergedSeenStateData();if(this.shouldHardcodeCurrentViewer()){e=this.seenStateDataWithViewerFiltered(n);var s=this.props.user.account_id,r=!this.props.fromBrowse&&e.length<n.length&&this.getSeenStates().some(function(e){var t=e.seen_state_user;return t.user_id===s&&"link_only"===(null!=t.sharing_access_type?t.sharing_access_type.type:void 0)}),o=y.get_viewer().get_user_by_id(this.props.user.id);t.push(new g.UserInfo(this.props.user.account_id,o.display_name,!0,!0,r,void 0,void 0,o.photo_url))}else e=n;var i=this.partitionUserInfoLists(e),a=i.newPresentUserInfoList,l=i.presentUserInfoList,c=i.anonymousUserInfoList,u=i.offlineUserInfoList,d=i.neverViewedUserInfoList;return l.sort(function(e,t){return e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())}),d.sort(function(e,t){return e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())}),t.concat(a,l,c,u,d)},t.prototype.isNewPresentUser=function(e){return this.state.newPresentUserIds.indexOf(e.key)>=0},
t.prototype.getMergedSeenStateData=function(){var e=this.getSeenStates(),t=e.map(function(e){return e.seen_state_user.user_id});if(this.props.sharingStorePassInfo.data){for(var n=0,s=this.props.sharingStorePassInfo.data.users;n<s.length;n++){var r=s[n],o=r.seen_state_user.user_id;t.indexOf(o)!==-1||o===this.props.user.account_id&&this.shouldHardcodeCurrentViewer()||e.push(r)}return e.concat(this.props.anonymousPresenceInfo,this.props.sharingStorePassInfo.data.invitees)}return e.concat(this.props.anonymousPresenceInfo)},t.prototype.shouldHardcodeCurrentViewer=function(){var e=!(y.get_viewer().is_assume_user_session||this.props.fromBrowse),t=null!=this.props.presence&&this.props.presence.indexOf(this.props.user.account_id)>=0;return e||t},t.prototype.getSeenStates=function(){return this.props.identifiedSeenStateInfo&&this.props.identifiedSeenStateInfo.seen_states?this.props.identifiedSeenStateInfo.seen_states.slice():[]},t.prototype.haveSeenStateDataToShow=function(e){var t=e.length;return t>=2||1===t&&e[0].key!==this.props.user.account_id},t.prototype.allDataHasLoaded=function(){return _.fetchingStatusSeenStateIsComplete(this.props.passFetchingStatus)&&this.props.sharingStorePassInfo.isLoaded&&this.props.uniqueMemberCountInfo.isLoaded},t.prototype.getEffectiveSizeClass=function(){var e=this.props,t=e.fromBrowse,n=e.sizeClass;return t?v.SizeClass.Large:n},t.prototype.render=function(){var e=this.getEffectiveSizeClass();if(e===v.SizeClass.Small||this.props.isPassPermissionsPending||this.props.passFetchingStatus===_.PASS_FETCHING_STATUS.ERROR||null==this.props.passPermissions||!this.props.passPermissions.canReadPresence&&!this.props.passPermissions.canReadSeenState)return this.renderEmptyFacepile();if(!this.allDataHasLoaded())return this.props.fromBrowse?r.createElement(a,{style:a.LoadingIndicatorStyle.DOTS}):r.createElement("div",null);var t=[],n=e===v.SizeClass.Medium?_.MAX_FACES_COMPACT:_.MAX_FACES_NORMAL,s=this.getUserInfoList();if(this.numUsersToLog=s.length,this.haveSeenStateDataToShow(s)){t=this.renderUserAvatars(s,n);var o=this.computeOverflowBasis(s),i=o>n;if(i&&--n,t=this.renderUserAvatars(s,n),i){var l=o-n;t.push(r.createElement(m.OverflowAvatar,{key:"overflow-avatar",moreFacepileCount:l,onMouseEnter:this.onAvatarHover}))}}return t.length?(this.hasDisplayedAvatars=!0,this.renderAvatarsInReverse(t)):this.renderEmptyFacepile()},t.prototype.renderEmptyFacepile=function(){return r.createElement(u.EmptySeenStateFacepile,{hasPresence:null!=this.props.presence})},t.prototype.facepileClassName=function(){return s((e={},e[_.FACEPILE_CLASSNAME]=!0,e[_.PRESENCE_RECEIVED_CLASSNAME]=null!=this.props.presence,e));var e},t.prototype.renderUserAvatars=function(e,t){for(var n=[],s=0,o=0,i=e;o<i.length;o++){var a=i[o];if(s===t)break;var l=a.key,c=a.photoUrl;c&&!this.state.loadedPhotoUrls.contains(c)||s++;var u=c?this.onAvatarImageLoad:void 0;n.push(r.createElement(m.UserAvatar,{key:l,userInfo:a,onMouseEnter:this.onAvatarHover,onLoad:u}))}return n},t.prototype.renderAvatarsInReverse=function(e){e.reverse();var t=r.createElement("div",null);return e.length>=2&&!this.props.fromBrowse&&(t=r.createElement("div",{className:"seen-state-coach-mark__container"},r.createElement(d.SeenStateCoachmark,{file:this.props.file,userId:this.props.user.id,shouldShowFeedbackCoachmark:this.state.hasHoveredOver,url:this.props.url}))),r.createElement("div",{className:"react-pass__facepile-padding"},r.createElement("div",{className:"react-pass__facepile-wrap"},t,r.createElement("div",{className:this.facepileClassName(),onClick:this.onAvatarClick},e)))},t.displayName="SeenStateFacepile",t})(r.Component);t.SeenStateFacepile=c(E,["/static/css/seen_state_facepile-vflYQCTDa.css"])}),define("modules/clean/react/file_viewer/seen_state_facepile_controller",["require","exports","tslib","external/react","modules/clean/react/file_viewer/empty_seen_state_facepile","modules/clean/react/file_viewer/seen_state_facepile","modules/clean/react/file_viewer/utils","modules/clean/react/pass/constants","modules/clean/react/pass/data_helpers","modules/clean/react/pass/store","modules/clean/react/pass/types","modules/clean/sharing/stores/sharing_info","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.state=n.getStateFromStore(),n.boundUpdate=n.onUpdateFromStore.bind(n),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){c.passStore.add_change_listener(this.boundUpdate),d.sharingInfoStore.add_change_listener(this.boundUpdate),l.PassHelpers.setup({user:this.props.user,fileData:this.getPassFileData(),prevFileData:null,shouldWritePresence:this.shouldRegisterPresence()})},t.prototype.componentWillReceiveProps=function(e){i.areFilesEqual(e.file,this.props.file)||this.setState({passInfo:{anonymousPresence:null,isPassPermissionsPending:!0,passFetchingStatus:a.PASS_FETCHING_STATUS.FETCHING,passPermissions:null,presence:null,identifiedSeenStateInfo:null,userIdsWithoutSeenStateInfo:[]},sharingInfo:void 0})},t.prototype.componentWillUpdate=function(e,t){var n=t.passInfo;if(n.userIdsWithoutSeenStateInfo.length>0&&a.fetchingStatusIsSuccessful(n.passFetchingStatus)&&e.user){var s=e.file;l.SeenStateHelpers.fetchSeenStateUsers(e.user.id,n.identifiedSeenStateInfo,n.userIdsWithoutSeenStateInfo,s.ns_id,s.sjid)}},t.prototype.componentDidUpdate=function(e){if(!i.areFilesEqual(this.props.file,e.file)){var t={file:e.file,url:this.urlFromProps(e)};l.PassHelpers.setup({user:this.props.user,fileData:this.getPassFileData(),prevFileData:t,shouldWritePresence:this.shouldRegisterPresence()})}},t.prototype.componentWillUnmount=function(){c.passStore.remove_change_listener(this.boundUpdate),d.sharingInfoStore.remove_change_listener(this.boundUpdate),l.PassHelpers.teardown({user:this.props.user,fileData:this.getPassFileData(),async:this.shouldRegisterPresence()})},t.prototype.onUpdateFromStore=function(){this.setState(this.getStateFromStore())},t.prototype.getStateFromStore=function(){var e=this.props,t=e.user,n=e.file,s=n.file_id,r=n.ns_id,o=n.sjid;return{passInfo:{anonymousPresence:c.passStore.anonymousPresence(r,o),isPassPermissionsPending:c.passStore.isPassPermissionsPending(s),passFetchingStatus:c.passStore.passFetchingStatus(r,o),passPermissions:c.passStore.getPassPermissions(s),presence:c.passStore.presence(this.props.file.ns_id,this.props.file.sjid),identifiedSeenStateInfo:c.passStore.identifiedSeenStateInfo(r,o),userIdsWithoutSeenStateInfo:c.passStore.userIdsWithoutSeenStateInfo(r,o)},sharingInfo:t&&d.sharingInfoStore.getSharingInfo(t.id,s)||void 0}},t.prototype.getAnonymousPassInfo=function(){return null==this.state.passInfo.anonymousPresence?[]:this.state.passInfo.anonymousPresence.map(function(e){return{seen_state_user:{user_id:e,display_name:p._("Guest")},seen_events:[]}})},t.prototype.getMemberInfosInPassFormat=function(e){return{invitees:this.getInviteeMemberInfos(e),users:this.getUserMemberInfos(e)}},t.prototype.getUserMemberInfos=function(e){return e.members().get("users").valueSeq().toArray().map(function(e){return{seen_state_user:{user_id:e.account_id,display_name:e.account?e.account.display_name:null,photo_url:e.account?e.account.profile_photo_url:null,access_level:e.access_type},seen_events:[]}})},t.prototype.getInviteeMemberInfos=function(e){return e.members().get("invitees").valueSeq().toArray().map(function(e){return{seen_state_user:{display_name:e.contact,access_level:e.access_type},seen_events:[]}})},t.prototype.getPassFileData=function(){return{file:this.props.file,url:this.urlFromProps()}},t.prototype.shouldRegisterPresence=function(){return!this.props.fromBrowse},t.prototype.urlFromProps=function(e){return void 0===e&&(e=this.props),e.sharedLinkInfo?e.sharedLinkInfo.url:void 0},t.prototype.getPropsFromPassInfo=function(){return{anonymousPresenceInfo:this.getAnonymousPassInfo(),isPassPermissionsPending:this.state.passInfo.isPassPermissionsPending,passFetchingStatus:this.state.passInfo.passFetchingStatus,passPermissions:this.state.passInfo.passPermissions,presence:this.state.passInfo.presence,identifiedSeenStateInfo:this.state.passInfo.identifiedSeenStateInfo}},t.prototype.getPropsFromSharingInfo=function(){var e={uniqueMemberCountInfo:u.FacepileInfo.createNotLoaded(),sharingStorePassInfo:u.FacepileInfo.createNotLoaded()};return this.state.sharingInfo?(null!=this.state.sharingInfo.memberCounts()&&(e.uniqueMemberCountInfo=u.FacepileInfo.create(this.state.sharingInfo.memberCounts().total_unique_users)),this.state.sharingInfo.hasDisplayableMembers()&&(e.sharingStorePassInfo=u.FacepileInfo.create(this.getMemberInfosInPassFormat(this.state.sharingInfo))),e):e},t.prototype.getPropsFromController=function(){var e=this.props,t=e.file,n=e.fromBrowse,s=e.sizeClass,r=e.user;return{file:t,fromBrowse:n,sizeClass:s,url:this.urlFromProps(),user:r}},t.prototype.render=function(){if(null==this.props.user)return s.createElement(r.EmptySeenStateFacepile,null);var e=n.__assign({},this.getPropsFromPassInfo(),this.getPropsFromSharingInfo(),this.getPropsFromController());return s.createElement(o.SeenStateFacepile,n.__assign({},e))},t.displayName="SeenStateFacepileController",t})(s.Component);t.SeenStateFacepileController=h}),define("modules/clean/react/file_viewer/share_helpers",["require","exports","modules/clean/previews/util","modules/clean/react/file_viewer/utils"],function(e,t,n,s){"use strict";function r(t,r,o,i){e(["modules/clean/sharing/share_modal_util"],function(e){var a={beaconContext:t.beacon_context,filename:n.get_filename(t),isFolder:!1,nsId:t.ns_id,origin:i,sjid:t.sjid,url:o};s.isBrowseFile(t)&&(a.fqPath=t.fq_path),null!=t.file_id&&(a.fileId=t.file_id),e.showShareModal(r,a)})}Object.defineProperty(t,"__esModule",{value:!0}),t.share=r}),define("modules/clean/react/home/resource_id_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_RESOURCE_ID_TYPE={ENCODED_FILE_OBJ_ID:"ENCODED_FILE_OBJ_ID",FQ_PATH:"FQ_PATH",PAPER_DOCUMENT_ID_PATH:"PAPER_DOCUMENT_ID_PATH",PAPER_FOLDER_ID_PATH:"PAPER_FOLDER_ID_PATH",EXTERNAL_RESOURCE_ID:"EXTERNAL_RESOURCE_ID"}}),define("modules/clean/react/overquota_modal",["require","exports","tslib","external/react","external/spectrum/tertiary_link","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/static_urls","modules/clean/react/modal","modules/constants/payments"],function(e,t,n,s,r,o,i,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._dismiss=function(){c.Modal.close()},t}return n.__extends(t,e),t.prototype._renderButtons=function(){var e=u.OUT_OF_SPACE_URL+"?oqa="+this.props.oqa;return s.createElement(c.ModalButtons,{className:"oq-modal__buttons"},s.createElement("a",{href:e,id:"oq-cta-button",className:"mc-button mc-button-primary"},a._("Get more space")))},t.prototype._renderAltAction=function(){return this.props.dismissText?s.createElement("div",{className:"overquota_modal__alt-action-container"},s.createElement(r.TertiaryLink,{onClick:this._dismiss},this.props.dismissText)):null},t.prototype._renderContentTitle=function(){return s.createElement("p",{className:"oq-modal__content--title"},a._("Your Dropbox is full"))},t.prototype._renderImage=function(){return s.createElement(i,{src:l.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:l.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})},t.prototype.render=function(){return s.createElement(c.Modal,{className:"overquota_modal",title:a._("Your Dropbox is full"),buttonComponent:this._renderButtons(),altAction:this._renderAltAction(),style:"clean",showX:!0},s.createElement("div",{className:"oq-modal__content"},this._renderImage(),this._renderContentTitle(),s.createElement("p",null,this.props.tagline)))},t.defaultProps={tagline:a._("Before you can update or move your files, you need more space."),oqa:"upl_f"},t})(s.Component);t.OverquotaModalElement=d,t.OverquotaModal=o(d,["/static/css/react/overquota_modal-vflG9lYFj.css"])}),define("modules/clean/react/pass/action_timestamps",["require","exports","modules/clean/react/pass/constants","modules/core/exception"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[n.LoggingActions.PRESENCE_RECEIVE,n.LoggingActions.TRANSMITTER_TOKEN_BEGIN,n.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,n.LoggingActions.RECEIVER_TOKEN_BEGIN,n.LoggingActions.RECEIVER_TOKEN_RECEIVE],o=(function(){function e(){this.allTimestamps={}}return e.prototype.record=function(e,t){if(t){var n=(new Date).getTime()/1e3;this.allTimestamps[t]=this.allTimestamps[t]||{};var s=this.allTimestamps[t];s.hasOwnProperty(e)?this.reportStackForRepeatedAction(s,e,t,n):s[e]=n}},e.prototype.get=function(e){return e?this.allTimestamps[e]||{}:{}},e.prototype.reportStackForRepeatedAction=function(e,t,n,o){if(!(r.indexOf(t)>=0)){var i=e[t];s.reportStack("Attempted to record action for which there existed a previous record",{severity:s.SEVERITY.NONCRITICAL,tags:["pass:actionTimestampsTracker"],exc_extra:{preview_session_id:n,action:t,oldTimestamp:i,newTimestamp:o}})}},e})();t.ActionTimestampsTracker=new o}),define("modules/clean/react/pass/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/constants"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){}return e.passPermissionRequest=function(e,t,r){n.dispatch({type:s.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e,nsId:t,sjid:r}})},e.setPassPermissions=function(e,t){n.dispatch({type:s.ActionTypes.SET_PASS_PERMISSIONS,data:{fileId:e,passPermissionObject:t}})},e.fetchPassError=function(e,t){n.dispatch({type:s.ActionTypes.FETCH_PASS_ERROR,data:{nsId:e,sjid:t}})},e.fetchPassConcluded=function(e,t){n.dispatch({type:s.ActionTypes.FETCH_PASS_CONCLUDED,data:{nsId:e,sjid:t}})},e.receivePresenceDelta=function(e,t,r,o,i){n.dispatch({type:s.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,nsId:t,sjid:r,onlineUniqueUsers:o,offlineUniqueUsers:i}})},e.receivePresenceSnapshot=function(e,t,r,o){n.dispatch({type:s.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,nsId:t,sjid:r,onlineUniqueUsers:o}})},e.resetPassInfo=function(e,t){n.dispatch({type:s.ActionTypes.RESET_PASS_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateInfo=function(e,t,r,o){n.dispatch({type:s.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:t,seenStateInfo:r,seenStateCursor:o}})},e.updateSeenStateInfoContinue=function(e,t,r,o){n.dispatch({type:s.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{nsId:e,sjid:t,seenStateInfo:r,seenStateCursor:o}})},e.discontinueSeenStateInfo=function(e,t){n.dispatch({type:s.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateUnavailable=function(e,t,r){n.dispatch({type:s.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,nsId:t,sjid:r}})},e})();t.PassActions=r}),define("modules/clean/react/pass/avatars",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/em_string","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/react_format","modules/core/browser","modules/core/user_i18n","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={loadResult:"loaded"},n}return n.__extends(t,e),t.prototype.getInitialsColor=function(){},t.prototype.render=function(){var e=this.wrapAvatarWithTooltip(),t="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return s.createElement("div",{className:t},e)},t.prototype.wrapAvatarWithTooltip=function(){return s.createElement(p,{content:this.getTooltipElement(),position:p.POSITIONS.BOTTOM,distanceFromTarget:9,isTargetPositionFixed:!0,onMouseEnter:this.props.onMouseEnter,className:this.getTooltipClass(),backgroundColor:this.getInitialsColor()},s.createElement("button",{className:"pass-facepile-avatar"},this.getAvatar()))},t})(s.Component),y=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={loadResult:null==n.props.userInfo.photoUrl?"loaded":"pending"},n.boundOnLoad=n.onFinalize.bind(n,!0),n.boundOnError=n.onFinalize.bind(n,!1),n}return n.__extends(t,e),t.prototype.offlineTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s",{comment:'Format like "userName <newline> Viewed 5 days ago"'}).replace("%(ago)s",l.ago(1e3*this.props.userInfo.whenLastSeen,!1,!0,!0))},t.prototype.onlineTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Viewing now",{comment:'Format like "user_name <newline> Viewing now"'})},t.prototype.accessNameTooltipTemplate=function(e){switch(e){case"owner":return f._("<b>%(user_name)s</b> <newline/> Owner",{comment:'Format like "user_name <newline> Owner"'});case"writer":return f._("<b>%(user_name)s</b> <newline/> Can edit",{comment:'Format like "user_name <newline> Can edit"'});case"reader":return f._("<b>%(user_name)s</b> <newline/> Can comment",{comment:'Format like "user_name <newline> Can comment"'});case"reader_no_comment":case void 0:return f._("<b>%(user_name)s</b> <newline/> Can view",{comment:'Format like "user_name <newline> Can view"'})}},t.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&d.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},t.prototype.getUserAvatarProps=function(){var e=this.props.userInfo,t=e.displayName,r=e.isActive,i=this.isGuestAvatar()?d.AnonymousViewerUtils.getAnonymousViewerInitials(t):_.getInitials(t),a={dimension:32,initials:i,color:this.getInitialsColor(),shape:"CIRCLE"};r||(a.optionalClass="c-avatar--inactive",m.msie&&(a.color="#7B8994"));var l=s.createElement(o,n.__assign({},a));return r||(l=s.createElement("span",{className:"c-avatar-initials-wrapper"},l)),{dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:l,optionalClass:a.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},t.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},t.prototype.getAvatar=function(){var e=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?s.createElement(a,n.__assign({},e)):s.createElement(r,n.__assign({},e))},t.prototype.onFinalize=function(e){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:e?"loaded":"error"});var t=this.props,n=t.userInfo.photoUrl,s=t.onLoad;s&&n&&s(n)}},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble"},t.prototype.getInitialsColor=function(){return this.isGuestAvatar()?i.colorValueForAvatarName(this.props.userInfo.userId):i.colorValueForAvatarName(this.props.userInfo.displayName)},t.prototype.getTooltipElement=function(){var e;e=this.props.userInfo.isActive?this.onlineTooltipTemplate():null!=this.props.userInfo.whenLastSeen?this.offlineTooltipTemplate():this.accessNameTooltipTemplate(this.props.userInfo.accessLevel);var t=h.reactFormat(e,{user_name:c.em_snippet(this.props.userInfo.displayName,10),b:s.createElement("b",{key:"thebold"}),newline:s.createElement("br",{key:"thenewline"})});return s.createElement("span",null,t)},t})(g);t.UserAvatar=y;var S=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},t.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},t.prototype.getAvatar=function(){return s.createElement(o,{dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble facepile-overflow"},t.prototype.getTooltipElement=function(){return f.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},t})(g);t.OverflowAvatar=S}),define("modules/clean/react/pass/constants",["require","exports"],function(e,t){"use strict";function n(e){return[i.SEEN_STATE_SUCCESS,i.SEEN_STATE_DISALLOWED,i.PASS_SUCCESS,i.PASS_MIXED_SUCCESS,i.CONCLUDED].indexOf(e)!==-1}function s(e){return[i.PASS_SUCCESS,i.PASS_MIXED_SUCCESS,i.CONCLUDED].indexOf(e)!==-1}function r(e){return[i.PASS_SUCCESS,i.PASS_MIXED_SUCCESS,i.ERROR,i.CONCLUDED].indexOf(e)!==-1}function o(e){return e===i.ERROR}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes={PASS_PERMISSION_REQUEST:"PASS_PERMISSION_REQUEST",SET_PASS_PERMISSIONS:"SET_PASS_PERMISSIONS",FETCH_PASS_CONCLUDED:"FETCH_PASS_CONCLUDED",FETCH_PASS_ERROR:"FETCH_PASS_ERROR",RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_INFO_CONTINUE:"UPDATE_SEEN_STATE_INFO_CONTINUE",DISCONTINUE_SEEN_STATE_INFO:"DISCONTINUE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_UNAVAILABLE:"FETCH_SEEN_STATE_UNAVAILABLE"},t.EventTypes={PASS_CLICK:"PASS_CLICK",PASS_SHOWN:"PASS_SHOWN",PASS_HOVER:"PASS_HOVER"},t.LoggingActions={STATUS_BEGIN:"status_begin",STATUS_RECEIVE:"status_receive",SEEN_STATE_BEGIN:"seen_state_begin",SEEN_STATE_RECEIVE:"seen_state_receive",SEEN_STATE_USERS_BEGIN:"seen_state_users_begin",SEEN_STATE_USERS_RECEIVE:"seen_state_users_receive",TRANSMITTER_TOKEN_BEGIN:"transmitter_token_begin",TRANSMITTER_TOKEN_RECEIVE:"transmitter_token_receive",RECEIVER_TOKEN_BEGIN:"receiver_token_begin",RECEIVER_TOKEN_RECEIVE:"receiver_token_receive",PRESENCE_RECEIVE:"presence_receive",MEMBER_COUNTS_BEGIN:"member_counts_begin",MEMBER_COUNTS_RECEIVE:"member_counts_receive",LIST_MEMBERS_BEGIN:"list_members_begin",LIST_MEMBERS_RECEIVE:"list_members_receive",LIST_MEMBERS_NO_SEEN_STATE:"list_members_no_seen_state"};var i;(function(e){e[e.NOT_YET_KNOWN=0]="NOT_YET_KNOWN",e[e.FETCHING=1]="FETCHING",e[e.ERROR=2]="ERROR",e[e.SEEN_STATE_SUCCESS=3]="SEEN_STATE_SUCCESS",e[e.SEEN_STATE_DISALLOWED=4]="SEEN_STATE_DISALLOWED",e[e.PRESENCE_SUCCESS=5]="PRESENCE_SUCCESS",e[e.PASS_SUCCESS=6]="PASS_SUCCESS",e[e.PASS_MIXED_SUCCESS=7]="PASS_MIXED_SUCCESS",e[e.CONCLUDED=8]="CONCLUDED"})(i=t.PASS_FETCHING_STATUS||(t.PASS_FETCHING_STATUS={})),t.fetchingStatusSeenStateIsComplete=n,t.fetchingStatusIsSuccessful=s,t.fetchingStatusIsComplete=r,t.fetchingStatusIsError=o,t.MAX_FACES_NORMAL=5,t.MAX_FACES_COMPACT=3,t.MAX_OVERFLOW_BUTTON_INDICATOR=99,t.FACEPILE_CLASSNAME="react-pass__facepile",t.PRESENCE_RECEIVED_CLASSNAME="facepile-presence-received"}),define("modules/clean/react/pass/data_helpers",["require","exports","jquery","external/underscore","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/beacon","modules/clean/previews/util","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/actions","modules/clean/react/pass/store","modules/clean/react/pass/constants","modules/clean/sharing/actions/sharing_actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C){"use strict";function I(e,t){f.PassActions.resetPassInfo(e,t),f.PassActions.fetchPassError(e,t)}function T(e,t){f.PassActions.resetPassInfo(e,t),f.PassActions.fetchPassConcluded(e,t)}function w(e,t,n,s,r,a){return e?new i.ApiV2RootAwareClient(r,a).rpc(e.id,t,s):new o.ApiV2Client(r,a).rpc(null,n,s)}function A(e){return"sjid:"+e.toString()}function M(e,t,n){return{ns_id:e,file_identifier:A(t),url:n}}Object.defineProperty(t,"__esModule",{value:!0});var N=y.MAX_FACES_NORMAL+y.MAX_OVERFLOW_BUTTON_INDICATOR+1,k=(function(){function e(){}return e.setup=function(t){var n=t.user,s=t.fileData,r=t.prevFileData,o=t.shouldWritePresence,i=void 0===o||o,a=t.limit,l=void 0===a?150:a;this.shouldInitializePass(n,i)&&setTimeout(function(){var t=s.file,o=t.file_id,a=t.ns_id,c=t.sjid;f.PassActions.passPermissionRequest(o,a,c),e.fetchPassStatus({user:n,fileData:s,prevFileData:r,shouldWritePresence:i,limit:l})},0)},e.teardown=function(e){var t=e.user,s=e.fileData,r=e.async,o=e.shouldWritePresence,i=void 0===o||o,a=s.file,l=s.url;if(this.shouldInitializePass(t,i)){var c=a.file_id,u=g.passStore.getPassPermissions(c),d=g.passStore.isPassPermissionsPending(c);if(null==u||d||!u.canWritePresence&&!u.canWriteAnonymousPresence)return;n(window).off("beforeunload.passpresence");var p=t&&t.account_id,h=new P(a,p,l);R.shutdown({beaconFileData:h,user:t,async:r,shouldWritePresence:i})}},e.shouldInitializePass=function(e,t){return d.determinePathContext()!==p.PathContext.SHARED_LINK_COLLECTION&&(null!==e||t)},e.fetchPassStatus=function(e){var t=this,n=e.user,s=e.fileData,r=e.prevFileData,o=e.shouldWritePresence,i=void 0===o||o,l=e.limit,c=void 0===l?150:l,u=s.file.ns_id,d=s.file.sjid,p=s.url,m=h.FilePreviewSession.currentSession&&h.FilePreviewSession.currentSession.id;return _.ActionTimestampsTracker.record(y.LoggingActions.STATUS_BEGIN,m),w(n,"seen_state/get_pass_status","seen_state/logged_out/get_pass_status",{file_infos:[{ns_id:u,file_identifier:A(d),url:p}]}).then(function(e){_.ActionTimestampsTracker.record(y.LoggingActions.STATUS_RECEIVE,m);var o=e[0],a={canReadPresence:o.can_read_presence,canReadSeenState:o.can_read_seen_state,canWritePresence:o.can_write_presence,canWriteAnonymousPresence:o.can_write_anonymous_presence};t.kickoffPassRequests({user:n,fileData:s,prevFileData:r,passPermissionObject:a,limit:c,previewSessionId:m,shouldWritePresence:i})}).catch(a.catchApiError(function(){I(u,d)}))},e.kickoffPassRequests=function(e){var t=this,s=e.user,r=e.fileData,o=e.prevFileData,i=e.passPermissionObject,a=e.limit,l=e.previewSessionId,c=e.shouldWritePresence,d=void 0===c||c,p=r.file,h=r.url;f.PassActions.setPassPermissions(p.file_id,i);var m=p.file_id||p.fq_path,g=s&&s.account_id,v=new P(p,g,h);if(s){if(m&&i.canReadPresence){S.SharingActions.fetchFileMemberCount({user:s,contentId:m,limit:N,countGroupsAsMembers:!1,url:h,previewSessionId:l});var E=!0;u.isPassPerfExperiment()&&(E=!1,_.ActionTimestampsTracker.record(y.LoggingActions.LIST_MEMBERS_NO_SEEN_STATE,l)),S.SharingActions.listMembers({user:s,contentId:m,isFolder:!1,limit:6,url:h,previewSessionId:l,includeSeenState:E})}i.canReadSeenState?L.fetchSeenStateInfo(s,p.ns_id,p.sjid,a,h,l):f.PassActions.updateSeenStateUnavailable(s.id,p.ns_id,p.sjid),i.canReadPresence&&R.receiveBeaconData({beaconFileData:v,user:s,previewSessionId:l})}if(d&&(i.canWritePresence||i.canWriteAnonymousPresence)){var b=o&&new P(o.file,g,o.url),C=!i.canWritePresence;R.transmitBeaconData({beaconFileData:v,prevBeaconFileData:b,accountId:g,previewSessionId:l,isAnonymous:C}),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(e){t.teardown({user:s,fileData:r,async:!1,shouldWritePresence:!0}),e.returnValue=void 0})}i.canReadPresence||i.canReadSeenState||T(p.ns_id,p.sjid)},e})();t.PassHelpers=k;var P=(function(){function e(e,t,n){var s=n||"",r=t||"";this.authKey="pass~"+r+"~"+s,this.nsId=e.ns_id,this.sjid=e.sjid,this.context=e.beacon_context}return e})();t.BeaconFileData=P;var R=(function(){function e(){}return e.shutdown=function(e){for(var t=e.beaconFileData,n=e.user,s=e.async,r=e.shouldWritePresence,o=void 0===r||r,i=[],a=0,l=[this.anonTransmitterData,this.identifiedTransmitterData];a<l.length;a++){var c=l[a];c&&(i.push([c.beaconUserId,c.identifier]),c.transmitter.stop())}delete this.anonTransmitterData,delete this.identifiedTransmitterData,i.length>0&&!E.get_viewer().is_assume_user_session&&o&&L.updateSeenStateOnResign(n,t,s,i),this.receiver&&(this.receiver.stop(),delete this.receiver)},e.receiveBeaconData=function(e){var t=this,n=e.beaconFileData,s=e.user,o=e.previewSessionId;_.ActionTimestampsTracker.record(y.LoggingActions.RECEIVER_TOKEN_BEGIN,o),r.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",dataType:"json",data:{account_id:s.account_id,auth_key:n.authKey,context:n.context},success:function(e){if(e.error)I(n.nsId,n.sjid);else{_.ActionTimestampsTracker.record(y.LoggingActions.RECEIVER_TOKEN_RECEIVE,o);var r=e.token,i=[new c.PresenceParams(c.PresenceType.Context,s.account_id,t.APP,n.context,r)];t.receiver&&t.receiver.stop(),t.receiver=new c.Receiver(i,function(e){_.ActionTimestampsTracker.record(y.LoggingActions.PRESENCE_RECEIVE,o),t.onUpdate(e,s.id,n)},function(){return t.receiveBeaconData({beaconFileData:n,user:s,previewSessionId:o})}),t.receiver.start()}}})},e.onUpdate=function(e,t,n){var s=e[0];if(s.delta){var r=this.parseBeaconUpdates(s.delta);f.PassActions.receivePresenceDelta(t,n.nsId,n.sjid,r.onlineUniqueUsers,r.offlineUniqueUsers)}else if(s.snapshot){var r=this.parseBeaconUpdates(s.snapshot);f.PassActions.receivePresenceSnapshot(t,n.nsId,n.sjid,r.onlineUniqueUsers)}},e.parseBeaconUpdates=function(e){for(var t={},n={},s=0,r=e;s<r.length;s++){var o=r[s],i=o.agent,a=i.user_id,l=i.source.identifier;o.status===C.BEACON_ONLINE_STATUS?(a in t||(t[a]={}),t[a][l]=!0):o.status===C.BEACON_OFFLINE_STATUS&&(a in n||(n[a]={}),n[a][l]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:n}},e.transmitBeaconData=function(e){var t=e.beaconFileData,n=e.prevBeaconFileData,s=e.accountId,r=e.previewSessionId,o=e.isAnonymous,i=void 0!==o&&o;if(!E.get_viewer().is_assume_user_session){var a=i?this.anonTransmitterData:this.identifiedTransmitterData;a&&n&&(a.transmitter.add_or_update_agents([this.getAgentStatusForFile(a.beaconUserId,a.identifier,n,C.BEACON_OFFLINE_STATUS)]),setTimeout(function(){a.transmitter.stop()},1)),this.fetchTransmitterToken(s,t,n,i,r)}},e.getAgentStatusForFile=function(e,t,n,s){var r=new c.Source(this.PLATFORM,this.SURFACE,t),o=new c.Agent(e,this.APP,n.context,r);return new c.AgentStatus(o,s,n.authKey)},e.fetchTransmitterToken=function(e,t,n,o,i){var a=this;_.ActionTimestampsTracker.record(y.LoggingActions.TRANSMITTER_TOKEN_BEGIN,i),r.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",dataType:"json",data:{account_id:e,context:t.context,auth_key:t.authKey},success:function(n){if(n.error)I(t.nsId,t.sjid);else{_.ActionTimestampsTracker.record(y.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,i);var r=n.token,l={identifier:v.v4({allowInsecure:!0}),beaconUserId:n.beacon_user_id,transmitter:new c.Transmitter(r,function(){return a.fetchTransmitterToken(e,t,null,o,i)},s.noop)};o?a.anonTransmitterData=l:a.identifiedTransmitterData=l,t&&l.transmitter.add_or_update_agents([a.getAgentStatusForFile(l.beaconUserId,l.identifier,t,C.BEACON_ONLINE_STATUS)]),l.transmitter.start()}}})},e.APP="harmony",e.PLATFORM=c.Platforms.WEB,e.SURFACE="file_viewer",e.receiver=null,e.anonTransmitterData=null,e.identifiedTransmitterData=null,e})();t.BeaconPresenceHelpers=R,t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT=9e3;var L=(function(){function e(){}return e.constructFakeSeenStateInfo=function(e,t,n){for(var r=n.seen_states,o=[],i=0,a=r;i<a.length;i++){var l=a[i];o.push(l.seen_state_user.user_id)}for(var c=0,u=e;c<u.length;c++){var d=u[c];if(!s.contains(o,d.user_id)){d.sharing_access_type&&(d.sharing_access_type=this.convertToUnion(d.sharing_access_type));var p=[{ts:t}],h={seen_state_user:d,when_last_seen:t,seen_events:p};r.unshift(h)}}return n.seen_states=r,n},e.convertToUnion=function(e){
return e?l.Union.parse(e):null},e.fetchSeenStateUsers=function(e,t,n,s,r){var o=this,l=Date.now()/1e3,c=void 0;m.FileViewerStore.instance.getCurrentFile()&&m.FileViewerStore.instance.getSharedLinkInfo()&&(c=m.FileViewerStore.instance.getSharedLinkInfo().url);var u=h.FilePreviewSession.currentSession&&h.FilePreviewSession.currentSession.id;return _.ActionTimestampsTracker.record(y.LoggingActions.SEEN_STATE_USERS_BEGIN,u),(new i.ApiV2RootAwareClient).rpc(e,"seen_state/get_seen_state_users",{user_ids:n,file_info:M(s,r,c)}).catch(a.catchApiError(function(){return I(s,r),Promise.reject(void 0)})).then(function(e){_.ActionTimestampsTracker.record(y.LoggingActions.SEEN_STATE_USERS_RECEIVE,u);var n=o.constructFakeSeenStateInfo(e,l,t);f.PassActions.updateSeenStateInfo(s,r,n)})},e.processAndUpdateSeenStateInfo=function(e,t,n,s,r){var o=s[0],i=o.seen_state_error;if(i)"seen_state_disabled"===l.Union.parse(i).type?f.PassActions.updateSeenStateUnavailable(e.id,t,n):r?f.PassActions.discontinueSeenStateInfo(t,n):I(t,n);else{for(var a=o.seen_state_info,c=0,u=a.seen_states;c<u.length;c++){var d=u[c];d.seen_state_user.sharing_access_type=this.convertToUnion(d.seen_state_user.sharing_access_type)}var p=o.seen_state_cursor;r?f.PassActions.updateSeenStateInfoContinue(t,n,a,p):f.PassActions.updateSeenStateInfo(t,n,a,p)}},e.fetchSeenStateInfo=function(e,t,n,s,r,o){var l=this;return _.ActionTimestampsTracker.record(y.LoggingActions.SEEN_STATE_BEGIN,o),(new i.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info",{file_infos:[M(t,n,r)],limit:s}).catch(a.catchApiError(function(){return I(t,n),Promise.reject(void 0)})).then(function(s){_.ActionTimestampsTracker.record(y.LoggingActions.SEEN_STATE_RECEIVE,o),l.processAndUpdateSeenStateInfo(e,t,n,s,!1)})},e.fetchSeenStateInfoContinue=function(e,t,n,s,r,o){var l=this;return(new i.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info/continue",{file_infos:[M(t,n,o)],cursor:s,limit:r}).catch(a.catchApiError(function(){return f.PassActions.discontinueSeenStateInfo(t,n),Promise.reject(void 0)})).then(function(s){l.processAndUpdateSeenStateInfo(e,t,n,s,!0)})},e.getCoachmark=function(e,t,n,s,r){return(new i.ApiV2RootAwareClient).rpc(e,"seen_state/get_coachmark_info",{file_info:M(t,n,s)}).catch(a.catchApiError(function(){return Promise.reject(void 0)})).then(function(e){r(e.type_with_data[".tag"])})},e.logCoachmarkInteraction=function(e,t,n,s,r,o){return(new i.ApiV2RootAwareClient).rpc(e,"seen_state/log_coachmark_interaction",{type:r,interaction:o,file_info:M(t,n,s)}).catch(a.catchApiError(function(){return Promise.reject(void 0)}))},e.updateSeenStateOnResign=function(e,n,s,r){var o=s?"async":"sync",i=void 0;s||(i=b.PASS_RESIGN_ONBEFOREUNLOAD_TIMEOUT||t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT);for(var a=[],l=0,c=r;l<c.length;l++){var u=c[l],d=u[0],p=u[1];a.push({beacon_user_id:d,context:n.context,auth_key:n.authKey,identifier:p})}return w(e,"seen_state/update_timestamps_and_mark_offline","seen_state/logged_out/mark_offline",{beacon_infos:a},o,i)},e})();t.SeenStateHelpers=L}),define("modules/clean/react/pass/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passEventEmitter=new n}),define("modules/clean/react/pass/store",["require","exports","tslib","external/underscore","modules/clean/flux/base_store","modules/clean/react/pass/constants","modules/clean/react/pass/types","modules/clean/react/pass/utils","modules/core/exception"],function(e,t,n,s,r,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){this.userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])},e.prototype.getOnlineUserIds=function(){return Object.keys(this.userIdToUniqueIds)},e})(),u=(function(e){function t(t){var n=e.call(this,t)||this;return n.seenStateInfos={},n.seenStateCursors={},n.presenceInfos={},n.passFetchingStatusMap={},n.userIdsWithoutSeenStateInfoMap={},n.passPermissions={},n}return n.__extends(t,e),t.prototype.presence=function(e,t){var n=this.fileKey(e,t);return n in this.presenceInfos?this.presenceInfos[n].getOnlineUserIds():null},t.prototype.seenStateInfo=function(e,t){var n=this.fileKey(e,t);return this.seenStateInfos[n]||null},t.prototype.identifiedSeenStateInfo=function(e,t){var n=this.fileKey(e,t);if(n in this.seenStateInfos){return{seen_states:s.reject(this.seenStateInfos[n].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null},t.prototype.seenStateCursorHasNext=function(e,t){var n=this.fileKey(e,t);return n in this.seenStateCursors?this.seenStateCursors[n].has_next:null},t.prototype.seenStateCursorState=function(e,t){var n=this.fileKey(e,t);return n in this.seenStateCursors?this.seenStateCursors[n].cursor_state:null},t.prototype.passFetchingStatus=function(e,t){var n=this.fileKey(e,t);return this.passFetchingStatusMap[n]||o.PASS_FETCHING_STATUS.NOT_YET_KNOWN},t.prototype.getLinkAndGroupInfo=function(e,t){var n=null,s=null,r=this.fileKey(e,t);if(!this.seenStateInfos[r])return{linkInfo:n,groupInfo:s};n=[],s={};for(var o=0,i=this.seenStateInfos[r].seen_states;o<i.length;o++){var l=i[o];if(!a.AnonymousViewerUtils.isAnonymousSeenState(l)){var c=l.seen_state_user.sharing_access_type;if(c)switch(c.type){case"link_only":n.push(l);break;case"view_member_access":case"edit_member_access":for(var u=c.value,d=0,p=u;d<p.length;d++){var h=p[d];h in s||(s[h]=[]),s[h].push(l)}}}}return{linkInfo:n,groupInfo:s}},t.prototype.anonymousPresence=function(e,t){var n=this.fileKey(e,t);return n in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[n].getOnlineUserIds()):null},t.prototype.userIdsWithoutSeenStateInfo=function(e,t){return this.userIdsWithoutSeenStateInfoMap[this.fileKey(e,t)]||[]},t.prototype.isPassPermissionsPending=function(e){return this.passPermissions[e]===i.PASS_PERMISSION_PENDING_STATUS},t.prototype.getPassPermissions=function(e){var t=this.passPermissions[e];return t&&"string"!=typeof t?t:null},t.prototype.resetPassInfo=function(e,t){var n=this.fileKey(e,t);delete this.seenStateInfos[n],delete this.seenStateCursors[n],delete this.presenceInfos[n],delete this.passFetchingStatusMap[n],delete this.passPermissions[n],delete this.userIdsWithoutSeenStateInfoMap[n],this.emit_change()},t.prototype.fileKey=function(e,t){return e+":"+t},t.prototype.setPassPermissionRequest=function(e,t,n){this.passPermissions[e]=i.PASS_PERMISSION_PENDING_STATUS,this.setPassFetchingStatus(t,n,o.PASS_FETCHING_STATUS.FETCHING)},t.prototype.setPassPermissions=function(e,t){this.passPermissions[e]=t,this.emit_change()},t.prototype.receivePresenceDelta=function(e,t,n,s,r){l.assert([o.PASS_FETCHING_STATUS.FETCHING,o.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t,n))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var i=this.fileKey(t,n),a=this.getOnlineUsersForFileKey(i);this.updatePresenceInfos(i,s,r),this.updateUserIdsWithoutSeenStateInfo(e,t,n,a),this.emit_change()},t.prototype.receivePresenceSnapshot=function(e,t,n,s){l.assert([o.PASS_FETCHING_STATUS.FETCHING,o.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t,n))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var r=this.fileKey(t,n),i=this.getOnlineUsersForFileKey(r);this.presenceInfos[r]=new c,this.updatePresenceInfos(r,s,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,n,i),this.emit_change()},t.prototype.getOnlineUsersForFileKey=function(e){return e in this.presenceInfos||(this.presenceInfos[e]=new c),this.presenceInfos[e].getOnlineUserIds()},t.prototype.updatePresenceInfos=function(e,t,n){for(var s=0,r=Object.keys(n);s<r.length;s++)for(var o=r[s],i=0,a=Object.keys(n[o]);i<a.length;i++){var l=a[i];this.presenceInfos[e].removeUniqueUser(o,l)}for(var c=0,u=Object.keys(t);c<u.length;c++)for(var d=u[c],p=0,h=Object.keys(t[d]);p<h.length;p++){var l=h[p];this.presenceInfos[e].addUniqueUser(d,l)}},t.prototype.updateUserIdsWithoutSeenStateInfo=function(e,t,n,r){var i,l=this.fileKey(t,n),c=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileKey(l)),u=a.AnonymousViewerUtils.filterAnonymousUserIds(r),d=s.difference(u,c),p=s.difference(c,u);if(l in this.seenStateInfos){var h=void 0,m=this.passFetchingStatus(t,n);[o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS].indexOf(m)!==-1?(_=this.createMinimalBaseSeenStateInfo(l,c),i=_.userIdsWithoutSeenStateInfo,h=_.baseSeenStateInfo,this.updateSeenStateInfo(t,n,h)):(f=this.makeSeenStateAgreeWithUpdatedPresence(l,c,d,p),i=f.userIdsWithoutSeenStateInfo,h=f.baseSeenStateInfo)}else i=[];this.userIdsWithoutSeenStateInfoMap[l]=i;var _,f},t.prototype.makeSeenStateAgreeWithUpdatedPresence=function(e,t,n,s){for(var r=[],o=this.seenStateInfos[e],i=o.seen_states,a=[],l=[],c=[],u=Date.now()/1e3,d=0,p=i;d<p.length;d++){var h=p[d],m=h.seen_state_user.user_id;m&&(r.push(m),s.includes(m)?(h.when_last_seen=u,h.seen_events=h.seen_events||[],h.seen_events.push({ts:u}),l.push(h)):n.includes(m)?(h.when_last_seen=u,h.seen_events=h.seen_events||[],h.seen_events.push({ts:u}),c.push(h)):a.push(h))}return o.seen_states=l.concat(c,a),{userIdsWithoutSeenStateInfo:t.filter(function(e){return!r.includes(e)}),baseSeenStateInfo:o}},t.prototype.createMinimalBaseSeenStateInfo=function(e,t){for(var n=[],r=[],o=0,i=this.seenStateInfos[e].seen_states;o<i.length;o++){var a=i[o],l=a.seen_state_user.user_id;l&&t.includes(l)&&(n.push(a),r.push(l))}return{userIdsWithoutSeenStateInfo:s.difference(t,r),baseSeenStateInfo:{seen_states:n}}},t.prototype.updateSeenStateInfo=function(e,t,n,s){void 0===s&&(s=!1),l.assert([null,o.PASS_FETCHING_STATUS.FETCHING].indexOf(this.passFetchingStatus(e,t))===-1,"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled");var r=this.fileKey(e,t);s&&r in this.seenStateInfos?this.seenStateInfos[r].seen_states=this.seenStateInfos[r].seen_states.concat(n.seen_states):this.seenStateInfos[r]=n,this.userIdsWithoutSeenStateInfoMap[r]=[],this.emit_change()},t.prototype.updateSeenStateInfoWithEmptyData=function(e,t){var n={seen_states:[]};this.updateSeenStateInfo(e,t,n)},t.prototype.setPassFetchingStatus=function(e,t,n){var s=this.fileKey(e,t);this.passFetchingStatusMap[s]=n,this.emit_change()},t.prototype.updateSeenStateCursor=function(e,t,n){var s=this.fileKey(e,t);n&&(this.seenStateCursors[s]=n,this.emit_change())},t.prototype.assureSeenStateSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS);break;case o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging T123456: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype.onFetchSeenStateDisabled=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED);break;case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging T123456: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype.assurePresenceSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case o.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case o.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case o.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,t,o.PASS_FETCHING_STATUS.PRESENCE_SUCCESS);break;case o.PASS_FETCHING_STATUS.NOT_YET_KNOWN:l.reportStack("Debugging T123456: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[this.fileKey(e,t)]}})}},t.prototype._new_payload=function(e){var t,n,s,r=e.action,i=r.type,a=r.data;switch(i){case o.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(a.nsId,a.sjid,o.PASS_FETCHING_STATUS.ERROR);break;case o.ActionTypes.FETCH_PASS_CONCLUDED:n=a.nsId,s=a.sjid,this.setPassFetchingStatus(n,s,o.PASS_FETCHING_STATUS.CONCLUDED),this.updateSeenStateInfoWithEmptyData(n,s);break;case o.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(a.fileId,a.nsId,a.sjid);break;case o.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(a.nsId,a.sjid),this.receivePresenceDelta(a.userId,a.nsId,a.sjid,a.onlineUniqueUsers,a.offlineUniqueUsers);break;case o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(a.nsId,a.sjid),this.receivePresenceSnapshot(a.userId,a.nsId,a.sjid,a.onlineUniqueUsers);break;case o.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(a.nsId,a.sjid);break;case o.ActionTypes.SET_PASS_PERMISSIONS:this.setPassPermissions(a.fileId,a.passPermissionObject);break;case o.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:var l={cursor_state:"",has_next:!1};this.updateSeenStateCursor(a.nsId,a.sjid,l);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(a.nsId,a.sjid),this.updateSeenStateInfo(a.nsId,a.sjid,a.seenStateInfo),this.updateSeenStateCursor(a.nsId,a.sjid,a.seenStateCursor);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(a.nsId,a.sjid),this.updateSeenStateInfo(a.nsId,a.sjid,a.seenStateInfo,!0),this.updateSeenStateCursor(a.nsId,a.sjid,a.seenStateCursor);break;case o.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:t=a.userId,n=a.nsId,s=a.sjid,this.onFetchSeenStateDisabled(n,s),this.updateSeenStateInfoWithEmptyData(n,s),this.updateUserIdsWithoutSeenStateInfo(t,n,s,[])}},t})(r);t.PassStore=u,t.passStore=new u}),define("modules/clean/react/pass/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n,s,r,o,i,a,l){this.key=e,this.displayName=t,this.isActive=n,this.isViewer=s,this.incrementOverflowBasis=r,this.accessLevel=o,this.whenLastSeen=i,this.photoUrl=a,this.userId=l}return e})();t.UserInfo=n,t.PASS_PERMISSION_PENDING_STATUS="pending";var s=(function(){function e(e,t){this.isLoaded=e,this.data=t}return e.create=function(t){return new e(!0,t)},e.createNotLoaded=function(){return new e(!1,null)},e})();t.FacepileInfo=s}),define("modules/clean/react/pass/utils",["require","exports","external/underscore","modules/core/user_i18n"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){function t(e){return e.startsWith("dbwsid:")||e.startsWith("dbafvid:")}function r(e){return t(e.seen_state_user.user_id)}function o(e){return n.filter(e,t)}function i(e){return n.reject(e,t)}function a(e){return s.isCjkLocale()&&1===e.split(" ").length?e.substring(0,1):s.getInitials(e)}e.isAnonymousUserId=t,e.isAnonymousSeenState=r,e.getAnonymousUserIds=o,e.filterAnonymousUserIds=i,e.getAnonymousViewerInitials=a})(t.AnonymousViewerUtils||(t.AnonymousViewerUtils={}))}),function(){define("modules/clean/react/select",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util","modules/core/dom"],function(e,t,n,s,r,o,i,a,l,c,u){var d,p,h,m,_,f,g,y;return p=o.KeyCode,d=a.HiddenSelect,m=t.DOM,h=t.createElement,_=function(e,t){var n,s,r,o;return o=e.scrollTop(),r=o+e.height(),s=t.position().top+o,n=s+t.height(),s<o?e.scrollTop(s):n>r?e.scrollTop(n-e.height()):void 0},y=t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number]),g=t.createClass({displayName:"selectOption",propTypes:{id:t.PropTypes.string,className:t.PropTypes.string,disabled:t.PropTypes.bool,title:t.PropTypes.string,value:y,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},getInitialState:function(){return{id:s.uniqueId("option")}},componentWillReceiveProps:function(e){if(null!=e.id)return this.setState({id:e.id})},render:function(){var t,n,s;return t={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},null!=this.props.className&&(t[this.props.className]=!0),s=this.props.value,n=r.extend(!0,{},this.props),delete n.value,m.div(r.extend({"data-value":s},n,{id:this.state.id,role:"option",className:e(t),"aria-disabled":this.props.disabled}),this.props.children)}}),f=t.createClass({displayName:"selectInput",mixins:[i],mouseInput:!0,propTypes:{name:t.PropTypes.string,onChange:t.PropTypes.func,defaultValue:y,style:t.PropTypes.object,value:y,variant:t.PropTypes.string,className:t.PropTypes.string,ariaLabelId:t.PropTypes.string,ariaDescriptionId:t.PropTypes.string,valueLink:t.PropTypes.object,isDisabled:t.PropTypes.bool,headerElement:t.PropTypes.element},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null,headerElement:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",selectOptionId:s.uniqueId("selected-option"),listboxId:s.uniqueId("listbox"),value:this.props.defaultValue}},_getFilteredChildren:function(){return s.isArray(this.props.children)?s.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var n,s,r,o,i,a,c;return s={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled},this.props.variant&&(s[this.props.variant]=!0),this.props.className&&(s[this.props.className]=!0),o={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},r=this.renderErrorIfEnabled(),n=this.props.ariaDescriptionId,((null!=(i=this.props.error)?i.message_text:void 0)||null!=(null!=(a=this.props.error)?a.message_html:void 0))&&(n=r.props.id),c=this.selectedOption(),m.div({className:e(s),style:this.props.style,ref:"wrapperDiv"},r,m.button({className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":n,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+c.props.id,ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},m.div({className:"select-input-input filter-item__filter-input",ref:"label"},c,m.div({className:"select-input-dropdown-arrow"},h(l,{group:"web",name:"arrow-down-gray",alt:""})))),h(d,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:(function(e){return function(){var n;return n=[],t.Children.forEach(e._getFilteredChildren(),function(e){return n.push(e.props.value)}),n}})(this)()}),m.div({className:"hidden-option-container"},m.div({id:this.state.listboxId,className:e(o),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;if(!this.props.isDisabled)return e.pageX===t&&e.pageY===n||(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var n;for(e=e.trim().toLowerCase(),t=t.trim().toLowerCase(),n=0;n<e.length&&n<t.length&&e.charAt(n)===t.charAt(n);)n++;return n},_keyboardSelect:function(e){var t,n,r,o,i;return i=s.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),r=this.sortedOptions[Math.max(i-1,0)],t=this.sortedOptions[Math.min(i,this.sortedOptions.length-1)],o=this._commonPrefixLen(e,r.text),n=this._commonPrefixLen(e,t.text),o>=n?this.setState({keyboarsSelectPrefix:e,focused:r.value}):this.setState({keyboarsSelectPrefix:e,focused:t.value})},handleKeydown:function(e){var t,n,r;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case p.TAB:return this.setState({open:!1,focused:null}),!0;case p.ENTER:case p.SPACE:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case p.ESC:this.state.open&&(r=this.getValue(),this.setValue(r),this.setState({open:!1}));break;case p.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case p.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;s.contains(s.values(p),e.keyCode)||(t=String.fromCharCode(e.which),n=this.state.keyboarsSelectPrefix+t,this._keyboardSelect(n),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout((function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}})(this),500))}return!1}},prev:function(e){var n,s;return n=null,s=null,t.Children.forEach(this._getFilteredChildren(),(function(t){return function(t){if(s||t.props.disabled||(s=t),t.props.value===e&&(n=s),!t.props.disabled)return s=t}})(this)),null!=n?n.props.value:void 0},next:function(e){var n,s,r;return n=null,s=null,t.Children.forEach(this._getFilteredChildren(),(function(t){return function(t){if(!t.props.disabled)return(null!=s?s.props.value:void 0)===e&&(n=t),s=t}})(this)),null!=(r=n||s)?r.props.value:void 0},menuChildren:function(){var n;return n=this.getValue(),t.Children.map(this._getFilteredChildren(),(function(s){return function(r){return t.cloneElement(r,{onMouseEnter:function(){if(u.scroll_lock_document(),s.mouseInput)return s.setState({focused:r.props.value})},onMouseOut:function(){return u.scroll_unlock_document()},onClick:function(){if(!r.props.disabled)return s.setState({open:!1}),s.setValue(r.props.value)},className:e({"focused-option":null!=s.state.focused&&s.state.focused===r.props.value,"selected-option":n===r.props.value},r.props.className)})}})(this))},componentWillMount:function(){var e;return e=t.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:c.getText(e).trim().toLowerCase()}}),this.sortedOptions=s.sortBy(e,"text")},componentDidMount:function(){return this.globalMenuCloser=(function(e){return function(t){var s;if(e.state.open&&(s=r(t.target).closest(".select-input"),!s.length||s[0]!==n.findDOMNode(e.refs.wrapperDiv)))return e.setState({open:!1,focused:null})}})(this),r(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return r(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(e,t){var s,o,i,a,l;if(o=r(n.findDOMNode(this.refs.dropdown)),i=r(n.findDOMNode(this.refs.selectButton)),this.state.open&&(s=o.find("[data-value='"+this.state.focused+"']"),o.attr("aria-activedescendant",s.attr("id"))),this.state.open&&this.state.focused&&null==this.props.headerElement&&(s=o.find("[data-value='"+this.state.focused+"']"),o.attr("aria-activedescendant",s.attr("id")),_(o,s)),l=t.open&&!this.state.open,a=!t.open&&this.state.open,a&&o.focus(),l)return i.focus()},selectedOption:function(){var e;return e=null,null!=this.props.headerElement?this.props.headerElement:(t.Children.forEach(this._getFilteredChildren(),(function(t){return function(n){if(e||(e=n),(null!=n?n.props.value:void 0)===t.getValue())return e=n}})(this)),e?t.cloneElement(e,{id:this.state.selectOptionId}):null)},handleClickOnInputButton:function(e){return e.preventDefault(),this.toggle()},toggle:function(){if(!this.props.isDisabled)return this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},getValue:function(){var e,t,n,s;return null!=(e=null!=(t=null!=(n=this.props.value)?n:null!=(s=this.props.valueLink)?s.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t,n;if(n=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),n!==e||null!=this.props.headerElement)return"function"==typeof(t=this.props).onChange?t.onChange(n,e):void 0}}),{input:f,option:g}})}.call(this),function(){define("modules/clean/react/sharing/shared_with_view",["external/classnames","external/react","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/sharing/constants","modules/clean/em_string","modules/clean/react/browse/models","modules/clean/sharing/api/types/metadata","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/constants/sharing","modules/constants/viewer","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_){var f,g,y,S,v,E,b,C,I,T,w,A,M,N,k,P,R,L;return g=n.AVATAR_DIMENSION_BY_SIZE,I=o.SNIPPET_SIZES,S=a.File,v=l.LinkAudience,T=l.SharedContentLinkMetadata,b=c.MemberAvatarsMixin,R=u.static_url,M=d.UserEducationEffect,A=h.TRUELINK,N=_._,L=_.ungettext,P=t.DOM,k=t.createElement,E=5,f=g.SMALL,y=12,C="--",w=t.createClass({displayName:"SharedWithView",mixins:[b],propTypes:{user:t.PropTypes.object.isRequired,file:t.PropTypes.instanceOf(S),onOverflowCountClick:t.PropTypes.func,onAvatarClick:t.PropTypes.func,groups:t.PropTypes.array,invitations:t.PropTypes.array,joinedMembers:t.PropTypes.array,numUndisplayableUsersAndInvites:t.PropTypes.number,memberCount:t.PropTypes.number,numInheritedMembers:t.PropTypes.number,parentFolderName:t.PropTypes.string,animation:t.PropTypes.bool,titleButtonDirection:t.PropTypes.string,avatarDimension:t.PropTypes.number,maxVisibleAvatars:t.PropTypes.number,sharedLinkInfo:t.PropTypes.object,onSharedLinkClick:t.PropTypes.func,isCdmRoot:t.PropTypes.bool,inSelectMode:t.PropTypes.bool,isInAudienceBox:t.PropTypes.bool,audienceDescription:t.PropTypes.string,hasSharedDataLoaded:t.PropTypes.bool,canViewMembers:t.PropTypes.bool,inContentManagerCdmRoot:t.PropTypes.bool,linkMetadata:t.PropTypes.instanceOf(T),publicFolderSharing:t.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:f,maxVisibleAvatars:E,file:null,canViewMembers:!0,inContentManagerCdmRoot:!1,inSelectMode:!1,memberCount:0,isCdmRoot:!1}},render:function(){var e,t;return this.props.inContentManagerCdmRoot?0===this.props.groups.length?P.div({}):(e=this.props.groups[0].num_users,P.div({className:"audience-description",onClick:function(e){return e.stopPropagation()}},L("%(num)s member","%(num)s members",e).format({num:e}))):this.props.isInAudienceBox?this.props.canViewMembers?(null!=(t=this.props.file)?t.isDeleted:void 0)?null:P.div({className:this.getClassName()},this.props.hasSharedDataLoaded?k(M,{containerName:this.constructor.displayName,name:"AudienceBoxAvatars"},this.renderAudienceBoxAvatars()):k(s,{style:s.LoadingIndicatorStyle.DOTS})):null:P.div({className:this.getClassName()},this._hasSharedLink()?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription())},getClassName:function(){return e({"shared-with-members":!0,clearfix:!0,"audience-box u-pad-top-xs u-pad-bottom-s u-mar-bottom-xs":this.props.isInAudienceBox})},renderSharedLinkInColumn:function(){var e,t;return t=this.props.onSharedLinkClick,e=this.props.inSelectMode,k(r,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata),direction:this.props.titleButtonDirection,className:"audience-description__link-avatar"},P.img({src:R("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||N("Shared link"),width:y,height:y,onClick:function(n){if(!e)return t(),n.stopPropagation()}}))},renderAudienceDescription:function(){var e,t,n,s,o,a,l,c,u,d,p,h,m,_,f,g,y;return this.props.hasSharedDataLoaded?((null!=(_=this.props.file)?_.isDeleted:void 0)?n=N("Deleted"):this.props.canViewMembers?this.props.audienceDescription&&(n=this.props.audienceDescription):n=C,s=(this.props.groups||[]).concat(this.props.joinedMembers||[]).concat(this.props.invitations||[]),d=s.length+(this.props.numUndisplayableUsersAndInvites||0),f=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers||[]),f[0],u=f[1],d>=0&&(1!==d||null==u)&&(n||(n=L("%(num)s member","%(num)s members",this.props.memberCount).format({num:this.props.memberCount})),y=s.slice(0,this.props.maxVisibleAvatars),h=(function(){var e,t,n;for(n=[],e=0,t=y.length;e<t;e++)c=y[e],n.push(i.em_snippet(c.display_name||c.email||c.name||c.email_or_fbname,I.DISPLAY_NAME));return n})(),d>this.props.maxVisibleAvatars&&(h.pop(),e=d-(this.props.maxVisibleAvatars-1),p=L("and %(num)s more...","and %(num)s more...",e,{comment:"Number of additional members in the file. Expected to be >= 2."}).format({num:e}),h.push(p)),o=h.join("\n")),this.props.publicFolderSharing&&this.props.file&&!this.props.file.is_dir?n||(n=N("Anyone")):n||(n=N("Only you")),m=this.props.onAvatarClick,a=this.props.inSelectMode,l=null!=(g=this.props.file)?g.isDeleted:void 0,t=P.div({className:"audience-description",onClick:function(e){if(!a&&!l)return m(),e.stopPropagation()}},n),o?k(r,{key:"membership_column_bubble",respectLineBreaks:!0,text:o,direction:this.props.titleButtonDirection},t):t):null},renderAudienceBoxAvatars:function(){var e,t,n,s,r,o,i,a,l,c;if(e=[],o=this.props.joinedMembers?this.props.joinedMembers:[],t=this.props.groups?this.props.groups.slice():[],s=this.props.invitations?this.props.invitations.slice():[],this._addSharedLinkIfExists(e),c=[],a=this.findOwnerAndMeInJoinedMembers(o),a[0],i=a[1],null!=i&&(c.push(i.user_id),e.push(this.renderJoinedMember(i))),this.addGroupsMembersInvitations(e,t,o,s,c),1===e.length&&null!=i){if(this.props.user.is_team_admin&&this.props.isCdmRoot){for(n=r=1,l=this.props.maxVisibleAvatars-1;1<=l?r<=l:r>=l;n=1<=l?++r:--r)e.push(this.renderPlaceholderAvatar(n,N("Invite")));return this.renderAvatarList(e)}return P.div({className:"audience-box--text-only"},N("Only you have access"))}return this.renderAvatarList(e)},_addSharedLinkIfExists:function(e){if(this._hasSharedLink())return A.TRUELINK_UI[this.props.user.id]?e.push(this.renderSharedLink(null,this.props.linkMetadata)):e.push(this.renderSharedLink(this.props.sharedLinkInfo))},_hasSharedLink:function(){return A.TRUELINK_UI[this.props.user.id]?this.props.linkMetadata&&this.props.linkMetadata.current_audience!==v.members:Boolean(this.props.sharedLinkInfo)}}),{SharedWithView:w}})}.call(this),define("modules/clean/react/snackbar",["require","exports","tslib","external/react","external/react-dom","external/spectrum/snackbar","modules/clean/react/css","modules/core/accessible_announce","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(n){var s=e.call(this,n)||this;return s.handleActionClick=function(e){var t=s.props.onActionClick;t&&t(e)},s.handleCloseClick=function(){var e=s.props.onCloseClick;t.close(),e&&e()},s.handleTimeout=function(){var e=s.props.onTimeout;t.close(),e&&e()},s.state={progress:0},s}return n.__extends(t,e),t.show=function(e){var n=t.getOrCreateContainer();return t.close(),r.render(e,n)},t.prototype.componentDidMount=function(){var e=this,n=this.props,s=n.syncProgressLoop,o=n.timeoutDelayMs,i=n.variant,l=r.findDOMNode(this).innerHTML;o?("fail"===i?a.AccessibleAnnounce.assertive(l,o):a.AccessibleAnnounce.polite(l,o),this.timer=setTimeout(function(){e.handleTimeout()},o)):"fail"===i?a.AccessibleAnnounce.assertive(l):a.AccessibleAnnounce.polite(l),s&&(this.progressLoop=setInterval(function(){e.setState({
progress:(e.state.progress+t.LOOP_UPDATE_STEP)%(t.MAX_PROGRESS+1)})},t.LOOP_UPDATE_RATE))},t.prototype.componentWillUnmount=function(){this.timer&&clearTimeout(this.timer),this.progressLoop&&clearInterval(this.progressLoop)},t.close=function(){var e=t.getOrCreateContainer();r.unmountComponentAtNode(e)},t.generic=function(e){return t.show(s.createElement(t,{title:e,variant:"generic",closeButtonText:l._("Close")}))},t.sync=function(e,n){return t.show(s.createElement(t,{syncProgressLoop:n,title:e,variant:"sync"}))},t.complete=function(e){return t.show(s.createElement(t,{title:e,variant:"complete",closeButtonText:l._("Close")}))},t.warn=function(e){return t.show(s.createElement(t,{title:e,variant:"warn",closeButtonText:l._("Close")}))},t.fail=function(e){return t.show(s.createElement(t,{title:e,variant:"fail",closeButtonText:l._("Close")}))},t.getOrCreateContainer=function(){var e=document.getElementById(t.SNACKBAR_ROOT_ID);return e||(e=document.createElement("div"),e.id=t.SNACKBAR_ROOT_ID,document.body.insertBefore(e,document.body.firstChild)),e},t.prototype.render=function(){var e=this.props,t=e.title,n=e.variant,r=e.actionButtonText,i=e.closeButtonText,a=this.state.progress;return s.createElement(o.Snackbar,{progress:a,variant:n,title:t},r&&s.createElement(o.SnackbarAction,{onClick:this.handleActionClick},r),i&&s.createElement(o.SnackbarAction,{onClick:this.handleCloseClick},i))},t.LOOP_UPDATE_RATE=16,t.LOOP_UPDATE_STEP=.2,t.MAX_PROGRESS=100,t.SNACKBAR_ROOT_ID="react-snackbar-root",t.snackbarTypes=["generic","sync","complete","warn","fail"],t.defaultProps={syncProgressLoop:!1},t})(s.Component);t.Snackbar=i(c,["/static/css/snackbar-vfl9Q86ds.css","/static/css/spectrum/snackbar-vflL5p6zP.css"])}),define("modules/clean/react/starred/browse_exports",["require","exports","modules/clean/react/starred/store","modules/clean/react/starred/browse_update","modules/clean/react/starred/star","modules/clean/react/starred/actions","modules/clean/react/home/resource_id_types"],function(e,t,n,s,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStore=n.StarredStore,t.checkForMissingStarredData=s.checkForMissingStarredData,t.Star=r.Star,t.StarredActions=o.StarredActions,t.HOME_RESOURCE_ID_TYPE=i.HOME_RESOURCE_ID_TYPE}),define("modules/clean/react/starred/browse_update",["require","exports","modules/clean/react/home/home_access/home_access_util","modules/clean/react/home/resource_id_types","modules/clean/react/starred/actions","modules/clean/react/starred/store"],function(e,t,n,s,r,o){"use strict";function i(e){var t=e.files,i=e.isNonUserRelativeContext,a=e.user;if(n.isHomeEnabled()&&!i){var l=t.map(function(e){return{type:s.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,id:e.file_id}}).filter(function(e){return!(!e.id||o.StarredStore.hasIdTypePair(e))});l.length&&r.StarredActions.fetchStatuses(a.role,l)}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkForMissingStarredData=i}),function(){define("modules/clean/react/tabs/tab_nav",["jquery","external/underscore","external/classnames","external/react","modules/clean/react/css","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/clean/react/tabs/tabs"],function(e,t,n,s,r,o,i,a){var l,c,u,d;return c=a.TabContent,d=s.DOM,l=s.PropTypes,u=s.createClass({displayName:"TabNav",propTypes:{tabs:l.arrayOf(l.oneOfType([l.string,l.number,l.shape({value:l.oneOfType([l.string,l.number]),label:l.string,rightAlign:l.bool})])),defaultSelectedIndex:l.number,onChange:l.func,idPrefix:l.string,variant:l.string,className:l.string},getDefaultProps:function(){return{defaultSelectedIndex:0,variant:i.variants.DEFAULT,onChange:function(){}}},getInitialState:function(){return{selectedIndex:this.props.defaultSelectedIndex}},componentWillReceiveProps:function(e){if(this.props.defaultSelectedIndex!==e.defaultSelectedIndex)return this.setState({selectedIndex:e.defaultSelectedIndex})},_onChange:function(e,t){return this.props.onChange(e,t),this.setState({selectedIndex:t})},render:function(){var e;return e=this.props.idPrefix?this.props.idPrefix:"tabset"+t.uniqueId(),d.div({className:n(this.props.variant,this.props.className)},s.createElement(o,{tabs:this.props.tabs,onChange:this._onChange,idPrefix:e,selectedIndex:this.state.selectedIndex}),s.createElement(c,{isSelected:!0,id:i.getTabContentId(e),tabId:i.getTabId(e,this.state.selectedIndex)},this.props.children))}}),r(u,["/static/css/legacy_packages/components-vflfWNhxV.css"])})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_folder_settings_modal",["external/react","external/underscore","modules/core/i18n","modules/clean/analytics","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_upsell_modal_banner","modules/clean/sharing/folder_settings_modal","modules/constants/trademark"],function(e,t,n,s,r,o,i,a){var l,c,u,d,p,h;return p=n._,d=s.TeamsWebActionsLogger,l=r.Modal,c=i.SharedFolderSettingsModal,u=a.TRADEMARK_BUSINESS,h=e.createElement,{showWithProps:function(e){var n,s;return n={altAction:h(o,{upsellText:p("Want to access these settings as well as other admin controls? Upgrade to %(trademark_business)s.").format({trademark_business:u}),upgradeButtonText:p("Upgrade now"),redirectQuery:{tk:"team_settings",_camp:"modal"},logEventName:"team_folder_settings_upsell"})},s=l.showInstance(h(c,t(e).extend(n))),d.log("team_folder_settings",null,null,null,!1,d.LOG_CATEGORY.TEAM_INFO),s}}})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_share_folder_modal",["external/react","modules/core/i18n","modules/clean/analytics","modules/clean/filepath","modules/clean/react/modal","modules/core/browser","modules/core/uri"],function(e,t,n,s,r,o,i){var a,l,c,u,d,p,h;return u=t._,c=n.TeamsWebActionsLogger,l=r.Modal,h=e.DOM,p=e.createElement,d=function(e){return c.log(e,null,null,null,!1,c.LOG_CATEGORY.TEAM_INFO)},a=e.createClass({mixins:[e.addons.PureRenderMixin],displayName:"LimitedTeamShareFolderModal",propTypes:{fqPath:e.PropTypes.string.isRequired},_navigateToTeam:function(){return d("team_folder_share_invite"),o.redirect(i({path:"/team",query:{invite_members:"",tk:"team_folder_share_invite",_camp:"modal"}}))},render:function(){var e;return e=s.filename(this.props.fqPath),p(l,{title:u("Share %(folder_name)s").format({folder_name:e}),acceptButtonText:u("Invite"),onAccept:this._navigateToTeam,showButtonDivider:!0},h.div({},u("To share the %(folder_name)s with someone, invite them to join your team!").format({folder_name:e})))}}),{showModalInstance:function(e){var t;return t=l.showInstance(p(a,e)),d("team_folder_share"),t}}})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_upsell_modal_banner",["external/react","modules/core/browser","modules/core/uri","modules/clean/react/button","modules/clean/analytics"],function(e,t,n,s,r){var o,i,a,l,c;return i=s.button,o=r.TeamsWebActionsLogger,l=e.DOM,a=e.createElement,c=e.PropTypes,e.createClass({mixins:[e.addons.PureRenderMixin],propTypes:{upgradeButtonText:c.string.isRequired,upsellText:c.string.isRequired,logEventName:c.string,redirectUrl:c.string,redirectQuery:c.shape({tk:c.string,_camp:c.string})},displayName:"LimitedTeamUpsellModalBanner",_handleCTAClick:function(){return this.props.logEventName&&o.log(this.props.logEventName,{},null,null,!1,o.LOG_CATEGORY.UPGRADE),t.redirect(n({path:this.props.redirectUrl?this.props.redirectUrl:"/team/upgrade",query:this.props.redirectQuery}))},render:function(){return l.div({className:"modal-upsell-bar"},l.div({className:"modal-upsell-bar__message"},this.props.upsellText),l.div({className:"modal-upsell-bar__action"},a(i,{className:"modal-upsell-bar__cta-button",onClick:this._handleCTAClick},this.props.upgradeButtonText)))}})})}.call(this),define("modules/clean/sharing/action_types",["require","exports","modules/clean/flux/action_type"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareModalActionTypes=n.withActionNamespace("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",SET_COMMENT_CHECKBOX_PREF_REQUEST:"set-comment-checkbox-pref-request",SET_COMMENT_CHECKBOX_PREF_SUCCESS:"set-comment-checkbox-pref-success",SET_COMMENT_CHECKBOX_PREF_FAILURE:"set-comment-checkbox-pref-failure",SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:"set-comment-checkbox-pref-help-request",SET_COMMENT_CHECKBOX_HELP_PREF_SUCCESS:"set-comment-checkbox-pref-help-success",SET_COMMENT_CHECKBOX_HELP_PREF_FAILURE:"set-comment-checkbox-pref-help-failure",FETCH_UPSELL_EXPERIMENT_VARIANT:"fetch-upsell-experiment-variant",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success"}),t.SharingActionTypes=n.withActionNamespace("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"})}),define("modules/clean/sharing/actions/share_modal",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/browse_interface","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/file_viewer/store","modules/clean/react/modal","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/react/pass/data_helpers","modules/clean/react/pass/store","modules/clean/react_format","modules/clean/sharing/action_types","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/confirmation_modals/simple_confirm_modal","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/link_settings_modal","modules/clean/sharing/parent_folder_access_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/teams/membership_discovery_util","modules/clean/teams/modals/create_team_prompt_modal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/zendesk_feedback","modules/constants/teams","modules/constants/sharing","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/snackbar"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T,w,A,M,N,k,P,R,L,F,O,x,D,U,B,H,q,V,G,W,j,K,Y,z,Q,X){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var J=r.createElement,Z=Y.i18n_default_project("sharing")._,$=(function(){function t(t,s,o){var i=this;this.groupSeenStateInfo=null,this.presentAccountIds=null,this.hasLoggedSet={},this.changeAccess=function(e,t,n){void 0===n&&(n=!1);var s=Promise.resolve({}),o=e.memberId(),a=i.getContentInfo(),l=a.id,c=m.browseStore.context().isNonUserRelativeContext;if(t===R.MEMBER_ACTION.REMOVE)o!==i.user.account_id||c?(s=(a.isFileFolder()?i.client.getParentFolderAccess({contentId:i.sharingInfo.parentSharedFolderId(),memberId:o}):i.removeMember(l,e,n,a.isFolder())).then(function(t){i.showParentFolderAccessModalIfQualified("remove",e,t)}),i.openShareModal()):i.client.relinquishMembership({contentId:l,leaveACopy:n}).then(function(){a.isFolder()?B.sharingNotificationSuccess(Z("Folder access removed.")):B.sharingNotificationSuccess(Z("File access removed.")),g.Modal.close(),i.redirectToBrowseUrl("/")});else if(t===P.ACCESS_LEVEL.OWNER)s=i.client.transferContent({contentId:l,memberId:o}).then(function(){i.dispatch(C.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS),B.sharingNotificationSuccess(Z("Made %(name)s the owner").format({name:e.displayName()})),i.fetchInitialData(),i.openShareModal()});else{var u=void 0;if(a.isFileFolder()&&t===P.ACCESS_LEVEL.READER)u=i.client.getParentFolderAccess({contentId:i.sharingInfo.parentSharedFolderId(),memberId:o,accessLevel:t});else{var d=i.getContentInfo().isFileFolder();d&&i.dispatch(C.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:e});var p=Date.now();u=i.shareIfFileFolder(b.reactFormat(Z("Sharing <st>%(folder_name)s</st>..."),{st:r.createElement("strong",null),folder_name:a.name()})).then(function(){return j.SHARING_UNSHARING.SNACKBAR_MESSAGES&&X.Snackbar.complete(b.reactFormat(Z("Shared <st>%(folder_name)s</st>."),{st:r.createElement("strong",null),folder_name:a.name()})),d&&i.dispatch(C.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e}),i.changeMemberAccess(i.getContentInfo().id,e,t)}).catch(function(t){j.SHARING_UNSHARING.SNACKBAR_MESSAGES&&i.reportShareFailure(t,p),d&&i.dispatch(C.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e})})}s=u.then(function(t){i.showParentFolderAccessModalIfQualified("update",e,t)})}return s.then(i.refreshSharedWithColumnContentData)},this.changeLinkAudience=function(e){var t=new w.CombinedPolicy({audience:e}),n=Date.now();if(i.getContentInfo().isFileFolder())return i.shareIfFileFolder(b.reactFormat(Z("Changing link settings for <st>%(folder_name)s</st>..."),{st:r.createElement("strong",null),folder_name:i.getContentInfo().name()}),t).then(function(){j.SHARING_UNSHARING.SNACKBAR_MESSAGES&&X.Snackbar.complete(b.reactFormat(Z("Changed link settings for <st>%(folder_name)s</st>."),{st:r.createElement("strong",null),folder_name:i.getContentInfo().name()}))}).catch(function(e){return j.SHARING_UNSHARING.SNACKBAR_MESSAGES&&i.reportShareFailure(e,n),Promise.reject(e)});var s=i.sharingInfo.linkMetadata(),o=s&&s.current_audience||w.LinkAudience.members;i.dispatch(C.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST,{newAudience:e});var a,c;return i.getContentInfo().isFile()?(a=R.ALPHA_FILE_METADATA_PERMISSIONS,c=i.client.updatePolicy.bind(i.client)):(a=R.ALPHA_FOLDER_METADATA_PERMISSIONS,c=i.client.updatePolicyAlpha.bind(i.client)),c({actions:Object.keys(a),contentId:i.getContentInfo().id,newPolicy:t}).then(function(e){i.dispatch(C.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS,{metadata:e})}).catch(l.catchApiError(function(){return i.dispatch(C.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE,{prevAudience:o}),Promise.reject({})}))},this.changeRecipientAccess=function(e){i.dispatch(C.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS,{newAccess:e})},this.changeRecipientMessage=function(e){i.dispatch(C.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE,{message:e})},this.createSharedLink=function(){return i.log("CLICK_TIB_CREATE_LINK"),i.dispatch(C.ShareModalActionTypes.CREATE_LINK_REQUEST),i.client.createSharedLink({fileIdOrPath:i.getContentInfo().displayPath()}).then(function(e){i.dispatch(C.ShareModalActionTypes.CREATE_LINK_SUCCESS,{linkMetadata:e}),i.refreshSharedWithColumnLinkData()}).catch(l.catchApiError(function(e){return e instanceof l.AppError&&e.error&&"access_denied"===e.error[".tag"]&&(i.getContentInfo().isFolder()?B.sharingNotificationError(Z("You don’t have permission to create a link to this folder")):B.sharingNotificationError(Z("You don’t have permission to create a link to this file"))),i.dispatch(C.ShareModalActionTypes.CREATE_LINK_FAILURE),Promise.reject(e)}))},this.fetchMetadataForFile=function(e){return I.SharingActions.loadFileMetadata({user:i.user,contentId:e.id,sourceUrl:e.url(),client:i.client}).catch(l.catchApiError(i.handleLoadingError))},this.fetchMetadataForFileFolder=function(e){var t,s,r=R.MEMBER_ACTION.ALL,o=i.user.is_cdm_member?R.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE:R.VALIDATE_PATH_PERMISSIONS,a={actions:Object.keys(o),listMembersArg:{actions:r},shouldParseMetadataFromError:!0};return m.browseStore.context().isNonUserRelativeContext&&!i.user.is_cdm_member?(t=function(e){var t=_.validateFolderPath(e);return i.client.validatePathContinue(t,!1)},s={nsId:e.nsId(),nsPath:e.nsPath()}):(t=i.client.validateFqPath,s={fqPath:e.displayPath(),shareAsConfidential:i.sharingInfo.shareAsConfidential()}),t(n.__assign({},s,a)).then(function(e){var t=e.metadata,n=e.inheritedMembers;i.handleGetMetadataSuccess(t);var s=i.getContentInfo();i.listMembers(s.id,s.url(),s.isFileFolder()&&n||void 0)}).catch(l.catchApiError(i.handleLoadingError))},this.fetchMetadataForSharedFolder=function(e){return i.client.getMetadata({contentId:e.id,actions:Object.keys(R.ALPHA_FOLDER_METADATA_PERMISSIONS)}).then(i.handleGetMetadataSuccess).catch(l.catchApiError(i.handleLoadingError))},this.handleMemberAccessChange=function(e,t){var n=e.displayName();if(t===R.MEMBER_ACTION.REMOVE||t===P.ACCESS_LEVEL.OWNER){var s=t===R.MEMBER_ACTION.REMOVE&&e.memberId()===i.user.account_id,r=i.getContentInfo().isFolder(),o=i.getContentInfo().isNestedSharedFolder(),a=e.permissions.leave_a_copy&&e.permissions.leave_a_copy.allow,l=function(n){i.changeAccess(e,t,n===!0)},c=i.openShareModal,u=i.getContentInfo().parentFolderName();s?N.showRelinquishMembershipConfirmationModal(r,o,l,c,a):M.showMemberAccessChangeConfirmationModal(n,t,r,o,a,l,c,u)}else i.changeAccess(e,t)},this.handleGetMetadataSuccess=function(e){i.dispatch(C.ShareModalActionTypes.FETCH_METADATA_SUCCESS,{metadata:e}),d.dispatch({type:O.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:i.user})},this.handleLinkSettingsClick=function(){var e=function(){i.refreshSharedWithColumnLinkData(),i.setLinkMetadata(void 0),i.openShareModal()},t=i.sharingInfo.getInitialProps().onDeleteLink||e,n=function(e){i.setLinkMetadata(e),i.refreshSharedWithColumnLinkData()},s=L.showUpgradeToBizBanner(i.user);a.TeamsWebActionsLogger.log("open_link_settings_modal"),g.Modal.showInstance(r.createElement(L.SharedLinkSettingsModal,{client:i.client,isFile:i.getContentInfo().isFile(),linkMetadata:i.sharingInfo.linkMetadata(),onClose:i.openShareModal,onDeleteLink:t,onPolicySet:n,showUpgradeToBiz:s,isTeam:i.user.is_team}))},this.handleLoadingError=function(e){e instanceof l.AppError?("not_a_member"===e.error[".tag"]||"no_access"===e.error[".tag"]?(B.sharingNotificationError(Z("You don’t have permission to share this folder")),g.Modal.close()):"invalid_id"===e.error[".tag"]&&(B.sharingNotificationError(Z("This folder can’t be shared")),g.Modal.close()),i.dispatch(C.ShareModalActionTypes.FETCH_METADATA_FAILURE,{reason:e.error&&e.error.bad_path&&e.error.bad_path[".tag"]})):(B.sharingNotificationError(e.message||Z("There was a problem completing this request.")),g.Modal.close())},this.handleSelectLinkAudience=function(e){if(i.sharingInfo.contentInfo().isFile())return i.changeLinkAudience(e);var t=i.sharingInfo.linkMetadata(),n=t&&t.current_audience||w.LinkAudience.members,s=t.audience_options.toArray().indexOf(n),o=t.audience_options.toArray().indexOf(e);if(o<s){var a="";if(e===w.LinkAudience.public)a=Z("All items in this folder will become viewable by anyone with the link.");else{if(e!==w.LinkAudience.team)throw"audience type not supported: %(newAudience)s".format({newAudience:e});a=Z("All items in this folder will become viewable by anyone on your team.")}g.Modal.showInstance(r.createElement(k.SimpleConfirmModal,{title:Z("Change link audience?"),confirmText:Z("Change audience"),onConfirm:function(){i.changeLinkAudience(e),i.openShareModal()},onCancel:i.openShareModal},a))}else if(o>s)return i.changeLinkAudience(e)},this.handleSetConfidential=function(e){var t=i.getContentInfo(),n=t.isSharedFolder()?t.sharedFolderId().toString():void 0;return n?i.client.setConfidentiality({contentId:n,confidential:e}):i.client.share({fqPath:t.displayPath(),confidential:e})},this.openShareModal=function(){g.Modal.showInstance(J(i.shareModalClass,{actionHandler:i}))},this.recipientsChange=function(e,t){return void 0===t&&(t=""),Promise.resolve({}).then(function(){i.dispatch(C.ShareModalActionTypes.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t})})},this.redirectToPath=function(t,n){if(!m.browseStore.user()){var s=c.browse_uri_for_fq_path(i.user,t);return n&&s.updateQuery({shareoptions:"1"}),void K.redirect(s.toString())}var r=function(){n&&e(["modules/clean/sharing/share_modal_util"],function(e){(0,e.showShareModal)(i.user,m.browseStore.context(),{origin:"PARENT_FOLDER_MODAL"})})};t!==m.browseStore.context().currentFQPath?(h.browseNavActions.setUrl({path:t}),h.browseNavActions.setPath({path:t,onPathLoaded:r})):r()},this.refreshSharedWithColumnContentData=function(){i.getContentInfo().isFolder()?d.dispatch({type:p.SharedWithActionTypes.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}}):d.dispatch({type:p.SharedWithActionTypes.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[i.getContentInfo().id]}})},this.handleShareClick=function(e,t){return i.sharingInfo.contentInfo().pathExists()?i.sendShare(e):Promise.resolve().then(function(){i.setContentNameAndSendShare(e,t)})},this.sharingProgressSnackbar=function(e){var t=function(){X.Snackbar.warn(Z("Sharing is taking a while. We’ll let you know when it’s done."))};X.Snackbar.show(r.createElement(X.Snackbar,{onTimeout:t,syncProgressLoop:!0,title:e,timeoutDelayMs:j.SHARING_UNSHARING.TRANSITION_MS,variant:"sync"}))},this.tooManyFilesSnackbar=function(){var e=function(){K.open_tab("/help/files-folders/share-with-others#foldersize")};X.Snackbar.show(r.createElement(X.Snackbar,{actionButtonText:Z("Learn more"),closeButtonText:Z("Close"),onActionClick:e,title:Z("Sharing unsuccessful. This folder has too many files."),variant:"fail"}))},this.shareIfFileFolder=function(e,t){if(j.SHARING_UNSHARING.SNACKBAR_MESSAGES&&i.sharingProgressSnackbar(e),!i.getContentInfo().isFileFolder())return Promise.resolve({});if(i.sharingInfo.shareFolderPromise())return i.sharingInfo.shareFolderPromise();var n;if(n=i.sharingInfo.isNonUserRelativeContext()&&!i.user.is_cdm_member?"ns:"+i.getContentInfo().nsId()+i.getContentInfo().nsPath():i.getContentInfo().displayPath(),j.TRUELINK.TRUELINK_UI[i.user.id]){var s=i.sharingInfo.linkMetadata();s&&s.current_audience!==w.LinkAudience.members&&(t||(t=new w.CombinedPolicy),t.audience||(t=t.set("audience",s.current_audience)))}var r={fqPath:n,folderPolicy:t,confidential:!1};i.sharingInfo.shareAsConfidential()&&(r.confidential=!0);var o=i.client.share(r);return i.dispatch(C.ShareModalActionTypes.SHARE_FOLDER_REQUEST,{promise:o}),o.then(function(e){return i.dispatch(C.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,{metadata:e}),d.dispatch({type:O.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:i.user}),e}).catch(function(e){return i.dispatch(C.ShareModalActionTypes.SHARE_FOLDER_FAILURE),Promise.reject(e)})},this.reportShareFailure=function(e,t){Date.now()-t>j.SHARING_UNSHARING.TRANSITION_MS&&e instanceof l.ServerError?i.tooManyFilesSnackbar():X.Snackbar.fail(U.convertIfHTML(U.genAddMemberErrorMessage(e)))},this.showParentFolderAccessModalIfQualified=function(e,t,n){null!=n&&g.Modal.showInstance(r.createElement(F.ParentFolderAccessModal,{contentInfo:i.getContentInfo(),memberAccessLevelResult:n,memberDisplayName:t.displayName()||"",originalAction:e,isInContentManager:i.sharingInfo.isNonUserRelativeContext(),onClose:i.openShareModal,onParentFolderClicked:i.redirectToPath}))},this.parseParentFolderAccessError=function(e){var t=e.error;if("member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"])return A.memberAccessLevelApiToRecord(i.user.id,t);B.sharingNotificationError(e.message||Z("There was a problem completing this request."))},this.turnLinkOnIfQualified=function(){var e=i.sharingInfo.linkMetadata();return!j.TRUELINK.TRUELINK_UI[i.user.id]||!j.TRUELINK.BROAD_AUDIENCE[i.user.id]||i.sharingInfo.parentSharedFolderId()||e&&e.current_audience!==w.LinkAudience.members?Promise.resolve({}):i.waitForAllMembersLoaded().then(function(){if(!i.sharingInfo.hasNonOwnerMembers())return i.changeLinkAudience(w.LinkAudience.default_on)})},this.updateLinkSettings=function(){},this.waitForAllMembersLoaded=function(){if(i.sharingInfo.areMembersFullyLoaded())return Promise.resolve({});var e=i.sharingInfo.fetchingMembersRequest();return e&&e.promise||Promise.resolve({})},this.client=t,this.user=s,this.shareModalClass=o}return t.prototype.initializeShareModal=function(e,t){void 0===t&&(t={});var n=e.contentInfo;return d.dispatch({type:C.ShareModalActionTypes.SHARE_MODAL_OPEN,data:{shareModalInfo:e,initialProps:t},contentIds:D.getContentIdsForContentInfo(n),user:this.user}),this.sharingInfo=x.sharingInfoStore.getSharingInfo(this.user.id,n.id),this.fetchInitialData()},t.prototype.fetchInitialData=function(){var e=this.sharingInfo.contentInfo(),t=this.sharingInfo.isNonUserRelativeContext();this.beginTime=Date.now(),this.fetchPassInfo(),this.fetchUpsellExperimentVariant();var n=[];return e.isFileFolder()?n.push(this.fetchMetadataForFileFolder(e)):(n.push(this.listMembers(e.id,e.url())),e.isFile()?n.push(this.fetchMetadataForFile(e)):e.isSharedFolder()&&n.push(this.fetchMetadataForSharedFolder(e))),n.push(this.fetchMemberCounts()),j.TRUELINK.TRUELINK_UI[this.user.id]?(this.sharingInfo.isTeamPolicyLoaded()||n.push(this.fetchTeamPolicy()),this.sharingInfo.areSharingPrefsLoaded()||n.push(this.fetchSharingPrefs())):(n.push(this.fetchTeamPolicy()),n.push(this.fetchSharingPrefs()),this.sharingInfo.canShareLink()&&!t&&e.isMounted()&&n.push(this.fetchLinkMetadata())),Promise.all(n)},t.prototype.fetchPassInfo=function(){var e=this;this.sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout(function(){return e.dispatch(C.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)},4e3);var t=this.getPassFileInfo(),n=t.nsId,s=t.sjid;if(t.fromBrowse){var r=E.passStore.passFetchingStatus(n,s);S.fetchingStatusIsSuccessful(r)?(this.groupSeenStateInfo=E.passStore.getLinkAndGroupInfo(n,s).groupInfo,this.presentAccountIds=E.passStore.presence(n,s)):r===S.PASS_FETCHING_STATUS.NOT_YET_KNOWN&&v.PassHelpers.setup({user:this.user,fileData:this.getFileData(),prevFileData:null,shouldWritePresence:!1})}},t.prototype.getSharingInfo=function(){return this.sharingInfo},t.prototype.clearCachedPassInfo=function(){e=[null,null],this.groupSeenStateInfo=e[0],this.presentAccountIds=e[1];var e},t.prototype.getPassInfo=function(){var e=this.getContentInfo();if(e.isFolder())return[{},[],S.PASS_FETCHING_STATUS.ERROR];if(this.groupSeenStateInfo&&this.presentAccountIds)return[this.groupSeenStateInfo,this.presentAccountIds,S.PASS_FETCHING_STATUS.PASS_SUCCESS];var t=this.getPassFileInfo(),n=t.nsId,s=t.sjid;if(!n||!s)return l=[{},[]],this.groupSeenStateInfo=l[0],this.presentAccountIds=l[1],[{},[],S.PASS_FETCHING_STATUS.ERROR];var r=E.passStore.getPassPermissions(e.id);if(E.passStore.isPassPermissionsPending(e.id)||null==r)return[{},[],S.PASS_FETCHING_STATUS.FETCHING];if(null!=r&&!r.canReadPresence)return[{},[],S.PASS_FETCHING_STATUS.ERROR];var o=E.passStore.passFetchingStatus(n,s);if(S.fetchingStatusIsSuccessful(o)){var i=E.passStore.getLinkAndGroupInfo(n,s),a=E.passStore.presence(n,s);return this.groupSeenStateInfo=i.groupInfo,this.presentAccountIds=a?a.slice():[],this.isContentInfoForFilePreview(e)&&this.presentAccountIds.indexOf(this.user.account_id)<0&&this.presentAccountIds.push(this.user.account_id),[this.groupSeenStateInfo,this.presentAccountIds,o]}return[{},[],o];var l},t.prototype.getPassFileInfo=function(){var e,t,n,s=this.getContentInfo(),r=s.extras.origin&&!s.isFolder()&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW"].indexOf(s.extras.origin)>=0,o=s.extras.origin&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW","PREVIEW_PAGE","PREVIEW_PAGE_FACEPILE"].indexOf(s.extras.origin)>=0;return o&&!s.isSharedFolder()?(e=s.nsId(),t=s.sjid(),n=s.beaconContext()):(i=[null,null,null],e=i[0],t=i[1],n=i[2]),{nsId:e,sjid:t,beaconContext:n,fromBrowse:r,contentInfoId:s.id};var i},t.prototype.getUrl=function(){return this.getPassFileInfo().fromBrowse?void 0:f.FileViewerStore.instance.getSharedLinkInfo()&&f.FileViewerStore.instance.getSharedLinkInfo().url},t.prototype.getFileData=function(e){var t=this.getPassFileInfo()
;return{file:{ns_id:t.nsId,sjid:t.sjid,beacon_context:t.beaconContext,file_id:t.contentInfoId},url:e}},t.prototype.getContentInfo=function(){return this.sharingInfo.contentInfo()},t.prototype.dispatch=function(e,t){void 0===t&&(t={}),d.dispatch({type:e,data:t,contentIds:[this.getContentInfo().id],user:this.user})},t.prototype.changeMemberAccess=function(e,t,n){var s=this,r=t.access_type;return this.dispatch(C.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:n}),this.client.updateMember({contentId:e,memberId:t.memberId(),accessLevel:n}).then(function(e){if(e.access_level&&e.warning)return s.dispatch(C.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:e.access_level}),e}).catch(l.catchApiError(function(e){return s.dispatch(C.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:r}),s.parseParentFolderAccessError(e)}))},t.prototype.fetchLinkMetadata=function(){var e=this;return"/"===this.getContentInfo().displayPath()||j.TRUELINK.TRUELINK_UI[this.user.id]?Promise.resolve({}):(this.dispatch(C.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST),this.client.sharedLinkInfo({fileIdOrPath:this.getContentInfo().idForLink()}).then(function(t){e.dispatch(C.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}).catch(function(){e.dispatch(C.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE),m.browseStore.context().isNonUserRelativeContext||(B.sharingNotificationError(Z("There was a problem completing this request.")),g.Modal.close())}))},t.prototype.fetchMemberCounts=function(){var e=this,t=this.getContentInfo();return this.dispatch(C.ShareModalActionTypes.FETCH_MEMBER_COUNTS_REQUEST),t.isSharedFolder()||t.isFolder()&&t.isInSharedFolder()?this.client.getMemberCounts({contentId:t.isSharedFolder()?t.sharedFolderId():t.nsId()}).then(function(t){e.dispatch(C.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS,{memberCounts:t})}):Promise.resolve({})},t.prototype.fetchSharingPrefs=function(){var e=this;return this.dispatch(C.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST),this.client.getSharingPrefs().then(function(t){e.dispatch(C.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:t})})},t.prototype.fetchUpsellExperimentVariant=function(){var e=this;i.SilentBackgroundRequest({url:"/get_sl_upsell_variant",data:{_subject_uid:this.user.id},success:function(t){var n=JSON.parse(t);n&&n.variant&&e.dispatch(C.ShareModalActionTypes.FETCH_UPSELL_EXPERIMENT_VARIANT,n)}})},t.prototype.onShareModalUnmount=function(e){this.teardownPass();var t=e&&e.serializeInputData()||{};this.dispatch(C.ShareModalActionTypes.SHARE_MODAL_CLOSE,t)},t.prototype.fetchTeamPolicy=function(){var e=this;return this.dispatch(C.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST),this.client.getCurrentAccountCached().then(function(t){e.dispatch(C.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:t.team&&t.team.sharing_policies})})},t.prototype.getSuggestableUsers=function(t){var n=this;H.filterSuggestableUsers(t,function(t){var s=t.contacts,o=t.is_admin,i=n.getContentInfo().id;s.length>0?e(["modules/clean/teams/membership_suggestion_modal"],function(e){var t=e.MembershipSuggestionModal;g.Modal.showInstance(r.createElement(t,{isAdmin:o,isFile:n.sharingInfo.contentInfo().isFile(),contacts:s,nsId:i,accessLevel:n.sharingInfo.recipientAccess()}))}):g.Modal.close()},function(){return g.Modal.close()})},t.prototype.handleContentNameChange=function(e){var t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE";this.hasLoggedSet[t]||(this.sharingExperimentsLog(t),this.hasLoggedSet[t]=!0),this.dispatch(C.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE,{name:e})},t.prototype.handleContentNameFocusChange=function(e){this.dispatch(C.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE,{focus:e})},t.prototype.handleUpdateFilePolicy=function(e,t){this.handleUpdateSharingSettings(e);var n=this.getSharingInfo().filePolicy(),s=this.getPassFileInfo(),r=s.nsId,o=s.sjid,i=s.fromBrowse,a=s.contentInfoId;if(null!=r&&null!=o)if(n.viewer_info_policy===w.ViewerInfoPolicy.disabled&&t.viewer_info_policy===w.ViewerInfoPolicy.enabled)this.clearCachedPassInfo(),y.PassActions.resetPassInfo(r,o),y.PassActions.fetchPassError(r,o),this.dispatch(C.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);else{var l=n.audience===w.LinkAudience.members!=(t.audience===w.LinkAudience.members),c=n.viewer_info_policy===w.ViewerInfoPolicy.enabled&&t.viewer_info_policy===w.ViewerInfoPolicy.disabled;if(l||c){this.clearCachedPassInfo();var u=this.getUrl();c&&this.listMembers(a,u),v.PassHelpers.setup({user:this.user,fileData:this.getFileData(u),prevFileData:null,shouldWritePresence:!i})}}},t.prototype.handleUpdateSharingSettings=function(e){this.dispatch(C.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS,{metadata:e})},t.prototype.listMembers=function(e,t,n){return I.SharingActions.listMembers({user:this.user,contentId:this.getContentInfo().id,isFolder:this.sharingInfo.isFolder(),url:t,members:n,client:this.client})},t.prototype.isContentInfoForFilePreview=function(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()},t.prototype.log=function(e,t){void 0===t&&(t={}),U.logTiburonEvent(this.getContentInfo(),this.user.id,e,t)},t.prototype.logIfHaventBefore=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!0),this.hasLoggedSet[e]||(this.hasLoggedSet[e]=!0,n&&(t.timing=Date.now()-this.beginTime),this.log(e,t))},t.prototype.onClickX=function(e){e&&e.finishLogging(!0),this.showTruelinkFeedbackIfQualified(),g.Modal.close()},t.prototype.redirectToBrowseUrl=function(e){h.browseNavActions.setUrl({path:e})},t.prototype.redirectToUpgrade=function(){K.redirect("/upgrade?oqa=spw")},t.prototype.refreshSharedWithColumnLinkData=function(){d.dispatch({type:p.SharedWithActionTypes.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.getContentInfo().displayPath()]}})},t.prototype.removeMember=function(e,t,n,s){var r=this;return this.dispatch(C.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:t}),this.client.removeMember({contentId:e,memberId:t.memberId(),leaveACopy:n}).then(function(e){return r.fetchMemberCounts().then(function(){if(e&&null!=e.access_level&&null!=e.warning)return r.dispatch(C.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:e.access_level}),e;s?B.sharingNotificationSuccess(Z("Folder access removed.")):B.sharingNotificationSuccess(Z("File access removed.")),r.dispatch(C.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS,{member:t})})}).catch(l.catchApiError(function(e){return r.dispatch(C.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:t}),r.parseParentFolderAccessError(e)}))},t.prototype.setAddMessageAsCommentChecked=function(e){this.dispatch(C.ShareModalActionTypes.SET_COMMENT_CHECKBOX_PREF_REQUEST,{checked:e}),this.client.setSharingPrefs({add_message_as_comment_checked:e})},t.prototype.setAddMessageAsCommentHelpClosed=function(){this.dispatch(C.ShareModalActionTypes.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST),this.client.setSharingPrefs({add_message_as_comment_help_shown:!1})},t.prototype.setContentNameAndSendShare=function(e,t){var n=this,r=o.findDOMNode(t),i=r&&r.value,a=u.parent_dir(this.sharingInfo.fqPath());new T.SharingApi(this.user).validate_new_sf_path(i,U.getNewFolderPathFromContentName(i,a),function(){n.dispatch(C.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS,{contentName:i}),n.sendShare(e)},function(e){n.sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME");var t=V.extract_errors(e.responseText);n.dispatch(C.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:t.folder_name&&t.folder_name.message_text});var o=s(r);o&&o.select()})},t.prototype.setLinkMetadata=function(e){this.dispatch(C.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:e})},t.prototype.sendShare=function(e){var t=this;this.log("CLICK_TIB_SEND_BUTTON");var n,s=Date.now(),o=this.isNewlySharedContent();return this.recipientsChange(e&&e.getContacts()).then(function(){return t.sharingInfo.contactsError().level===U.CONTACT_ERROR_LEVEL.ERROR?Promise.reject({}):(t.dispatch(C.ShareModalActionTypes.SEND_SHARE_REQUEST),n=A.contactsToMembers(t.sharingInfo.recipientTokens()),t.shareIfFileFolder(b.reactFormat(Z("Sharing <st>%(folder_name)s</st>..."),{st:r.createElement("strong",null),folder_name:t.sharingInfo.contentInfo().name()})))}).then(function(){return t.turnLinkOnIfQualified(),t.client.addMembers({accessLevel:t.sharingInfo.recipientAccess(),contentId:t.sharingInfo.contentInfo().id,addMessageAsComment:t.sharingInfo.isAddMessageAsCommentChecked(),customMessage:t.sharingInfo.recipientMessage(),members:n})}).catch(l.catchApiError(function(e){t.dispatch(C.ShareModalActionTypes.SEND_SHARE_FAILURE);var r=U.genAddMemberErrorMessage(e);return j.SHARING_UNSHARING.SNACKBAR_MESSAGES?t.reportShareFailure(e,s):z.error(r),t.log("SHARE_MODAL_SEND_FAIL",{timing:Date.now()-s,num_recipients:n.length}),Promise.reject({})})).then(function(){if(t.dispatch(C.ShareModalActionTypes.SEND_SHARE_SUCCESS),j.SHARING_UNSHARING.SNACKBAR_MESSAGES?X.Snackbar.complete(b.reactFormat(Z("Shared <st>%(folder_name)s</st>."),{st:r.createElement("strong",null),folder_name:t.sharingInfo.contentInfo().name()})):z.success(U.genShareSuccessMessage(t.sharingInfo.recipientTokens(),t.sharingInfo.contentInfo().name(),t.sharingInfo.isTeamSharedFolder(),t.sharingInfo.isFolderInsideTeamFolderTree())),t.log("SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-s,num_recipients:n.length}),t.sharingInfo.getInitialProps().onSuccessSharing&&t.sharingInfo.getInitialProps().onSuccessSharing(),e&&e.finishLogging(!1),t.refreshSharedWithColumnContentData(),W.SHOW_CREATE_TEAM_MODAL_AFTER_SHARING&&o&&n.length>=2)g.Modal.showInstance(r.createElement(q.CreateTeamPromptModal,{invitedMembers:t.sharingInfo.recipientTokens().filter(function(e){return e.email!==t.user.email})}));else if(t.sharingInfo.ownerTeam()&&W.SUBGROWTH_PROJECT_MAGNET){var i=t.sharingInfo.recipientTokens().map(function(e){return e.email});t.getSuggestableUsers(i)}else if(j.SHARING_EXPERIMENTS.SHOW_COPY_SCL_LINK[t.user.id]&&t.sharingInfo.isFolder()&&t.sharingInfo.recipientAccess()===P.ACCESS_LEVEL.WRITER){t.sharingExperimentsLog("COPY_SCL_LINK::SHOW_MODAL");var a=Q.parse(t.sharingInfo.metadata().preview_url);a.updateQuery("oref","cslm");var l,c=function(){l.select(),document.execCommand("copy"),B.sharingNotificationSuccess("Link copied to clipboard")},u=r.createElement("input",{onClick:function(){t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_INPUT_ATTEMPT"),c(),t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_INPUT_SUCCESS")},readOnly:!0,ref:function(e){return l=e},style:{width:"96.5%",padding:"7px 0px 7px 15px"},type:"text",value:a.toString()});g.Modal.showInstance(r.createElement(g.Modal,{acceptButtonText:"Copy",autoClose:!1,dismissButtonText:"No thanks",onAccept:function(){t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_COPY_ATTEMPT"),c(),t.sharingExperimentsLog("COPY_SCL_LINK::CLICK_COPY_SUCCESS")},title:"Share via link"},r.createElement("div",{style:{"font-size":"14px",color:"#536170","padding-bottom":"5px"}},"Copy and paste this link if you'd like to send it via email or chat."),r.createElement("div",{style:{"font-size":"12px",color:"#7A8994","margin-bottom":"25px"}},"Only members of the folder can use this link."),u))}else t.showTruelinkFeedbackIfQualified(),g.Modal.close()})},t.prototype.isNewlySharedContent=function(){var e=this.getContentInfo();return e.isFileFolder()||e.isFile()&&!this.sharingInfo.hasNonOwnerMembers()},t.prototype.sharingExperimentsLog=function(e,t){void 0===t&&(t={});var n=this.getContentInfo().extras.modalSessionId;t.modalSessionId=t.modalSessionId||n,a.SharingExperimentsLogger.log(this.user.id,e,t)},t.prototype.showTruelinkFeedbackIfQualified=function(){j.TRUELINK.TRUELINK_UI[this.user.id]&&(this.sharingInfo.hasChangedSharingSettings()?G.showFeedbackFlyoutIfAllowed("settings"):this.sharingInfo.hasChangedLinkAudience()&&G.showFeedbackFlyoutIfAllowed("sender"))},t.prototype.teardownPass=function(){this.clearCachedPassInfo(),this.getPassFileInfo().fromBrowse&&v.PassHelpers.teardown({user:this.user,fileData:this.getFileData(),async:!0,shouldWritePresence:!1})},t.prototype.updateBanner=function(e){this.dispatch(C.ShareModalActionTypes.UPDATE_BANNER,{banner:e})},t})();t.ShareModalActionHandler=$}),define("modules/clean/sharing/actions/sharing_actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/browse/store","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/constants","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/constants/sharing","modules/core/exception"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=s.browseStore;t.SharingActions={loadFileMetadataBatch:function(e,t){return new a.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(l.ALPHA_FILE_METADATA_PERMISSIONS)}).then(function(t){return n.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})})},loadFolderLinkMetadataBatch:function(e,t){var s=m.context().isNonUserRelativeContext;return Promise.resolve({}).then(function(){return t.forEach(function(t){return n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,user:e,contentIds:[t]})})}),new a.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:s}).validateFolderPathBatch({paths:t}).then(function(t){t.forEach(function(t){var s=t.metadata,r=t.path;s&&s.link_metadata?n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,data:{linkMetadata:s.link_metadata},user:e,contentIds:d.getContentIdsForMetadata(s).concat([r])}):n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE,user:e,contentIds:[r]})})})},loadFileMetadata:function(e){var t=e.user,s=e.contentId,r=e.sourceUrl,o=e.client,d=u.sharingInfoStore.getSharingInfo(t.id,s);if(d&&d.fetchingMetadataPromise())return d.fetchingMetadataPromise();o=o||new a.FileShareApiClient({userId:t.id});var p=o.getMetadataAlpha({contentId:s,actions:Object.keys(l.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:r}).then(function(e){n.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:t,data:[e]}),n.dispatch({type:c.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:t})});return n.dispatch({type:i.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[s],data:{promise:p},user:t}),p},listMembers:function(e){var t=e.user,s=e.contentId,l=e.isFolder,c=e.limit,d=e.url,p=e.members,_=e.client,f=e.previewSessionId,g=void 0===f?null:f,y=e.includeSeenState,S=void 0===y||y;h.assert(!c||c<=100,"listMembers not implemented for limit > 100");var v=c||9999999,E=u.sharingInfoStore.getSharingInfo(t.id,s);if(E){var b=E.fetchingMembersRequest();if(b&&v<=b.limitNonNull)return b.promise;if(E.hasDisplayableMembers()&&v<E.members().getMemberCount())return Promise.resolve({})}var C=Math.random().toString(),I=!l,T=m.context().isNonUserRelativeContext;_||(_=l?new a.FolderShareApiClient({userId:t.id,isNonUserRelativeContext:T}):new a.FileShareApiClient({userId:t.id,isNonUserRelativeContext:T}));var w,A=function(e){return e?(n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[s],user:t}),_.listMembersContinue({cursor:e,url:d,isAlpha:I}).then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[s],data:{members:e,requestId:C},user:t}),A(e.cursor)})):Promise.resolve({})};return r.ActionTimestampsTracker.record(o.LoggingActions.LIST_MEMBERS_BEGIN,g),w=p?Promise.resolve(p):_.listMembers({contentId:s,url:d,limit:c,isAlpha:I,includeSeenState:S}),w=w.then(function(e){r.ActionTimestampsTracker.record(o.LoggingActions.LIST_MEMBERS_RECEIVE,g),n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[s],data:{members:e,requestId:C},user:t}),c||A(e.cursor)}),n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[s],data:{limitNonNull:v,requestId:C,promise:w},user:t}),w},fetchFileMemberCount:function(e){var t=e.user,s=e.contentId,l=e.limit,c=e.url,u=e.client,d=e.countGroupsAsMembers,p=void 0!==d&&d,h=e.previewSessionId,m=void 0===h?null:h;u=u||new a.FileShareApiClient({userId:t.id}),r.ActionTimestampsTracker.record(o.LoggingActions.MEMBER_COUNTS_BEGIN,m);var _=u.getMemberCounts({contentId:s,limit:l,url:c,countGroupsAsMembers:p});return n.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[s],user:t}),_.then(function(e){r.ActionTimestampsTracker.record(o.LoggingActions.MEMBER_COUNTS_RECEIVE,m),n.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[s],data:e,user:t})})},fetchLinkMetadata:function(e){var t=e.user,s=e.contentId,r=e.client;p.TRUELINK.TRUELINK_UI[t.id]||(r=r||new a.ShareApiClient({userId:t.id}),n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,contentIds:[s],data:{},user:t}),r.sharedLinkInfo({fileIdOrPath:s}).then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,contentIds:[s],data:{linkMetadata:e},user:t})}))}}}),define("modules/clean/sharing/api",["require","exports","jquery","modules/clean/ajax"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e){this.user=e}return e.prototype.get_sync_vars_for_ns_id=function(e,t,n){var s={ns_id:e,sub_path:t};this._make_request("/sharing/get_sync_vars_for_ns_id",s,n,null,!0)},e.prototype.validate_new_sf_path=function(e,t,n,s){var r={share_type:"new",folder_name:e,path:t};this._make_request("/share_ajax/validate_folder",r,n,s,!0)},e.prototype.validate_shareable_existing_sf_path=function(e,t,n){var s={share_type:"shareable_existing",path:e};this._make_request("/share_ajax/validate_folder",s,t,n,!0)},e.prototype._make_request=function(t,r,o,i,a,l){void 0===a&&(a=!1),void 0===l&&(l=!0);var c={url:t,data:r,success:function(s,i,a){o(a),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:r.ns_id||null})},error:function(e){i&&i(e)}};l&&(c.subject_user=this.user.id),a?s.FormWebRequest(c):s.WebRequest(c)},e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e})();t.SharingApi=r}),function(){var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/api/client",["external/immutable","external/underscore","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/core/exception","modules/core/user_i18n","modules/clean/viewer"],function(t,s,r,o,i,a,l,c,u,d,p){var h,m,_,f,g,y,S,v,E,b,C,I,T,w,A,M,assert,N,k,P,R,L,F,O,x,D,U,B,H,q,V,G,W,j;return w=r.UserActionsRootAwareClient,m=o.AppError,N=o.catchApiError,h=a.ACCESS_LEVEL,S=a.MEMBER_ACTION,_=l.FilePolicy,g=l.FolderPolicy,v=l.MemberPermission,I=l.SharingMembership,T=l.TeamSharingPolicies,A=c.accessLevelConstToApi,M=c.accountInfoApiToRecord,k=c.combinedPolicyDiffToApi,P=c.fileMetadataApiToRecord,R=c.folderMetadataApiToRecord,L=c.fullAccountApiToRecord,F=c.hasFolderMetadataRecordInMetadata,O=c.linkMetadataApiToRecord,x=c.listFilesResultApiToRecord,D=c.listFoldersResultApiToRecord,U=c.makeMemberSelector,B=c.memberAccessLevelApiToRecord,H=c.memberCountsApiToRecord,q=c.membershipApiToRecord,V=c.parseFolderPolicy,W=c.sharedContentLinkMetadataToRecord,j=c.sharingPrefsApiToRecord,assert=u.assert,C=(function(t){function n(e){this.message=e,this.name="ShareError",this.stack=(new Error).stack}return e(n,t),n})(Error),b=(function(){function e(e){var t,n,s;this.userId=e.userId,this.client=null!=(n=e.client)?n:null,t=null!=(s=e.isNonUserRelativeContext)&&s,null==this.client&&(this.client=new w),t&&null==this.teamMemberId&&(this.teamMemberId=p.get_viewer().work_user.team_member_id)}return e.prototype._getHeaders=function(e){return null==e&&(e=null),null!=this.teamMemberId&&(null===e&&(e={}),e["Dropbox-API-Select-Admin"]=this.teamMemberId),e},e.prototype._rpc=function(e,t,n,s,r){return null==n&&(n=null),null==s&&(s=!1),null==r&&(r=null),r=this._getHeaders(r),this.client.rpc(e,t,n,s,r)},e.prototype.addMembers=function(e){var t,n;throw e.contentId,e.members,e.accessLevel,null!=(t=e.customMessage)?t:null,null!=(n=e.quiet)&&n,new TypeError("Not implemented")},e.prototype.removeMember=function(e){throw e.contentId,e.memberId,new TypeError("Not implemented")},e.prototype.getMetadata=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.getMetadataInternal=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.getMetadataAlpha=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.listMembers=function(e){throw e.contentId,e.isAlpha,new TypeError("Not implemented")},e.prototype.listMembersContinue=function(e){throw e.cursor,e.isAlpha,new TypeError("Not implemented")},e.prototype.getMemberCounts=function(e){throw e.contentId,new TypeError("Not implemented")},e.prototype.getParentFolderAccess=function(e){throw e.contentId,e.memberId,e.accessLevel,new TypeError("Not implemented")},e.prototype.updateMember=function(e){throw e.contentId,e.memberId,e.accessLevel,new TypeError("Not implemented")},e.prototype.dismissInviteNotification=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/dismiss_invite_notification",{content_id:t})},e.prototype.getSharingPrefs=function(){return this._rpc(this.userId,"users/get_sharing_prefs",null,!1).then(j)},e.prototype.setSharingPrefs=function(e){return this._rpc(this.userId,"users/set_sharing_prefs",e)},e.prototype.claimMembership=function(e){var t;return t=e.contentUrl,this._rpc(this.userId,"sharing/claim_membership",{content_url:t})},e.prototype.checkJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_job_status",{async_job_id:t})},e.prototype.getAccountBatch=function(e){var t;return t=e.accountIds,t.length>0?this._rpc(this.userId,"users/get_account_batch",{account_ids:t}).then(function(e){return e.map(M)}):Promise.resolve([])},e.prototype._getAccountBatchCache={},e.prototype.getAccountBatchCached=function(e){var t,n,r,o,i,a;return t=e.accountIds,o=this._getAccountBatchCache,i=s.partition(t,function(e){return e in o}),r=i[0],a=i[1],n=s.values(s.pick(o,r)),this.getAccountBatch({accountIds:a}).then(function(e){var t;return t=s.object(e.map(function(e){return[e.account_id,e]})),s.extendOwn(o,t),e.concat(n)})},e.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},e.prototype.getCurrentAccount=function(e){return this._rpc(this.userId,"users/get_current_account").then(function(e){return L(e)})},e.prototype._getCurrentAccountCache=null,e.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},e.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},e.prototype.requestAccess=function(e){var t,n;return t=e.contentUrl,n=e.customMessage,this._rpc(this.userId,"sharing/request_access",{content_url:t,custom_message:n})},e.prototype.sharedLinkInfo=function(e){var t,n;return t=e.fileIdOrPath,assert(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),n=this._rpc(this.userId,"sharing/alpha/list_shared_links",{path:t,direct_only:!0}),n.then(function(e){return 0===e.links.length?null:O(e.links[0])})},e.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this._rpc(this.userId,"sharing/alpha/create_shared_link_with_settings",{path:t}).then(O)},e.prototype.modifySharedLinkSettings=function(e){var t,n,s;return s=e.url,n=e.settings,t=e.remove_expiration,this._rpc(this.userId,"sharing/alpha/modify_shared_link_settings",{url:s,settings:n,remove_expiration:t}).then(O)},e.prototype.revokeSharedLink=function(e){var t;return t=e.url,this._rpc(this.userId,"sharing/revoke_shared_link",{url:t})},e.prototype.getLinkMetadata=function(e){var t;return t=e.url,this._rpc(this.userId,"sharing/alpha/get_link_metadata",{url:t}).then(W)},e.prototype.setLinkSettings=function(e){var t,n;return t=e.linkSettings,n=e.url,this._rpc(this.userId,"sharing/alpha/set_link_settings",{link_settings:t,url:n}).then(W)},e.prototype._addAccountsToMembership=function(e){return this._addAccountsToMembershipBatch(t.Map([[1,e]])).then(function(e){return e.get(1)})},e.prototype._addAccountsToMembershipBatch=function(e){var n;return n=e.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray(),n.length>0?this.getAccountBatchCached({accountIds:n}).then(function(n){var s;return s=t.Map(n.map(function(e){return[e.account_id,e]})),e.map(function(e,t){return e.set("users",e.users.map((function(e){return function(e){var t;return t=s.get(e.account_id),null!=t?e.set("account",t):e}})(this)))})}):Promise.resolve(e)},e})(),E=(function(t){function s(){this.validateFqPath=n(this.validateFqPath,this),this.getMetadataAlpha=n(this.getMetadataAlpha,this),this.getMetadataInternal=n(this.getMetadataInternal,this),this.getMetadata=n(this.getMetadata,this),s.__super__.constructor.apply(this,arguments),this._promises={}}return e(s,t),s.prototype.addMembers=function(e){var t,n;return e.contentId,e.members,e.accessLevel,null!=(t=e.customMessage)?t:null,null!=(n=e.quiet)&&n,this.createPromise("addMembers")},s.prototype.getMetadata=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadata")},s.prototype.getMetadataInternal=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadataInternal")},s.prototype.getMetadataAlpha=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadataAlpha")},s.prototype.dismissInviteNotification=function(e){var t;return e.contentId,null!=(t=e.cursor)?t:null,this.createPromise("dismissInviteNotification")},s.prototype.getSharingPrefs=function(){return this.createPromise("getSharingPrefs")},s.prototype.listMembers=function(e){return e.contentId,e.isAlpha,this.createPromise("listMembers")},s.prototype.listMembersContinue=function(e){return e.cursor,e.isAlpha,this.createPromise("listMembersContinue")},s.prototype.getMemberCounts=function(e){return e.contentId,this.createPromise("getMemberCounts")},s.prototype.getParentFolderAccess=function(e){return e.contentId,e.memberId,e.accessLevel,this.createPromise("getParentFolderAccess")},s.prototype.removeMember=function(e){return e.contentId,e.memberId,this.createPromise("removeMember")},s.prototype.setLinkSettings=function(e){return e.linkSettings,e.url,this.createPromise("setLinkSettings")},s.prototype.share=function(e){var t,n,s,r;return e.fqPath,null!=(t=e.memberPolicy)?t:null,null!=(n=e.aclUpdatePolicy)?n:null,null!=(s=e.sharedLinkPolicy)?s:null,null!=(r=e.forceAsync)&&r,this.createPromise("share")},s.prototype.shareInternal=function(e){var t,n,s;return e.fqPath,null!=(t=e.folderPolicy)?t:null,null!=(n=e.forceAsync)&&n,null!=(s=e.confidential)&&s,this.createPromise("shareInternal")},s.prototype.requestAccess=function(e){return e.contentUrl,e.customMessage,this.createPromise("requestAccess")},s.prototype.sharedLinkInfo=function(e){return e.fileIdOrPath,this.createPromise("sharedLinkInfo")},s.prototype.transferContent=function(e){return e.contentId,e.memberId,this.createPromise("transferContent")},s.prototype.createSharedLink=function(e){return e.fileIdOrPath,this.createPromise("createSharedLink")},s.prototype.updateMember=function(){return this.createPromise("updateMember")},s.prototype.updatePolicyAlpha=function(){return this.createPromise("updatePolicyAlpha")},s.prototype.validateFqPath=function(e){var t;return e.fqPath,null!=(t=e.actions)?t:[],this.createPromise("validateFqPath")},s.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},s.prototype.modifySharedLinkSettings=function(e){return e.url,e.settings,e.remove_expiration,this.createPromise("modifySharedLinkSettings")},s.prototype.revokeSharedLink=function(e){return e.url,this.createPromise("revokeSharedLink")},s.prototype.relinquishMembership=function(e){var t;return e.contentId,null!=(t=e.leaveACopy)&&t,this.createPromise("relinquishMembership")},s.prototype.setConfidentiality=function(e){return e.contentId,e.confidential,this.createPromise("setConfidentiality")},s.prototype.createPromise=function(e){var t;return t=this._promises[e],t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new Promise(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t,t.promise)},s.prototype.getPromise=function(e){var t;return null!=(t=this._promises[e])?t.promise:void 0},s.prototype.resolvePromise=function(e,t,n){var s;return null==n&&(n=!1),this._promises[e]||this.createPromise(e),s=this._promises[e],s.calledBeforeCreatePromise=n,s.resolve.apply(null,t),s.promise},s.prototype.rejectPromise=function(e,t){var n;return this._promises[e]||this.createPromise(e),n=this._promises[e],n.reject.apply(null,t),n.promise},s})(b),f=(function(s){function r(){return this.getMetadataBatchAlpha=n(this.getMetadataBatchAlpha,this),this.getMetadataAlpha=n(this.getMetadataAlpha,this),this.getMetadata=n(this.getMetadata,this),r.__super__.constructor.apply(this,arguments)}return e(r,s),r.prototype.addMembers=function(e){var t,n,s,r,o,i,a,l,c,u,d;return r=e.contentId,i=e.members,o=null!=(l=e.customMessage)?l:null,a=null!=(c=e.quiet)&&c,t=null!=(u=e.accessLevel)?u:h.READER,n=null!=(d=e.addMessageAsComment)&&d,s=A(t),0===(null!=o?o.length:void 0)&&(o=null),this._rpc(this.userId,"sharing/add_file_member",{file:r,members:i,custom_message:o,quiet:a,access_level:s,add_message_as_comment:n})},r.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this._rpc(this.userId,"sharing/remove_file_member_2",{file:t,member:U(n)},!1).then((function(e){return function(t){return B(e.userId,t)}})(this))},r.prototype.getMetadata=function(e){var t,n,s;return n=e.contentId,t=null!=(s=e.actions)?s:[],this._rpc(this.userId,"sharing/get_file_metadata",{file:n,actions:t},!1).then(P)},r.prototype.getMetadataAlpha=function(e){var t,n,s,r;return n=e.contentId,t=null!=(s=e.actions)?s:[],r=e.sourceURL,this._rpc(this.userId,"sharing/alpha/get_file_metadata",{file:n,actions:t,url:r},!1).then(P)},r.prototype.getMetadataBatchAlpha=function(e){var t,n,s;return n=e.contentIds,t=null!=(s=e.actions)?s:[],this._rpc(this.userId,"sharing/alpha/get_file_metadata/batch",{files:n,actions:t},!1).then(function(e){return e.map(function(e){return P(e.result)})})},r.prototype.listMembers=function(e){var t,n,s,r,o,i,a,l,c;return t=e.contentId,c=null!=(o=e.url)?o:null,r=null!=(i=e.limit)?i:100,s=null!=(a=e.isAlpha)&&a,n=null==(l=e.includeSeenState)||l,this._rpc(this.userId,s?"sharing/alpha/list_file_members":"sharing/list_file_members",{file:t,actions:S.ALL,include_inherited:!0,limit:r,url:s?c:void 0,include_seen_state:n},!1).then(q).then(this._addAccountsToMembership.bind(this))},r.prototype.listMembersContinue=function(e){var t,n,s,r,o;return t=e.cursor,o=null!=(s=e.url)?s:null,n=null!=(r=e.isAlpha)&&r,this._rpc(this.userId,n?"sharing/alpha/list_file_members/continue":"sharing/list_file_members/continue",{cursor:t,url:n?o:void 0}).then(function(e){return q(e,null)}).then(this._addAccountsToMembership.bind(this))},r.prototype.listMembersBatch=function(e){var n,s,r;return n=e.contentIds,s=null!=(r=e.limit)?r:10,
this._rpc(this.userId,"sharing/list_file_members/batch",{files:n,limit:s}).then(function(e){var n,s,r,o;for(o={},s=0,r=e.length;s<r;s++)n=e[s],"result"===n.result[".tag"]&&(o[n.file]=q(n.result.members,n.result.member_count));return t.Map(o)}).then(this._addAccountsToMembershipBatch.bind(this))},r.prototype.getMemberCounts=function(e){var t,n,s,r,o,i;return t=e.contentId,s=e.limit,n=null!=(r=e.countGroupsAsMembers)&&r,i=null!=(o=e.url)?o:null,this._rpc(this.userId,"sharing/get_file_member_counts",{file:t,limit:s,count_groups_as_members:n,url:i})},r.prototype.getParentFolderAccess=function(e){throw e.contentId,e.memberId,e.accessLevel,new C("Parent folder access points not implemented for files")},r.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/relinquish_file_membership",{file:String(t)})},r.prototype.listReceivedFiles=function(e){var t,n,s,r;return n=null!=(s=e.limit)?s:100,t=null!=(r=e.actions)?r:[],this._rpc(this.userId,"sharing/list_received_files",{limit:n,actions:t}).then(x)},r.prototype.listReceivedFilesContinue=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/list_received_files/continue",{cursor:t}).then(x)},r.prototype.updateMember=function(e){var t,n,s;return n=e.contentId,s=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/update_file_member",{file:String(n),member:U(s),access_level:A(t)}).then((function(e){return function(t){return B(e.userId,t)}})(this))},r.prototype.updatePolicy=function(e){var t,n,s,r;return s=e.contentId,r=e.newPolicy,t=e.actions,n=k(r),n.actions=t,n.file=s,this._rpc(this.userId,"sharing/alpha/update_file_policy",n).then(function(e){return null!=e.metadata&&(e=e.metadata),P(e)})},r.prototype.unshare=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/unshare_file",{file:String(t)})},r})(b),y=(function(t){function s(){return this.updatePolicyAlpha=n(this.updatePolicyAlpha,this),this.updatePolicy=n(this.updatePolicy,this),this.validateFqPath=n(this.validateFqPath,this),this.getMetadata=n(this.getMetadata,this),s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.share=function(e){var t,n,s,r,o;return r=e.fqPath,s=e.folderPolicy,n=null!=(o=e.confidential)&&o,t=k(s),t.path=r,t.confidentiality=n?"confidential":"not_confidential",this._rpc(this.userId,"sharing/alpha/share_folder",t,!1).then((function(e){return function(t){return("complete"===t[".tag"]?Promise.resolve(t):G(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))).then(R)}})(this))},s.prototype.checkShareJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_share_internal_job_status",{async_job_id:t})},s.prototype.checkRemoveMemberJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_remove_member_job_status",{async_job_id:t})},s.prototype.addMembers=function(e){var t,n,s,r,o,i,a,l,c,u;return r=e.contentId,a=e.members,t=e.accessLevel,o=null!=(c=e.customMessage)?c:null,l=null!=(u=e.quiet)&&u,s=A(t),0===(null!=o?o.length:void 0)&&(o=null),n={shared_folder_id:String(r),members:(function(){var e,t,n;for(n=[],e=0,t=a.length;e<t;e++)i=a[e],n.push({member:i,access_level:s});return n})(),custom_message:o,quiet:l},this._rpc(this.userId,"sharing/add_folder_member",n,!1)},s.prototype.fetchNsId=function(e){return this._rpc(this.userId,"files/get_metadata",{path:e}).then(function(e){var t;return null!=(t=e.sharing_info)?t.shared_folder_id:void 0})},s.prototype.getMetadata=function(e){var t,n,s;return n=e.contentId,t=null!=(s=e.actions)?s:[],this._rpc(this.userId,"sharing/alpha/get_folder_metadata",{shared_folder_id:String(n),actions:t},!1).then(R)},s.prototype._metadataAndInheritMembers=function(e){var t;return t=e.members_cursor,t?this.listMembersContinue({cursor:t}).then(function(t){return{metadata:e,inheritedMembers:t}}):{metadata:e,inheritedMembers:new I}},s.prototype.validateFqPath=function(e){var t,n,s,r,o,i,a,l,c,u;return n=e.fqPath,t=null!=(r=e.actions)?r:[],s=null!=(o=e.listMembersArg)?o:{},u=null!=(i=e.shouldParseMetadataFromError)&&i,c=null!=(a=e.shareAsConfidential)&&a,l=this._rpc(this.userId,"sharing/validate_folder_path",{path:n,actions:t,list_members_arg:s,confidentiality:c?"confidential":"not_confidential"},!1),this.validatePathContinue(l,u)},s.prototype.validatePathContinue=function(e,t){return e.catch(N(function(e){var n,s;if("already_shared"===(null!=(n=e.error)&&null!=(s=n.bad_path)?s[".tag"]:void 0))return e.error.bad_path;if(t&&e instanceof m&&e.error&&"no_permission"===e.error[".tag"]&&F(e.error))return e.error;throw e})).then(R).then(this._metadataAndInheritMembers.bind(this))},s.prototype.validateFolderPathBatch=function(e){var t;return t=e.paths,this._rpc(this.userId,"sharing/validate_folder_path/batch",{paths:t}).then(function(e){return e.entries.map(function(e){var t,n,s,r,o,i;return i=e.result,t=null,"metadata"===i[".tag"]?t=i:"no_permission"===(null!=(s=i.path_error)?s[".tag"]:void 0)?t=i.path_error:"already_shared"===(null!=(r=i.path_error)&&null!=(o=r.bad_path)?o[".tag"]:void 0)&&(t=i.path_error.bad_path),n=null,t&&t.link_metadata&&(n=R(t)),{path:e.path,metadata:n}})})},s.prototype.updatePolicy=function(e){var t,n,s;return n=e.contentId,s=e.newPolicy,t=s,t.shared_folder_id=String(n),this._rpc(this.userId,"sharing/update_folder_policy",t,!1).then(R)},s.prototype.updatePolicyAlpha=function(e){var t,n,s;return n=e.contentId,s=e.newPolicy,t=k(s),t.shared_folder_id=String(n),this._rpc(this.userId,"sharing/alpha/update_folder_policy",t,!1).then(R)},s.prototype.unshare=function(e){var t,n,s;return t=e.contentId,n=null!=(s=e.leaveACopy)&&s,this._rpc(this.userId,"sharing/unshare_folder",{shared_folder_id:String(t),leave_a_copy:n}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve(t):G(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}})(this))},s.prototype.listMembers=function(e){var t,n,s,r;return t=e.contentId,n=null!=(s=e.limit)?s:100,null!=(r=e.isAlpha)&&r,this._rpc(this.userId,"sharing/list_folder_members",{shared_folder_id:String(t),actions:S.ALL,limit:n},!1).then(q).then(this._addAccountsToMembership.bind(this))},s.prototype.listMembersContinue=function(e){var t,n;return t=e.cursor,null!=(n=e.isAlpha)&&n,this._rpc(this.userId,"sharing/list_folder_members/continue",{cursor:t},!1).then(function(e){return q(e,null)}).then(this._addAccountsToMembership.bind(this))},s.prototype.listMountableFolders=function(e){var t,n,s,r,o;return s=null!=e?e:{},n=null!=(r=s.limit)?r:100,t=null!=(o=s.actions)?o:[],this._rpc(this.userId,"sharing/list_mountable_folders",{limit:n,actions:t}).then(D)},s.prototype.listMountableFoldersContinue=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/list_mountable_folders/continue",{cursor:t}).then(D)},s.prototype.listMountableFoldersAlpha=function(e){var t,n,s,r,o;return s=null!=e?e:{},n=null!=(r=s.limit)?r:100,t=null!=(o=s.actions)?o:[],this._rpc(this.userId,"sharing/alpha/list_mountable_folders",{limit:n,actions:t}).then(D)},s.prototype.listMountableFoldersContinueAlpha=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/alpha/list_mountable_folders/continue",{cursor:t}).then(D)},s.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/get_folder_member_counts",{shared_folder_id:String(t)},!1).then(H)},s.prototype.getParentFolderAccess=function(e){var t,n,s;return n=e.contentId,s=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/get_parent_folder_access",{shared_folder_id:String(n),member:U(s),access_level:null!=t?A(t):void 0},!1).then(B.bind(null,this.userId))},s.prototype.relinquishMembership=function(e){var t,n,s;return t=e.contentId,n=null!=(s=e.leaveACopy)&&s,this._rpc(this.userId,"sharing/relinquish_folder_membership",{shared_folder_id:String(t),leave_a_copy:n}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve():G(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}})(this))},s.prototype.removeMember=function(e){var t,n,s,r;return t=e.contentId,s=e.memberId,n=null!=(r=e.leaveACopy)&&r,this._rpc(this.userId,"sharing/remove_folder_member",{shared_folder_id:String(t),member:U(s),leave_a_copy:n},!1).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve():G(e.checkRemoveMemberJobStatus.bind(e,{jobId:t.async_job_id}))}})(this)).then((function(e){return function(t){return B(e.userId,t)}})(this))},s.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this._rpc(this.userId,"sharing/transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n})},s.prototype.updateMember=function(e){var t,n,s;return n=e.contentId,s=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/update_folder_member",{shared_folder_id:String(n),member:U(s),access_level:A(t)},!1).then((function(e){return function(t){return B(e.userId,t)}})(this))},s.prototype.mount=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)}).then(R)},s.prototype.unmount=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/unmount_folder",{shared_folder_id:String(t)})},s.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this._rpc(this.userId,"sharing/set_confidentiality",{shared_folder_id:String(n),confidentiality:t?"confidential":"not_confidential"}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve(t):G(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))}})(this)).then(R)},s})(b),G=function(e,t){var n,s,r,o,i,a,l;return o=null!=t?t:{},r=null!=(i=o.interval)?i:1e3,l=null!=(a=o.timeout)?a:null,s=null!=l?Date.now()+l:null,n=function(t,o){return null!=s&&Date.now()>s?o():e().then(function(e){switch(e[".tag"]){case"failed":return o(e);case"complete":return t(e);case"in_progress":return window.setTimeout(n,r,t,o)}}).catch(N(function(e){return o(e)}))},new Promise(n)},{FilePolicy:_,FileShareApiClient:f,FolderPolicy:g,FolderShareApiClient:y,MemberPermission:v,MockShareApiClient:E,parseFolderPolicy:V,ShareError:C,ShareApiClient:b,TeamSharingPolicies:T}})}.call(this),define("modules/clean/sharing/api/mount_client",["require","exports","modules/clean/api_v2/root_aware_client"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=e.userId;this.client=new n.UserActionsRootAwareClient,this.userId=t}return e.prototype.mount=function(e){var t=e.contentId;return this.client.rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)})},e})();t.MountFolderApiClient=s}),define("modules/clean/sharing/api/types/metadata",["require","exports","tslib","external/immutable","modules/clean/api_v2/types"],function(e,t,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.AclUpdatePolicy={owner:new r.UnionScalar("owner"),editors:new r.UnionScalar("editors")},t.SharedLinkPolicy={anyone:new r.UnionScalar("anyone"),members:new r.UnionScalar("members")},t.SharedFolderMemberMemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.SharedFolderJoinPolicy={from_team_only:new r.UnionScalar("from_team_only"),from_anyone:new r.UnionScalar("from_anyone")},t.SharedLinkCreatePolicy={default_public:new r.UnionScalar("default_public"),default_team_only:new r.UnionScalar("default_team_only"),team_only:new r.UnionScalar("team_only")},t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},t.VisibilityDisallowedReason={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team",permission_denied:"permission_denied"},t.LinkExpiryPolicy={policy_name:"expires"},t.ViewerInfoPolicy={policy_name:"viewer_info_policy",enabled:"enabled",disabled:"disabled"},t.DownloadPolicy={policy_name:"download_policy",allow:"allow",disallow:"disallow"},t.LinkAudience={public:"public",team:"team",members:"members",default_on:"default_on"},t.GroupManagementType={user_managed:new r.UnionScalar("user_managed"),company_managed:new r.UnionScalar("company_managed"),system_managed:new r.UnionScalar("system_managed")};var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({id:null,name:null},"Team"));t.Team=o;var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"));t.TeamMemberInfo=i;var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({id:null,name:null,sharing_policies:null},"FullTeam"));t.FullTeam=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null},"TeamSharingPolicies"));t.TeamSharingPolicies=l;var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"));t.BasicAccount=c;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"));t.FullAccount=u;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({allow:!1,reason:null},"PermissionSetting"));t.PermissionSetting=d;var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.shared_folder_id||this.path_lower},t.prototype.isSharedFolder=function(){return Boolean(this.shared_folder_id)},t.prototype.isNewSharedFolder=function(){return!this.shared_folder_id},t})(s.Record({access_type:null,is_confidential:!1,is_inside_team_folder:!1,is_team_folder:!1,link_metadata:null,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null},"SharedFolderMetadata"));t.SharedFolderMetadata=p;var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy"));t.FolderPolicy=h;var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,shared_link_policy:null,audience:null,access_level:null,expiry:null,password:null},"CombinedPolicy"));t.CombinedPolicy=m;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,update_confidentiality:null,unmount:null,unshare:null},"FolderPermissions"));t.FolderPermissions=_;var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({entries:s.Map(),cursor:null},"ListFoldersResult"));t.ListFoldersResult=f;var g=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.id},t.prototype.isSharedFolder=function(){return!1},t.prototype.isNewSharedFolder=function(){return!1},t})(s.Record({access_type:null,id:null,file_policy:null,link_metadata:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null},"SharedFileMetadata"));t.SharedFileMetadata=g;var y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_viewer:null,invite_viewer_no_comment:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,unshare:null,view_members:null},"FilePermissions"));t.FilePermissions=y;var S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({audience:null,download_policy:null,viewer_info_policy:null},"FilePolicy"));t.FilePolicy=S;var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({entries:s.Map(),cursor:null},"ListFilesResult"));t.ListFilesResult=v;var E=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberCount=function(){return this.memberCount||this.invitees.count()+this.groups.count()+this.users.count()},t})(s.Record({cursor:null,invitees:s.Map(),groups:s.Map(),users:s.Map(),memberCount:null},"SharingMembership"));t.SharingMembership=E,t.makeMemberKey=function(e,t){return e+":"+t};var b=(function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(s,e),s.prototype.memberId=function(){return this.account_id},s.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},s.prototype.displayName=function(){return this.account?this.account.display_name:void 0},s.prototype.type=function(){return"users"},s})(s.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null,time_last_seen:null},"UserMembershipInfo"));t.UserMembershipInfo=b;var C=(function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(s,e),s.prototype.memberId=function(){return this.contact_type+":"+this.contact},s.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},s.prototype.displayName=function(){return this.contact},s.prototype.type=function(){return"invitees"},s})(s.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo"));t.InviteeMembershipInfo=C;var I=(function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(s,e),s.prototype.memberId=function(){return this.group_id},s.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},s.prototype.displayName=function(){return this.group_name},s.prototype.type=function(){return"groups"},s})(s.Record({access_type:null,group_external_id:null,group_id:null,group_management_type:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_member:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"));t.GroupMembershipInfo=I;var T=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions"));t.MemberPermissions=T;var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({total_unique_users:null,users_outside_team:null,exceeds_count:!1},"MemberCounts"));t.MemberCounts=w;var A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult"));t.MemberAccessLevelResult=A;var M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({name:null,shared_folder_id:null,path:null,permissions:null},"ParentFolderInfo"));t.ParentFolderInfo=M;var N=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isFolder=function(){return"folder"===this.file_type},t.prototype.teamInfo=function(){return this.content_owner_team_info?this.content_owner_team_info:this.team_member_info?this.team_member_info.team_info:void 0},t})(s.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null,preview_type:null},"LinkMetadata"));t.LinkMetadata=N;var k=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({requested_visibility:null,link_password:null,expires:null,allow_download:null},"LinkPolicy"));t.LinkPolicy=k;var P=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null},"LinkPermissions"));t.LinkPermissions=P;var R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null},"LinkVisibilityPolicy"));t.LinkVisibilityPolicy=R;var L=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({add_message_as_comment_checked:null,add_message_as_comment_help_shown:null,access_reader_no_comment_content_links:null,access_reader_no_comment_shared_folders:null},"SharingPrefs"));t.SharingPrefs=L;var F=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({change_audience:null,remove_expiry:null,remove_password:null,set_expiry:null,set_password:null},"SharedContentLinkPermissions"));t.SharedContentLinkPermissions=F;var O=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({shared_folder_id:null,name:null,audience:null},"AudienceRestrictingSharedFolder"));t.AudienceRestrictingSharedFolder=O;var x=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({audience_options:null,current_audience:null,expiry:null,link_permissions:null,password_protected:null,url:null,audience_restricting_shared_folder:null,access_level:null},"SharedContentLinkMetadata"));t.SharedContentLinkMetadata=x;var D=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({audience:null,remove_expiry:null,set_expiry:null,remove_password:null,set_password:null,access_level:null},"SharedContentLinkSettings"));t.SharedContentLinkSettings=D}),define("modules/clean/sharing/api/util/types",["require","exports","tslib","modules/clean/contacts/types","external/immutable","external/underscore","modules/clean/api_v2/types","modules/clean/sharing/access_level","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata"],function(e,t,n,s,r,o,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accessLevelConstToApi=function(e){switch(e){case a.ACCESS_LEVEL.OWNER:return new i.UnionScalar("owner");case a.ACCESS_LEVEL.WRITER:return new i.UnionScalar("editor");case a.ACCESS_LEVEL.READER:return new i.UnionScalar("viewer");case a.ACCESS_LEVEL.READER_NO_COMMENT:return new i.UnionScalar("viewer_no_comment");default:throw new Error("unknown access level")}},t.accessLevelApiToConst=function(e){switch(e.type||e){case"owner":return a.ACCESS_LEVEL.OWNER;case"editor":return a.ACCESS_LEVEL.WRITER;case"viewer":return a.ACCESS_LEVEL.READER;case"viewer_no_comment":return a.ACCESS_LEVEL.READER_NO_COMMENT}},t.groupManagementTypeApiToConst=function(e){if(!e)return null;switch(e[".tag"]){case"user_managed":return c.GroupManagementType.user_managed;case"company_managed":return c.GroupManagementType.company_managed;case"system_managed":return c.GroupManagementType.system_managed;default:return}},t.hasFolderMetadataRecordInMetadata=function(e){return null!=e.path_lower&&null!=e.access_type&&null!=e.policy},t.folderPolicyApiToRecord=function(e){return null==e?new c.FolderPolicy:new c.FolderPolicy({acl_update_policy:e.acl_update_policy&&e.acl_update_policy[".tag"],download_policy:e.download_policy&&e.download_policy[".tag"],member_policy:e.member_policy&&e.member_policy[".tag"],resolved_member_policy:e.resolved_member_policy&&e.resolved_member_policy[".tag"],shared_link_policy:e.shared_link_policy&&e.shared_link_policy[".tag"],viewer_info_policy:e.viewer_info_policy&&e.viewer_info_policy[".tag"]})};var u=function(e){for(var t={},n=0,s=e;n<s.length;n++){var r=s[n];t[r.action[".tag"]]=new c.PermissionSetting({allow:r.allow,reason:r.reason?r.reason[".tag"]:void 0})}return t};t.sharedContentLinkPermissionsApiToRecord=function(e){var t=u(e);return new c.SharedContentLinkPermissions(t)},t.audienceRestrictingSharedFolderToRecord=function(e){return new c.AudienceRestrictingSharedFolder({shared_folder_id:e.shared_folder_id,name:e.name,audience:e.audience[".tag"]})},t.sharedContentLinkMetadataToRecord=function(e){return new c.SharedContentLinkMetadata({audience_options:r.List(e.audience_options.map(function(e){return e[".tag"]})),current_audience:e.current_audience[".tag"],expiry:e.expiry&&new Date(e.expiry)>new Date?new Date(e.expiry):void 0,link_permissions:t.sharedContentLinkPermissionsApiToRecord(e.link_permissions),password_protected:e.password_protected,url:e.url,audience_restricting_shared_folder:e.audience_restricting_shared_folder&&t.audienceRestrictingSharedFolderToRecord(e.audience_restricting_shared_folder),access_level:e.access_level&&e.access_level[".tag"]})},t.parseFolderPolicy=t.folderPolicyApiToRecord,t.folderPermissionsApiToRecord=function(e){var t=u(e);return new c.FolderPermissions(t)},t.folderMetadataApiToRecord=function(e){return new c.SharedFolderMetadata({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),is_inside_team_folder:e.is_inside_team_folder,is_team_folder:e.is_team_folder,link_metadata:null!=e.link_metadata?t.sharedContentLinkMetadataToRecord(e.link_metadata):void 0,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new c.Team(e.owner_team):void 0,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?t.folderPermissionsApiToRecord(e.permissions):void 0,policy:t.parseFolderPolicy(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0})},t.listFoldersResultApiToRecord=function(e){return new c.ListFoldersResult({entries:r.Map(e.entries.map(t.folderMetadataApiToRecord).map(function(e){return[e.shared_folder_id,e]})),cursor:e.cursor})},t.filePermissionsApiToRecord=function(e){var t={};if(e)for(var n=0,s=e;n<s.length;n++){var r=s[n];t[r.action[".tag"]]=new c.PermissionSetting({allow:r.allow,reason:r.reason&&r.reason[".tag"]})}return new c.FilePermissions(t)},t.getFilePolicy=function(e){var t={};return t[c.ViewerInfoPolicy.policy_name]=e&&e.viewer_info_policy&&e.viewer_info_policy[".tag"],t[c.DownloadPolicy.policy_name]=e&&e.download_policy&&e.download_policy[".tag"]||c.DownloadPolicy.allow,new c.FilePolicy(t)},t.fileMetadataApiToRecord=function(e){return new c.SharedFileMetadata({access_type:null!=e.access_type?t.accessLevelApiToConst(i.Union.parse(e.access_type)):a.ACCESS_LEVEL.READER,id:e.id,file_policy:t.getFilePolicy(e.policy),link_metadata:e.link_metadata&&t.sharedContentLinkMetadataToRecord(e.link_metadata),name:e.name,owner_team:e.owner_team&&new c.Team(e.owner_team),policy:null!=e.policy?t.parseFolderPolicy(e.policy):new c.FolderPolicy,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:t.filePermissionsApiToRecord(e.permissions),preview_url:e.preview_url,time_invited:e.time_invited&&new Date(e.time_invited)})},t.listFilesResultApiToRecord=function(e){return new c.ListFilesResult({entries:r.Map(e.entries.map(function(e){return[e.id,t.fileMetadataApiToRecord(e)]})),cursor:e.cursor})},t.memberPermissionsApiToRecord=function(e){var t={};if(null!=e)for(var n=0,s=e;n<s.length;n++){var r=s[n];t[r.action[".tag"]]=new c.PermissionSetting({allow:r.allow,reason:r.reason&&r.reason[".tag"]})}return new c.MemberPermissions(t)},t.inviteeMembershipApiToRecord=function(e){var n=e.invitee[".tag"];return new c.InviteeMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),contact:e.invitee[n],contact_type:n,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:Boolean(e.user&&e.user.same_team)})},t.groupMembershipApiToRecord=function(e){return new c.GroupMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_management_type:t.groupManagementTypeApiToConst(e.group.group_management_type),group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_member:e.group.is_member,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.group.same_team})},t.userMembershipApiToRecord=function(e){return new c.UserMembershipInfo({access_type:t.accessLevelApiToConst(i.Union.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id,time_last_seen:e.time_last_seen&&new Date(e.time_last_seen)})},t.membershipApiToRecord=function(e,n){return void 0===n&&(n=null),new c.SharingMembership({cursor:e.cursor,invitees:r.Map(e.invitees.map(function(e){var n=t.inviteeMembershipApiToRecord(e);return[n.memberKey(),n]})),groups:r.Map(e.groups.map(function(e){var n=t.groupMembershipApiToRecord(e);return[n.memberKey(),n]})),users:r.Map(e.users.map(function(e){var n=t.userMembershipApiToRecord(e);return[n.memberKey(),n]})),memberCount:n})},t.memberCountsApiToRecord=function(e){return new c.MemberCounts(e)},t.parentFolderInfoApiToRecord=function(e){return new c.ParentFolderInfo({name:e.folder_name,shared_folder_id:e.shared_folder_id,path:e.path,permissions:t.memberPermissionsApiToRecord(e.permissions)})},t.memberAccessLevelApiToRecord=function(e,n){if(null==n)return new c.MemberAccessLevelResult;var s;return null!=n.access_details&&(s=n.access_details.map(function(e){return t.parentFolderInfoApiToRecord(e)})),new c.MemberAccessLevelResult({access_level:n.access_level&&t.accessLevelApiToConst(i.Union.parse(n.access_level)),warning:n.warning,parentFolders:s})},t.teamMemberInfoApiToRecord=function(e){return null==e?null:new c.TeamMemberInfo({display_name:e.display_name,member_id:e.member_id,team_info:e.team_info&&new c.Team(e.team_info)})},t.visibilityPolicyApiToRecord=function(e){return new c.LinkVisibilityPolicy({
policy:e.policy&&e.policy[".tag"],resolved_policy:e.resolved_policy&&e.resolved_policy[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason&&e.disallowed_reason[".tag"]})},t.linkPermissionsApiToRecord=function(e){return null==e?new c.LinkPermissions:new c.LinkPermissions({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,requested_visibility:e.requested_visibility&&e.requested_visibility[".tag"],resolved_visibility:e.resolved_visibility&&e.resolved_visibility[".tag"],restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:e.revoke_failure_reason&&e.revoke_failure_reason[".tag"],team_restricts_comments:e.team_restricts_comments,visibility_policies:e.visibility_policies&&e.visibility_policies.map(t.visibilityPolicyApiToRecord)})},t.linkMetadataApiToRecord=function(e){return new c.LinkMetadata({url:e.url,client_modified:e.client_modified&&new Date(e.client_modified),content_owner_team_info:e.content_owner_team_info&&new c.Team(e.content_owner_team_info),expires:e.expires&&new Date(e.expires),file_type:e[".tag"],id:e.id,link_permissions:t.linkPermissionsApiToRecord(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:e.server_modified&&new Date(e.server_modified),size:e.size,team_member_info:t.teamMemberInfoApiToRecord(e.team_member_info),preview_type:e.preview_type})},t.accountInfoApiToRecord=function(e){return new c.BasicAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},t.teamSharingPoliciesApiToRecord=function(e){return e&&new c.TeamSharingPolicies({shared_folder_member_policy:e.shared_folder_member_policy&&e.shared_folder_member_policy[".tag"],shared_folder_join_policy:e.shared_folder_join_policy&&e.shared_folder_join_policy[".tag"],shared_link_create_policy:e.shared_link_create_policy&&e.shared_link_create_policy[".tag"]})},t.fullAccountApiToRecord=function(e){var n=e.team&&new c.FullTeam({id:e.team.id,name:e.team.name,sharing_policies:t.teamSharingPoliciesApiToRecord(e.team.sharing_policies)});return new c.FullAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:n})},t.sharingPrefsApiToRecord=function(e){return new c.SharingPrefs({add_message_as_comment_checked:e.add_message_as_comment_checked,add_message_as_comment_help_shown:e.add_message_as_comment_help_shown,access_reader_no_comment_content_links:e.access_reader_no_comment_content_links,access_reader_no_comment_shared_folders:e.access_reader_no_comment_shared_folders})},t.makeMemberSelector=function(e){return e.startsWith("email:")?new i.UnionScalar("email",e.substr(6)):new i.UnionScalar("dropbox_id",e)},t.parseSharedLinkMetadata=function(e){if(null==e)return null;var t=i.Union.parse(e.link_permissions.resolved_visibility).type,s=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},r={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:e.expires&&new Date(e.expires),visibility:t,isPackage:e.is_package};return new l.LinkInfo(n.__assign({},r,s))},t.contactsToMembers=function(e){return e.map(function(e){if(e.type===s.NEW_STYLE_GROUP)return new i.UnionScalar("dropbox_id",e.getContactID());if(e.type!==s.INVALID_ID)return new i.UnionScalar("email",e.getContactID());throw new Error("Unknown contact type")})},t.getCombinedPolicy=function(e,t){return new c.CombinedPolicy({acl_update_policy:e instanceof c.FolderPolicy?e.acl_update_policy:void 0,download_policy:e.download_policy||"allow",member_policy:e instanceof c.FolderPolicy?e.resolved_member_policy:void 0,viewer_info_policy:e.viewer_info_policy,shared_link_policy:e instanceof c.FolderPolicy?e.shared_link_policy:void 0,audience:t&&t.current_audience,access_level:t&&t.access_level,expiry:{status:t&&t.expiry?"on":"off",value:t&&t.expiry||""},password:{status:t&&t.password_protected?"on":"off"}})},t.combinedPolicyDiffToApi=function(e){var t={};if(!e)return t;null!=e.acl_update_policy&&(t.acl_update_policy=e.acl_update_policy),null!=e.download_policy&&(t.download_policy=e.download_policy),null!=e.member_policy&&(t.member_policy=e.member_policy),null!=e.viewer_info_policy&&(t.viewer_info_policy=e.viewer_info_policy),null!=e.shared_link_policy&&(t.shared_link_policy=e.shared_link_policy);var n={};if(null!=e.audience&&(n.audience=new i.UnionScalar(e.audience)),null!=e.access_level&&(n.access_level=new i.UnionScalar(e.access_level)),null!=e.expiry){var s=e.expiry;if("on"===s.status&&s.value)s.value.setHours(23),s.value.setMinutes(59),s.value.setSeconds(59),n.expiry=new i.UnionScalar("set_expiry",i.formatTimestamp(s.value)).toJSON();else{if("off"!==s.status)throw new Error("Bad expiry settings");n.expiry=new i.UnionScalar("remove_expiry").toJSON()}}if(null!=e.password){var r=e.password;"on"===r.status&&r.value?n.password=new i.UnionScalar("set_password",r.value).toJSON():"off"===r.status&&(n.password=new i.UnionScalar("remove_password").toJSON())}return o.keys(n).length>0&&(t.link_settings=n),t}}),define("modules/clean/sharing/components/button_group",["require","exports","tslib","external/spectrum/button","external/react","modules/clean/react/css"],function(e,t,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this;return r.createElement("div",{className:"sharing-button-group"},this.props.options.map(function(t){var n=t.value,o=t.label,i=n===e.props.value;return r.createElement(s.Button,{key:n,variant:i?"primary":"secondary",onClick:function(){return e.props.onSelectValue(n)},disabled:i},o)}))},t})(r.Component);t.ButtonGroup=o(i,["/static/css/sharing/components-vflrV8W4h.css"])}),define("modules/clean/sharing/confirmation_modals/confirm_with_option_modal",["require","exports","tslib","external/react","modules/clean/react/modal"],function(e,t,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var n=e.call(this,t)||this;if(null==n.props.children)throw new Error("Must have children prop");return n.state={checked:!1},n.handleOptionClick=n.handleOptionClick.bind(n),n.handleAccept=n.handleAccept.bind(n),n.handleDismissCompleted=n.handleDismissCompleted.bind(n),n}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(r.Modal,{acceptButtonText:this.props.confirmText,autoClose:this.props.autoClose,className:"simple-modal confirm-with-option-modal",dismissButtonText:this.props.cancelText,onAccept:this.handleAccept,onDismissCompleted:this.handleDismissCompleted,title:this.props.title},s.createElement("div",{className:"simple-modal-content"},s.createElement("div",{className:"confirm-with-option-modal__body-text"},this.props.children),this.renderOption()))},t.prototype.renderOption=function(){return this.props.showOption?s.createElement("div",{className:"u-mar-vertical-s confirm-with-option-modal__option"},s.createElement("input",{"aria-checked":this.state.checked,checked:this.state.checked,className:"confirm-with-option-modal__option-input",id:"confirm-with-option-modal__input",name:"confirmation_option",onClick:this.handleOptionClick,role:"checkbox",type:"checkbox"}),s.createElement("label",{className:"confirm-with-option-modal__option-label",htmlFor:"confirm-with-option-modal__input"},this.props.optionLabel)):null},t.prototype.handleOptionClick=function(){this.setState({checked:!this.state.checked})},t.prototype.handleAccept=function(){this.props.onConfirm&&this.props.onConfirm(this.state.checked)},t.prototype.handleDismissCompleted=function(){this.props.onCancel&&this.props.onCancel(this.state.checked)},t})(s.Component);t.ConfirmWithOptionModal=o}),define("modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react/modal","modules/clean/react_format","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=l.i18n_default_project("sharing")._,u=function(e,t,l,u,d,p,h,m){void 0===e&&(e=""),void 0===d&&(d=!1);var _,f,g,y=s.em_snippet(e,40),S=null;return t===a.MEMBER_ACTION.REMOVE?(g=c("Remove access for %(name)s?").format({name:y}),l?(_=u?m?o.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access <strong>%(parentname)s</strong> will still be able to access this folder."),{strong:n.createElement("strong",null),name:y,parentname:m}):o.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access the parent folder will still be able to access this folder."),{strong:n.createElement("strong",null),name:y}):o.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder."),{strong:n.createElement("strong",null),name:y}),d&&(S=c("Let %(name)s keep a copy of this shared folder").format({name:y}))):_=o.reactFormat(c("If you continue, <strong>%(name)s</strong> will lose access to this file."),{strong:n.createElement("strong",null),name:y}),f=c("Remove")):(g=c("Make %(name)s the owner of this folder?").format({name:y}),_=o.reactFormat(c("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings."),{strong:n.createElement("strong",null),name:y}),f=c("Make owner")),r.Modal.showInstance(n.createElement(i.ConfirmWithOptionModal,{autoClose:!1,confirmText:f,cancelText:c("Cancel"),onConfirm:p,onCancel:h,optionLabel:S,showOption:null!=S,title:g},_))};t.showMemberAccessChangeConfirmationModal=u}),define("modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal",["require","exports","external/react","modules/clean/react/modal","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/core/i18n"],function(e,t,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o.i18n_default_project("sharing")._;t.showRelinquishMembershipConfirmationModal=function(e,t,o,a,l){void 0===l&&(l=!1);var c,u,d=null;e?(u=i("Remove your access to this folder?"),c=i(t?"You may still have access to this folder through a company group or parent folder.":"If you continue, you won’t be able to access this folder anymore."),l&&(d=i("Keep a copy of this folder"))):(u=i("Remove your access to this file?"),c=i("If you continue, you won’t be able to access this file anymore.")),s.Modal.showInstance(n.createElement(r.ConfirmWithOptionModal,{cancelText:i("Cancel"),confirmText:i("Remove my access"),onCancel:a,onConfirm:o,optionLabel:d,showOption:null!=d,title:u},c))}}),define("modules/clean/sharing/confirmation_modals/reset_access_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,s,r,o,i,a){"use strict";function l(e){var t,a=c("Let removed members keep a copy of this shared folder");t=c(e.linkAccessLanguage?e.isFolder?e.isNestedSharedFolder?"The link to this folder will no longer work. Unsharing will only remove members who             don’t have access to the parent folder.":"The link to this folder will no longer work, and everyone will be removed from this folder.             You’ll still keep a copy of this folder in your Dropbox account.":"Everyone else will lose access to this file and its link         except those who have access from a parent folder.         You’ll still keep a copy of this file in your Dropbox.":e.isFolder?"Everyone will be removed from this folder. You’ll         still keep a copy of this folder in your Dropbox.":"Everyone will be removed from this file. You’ll         still keep a copy of this file in your Dropbox.");var l=c("Unshare “%(content_name)s”?").format({content_name:s.em_snippet(e.contentName,i.SNIPPET_SIZES.FILENAME)});r.Modal.showInstance(n.createElement(o.ConfirmWithOptionModal,{cancelText:c("Cancel"),confirmText:c("Unshare"),onCancel:e.onCancel,onConfirm:e.onConfirm,optionLabel:a,showOption:e.allowLeaveACopy&&e.isFolder,title:l},t))}Object.defineProperty(t,"__esModule",{value:!0});var c=a.i18n_default_project("sharing")._;t.confirmResetAccess=l}),define("modules/clean/sharing/confirmation_modals/simple_confirm_modal",["require","exports","tslib","external/react","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o.i18n_default_project("sharing")._,a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(r.Modal,{style:"bare"},s.createElement("div",{className:"simple-confirm-modal"},s.createElement("div",{className:"simple-confirm-modal__main"},s.createElement("div",{className:"simple-confirm-modal__title"},this.props.title),s.createElement("div",{className:"simple-confirm-modal__body"},this.props.children)),s.createElement("div",{className:"simple-confirm-modal__footer"},s.createElement("button",{className:"simple-confirm-modal__cancel c-btn c-btn--secondary",onClick:this.props.onCancel},this.props.cancelText||i("Cancel")),s.createElement("button",{className:"simple-confirm-modal__confirm c-btn c-btn--primary",onClick:this.props.onConfirm},this.props.confirmText))))},t})(s.Component);t.SimpleConfirmModal=a}),define("modules/clean/sharing/content_info",["require","exports","tslib","external/immutable","modules/constants/python"],function(e,t,n,s,r){"use strict";function o(e){var t=(e.isFolder?e.targetNsId:e.fileId)||e.fqPath;if(null===t)throw new Error("Not enough fields provided for extras");return t}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.createFromParams=function(e){var n=new a(e);return new t({extras:n,id:o(n)})},t.prototype.setNsId=function(e){var t=this.setIn(["extras","targetNsId"],e);return t.set("id",o(t.extras))},t.prototype.setFQPath=function(e){var t=this.setIn(["extras","fqPath"],e);return t.set("id",o(t.extras))},t.prototype.isFolder=function(){return this.extras.isFolder},t.prototype.isFile=function(){return!this.isFolder()},t.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},t.prototype.isSharedFolder=function(){return Boolean(this.extras.targetNsId)},t.prototype.isTeamSharedFolder=function(){return this.extras.isTeamSharedFolder},t.prototype.isInSharedFolder=function(){return Boolean(this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)},t.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},t.prototype.isOSXPackage=function(){var e=this.extras.fqPath,t=e.substr(e.lastIndexOf("."));return r.PACKAGE_EXTS.indexOf(t)>=0},t.prototype.isMounted=function(){return!this.extras.url},t.prototype.url=function(){return this.extras.url},t.prototype.pathExists=function(){return Boolean(this.extras.exists)},t.prototype.name=function(){return this.displayPath()?this.displayPath().split("/").pop():this.filename()},t.prototype.idForLink=function(){var e=this.extras.fileId||this.extras.fqPath;if(!e)throw new Error("No identifiers for getting links");return e},t.prototype.sharedFolderId=function(){var e=this.extras.targetNsId;if(!e)throw new Error("No shared folder ID");return e},t.prototype.displayPath=function(){return this.extras.fqPath},t.prototype.parentFolderName=function(){if(this.extras.fqPath){var e=this.displayPath().split("/");if(e.length>1)return e[e.length-2]}return""},t.prototype.filename=function(){return this.extras.filename},t.prototype.nsId=function(){if(!this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId},t.prototype.nsPath=function(){if(null===this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath},t.prototype.sjid=function(){return this.extras.sjid},t.prototype.teamGroupInfo=function(){return this.extras&&this.extras.teamGroupInfo},t.prototype.beaconContext=function(){return this.extras&&this.extras.beaconContext},t})(s.Record({extras:null,id:null},"ContentInfo"));t.ContentInfo=i;var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(s.Record({beaconContext:null,exists:!0,fileId:null,filename:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,sjid:null,targetNsId:null,url:null,userHomeNs:null,teamGroupInfo:null},"ContentInfoExtras"));t.ContentInfoExtras=a}),define("modules/clean/sharing/delete_link_modal",["require","exports","modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=l.i18n_default_project("sharing")._,u=function(){return c(a.MAESTRO_ENABLED?"Delete":"Delete link")},d=function(e){var t=e.client,n=e.url,l=e.contentName,d=e.onDeleteLink,p=e.onCancel;l=s.em_snippet(l,o.SNIPPET_SIZES.FILENAME);var h=function(){return t.revokeSharedLink({url:n}).then(function(){var e=c("Deleted link to “%(name)s”").format({name:l});i.sharingNotificationSuccess(e),r.Modal.close(),d&&d()})};r.SimpleModal.show({autoclose:!1,body_html:c("This link will no longer work for anyone who has it."),cancel_completed_callback:p,cancel_text:c("Cancel"),confirm_callback:h,confirm_text:u(),title_text:c("Delete link to “%(name)s”?").format({name:l}),style:a.MAESTRO_ENABLED?"default-maestro":void 0})};t.deleteLinkWithConfirm=d;var p=function(e){var t=e.client,l=e.tkey,d=e.contentName,p=e.onDeleteLink,h=e.onCancel;if(d=s.em_snippet(d,o.SNIPPET_SIZES.FILENAME),null===l)return void r.Modal.close();var m=function(){return n.WebRequest({url:"/sm/disable/"+l,type:"POST",data:{tkey:l},subject_user:t.userId,success:function(){var e=c("Deleted link to “%(name)s”").format({name:d});i.sharingNotificationSuccess(e),r.Modal.close(),p&&p()}})};return r.SimpleModal.show({autoclose:!1,body_html:c("This link will no longer work for anyone who has it."),cancel_completed_callback:h,cancel_text:c("Cancel"),confirm_callback:m,confirm_text:u(),title_text:c("Delete link to “%(name)s”?").format({name:d}),style:a.MAESTRO_ENABLED?"default-maestro":void 0})};t.deleteLinkWithConfirmLegacy=p}),define("modules/clean/sharing/file_settings_modal",["require","exports","tslib","external/react","external/underscore","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_notifications_util","modules/constants/sharing","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=C.i18n_default_project("sharing")._,T=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAcceptClick=function(){var e=n.getPolicyDiff();e?d.setStatePromise(n,{isSubmitting:!0}).then(function(){return n.getClient().updatePolicy({contentId:n.props.contentId,newPolicy:e,actions:Object.keys(f.ALPHA_FILE_METADATA_PERMISSIONS)})}).catch(o.catchApiError(function(){n.setState({isSubmitting:!1}),Promise.reject({})})).then(function(e){E.sharingNotificationSuccess(I("File settings updated")),n.props.onPolicySet&&n.props.onPolicySet(e)}):n.props.onPolicySet&&n.props.onPolicySet(void 0)},n.handleDismissClick=function(){c.Modal.close(),n.props.onCancel&&n.props.onCancel()},n.handleDismissCompleted=function(){n.props.onCancel&&n.props.onCancel()},n.handlePolicyUpdate=function(e,t){n.setState({desiredPolicy:n.state.desiredPolicy.set(e,t)})},n.getPolicyDiff=function(){var e={};return n.state.desiredPolicy.keySeq().toArray().map(function(t){var s=n.state.desiredPolicy.get(t),o=n.props.initialPolicy.get(t);("object"==typeof s?r.isEqual(s,o):s===o)||(e[t]=n.state.desiredPolicy.get(t))}),e},n.handleUnshareFile=function(){var e=function(){return b.SHARING_UNSHARING.SNACKBAR_MESSAGES&&u.Snackbar.sync(I("Unsharing %(file_name)s...").format({file_name:n.props.fileName}),!0),n.getClient().unshare({contentId:n.props.contentId}).then(function(){n.refreshSharedMemberData(),E.sharingNotificationSuccess(I("Unshared %(file_name)s.").format({file_name:n.props.fileName})),c.Modal.close(),b.TRUELINK.TRUELINK_UI[n.props.user.id]&&p.SharingActions.loadFileMetadata({user:n.props.user,contentId:n.props.contentId})})};_.confirmResetAccess({allowLeaveACopy:!1,contentName:n.props.fileName,isFolder:!1,isNestedSharedFolder:!1,linkAccessLanguage:b.TRUELINK.TRUELINK_UI[n.props.user.id],onConfirm:e})},n.refreshSharedMemberData=function(){a.dispatch({type:l.SharedWithActionTypes.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[n.props.contentId]}})},n.state={isSubmitting:!1,desiredPolicy:t.initialPolicy},n}return n.__extends(t,e),t.prototype.render=function(){return b.TRUELINK.TRUELINK_UI[this.props.user.id]?this.openSharingSettingsModal():s.createElement(w,{canChangeOptions:this.props.canChangeOptions,canChangeViewerInfo:this.wrapCanChangePolicy(g.VIEWER_INFO_POLICY),canUnshareFile:this.props.canUnshareFile,contentId:this.props.contentId,desiredPolicy:this.state.desiredPolicy,fileName:this.props.fileName,handleUnshareFile:this.handleUnshareFile,isSubmitting:this.state.isSubmitting,onAccept:this.handleAcceptClick,onDismiss:this.handleDismissClick,onDismissCompleted:this.handleDismissCompleted,onPolicyUpdate:this.handlePolicyUpdate,ownerTeam:this.props.ownerTeam,user:this.props.user,viewerInfoDenyReason:v.getPassDenyReason(this.props.initialPolicy,this.props.permissions)})},t.prototype.getClient=function(){return new h.FileShareApiClient({userId:this.props.user.id})},t.prototype.wrapCanChangePolicy=function(e){var t=this.props.canChangeOptions;return v.isCommonSharingSettingsPolicy(e)&&(t=v.canChangePolicy(e,this.props.initialPolicy,this.state.desiredPolicy,this.props.linkMetadata,this.props.permissions)),t},t.prototype.openSharingSettingsModal=function(){var e=this,t=function(t,n){return[e.state.desiredPolicy.get(t),e.wrapCanChangePolicy(t)]};return s.createElement(S.SharingSettingsModal,{contentId:this.props.contentId,currentPolicy:this.props.initialPolicy,fileName:this.props.fileName,folderName:this.props.fileName,getEffectivePolicyValue:t,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isFolder:!1,isLoading:!1,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onDismiss:this.handleDismissClick,onOptionChange:this.handlePolicyUpdate,onSaveSettings:this.handleAcceptClick,onUnshare:this.handleUnshareFile,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,policyUpdate:this.getPolicyDiff(),user:this.props.user})},t.displayName="FileSettingsModal",t})(s.Component);t.FileSettingsModal=T;var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return this.props.canChangeOptions&&(e=s.createElement(y.SettingsModalButtons,{disableSave:!1,isAccepting:this.props.isSubmitting,onAccept:this.props.onAccept,onDismiss:this.props.onDismiss})),s.createElement(c.Modal,{autoClose:!1,className:"file-settings-modal",buttonComponent:s.createElement("span",null),onDismissCompleted:this.props.onDismissCompleted,title:I("“%(file_name)s” settings").format({file_name:i.em_snippet(this.props.fileName,f.SNIPPET_SIZES.FILENAME)})},s.createElement("div",{className:"file-settings-form"},this.renderHeader(),this.renderPolicies(),this.renderButtons(),e))},t.prototype.renderHeader=function(){if(!this.props.canChangeOptions)return s.createElement("div",{className:"u-pad-xs u-font-center u-mar-bottom-s file-settings-form__no-permission-banner"},I("You don’t have permission to change the settings on this file."))},t.prototype.renderPolicies=function(){return s.createElement("div",null,null!=this.props.desiredPolicy.viewer_info_policy?this.renderViewerInfoPolicy():void 0)},t.prototype.renderViewerInfoPolicy=function(){var e;return e=this.props.ownerTeam?I("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:this.props.ownerTeam.name}):I("Show viewer info to people who can edit"),s.createElement(y.SinglePolicyControl,{canChange:this.props.canChangeViewerInfo,denyReason:this.props.viewerInfoDenyReason,policyName:m.ViewerInfoPolicy.policy_name,policyDescription:I("Show who views this file?"),currentValue:this.props.desiredPolicy.viewer_info_policy,options:[{label:e,value:m.ViewerInfoPolicy.enabled},{label:I("Don’t show who views"),value:m.ViewerInfoPolicy.disabled}],handleOptionChange:this.props.onPolicyUpdate})},t.prototype.renderButtons=function(){var e;return this.props.canUnshareFile&&(e=s.createElement("div",{className:"u-l-fl"},s.createElement("button",{className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.handleUnshareFile},I("Unshare file")))),s.createElement("div",{className:"u-mar-top-m clearfix"},e)},t.displayName="FileSettingsModalContents",t})(s.Component);t.FileSettingsModalContents=w}),function(){define("modules/clean/sharing/folder_settings_modal",["external/classnames","external/immutable","external/purify","external/react","external/underscore","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/react_format","modules/clean/sharing/actions/share_modal","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/settings_modal_components","modules/clean/sharing/share_page/action_types","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/user","modules/constants/sharing","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T,w,A,M,N,k,P,R){var L,F,O,x,D,U,B,H,q,V,G,W,j,K,Y,z,Q,X,J,Z,$,ee,te,ne,se,re,oe,ie,ae,le,ce,ue,de,pe,he,me,_e,fe,ge,ye;return ce=o.catchApiError,W=o.ServerError,ae=c.browseStore,H=d.Modal,$=d.SimpleModal,te=p.Snackbar,ge=h.setStatePromise,fe=m.reactFormat,K=_.ShareModalActionHandler,G=f.SNIPPET_SIZES,he=g.genContentManagerBridgeUri,ye=y.sharingNotificationError,y.sharingNotificationSuccess,j=S.SettingsModalButtons,ee=S.SinglePolicyControl,Y=v.SharePageActionTypes,U=E.FolderShareApiClient,re=E.TeamSharingPolicies,L=b.CombinedPolicy,D=b.FolderPolicy,x=b.FolderPermissions,B=b.LinkMetadata,z=b.SharedContentLinkMetadata,Q=b.SharedFolderMetadata,de=C.confirmResetAccess,Z=I.SharingSettingsModal,le=T.canChangePolicy,me=T.getPassDenyReason,_e=T.isCommonSharingSettingsPolicy,V=A.SHARING_UNSHARING,se=A.TRUELINK,ne=M.TRADEMARK_BUSINESS,ue=s.createElement,pe=s.DOM,oe=k.i18n_default_project("sharing")._,F={shared_folder_member_policy:"team"},O={shared_folder_member_policy:"team"},q={member_policy:"shared_folder_member_policy"},X=s.createClass({displayName:"SharedFolderSettingsModal",propTypes:{actionHandler:s.PropTypes.instanceOf(K),altAction:s.PropTypes.node,folderName:s.PropTypes.string.isRequired,folderId:s.PropTypes.string,folderPath:s.PropTypes.string,hasDisplayableMembers:s.PropTypes.bool,hasNonOwnerMembers:s.PropTypes.bool,nsId:s.PropTypes.string,nsPath:s.PropTypes.string,initialHasParentSharedFolder:s.PropTypes.bool,initialIsTeamSharedFolder:s.PropTypes.bool,initialMetadata:s.PropTypes.instanceOf(Q),initialOwnerTeam:s.PropTypes.shape({id:s.PropTypes.string.isRequired,name:s.PropTypes.string.isRequired}),initialPermissions:s.PropTypes.instanceOf(x),initialPolicy:s.PropTypes.oneOfType([s.PropTypes.instanceOf(L),s.PropTypes.instanceOf(D)]),isFolderInsideTeamFolderTree:s.PropTypes.bool,isLimitedTeam:s.PropTypes.bool,isSharedFolder:s.PropTypes.bool,isUserOnOwnerTeam:s.PropTypes.bool,linkMetadata:s.PropTypes.oneOfType([s.PropTypes.instanceOf(B),s.PropTypes.instanceOf(z)]),onCancel:s.PropTypes.func,onPolicySet:s.PropTypes.func,onUnshare:s.PropTypes.func,showContentManagerBridge:s.PropTypes.bool,isInContentManager:s.PropTypes.bool,teamPolicy:s.PropTypes.instanceOf(re),updateLinkSettings:s.PropTypes.func,user:s.PropTypes.instanceOf(w).isRequired},getInitialState:function(){return{currentPolicy:this.props.initialPolicy,hasParentSharedFolder:this.props.initialHasParentSharedFolder,isLoading:!(null!=this.props.initialPolicy&&null!=this.props.initialPermissions),isPolicyChangeRecursive:this._hasRecursivePolicyChanges(this.props.initialIsTeamSharedFolder,this.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:this.props.initialIsTeamSharedFolder,metadata:this.props.initialMetadata,teamPolicy:this.props.teamPolicy,newPolicy:this.props.initialPolicy,ownerTeam:this.props.initialOwnerTeam,permissions:this.props.initialPermissions}},componentDidMount:function(){if(this.state.isLoading)return this._fetchInitialState()},render:function(){var e;return e={altAction:this.props.altAction,contentId:this.props.folderId,currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPath:this.props.folderPath,getEffectivePolicyValue:this._getEffectivePolicyValue,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.state.hasParentSharedFolder,isFolder:!0,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isLimitedTeam:this.props.isLimitedTeam,isLoading:this.state.isLoading,isSharedFolder:this.props.isSharedFolder,isSubmitting:this.state.isSubmitting,isTeamSharedFolder:this.state.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onDismiss:this._handleDismiss,onOptionChange:this._handleOptionChange,onSaveSettings:this._handleSaveSettings,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,permissions:this.state.permissions,showContentManagerBridge:this.props.showContentManagerBridge,shouldHideHeader:this.state.shouldHideHeader,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate(),user:this.props.user
},se.TRUELINK_UI[this.props.user.id]?ue(Z,e):ue(J,e)},_getClient:function(){var e;return e=ae.context().isNonUserRelativeContext,new U({userId:this.props.user.id,isNonUserRelativeContext:e})},_fetchFolderMetadata:function(){var e;return e=[{".tag":"change_options"},{".tag":"unshare"}],null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validateFqPath({fqPath:this.props.folderPath,actions:e}).then(function(e){return e.metadata})},_fetchInitialState:function(){return this._fetchFolderMetadata().then((function(e){return function(t){var n,s,r,o;if(e.isMounted())return n=t.policy,s={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,shouldHideHeader:"folder_is_limited_team_folder"===(null!=(r=t.permissions)&&null!=(o=r.change_options)?o.reason:void 0),isLoading:!1,permissions:t.permissions,newPolicy:n,ownerTeam:t.owner_team,metadata:t},null!=e.props.folderId&&(s.currentPolicy=n),s.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(s.isTeamSharedFolder,s.hasParentSharedFolder),ge(e,s)}})(this)).catch(ce(function(){return H.close()}))},_hasRecursivePolicyChanges:function(e,t){return e||t},_handlePolicyUpdate:function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_handleSaveSettings:function(){var e,t,s;if(t=this._getPolicyUpdate(),null!=t)return e=(function(e){return function(){var n;return n=e.props.onPolicySet,(e.isMounted()?ge(e,{isSubmitting:!0}):Promise.resolve()).then(function(){var n,s,r,o,i,a;return a=Date.now(),r=function(e){return V.SNACKBAR_MESSAGES||P.success(oe("Folder settings updated")),Promise.resolve({policyUpdate:t,sharedFolderMetadata:e})},s=function(e){return V.SNACKBAR_MESSAGES?te.complete(oe("Successfully changed settings and shared folder.")):P.success(oe("Folder settings updated")),Promise.resolve({policyUpdate:t,sharedFolderMetadata:e})},n=function(e){if(V.SNACKBAR_MESSAGES)return this.props.actionHandler.reportShareFailure(e,a)},null!=e.props.folderId?(o=e._getClient().updatePolicyAlpha,o({contentId:e.props.folderId,newPolicy:t,url:null!=(i=e.props.linkMetadata)?i.url:void 0}).then(r)):(t=se.TRUELINK_UI[e.props.user.id]?new L(t):new D(t),e.props.actionHandler.shareIfFileFolder(oe("Changing settings and sharing folder..."),t).then(s).catch(n))}).then(function(e){var t,s;return t=e.policyUpdate,s=e.sharedFolderMetadata,"function"==typeof n?n(t,s):void 0}).catch(ce(function(t){var n;if(V.SNACKBAR_MESSAGES||P.error(null!=(n=t.user_message)?n:oe("Something went wrong! Please try again.")),e.isMounted())return e.setState({isSubmitting:!1})}))}})(this),this.state.isPolicyChangeRecursive?(s=this.props,$.show({title_text:oe("Save settings?"),body_html:this.state.isTeamSharedFolder?n.sanitize(oe("Your changes will be applied to this team folder and any folders inside it.")):n.sanitize(oe("Your changes will be applied to this folder and any folders inside it.")),confirm_text:oe("Save settings"),cancel_text:oe("Cancel"),autoclose:!1,confirm_callback:e,cancel_completed_callback:function(){return H.showInstance(ue(X,s))}})):e()},_handleDismiss:function(){var e;return H.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_unsharingProgressSnackbar:function(e){var t,n;return t=function(){return te.warn(oe("Unsharing is taking a while. We’ll let you know when it’s done."))},n=fe(oe("Unsharing <st>%(folder_name)s</st>..."),{st:pe.strong(),folder_name:this.props.folderName}),te.show(ue(te,{onTimeout:t,syncProgressLoop:!0,title:n,timeoutDelayMs:V.TRANSITION_MS,variant:"sync"}))},_tooManyFilesSnackbar:function(){var e;return e=function(){return N.open_tab("/help/files-folders/unshare-folder#foldersize")},te.show(ue(te,{actionButtonText:oe("Learn more"),closeButtonText:oe("Close"),onActionClick:e,title:oe("Unsharing unsuccessful. This folder has too many files."),variant:"fail"}))},_handleUnshareFolder:function(){var e,t,n,s,r,o;if(null!=this.props.folderId&&(null!=(n=this.state.permissions)&&null!=(s=n.unshare)?s.allow:void 0))return e=(function(e){return function(t){var n,s;return s=Date.now(),V.SNACKBAR_MESSAGES&&e._unsharingProgressSnackbar(e.props.folderName),n=e._getClient().unshare({contentId:e.props.folderId,leaveACopy:t}),n.then(function(){var t;return V.SNACKBAR_MESSAGES?te.complete(fe(oe("Unshared <st>%(folder_name)s</st>"),{st:pe.strong(),folder_name:e.props.folderName})):P.success(oe("Unshared “%(folder_name)s”").format({folder_name:e.props.folderName})),null!=(t=e.props.actionHandler)&&t.refreshSharedWithColumnContentData(),H.close(),l.dispatch({type:Y.UNSHARE_FOLDER_SUCCESS,metadata:e.state.metadata,user:e.props.user})}).catch(function(t){var n;return n=Date.now(),V.SNACKBAR_MESSAGES&&n-s>V.TRANSITION_MS&&t instanceof W?e._tooManyFilesSnackbar():ye(oe("There was problem while unsharing this folder. Try again later.")),l.dispatch({type:Y.UNSHARE_FOLDER_ERROR,metadata:e.state.metadata,user:e.props.user})})}})(this),t=(function(e){return function(){return H.showInstance(ue(X,e))}})(this.props),de({allowLeaveACopy:null!=(r=this.state.permissions)&&null!=(o=r.leave_a_copy)?o.allow:void 0,contentName:this.state.metadata.name,isFolder:!0,isNestedSharedFolder:this.props.hasParentSharedFolder,linkAccessLanguage:se.TRUELINK_UI[this.props.user.id],onCancel:t,onConfirm:e})},_getPolicyUpdate:function(){var e;return null==this.state.newPolicy&&null==this.state.currentPolicy?null:(e={},this.state.newPolicy.forEach((function(t){return function(n,s){var o,i,a,l;if(l=t._getEffectivePolicyValue(s),i=l[0],o=l[1],o&&(a="object"==typeof n?r.isEqual(n,i):n===i,!a))return e[s]=n}})(this)),e)},_handleOptionChange:function(e,t){var n;if((null!=(n=this._getPolicyUpdate())?n[e]:void 0)!==t)return"function"==typeof this._handlePolicyUpdate?this._handlePolicyUpdate(e,t):void 0},_getEffectivePolicyValue:function(e,t){var n,s,r,o,i,a;return null==t&&(t=void 0),i=q[e],null!=i&&null!=this.props.teamPolicy&&(a=this.props.teamPolicy.get(i)),s=null!=(r=null!=t?t[e]:void 0)?r:this.state.currentPolicy.get(e),n=null!=(o=this.state.permissions.change_options)?o.allow:void 0,null!=a&&F[i]===a&&(n=!1,s=O[i]),_e(e)&&(n=le(e,this.state.currentPolicy,this.state.newPolicy,this.props.linkMetadata,this.state.permissions,this.props.showContentManagerBridge)),this.props.showContentManagerBridge&&(n=!1),[s,n]}}),ie=s.createClass({displayName:"SharedFolderSettingsModalContents",propTypes:{altAction:s.PropTypes.node,currentPolicy:s.PropTypes.instanceOf(D),folderId:s.PropTypes.string,folderName:s.PropTypes.string.isRequired,folderPath:s.PropTypes.string,permissions:s.PropTypes.instanceOf(x),getEffectivePolicyValue:s.PropTypes.func,hasParentSharedFolder:s.PropTypes.bool,isLimitedTeam:s.PropTypes.bool,isLoading:s.PropTypes.bool.isRequired,isSharedFolder:s.PropTypes.bool,isSubmitting:s.PropTypes.bool,isTeamSharedFolder:s.PropTypes.bool,isUserOnOwnerTeam:s.PropTypes.bool,onDismiss:s.PropTypes.func,onSaveSettings:s.PropTypes.func,onOptionChange:s.PropTypes.func,onUnshare:s.PropTypes.func,ownerTeam:s.PropTypes.shape({id:s.PropTypes.string.isRequired,name:s.PropTypes.string.isRequired}),showContentManagerBridge:s.PropTypes.bool,shouldHideHeader:s.PropTypes.bool,teamPolicy:s.PropTypes.instanceOf(re),policyUpdate:s.PropTypes.instanceOf(D)},getDefaultProps:function(){return{currentPolicy:null,folderId:null,getEffectivePolicyValue:null,hasParentSharedFolder:!1,isTeamSharedFolder:!1,onDismiss:null,onOptionChange:null,onSaveSettings:null,onUnshareFolder:null,ownerTeam:null,shouldHideHeader:!1,teamPolicy:null,policyUpdate:null}},render:function(){var t,n;return ue(H,{altAction:this.props.altAction,autoClose:!1,className:e({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!(null!=(t=this.props.permissions)&&null!=(n=t.change_options)?n.allow:void 0)}),buttonComponent:pe.span(),onDismissCompleted:this.props.onDismiss,title:this.props.isTeamSharedFolder?oe("“%(folder_name)s” team folder settings").format({folder_name:i.em_snippet(this.props.folderName,G.FILENAME)}):oe("“%(folder_name)s” settings").format({folder_name:i.em_snippet(this.props.folderName,G.FILENAME)})},this.props.isLoading?pe.div({className:"shared-folder-settings-modal__loading-text"},oe("Loading...")):pe.div({},this._renderHeader(),this._renderPolicies(),this._renderButtons()))},_renderHeader:function(){var t,n,s,o,i,l,c;if(!this.props.shouldHideHeader)return t={"shared-folder-settings-form__team-folder-banner":!0,"u-pad-xs":!0,"u-font-center":!0,"u-mar-bottom-s":!0},l=pe.div({},oe("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName})),this.props.isInContentManager?pe.div({className:e(t)},l):this.props.showContentManagerBridge?(n=a.parent_dir(this.props.folderPath),s=a.filename(this.props.folderPath),c=he({containingFolder:n,filenameToSelect:s,isLimitedTeam:this.props.isLimitedTeam}),pe.div({className:e(t)},l,pe.div({},oe("You can change these settings in the Admin Console. "),pe.a({href:c.toString(),target:"_blank"},oe("Open in new tab."))))):(this.props.isTeamSharedFolder||this.props.hasParentSharedFolder)&&this.props.isUserOnOwnerTeam?pe.div({className:e(t)},l,pe.div({},pe.a({href:"/team",target:"_blank"},oe("To edit, ask your admin.")))):(null!=(o=this.props.permissions)&&null!=(i=o.change_options)?i.allow:void 0)?void 0:pe.div({className:e(r.extend(t,{"shared-folder-settings-form__team-folder-banner":!1,"shared-folder-settings-form__no-permissions-banner":!0}))},oe("You don’t have permission to change the settings on this folder."))},_renderPolicies:function(){var e,t,n,s,r;return n=null!=this.props.ownerTeam,s=null!=this.props.ownerTeam&&!this.props.isLimitedTeam,r=null!=this.props.currentPolicy.viewer_info_policy,t=this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree,pe.div({},n?this._renderPolicy("member_policy",oe(t?"Who can be added to folders?":"Who can be invited to this folder?"),[{label:this.props.isLimitedTeam?oe("Only people on your team"):oe("Only people on your %(trademark_business)s account").format({trademark_business:ne}),value:"team"},{label:oe("Anyone"),value:"anyone"}]):void 0,this._renderPolicy("acl_update_policy",oe(t?"Who can manage access to folders?":"Who can manage access to this folder?"),[{label:oe(t?"Only Team Admins":"Only owners"),value:"owner"},{label:n?this.props.isLimitedTeam?oe("Anyone on your team with edit permissions"):oe("Anyone on your %(trademark_business)s account with edit permissions").format({trademark_business:ne}):oe("People with edit permissions"),value:"editors"}]),s?this._renderPolicy("shared_link_policy",oe(this.props.isTeamSharedFolder?"Allow members of this team folder to share links with others?":"Allow links to be shared with people outside of this folder?"),[{label:oe("No"),value:"members"},{label:oe("Yes"),value:"anyone"}]):void 0,r?(e=this.props.ownerTeam?oe("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:this.props.ownerTeam.name}):oe("Show viewer info to people who can edit"),this._renderPolicy("viewer_info_policy",oe("Show who views files in this folder?"),[{label:e,value:"enabled"},{label:oe("Don’t show viewer info"),value:"disabled"}],me(this.props.currentPolicy,this.props.permissions))):void 0)},_renderPolicy:function(e,t,n,s){var r,o,i;return null==s&&(s=null),i=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),o=i[0],r=i[1],ue(ee,{canChange:r,denyReason:s,policyName:e,policyDescription:t,currentValue:o,options:n,handleOptionChange:this.props.onOptionChange})},_renderButtons:function(){var e,t,n;return e=null!=(t=this.props.permissions)&&null!=(n=t.unshare)?n.allow:void 0,pe.div({className:"u-mar-top-m clearfix"},this.props.isSharedFolder&&e?pe.div({className:"u-l-fl"},pe.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},oe(this.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,this._renderUpdateSettingsButtons())},_renderUpdateSettingsButtons:function(){var e;if(null!=(e=this.props.permissions)?e.change_options.allow:void 0)return ue(j,{disableSave:null==this.props.policyUpdate,isAccepting:this.props.isSubmitting,onAccept:this.props.onSaveSettings,onDismiss:this.props.onDismiss})}}),J=u(ie,["/static/css/sharing/share_modal-vflhe7tSD.css"],[ee]),{SharedFolderSettingsModal:X,SharedFolderSettingsModalContents:J}})}.call(this),define("modules/clean/sharing/link_description",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/viewer","modules/constants/trademark","modules/core/i18n","modules/core/exception"],function(e,t,n,s,r,o,i,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=c.i18n_default_project("sharing"),p=d._,h=d.ungettext,m=function(e){return(function(){switch(e){case"public":return p("Anyone with the link");case"team_only":return p("Only people on your Dropbox team");case"password":return p("Only people with the password");case"team_and_password":return p("Only people on your Dropbox team with the password");default:throw Error("Unknown visibility option "+e)}})()};t.formatLinkVisibilityOption=m;var _=function(e,t,n){return void 0===n&&(n=null),e?(function(){switch(t){case"public":return p("Anyone with the link can comment.");case"team_only":return p("Only people on your Dropbox team can comment.");case"password":return p("Only people with the password can comment.");case"team_and_password":return p("Only people on your Dropbox team with the password can comment.");case"shared_folder_only":return n=n?n:"",p("Only members of the shared folder “%(shared_folder_name)s” can comment.").format({shared_folder_name:s.em_snippet(n,i.SNIPPET_SIZES.FILENAME)});case"only_you":return p("Only you can comment.");default:throw Error("Unknown visibility setting "+t)}})():p("No one can comment.")};t.formatLinkCommentingVisibility=_;var f=function(e,t){void 0===t&&(t=!1),u.assert(!!e.expiry,"this function should only be used when there is expiry for linkMetadata");var n=e.expiry?e.expiry.getTime():0,s=n-(new Date).getTime(),r=Math.floor(s/864e5);if(r<1){var o=Math.floor(s/36e5)+1;return t?h("Expires in the next hour","Expires in the next %(num_hours)s hours",o,"sharing").format({num_hours:o}):h("link turns off in the next hour","link turns off in the next %(num_hours)s hours",o,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_hours:o})}return t?h("Expires in 1 day","Expires in %(num_days)s days",r,"sharing").format({num_days:r}):h("link turns off in 1 day","link turns off in %(num_days)s days",r,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_days:r})};t.formatSharedContentLinkExpiry=f;var g=function(e){var t=null!=(null!=e?e.current_audience:void 0)?null!=e?e.current_audience:void 0:o.LinkAudience.members;if(!(null!=e?e.url:void 0)&&t!==o.LinkAudience.members||t===o.LinkAudience.default_on)return p("Updating link...");var n=a.get_viewer().team_is_limited,s=(function(){if(t===o.LinkAudience.members)return p("Only invited members can access");if(t===o.LinkAudience.public)return p(e.password_protected?"Anyone with the link and password can view":"Anyone with the link can view");if(t===o.LinkAudience.team)return e.password_protected?n?p("Only people on your team with the password can view"):p("Only people on your %(trademark_business)s team with the password can view").format({trademark_business:l.TRADEMARK_BUSINESS}):n?p("Only people on your team can view"):p("Only people on your %(trademark_business)s team can view").format({trademark_business:l.TRADEMARK_BUSINESS});throw Error("Unknown link audience "+e.current_audience)})();return e.expiry&&t!==o.LinkAudience.members&&(s=s+" ("+f(e)+")"),s};t.formatSharedContentLinkDescription=g;var y=function(e){return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"public":return r.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder"),{strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"public":return r.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file"),{strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},S=function(e){return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"public":return r.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"public":return r.reactFormat(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(p("<strong>Only you</strong> can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},v=function(e){u.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");var t=e.expires?e.expires.getTime():0,s=(function(){if(null!=e.expires){var n=t-(new Date).getTime();return n<0&&(n=0),Math.floor(n/864e5)}return-1})();return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"public":return r.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(h("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"public":return r.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(h("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Only you<strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",s),{expires_days:s,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},E=function(e){u.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");var t=(function(){if(null!=e.expires){var t=e.expires.getTime()-(new Date).getTime();return t<0&&(t=0),Math.floor(t/864e5)}return-1})();return(function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone </strong>with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"public":return r.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(h("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return r.reactFormat(h("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"public":return r.reactFormat(h("<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"shared_folder_only":return r.reactFormat(h("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_and_password":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"team_only":return r.reactFormat(h("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});case"only_you":return r.reactFormat(h("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:n.createElement("strong",null)});default:throw Error("Unknown visibility setting")}})()},b=function(e){return null!=e.expires?E(e):y(e)},C=function(e){return null!=e.expires?v(e):S(e)},I=function(e){return e.link_permissions.allow_download===!1?C(e):b(e)};t.formatLinkDescription=I}),function(){define("modules/clean/sharing/link_info",[],function(){var e;return e=(function(){
function e(e){this.expires=e.expires,this.isFolder=e.isFolder,this.name=e.name,this.teamId=e.teamId,this.teamName=e.teamName,this.url=e.url,this.visibility=e.visibility,this.isPackage=e.isPackage}return e})(),{LinkInfo:e}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/link_settings_modal",["external/classnames","external/immutable","external/react","external/underscore","modules/clean/api_v2/types","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/delete_link_modal","modules/clean/sharing/link_description","modules/clean/sharing/ui_notifications_util","modules/clean/static_urls","modules/clean/user","modules/clean/previews/util","modules/constants/sharing","modules/constants/trademark","modules/core/i18n"],function(t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T){var w,A,M,N,k,P,R,L,F,O,x,D,U,B,H,q,V,G,W,j,K,Y,z,Q,X,J,Z,$,ee;return z=o.formatTimestamp,G=i.daysAfterToday,Q=i.format_date,X=i.localized_date_format,j=l.file_extension,w=c.BubbleMenu,A=c.BubbleMenuItem,M=u.Calendar,P=p.Modal,F=m.ShareApiClient,N=_.LinkMetadata,k=_.LinkPolicy,R=_.RequestedVisibilityPolicy,L=_.ResolvedVisibilityPolicy,U=_.VisibilityDisallowedReason,W=g.deleteLinkWithConfirm,K=y.formatLinkCommentingVisibility,Y=y.formatLinkVisibilityOption,J=S.sharingNotificationError,Z=S.sharingNotificationSuccess,ee=v.static_url,x=I.TRADEMARK_BUSINESS,D=I.TRADEMARK_PLUS,q=s.createElement,V=s.DOM,B=T.i18n_default_project("sharing")._,H=s.createClass({displayName:"SharedLinkSettingsModal",propTypes:{client:s.PropTypes.instanceOf(F).isRequired,isFile:s.PropTypes.bool.isRequired,linkMetadata:s.PropTypes.instanceOf(N).isRequired,onClose:s.PropTypes.func,onDeleteLink:s.PropTypes.func,onPolicySet:s.PropTypes.func,showUpgradeToBiz:s.PropTypes.bool.isRequired,isTeam:s.PropTypes.bool},getInitialState:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.requested_visibility,n=this.props.linkMetadata.link_permissions.resolved_visibility,t===R.public&&n===L.team_only&&(t=R.team_only),e=k({requested_visibility:t,link_password:t===R.password?null:"",expires:this.props.linkMetadata.expires,allow_download:this.props.linkMetadata.link_permissions.allow_download}),{existingPolicy:e,isSubmitting:!1,newPolicy:e}},render:function(){var e,t;return e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.disallowed_reason===U.user_account_type}),t=e.length>0,q(P,{autoClose:!1,className:"shared-link-settings-modal",buttonComponent:V.span(),onDismissCompleted:this._handleDismissed,title:B("Link permissions for “%(content_name)s”").format({content_name:this.props.linkMetadata.name})},q(O,{canSubmit:!this.state.existingPolicy.equals(this.state.newPolicy),isFile:this.props.isFile,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onCancel:this._dismissModal,onSubmit:this._saveSettings,onPolicyUpdate:this._handlePolicyUpdate,onDeleteLink:this._deleteLink,renderedPolicy:this.state.newPolicy,showUpgradeToBiz:this.props.showUpgradeToBiz,showUpgradeMessage:t,isTeam:this.props.isTeam}))},_handlePolicyUpdate:function(e,t){return"expires"===e&&null!=t&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_getModifiedSettings:function(){var e,t;if(t=this.state.newPolicy,t.requested_visibility===R.password){if(null==t.link_password)t=t.set("requested_visibility",null);else if(""===t.link_password)return J(B("Password can’t be empty")),null}else t=t.set("link_password",null);return e=this.props.linkMetadata.link_permissions.resolved_visibility,e===L.shared_folder_only&&(t=t.set("requested_visibility",null)),null!=t.expires&&(t=this.props.linkMetadata.link_permissions.can_set_expiry?t.set("expires",z(t.expires)):t.set("expires",null)),t.allow_download===this.state.existingPolicy.allow_download&&(t=t.set("allow_download",void 0)),{url:this.props.linkMetadata.url,settings:t,remove_expiration:null!=this.props.linkMetadata.expires&&null==this.state.newPolicy.expires}},_saveSettings:function(){var e;if(e=this._getModifiedSettings(),null!=e)return this.setState({isSubmitting:!0}),this.props.client.modifySharedLinkSettings(e).catch((function(e){return function(){return e.setState({isSubmitting:!1}),Promise.reject()}})(this)).then((function(e){return function(t){var n;return Z(B("Settings saved.")),"function"==typeof(n=e.props).onPolicySet&&n.onPolicySet(t),e._dismissModal()}})(this))},_dismissModal:function(){return P.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0},_deleteLink:function(){var e,t;return t=(function(e){return function(){var t;return"function"==typeof(t=e.props).onDeleteLink?t.onDeleteLink():void 0}})(this),e=(function(e){return function(){return P.showInstance(q(H,e))}})(this.props),W({client:this.props.client,contentName:this.props.linkMetadata.name,onCancel:e,onDeleteLink:t,url:this.props.linkMetadata.url})}}),O=s.createClass({displayName:"SharedLinkSettingsModalContents",propTypes:{canSubmit:s.PropTypes.bool.isRequired,isFile:s.PropTypes.bool.isRequired,isSubmitting:s.PropTypes.bool.isRequired,linkMetadata:s.PropTypes.instanceOf(N).isRequired,onCancel:s.PropTypes.func,onSubmit:s.PropTypes.func,onPolicyUpdate:s.PropTypes.func,onDeleteLink:s.PropTypes.func,renderedPolicy:s.PropTypes.instanceOf(k).isRequired,showUpgradeToBiz:s.PropTypes.bool.isRequired,showUpgradeMessage:s.PropTypes.bool.isRequired,isTeam:s.PropTypes.bool},getInitialState:function(){return{selectedExpiry:null!=this.props.renderedPolicy.expires?this.props.linkMetadata.link_permissions.can_set_expiry?"custom":"read-only":"no-expiry"}},render:function(){return V.div({className:"shared-link-settings-modal__contents"},this._renderHeader(),this._renderPolicies(),this._renderButtons())},_renderHeader:function(){var e,t;return this.props.showUpgradeToBiz?V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner"},V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-text"},B("Did you know %(trademark_business)s lets you add passwords and expiration dates to shared links?").format({trademark_business:x})),V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-cta"},V.a({className:"c-btn c-btn--secondary shared-link-settings-modal__upgrade-to-biz-banner-cta-button",href:"/business?tk=teams&camp=sharing_link_modal",target:"_blank"},B("Learn More")))):this.props.showUpgradeMessage?(this.props.isTeam?(e="/team/upgrade",t=B("Upgrade to %(trademark_business)s to enable permission settings").format({trademark_business:x})):(e="/upgrade?oqa=sfp",t=B("Upgrade to Dropbox %(trademark_plus)s to enable permission settings.").format({trademark_plus:D})),V.div({className:"shared-link-settings-modal__upgrade-to-pro-banner"},V.a({href:e,target:"_blank"},t))):void 0},_renderPolicies:function(){return V.div({},this._renderVisibilityPolicies(),this._renderExpiryPolicy(),this._renderDownloadPolicy(),this._renderCommentsPolicy())},_renderVisibilityPolicies:function(){var e,t;return t=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.allowed||e.disallowed_reason===U.user_account_type}),e=this.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason,this._renderFieldset(B("Who can view this link?"),e===U.permission_denied&&0===t.length?this._renderNonPermissionVisibility():t.length<2?this._renderRestrictedBySharedFolderVisibility():t.map(this._renderVisibilityOption))},_renderNonPermissionVisibility:function(){var e;return e=this.props.linkMetadata.link_permissions.resolved_visibility,V.span({},V.span({className:"shared-link-settings-modal__visibility-text"},e===L.shared_folder_only?B("Only invited members can view this link."):Y(e))," ",V.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},B("You don’t have permission to change the visibility.")))},_renderRestrictedBySharedFolderVisibility:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.resolved_visibility,e=this.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason,V.span({},V.span({className:"shared-link-settings-modal__visibility-text"},function(){if(t===L.shared_folder_only)return n=this.props.linkMetadata.link_permissions.restricting_shared_folder_path,n=a.em_snippet(n,f.SNIPPET_SIZES.FILENAME),B("Only members of the shared folder “%(shared_folder_name)s” can view this link.").format({shared_folder_name:n});if(t===L.only_you)return B("Only you can view this link.");throw"Unexpected visibility "+t}.call(this))," ",V.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},(function(){if(e===U.restricted_by_shared_folder)return B("To change who can access the link, go to the shared folder options.");if(e===U.delete_and_recreate)return B("To change who can access the link, delete this link and create a new one.");throw"Unexpected disallowed reason "+e})()))},_renderVisibilityOption:function(e){var n,s;return n=e.disallowed_reason===U.user_account_type,[V.label({className:t({"u-font-meta":!e.allowed}),key:"visibility-label"},V.input({checked:e.policy===this.props.renderedPolicy.requested_visibility,className:t((s={"shared-link-settings-modal__audience":!0},s["shared-link-settings-modal__audience-"+e.policy]=!0,s)),disabled:n,name:R.policy_name,onChange:(function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}})(this),type:"radio",value:e.policy}),this._renderVisibilityLabelText(e)),e.policy===R.password&&this.props.renderedPolicy.requested_visibility===R.password?V.div({key:"password-input"},this._renderPasswordInput(n)):void 0]},_renderVisibilityLabelText:function(e){var n;return V.span({className:t((n={"shared-link-settings-modal__audience":!0},n["shared-link-settings-modal__audience-"+e.policy+"-label"]=!0,n))},Y(e.resolved_policy))},_renderPasswordInput:function(e){var t,n;return n=null==this.props.renderedPolicy.link_password,V.div({className:"shared-link-settings-modal__password-container u-mar-left-m u-mar-right-xl u-mar-top-xs"},V.input({className:"shared-link-settings-modal__password-input c-input",disabled:e||n,name:"link_password",onChange:(function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}})(this),placeholder:B("Set password"),value:null!=(t=this.props.renderedPolicy.link_password)?t:"123456",type:"password"}),n&&!e?V.button({className:"shared-link-settings-modal__password-change button-as-link",onClick:(function(e){return function(){return e.props.onPolicyUpdate("link_password","")}})(this)},B("Change",{comment:"A link to change the password for the shared link"})):void 0)},_renderExpiryPolicy:function(){return this._renderFieldset(B("Add an expiry date to this link?"),V.div({},V.label({className:t({"shared-link-settings-modal__expiry-label-yes":!0,"u-font-meta":!this.props.linkMetadata.link_permissions.can_set_expiry})},V.input({checked:"no-expiry"!==this.state.selectedExpiry,className:"shared-link-settings-modal__expiry-option-yes",disabled:!this.props.linkMetadata.link_permissions.can_set_expiry,onChange:(function(e){return function(){if("no-expiry"===e.state.selectedExpiry)return e._handleExpirySelectChange(30)}})(this),type:"radio"}),this._renderYesExpiryText()),"custom"===this.state.selectedExpiry?this._renderExpiryCustom():void 0,V.label({className:t({"u-font-meta":!this.props.linkMetadata.link_permissions.can_remove_expiry})},V.input({checked:null==this.props.renderedPolicy.expires,className:"shared-link-settings-modal__expiry-option-no",disabled:!this.props.linkMetadata.link_permissions.can_remove_expiry,onChange:(function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate&&t.onPolicyUpdate("expires",null),e.setState({selectedExpiry:"no-expiry"})}})(this),type:"radio"}),B("No"))))},_renderYesExpiryText:function(){var e,t;if(7===(e=this.state.selectedExpiry)||30===e)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes, expires in",{comment:'Label followed by a date range e.g. "Yes, expires in 7 days"'})," ",this._renderExpirySelect());if("custom"===(t=this.state.selectedExpiry)||"read-only"===t)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes, expires on",{comment:'Label followed by a date. e.g. "Yes, expires on 5/10/2017"'})," ","read-only"===this.state.selectedExpiry?Q(this.props.linkMetadata.expires,X):void 0);if("no-expiry"===this.state.selectedExpiry)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes"));throw"Expiry policy is in an unknown state"},_renderExpirySelect:function(){var e;return q(w,{position:w.POSITIONS.BOTTOM,targetFixed:!0,items:function(){var t,n,s,r;for(s=[7,30,"custom"],r=[],t=0,n=s.length;t<n;t++)e=s[t],r.push(q(A,{onClick:(function(e){return function(t){return function(){return e._handleExpirySelectChange(t)}}})(this)(e)},this._renderExpirySelectLabel(e)));return r}.call(this),targetButton:V.button({className:"shared-link-settings-modal__selected-expiry button-as-link"},this._renderExpirySelectLabel(this.state.selectedExpiry)," ",V.img({alt:"",className:"sprite sprite_web s_web_arrow-down-gray",src:ee("/static/images/icons/icon_spacer-vflN3BYt2.gif")}))})},_renderExpirySelectLabel:function(e){if(7===e)return B("7 days",{comment:'as in "This link expires in 7 days"'});if(30===e)return B("30 days",{comment:'as in "This link expires in 30 days"'});if("custom"===e)return B("Custom date...",{comment:"Dropdown option for expiry date on a link. The user can choose 7 days, 30 days, or a custom expiry"});throw"Unknown selected expiry"},_handleExpirySelectChange:function(e){var t;return this.setState({selectedExpiry:e}),"custom"===e&&(e=30),"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate("expires",G(e)):void 0},_renderExpiryCustom:function(){var e;return V.span({className:"shared-link-settings-modal__calendar-input"},q(M,{alignAtLeft:!1,onDateChange:(function(e){return function(t){var n;return"function"==typeof(n=e.props).onPolicyUpdate?n.onPolicyUpdate("expires",t):void 0}})(this),initDate:null!=(e=this.props.linkMetadata.expires)?e:G(30),firstDay:G(1),lastDay:G(365)}))},_renderDownloadPolicy:function(){var e,n,s;if(s=this.props.linkMetadata.link_permissions.can_disallow_download,n=this.props.linkMetadata.link_permissions.can_allow_download,e=this.props.linkMetadata.link_permissions.allow_download,null!=s&&null!=n&&null!=e&&(s!==!1||e!==!0))return this._renderFieldset(B("Allow people to download this?"),V.div({},V.label({className:t({"u-font-meta":!n})},V.input({checked:this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-yes",disabled:!n,onChange:(function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!0):void 0}})(this),type:"radio"}),B("Yes")),V.label({className:t({"u-font-meta":!s})},V.input({checked:!this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-no",disabled:!s,onChange:(function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!1):void 0}})(this),type:"radio"}),B("No"))),this._renderNoPreviewFileWarning())},_renderNoPreviewFileWarning:function(){var t,n,s,r;if(this.props.isFile&&(t=j(this.props.linkMetadata.name),n=t.toUpperCase(),!(null!=(null!=(r=this.props.linkMetadata)?r.preview_type:void 0)&&(s=this.props.linkMetadata.preview_type,e.call(b.VALID_PREVIEW_TYPES,s)>=0))))return this.props.renderedPolicy.allow_download===!1?V.div({className:"shared-link-settings-modal__preview-warning c-banner c-banner--warning"},V.div({className:"o-flag"},V.div({className:"o-flag-fix"},q(h,{alt:"",group:"web",name:"page_white_32"})),V.div({className:"o-flag__flex u-pad-left-xs"},B("People can’t view this %(file_extension)s file if they can’t download it.",{comment:'as in "People can’t view this .PDF file'}).format({file_extension:"."+n})))):void 0},_renderCommentsPolicy:function(){if(!this.props.linkMetadata.link_permissions.team_restricts_comments)return this._renderFieldset(B("Who can comment?"),V.div({},V.div({className:"shared-link-settings-modal__commenting-policy"},K(this.props.linkMetadata.link_permissions.allow_comments,this._getResolvedVisibility(this.props.renderedPolicy.requested_visibility),this.props.linkMetadata.link_permissions.restricting_shared_folder_path)),V.div({className:"shared-link-settings-modal__commenting-advice"},this.props.linkMetadata.link_permissions.allow_comments?V.a({href:"/help/9016#comments",target:"_blank"},B("Learn how to disable comments")):V.a({href:"/help/9016#comments",target:"_blank"},B("Learn how to enable comments")))))},_getResolvedVisibility:function(e){var t;if(t=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(t){return t.policy===e}),1!==t.length)throw"Logic error: "+t.length+" should be 1.";return t[0].resolved_policy},_renderFieldset:function(e,t,n){return null==n&&(n=null),V.fieldset({className:"settings-form-entry"},V.legend({className:"settings-form-entry__explanation u-trim-margin"},e),V.div({className:"settings-form-entry__options"},t),V.div({className:"u-mar-top-m"},n))},_renderButtons:function(){return V.div({className:"u-mar-top-m clearfix"},this.props.linkMetadata.link_permissions.can_revoke?V.div({className:"u-l-fl"},V.button({className:"button-as-link delete-link",onClick:this.props.onDeleteLink,style:{lineHeight:"32px"},type:"button"},B("Delete link"))):void 0,V.div({className:"u-l-fr"},V.button({className:"c-btn c-btn--primary confirm-button",disabled:this.props.isSubmitting||!this.props.canSubmit,onClick:this.props.onSubmit},B(this.props.isSubmitting?"Saving...":"Save settings")),V.button({className:"c-btn c-btn--secondary u-mar-left-xs cancel-button",onClick:this.props.onCancel},B("Cancel"))))}}),$=function(e){return C.SHARING_EXPERIMENTS.SHOW_UPGRADE_TO_BIZ_BANNER[e]},{SharedLinkSettingsModal:d(H,["/static/css/sharing/share_modal-vflhe7tSD.css"]),SharedLinkSettingsModalContents:O,showUpgradeToBizBanner:$}})}.call(this),define("modules/clean/sharing/member_avatars",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/sharing/constants","modules/clean/viewer","modules/core/i18n","modules/clean/static_urls","modules/clean/sharing/link_description","modules/clean/datetime"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MemberAvatarsMixin={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e=this.arePairedUsersInSf(this.props.joinedMembers);this.setState({paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t=this.arePairedUsersInSf(e.joinedMembers);this.setState({paired_users_in_sf:t})},_wrap_with_avatar_type_and_data:function(e,t,n){return function(s){e(t,n),s.stopPropagation()}},arePairedUsersInSf:function(e){if(!e)return!1;var t=m.get_viewer();if(t.is_paired){var n=t.get_user_ids(!0),s=e.map(function(e){return e.user_id});if(s.includes(n[0])&&s.includes(n[1]))return!0}return!1},findOwnerAndMeInJoinedMembers:function(e){for(var t=null,n=null,s=0,r=e;s<r.length;s++){var o=r[s];if("owner"===o.access_type&&(t=o),o.user_id===this.props.user.id&&(n=o),t&&n)break}return[t,n]},addGroupsMembersInvitations:function(e,t,n,s,r){var o=this;null==r&&(r=[]);for(var i=0,a=t;i<a.length;i++){var l=a[i];e.push(this.renderGroup(l))}for(var c=0,u=n;c<u.length;c++){var d=u[c];r.includes(d.user_id)||e.push(this.renderJoinedMember(d))}return s.map(function(t){return e.push(o.renderInvitedPerson(t))})},_renderOverflowCount:function(e){var t=_.ungettext("%(count)s more member","%(count)s more members",e).format({count:e}),n=e>=99?"99+":""+e;return s.createElement(d,{key:"overflow_count",text:t,direction:this.props.titleButtonDirection},s.createElement(o,{alt:t,dimension:this.props.avatarDimension,initials:n,color:"#7B8994",shape:"CIRCLE",onClick:this.props.onOverflowCountClick}))},renderAvatarList:function(e,t){return s.createElement(u,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,overflowCountRenderer:this._renderOverflowCount,animation:this.props.animation,className:t||""})},renderJoinedMember:function(e){var t,o=e.user_id,a=m.get_viewer(),l=a.get_user_ids(!0).includes(o),u="";if(l&&this.state.paired_users_in_sf){var _=e.user_id,f=a.get_user_by_role("personal",!0),g=a.get_user_by_role("work",!0);f&&_===f.id?u="Personal":g&&_===g.id&&null!=a.team_name&&(u=a.team_name)}else u=e.display_name;this.props.isInAudienceBox&&(u=p.em_snippet(u,h.SNIPPET_SIZES.DISPLAY_NAME));var y=this.individualAccessTypeString(u,e.access_type,l,this.state.paired_users_in_sf),S=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"member",e),v={alt:y,dimension:this.props.avatarDimension,onPhotoClick:S,photoUrl:e.photo_url,defaultAvatar:s.createElement(i,{alt:y,dimension:this.props.avatarDimension,name:e.display_name,initials:this.props.isInAudienceBox?e.initials.toUpperCase():e.initials,shape:"CIRCLE",onClick:S})};return t=l?s.createElement(c,n.__assign({},v)):s.createElement(r,n.__assign({},v)),s.createElement(d,{key:"user:"+e.user_id+":"+e.photo_url,text:y,direction:this.props.titleButtonDirection},t)},renderGroup:function(e){var t,n,r=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"group",e);return e.is_automatic?(n=this.teamAccessTypeString(e.name,e.access_type),t=s.createElement(a,{alt:n,dimension:this.props.avatarDimension,photoUrl:f.static_url("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:r})):(n=this.groupAccessTypeString(e.name,e.access_type,e.num_users),t=s.createElement(i,{alt:n,dimension:this.props.avatarDimension,name:e.name,shape:"SQUARE",initials:this.getInitials(e.name),onClick:r})),s.createElement(d,{key:"group:"+e.gid+":"+e.name,text:n,direction:this.props.titleButtonDirection},t)},renderPlaceholderAvatar:function(e,t){var n=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"placeholder",null);return s.createElement(d,{key:"placeholder:"+e,text:t,direction:this.props.titleButtonDirection},s.createElement("button",{className:"u-unbutton c-avatar--m",onClick:n},s.createElement("img",{alt:t,src:f.static_url("/static/images/icons/no_member-vflE0FYQV.svg"),width:this.props.avatarDimension,height:this.props.avatarDimension})))},renderInvitedPerson:function(e){var t=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"invited",e),n=this.individualAccessTypeString(e.email_or_fbname,"pending",!1);return s.createElement(d,{key:"invitation:"+e.invitation_id,text:n,direction:this.props.titleButtonDirection},s.createElement(o,{alt:n,dimension:this.props.avatarDimension,color:"#aaa",initials:this.getInitials(e.email_or_fbname),shape:"CIRCLE",onClick:t}))},getInitials:function(e){if(null==e||!(e.length>0))return"";var t=e.split(" "),n=t.map(function(e){return e.charAt(0).toLowerCase()});return n.length>2&&(n=n.splice(0,2)),n.join("")},teamAccessTypeString:function(e,t){return("editor"===t?_._("%(team_group_name)s can edit"):_._("%(team_group_name)s can view")).format({team_group_name:p.em_snippet(e,h.SNIPPET_SIZES.DISPLAY_NAME)})},groupAccessTypeString:function(e,t,n){var s;return s="editor"===t?_.ungettext("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",n):_.ungettext("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",n),s.format({group_name:p.em_snippet(e,h.SNIPPET_SIZES.DISPLAY_NAME),num_users:n})},individualAccessTypeString:function(e,t,n,s){void 0===s&&(s=!1);var r,o={viewer:_._("You can view"),editor:_._("You can edit"),owner:_._("You’re the owner"),team:_._("You’re a member of this team folder"),default:_._("You")},i={viewer:_._("%(name)s can view"),editor:_._("%(name)s can edit"),owner:_._("%(name)s is the owner"),pending:_._("%(name)s hasn’t added this to their Dropbox yet"),team:_._("%(name)s is a member of this team folder"),default:_._("%(name)s"),"no access":_._("No access")},a={viewer:_._("You (%(name)s) can view"),editor:_._("You (%(name)s) can edit"),owner:_._("You (%(name)s) are the owner")};return r=n?s&&null!=e?a:o:i,r.hasOwnProperty(t)?r[t].format({name:p.em_snippet(e,h.SNIPPET_SIZES.DISPLAY_NAME)}):""},renderSharedLink:function(e,t){var n,r=this,o=this.getDescriptionForSharedLinkInfo(e,t),i=s.createElement(l,{alt:o,dimension:this.props.avatarDimension,onClick:function(t){r.props.onSharedLinkClick(e),t.stopPropagation()}});return(null!=e?e.allow_download:void 0)===!1?(n="sharing-icon-bubble-title u-font-center",!0):(n="",!1),s.createElement(d,{key:"shared_link",text:o,direction:"south",className:n,respectLineBreaks:!0},i)},getDescriptionForSharedLinkInfo:function(e,t){var n;if(t)return g.formatSharedContentLinkDescription(t);var s=e.visibility_type,r=e.expires_posix,o=e.shared_folder_link_policy,i="";if(r){var a=(new Date).getTime()/1e3,l=r-a,c=Math.floor(l/86400);if(l<0)return _._("Link Disabled");n=new Date(1e3*r);var u=c>180;n=y.nice_date_with_month_name(n,u,!1,!0)}e.allow_download===!1&&(i=". "+_._("(Downloading is turned off.)",{comment:'This follows a description of link visibility. For example: "Anyone with the link can view this file. (Downloading is turned off.)"'}));var d="MEMBERS_ONLY"===o;if(n){if(d)return _._("Folder members with the link can view until %(date)s").format({date:n})+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return _._("People with the link can view until %(date)s").format({date:n})+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return _._("People with the password can view until %(date)s").format({date:n})+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return _._("People at %(team_name)s can view until %(date)s").format({team_name:m.get_viewer().team_name,date:n})+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return _._("Only you can view until %(date)s").format({date:n})+i}else{if(d)return _._("Folder members with the link can view")+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return _._("People with the link can view")+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return _._("People with the password can view")+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return _._("People at %(team_name)s with the link can view").format({team_name:m.get_viewer().team_name})+i;if(s===h.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return _._("Only you can view")+i}throw Error("Unable to construct description!")}}}),define("modules/clean/sharing/parent_folder_access_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react/flag","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=u.i18n_default_project("sharing"),p=d._,h=d.ungettext,m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismissModal=function(){i.Modal.close(),t.handleDismissed()},t.handleDismissed=function(){t.props.onClose&&t.props.onClose()},t.handleNavigateToParentFolder=function(e){return function(){i.Modal.close(),t.props.onParentFolderClicked&&t.props.onParentFolderClicked(e.path,t.arePermissionsAllowed(e.permissions))}},t.arePermissionsAllowed=function(e){return e.some(function(e){return e&&e.allow})},t.memberCanEdit=function(){return[l.ACCESS_LEVEL.OWNER,l.ACCESS_LEVEL.WRITER].indexOf(t.props.memberAccessLevelResult.access_level)>-1},t.getInfoStr=function(){return"remove"===t.props.originalAction?t.props.contentInfo.isFolder()?h("As a member of the parent folder listed below, %(member_name)s can still access the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still access “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.props.contentInfo.isFolder()?t.memberCanEdit()?h("As a member of the parent folder listed below, %(member_name)s can still edit the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still view the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.memberCanEdit()?h("As a member of the parent folder listed below, %(member_name)s can still edit “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):h("As a member of the parent folder listed below, %(member_name)s can still view “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length)},t.renderParentFolderContent=function(){var e=t.getInfoStr();return s.createElement("div",null,e.format({member_name:r.em_snippet(t.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME),content_name:r.em_snippet(t.props.contentInfo.name()||"",c.SNIPPET_SIZES.FILENAME)}),s.createElement("div",{className:"parent-folder-access-modal__folder-list u-mar-top-s"},s.createElement("ul",{className:"o-list-ui o-list-ui--dividers"},t.props.memberAccessLevelResult.parentFolders.map(t.renderParentFolder))))},t.renderParentFolder=function(e){var n=s.createElement(a,{group:"web",name:"folder_user_32",className:"u-pad-right-xs",alt:""});return s.createElement("li",null,s.createElement("div",{className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:t.handleNavigateToParentFolder(e)},s.createElement(o.Flag,{leftAttachment:n,rightAttachment:t.renderFolderLink(e)},s.createElement("span",{className:"parent-folder-access-modal__folder-name"},r.em_snippet(e.name,c.SNIPPET_SIZES.FILENAME)))))},t.renderFolderLink=function(e){return s.createElement("button",{className:"button-as-link",onClick:t.handleNavigateToParentFolder(e),type:"button"},p(t.arePermissionsAllowed(e.permissions)?"Manage membership":"View folder"))},t.renderSimpleContent=function(){return s.createElement("div",null,s.createElement("span",{className:"parent-folder-access-modal__warning"},t.props.memberAccessLevelResult.warning),s.createElement("div",{className:"u-mar-top-m clearfix"},s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirm-button",onClick:t.dismissModal},p("OK")))))},t.getTitleStr=function(){
return p("remove"===t.props.originalAction?t.props.contentInfo.isFolder()?"%(member_name)s can still access this folder":"%(member_name)s can still access this file":t.props.contentInfo.isFolder()?t.memberCanEdit()?"%(member_name)s can still edit this folder":"%(member_name)s can still view this folder":t.memberCanEdit()?"%(member_name)s can still edit this file":"%(member_name)s can still view this file")},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.getTitleStr();return s.createElement(i.Modal,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:s.createElement("span",null),onDismissCompleted:this.handleDismissed,title:e.format({member_name:r.em_snippet(this.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME)})},s.createElement("div",{className:"parent-folder-access-modal__contents"},this.props.memberAccessLevelResult.parentFolders&&!this.props.isInContentManager?this.renderParentFolderContent():this.renderSimpleContent()))},t.displayName="ParentFolderAccessModal",t})(s.Component);t.ParentFolderAccessModal=m}),define("modules/clean/sharing/role_selector_modal",["require","exports","tslib","jquery","modules/clean/dbmodal","modules/clean/multiaccount_login","modules/clean/viewer"],function(e,t,n,s,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,{element_id:"select-role-modal-sync"})||this;return n.onSelectRole=t,n}return n.__extends(t,e),t.prototype.on_show=function(){var e=this;return s(".role-options li").click(function(t){var n=s(t.target).closest("li").data("role");return e.hide(),i.get_viewer().is_role_signed_in(n)?e.onSelectRole(n):o.show_modal({role:n,on_success:function(){return e.onSelectRole(n)}})})},t})(r.DBModal);t.RoleSelectorModal=a}),define("modules/clean/sharing/settings_modal/views/link_settings_tab",["require","exports","modules/clean/em_string","modules/core/i18n","external/react","modules/clean/sharing/api/types/metadata","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/gating_util","modules/constants/trademark"],function(e,t,n,s,r,o,i,a,l){"use strict";function c(){return d("Link settings")}function u(e){return a.isUserNoCommentEnabled(e)?[i.AUDIENCE_POLICY,i.ACCESS_LEVEL_POLICY,i.EXPIRY_POLICY,i.PASSWORD_POLICY]:[i.AUDIENCE_POLICY,i.EXPIRY_POLICY,i.PASSWORD_POLICY]}Object.defineProperty(t,"__esModule",{value:!0});var d=s.i18n_default_project("sharing")._;t.TabName=c,t.Description=function(e){var t;return t="owner"===e.aclUpdatePolicy?d(e.isTeamFolderTree?"Only team admins can change these settings":e.userIsOwner?"Only you (the owner) can change these settings":"Only the owner can change these settings"):null!=e.ownerTeam?d("Members of %(team_name)s with edit access can change these settings").format({team_name:n.em_snippet(e.ownerTeam.name,12)}):d("Anyone with edit access can change these settings"),r.createElement("span",null,t)},t.Banner=function(e){var t,n=e.linkMetadata.link_permissions&&e.linkMetadata.link_permissions.some(function(e){return!(!e||!e.allow)}),s=null!=e.linkMetadata.link_permissions.set_password&&e.linkMetadata.link_permissions.set_password.reason===o.VisibilityDisallowedReason.user_account_type;if(n){if(!s)return r.createElement("div",null);t=e.user.is_team?r.createElement("a",{href:"/team/upgrade",target:"_blank",rel:"noopener noreferrer"},d("Upgrade to %(trademark_business)s to enable expiration and password settings").format({trademark_business:l.TRADEMARK_BUSINESS})):r.createElement("a",{href:"/upgrade?oqa=sfp",target:"_blank",rel:"noopener noreferrer"},d("Upgrade to Dropbox %(trademark_plus)s to enable expiration and password settings.").format({trademark_plus:l.TRADEMARK_PLUS}))}else t=r.createElement("span",null,d("You don’t have permission to modify these link settings"));return r.createElement("div",{className:"sharing-settings-modal__banner u-font-center"},t)},t.getPolicies=u}),function(){define("modules/clean/sharing/settings_modal_components",["external/classnames","external/spectrum/button","external/react","modules/clean/react/css","modules/core/i18n"],function(e,t,n,s,r){var o,i,a,l,c,u;return o=t.Button,u=n.DOM,l=r.i18n_default_project("sharing")._,i=n.createClass({displayName:"SettingsModalButtons",propTypes:{disableSave:n.PropTypes.bool,isAccepting:n.PropTypes.bool,onAccept:n.PropTypes.func,onDismiss:n.PropTypes.func},render:function(){return u.div({className:"u-l-fr"},n.createElement(o,{className:"cancel-button",variant:"secondary",onClick:this.props.onDismiss},l("Cancel")),n.createElement(o,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:this.props.disableSave||this.props.isAccepting,onClick:this.props.onAccept},l(this.props.isAccepting?"Saving...":"Save")))}}),c=n.createClass({displayName:"SinglePolicyControl",propTypes:{canChange:n.PropTypes.bool,denyReason:n.PropTypes.string,currentValue:n.PropTypes.string,handleOptionChange:n.PropTypes.func,options:n.PropTypes.array,policyDescription:n.PropTypes.string,policyName:n.PropTypes.string},getDefaultProps:function(){return{canChange:!0}},render:function(){var t;return u.fieldset({className:e({"settings-form-entry":!0,"settings-form-entry--no-permissions":!this.props.canChange})},this.props.canChange||void 0===this.props.denyReason?void 0:u.div({className:"u-pad-xs u-font-center u-mar-bottom-s shared-folder-settings-form__no-permissions-banner"},this.props.denyReason),u.legend({className:"settings-form-entry__explanation u-trim-margin"},this.props.policyDescription),u.div({className:"settings-form-entry__options"},function(){var e,n,s,r;for(s=this.props.options,r=[],e=0,n=s.length;e<n;e++)t=s[e],r.push(u.label({key:t.value},u.input({checked:t.value===this.props.currentValue,className:"settings-form-entry-option-"+this.props.policyName+"__"+t.value,disabled:!this.props.canChange,name:this.props.policyName,onChange:(function(e){return function(t){var n;return"function"==typeof(n=e.props).handleOptionChange?n.handleOptionChange(t.target.name,t.target.value):void 0}})(this),type:"radio",value:t.value}),t.label));return r}.call(this)))}}),a=s(c,["/static/css/sharing/share_modal-vflhe7tSD.css"]),{SettingsModalButtons:i,SinglePolicyControl:a}})}.call(this),define("modules/clean/sharing/share_modal",["require","exports","tslib","external/immutable","external/react","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/pass/store","modules/clean/react/pass/utils","modules/clean/sharing/api/types/metadata","modules/clean/sharing/access_level","modules/clean/sharing/api/util/types","modules/clean/sharing/file_settings_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/inherited_members","modules/clean/sharing/views/modal_content","modules/clean/viewer","modules/constants/sharing","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=r.createElement,T=C.i18n_default_project("sharing")._,w=function(e){var t=u.AnonymousViewerUtils.getAnonymousUserIds(e),n=T("Guest");return t.map(function(e){return new d.UserMembershipInfo({access_type:p.ACCESS_LEVEL.READER,account:new d.BasicAccount({account_id:e,display_name:n,familiar_name:n,given_name:n,surname:""}),account_id:e,initials:u.AnonymousViewerUtils.getAnonymousViewerInitials(n),is_inherited:!1,permissions:new d.MemberPermissions({make_editor:new d.PermissionSetting({allow:!1}),make_viewer:new d.PermissionSetting({allow:!1}),make_owner:new d.PermissionSetting({allow:!1}),remove:new d.PermissionSetting({allow:!1})}),same_team:!1,time_last_seen:null})})},A=function(e){var t=e.actionHandler.getSharingInfo(),r=e.actionHandler.getPassInfo(),o=r[0],i=r[1],a=r[2],l={actionHandler:e.actionHandler,areMembersFullyLoaded:t.areMembersFullyLoaded(),areSharingPrefsLoaded:t.areSharingPrefsLoaded(),banner:t.banner(),canChangeOptions:t.canChangeOptions(),canEdit:t.canEdit(),canInviteEditor:t.canInviteEditor(),canInviteViewer:t.canInviteViewer(),canInviteViewerNoComment:t.canInviteViewerNoComment(),canMakeViewerNoComment:t.canMakeViewerNoComment(),canRelinquishMembership:t.canRelinquishMembership(),canShareLink:t.canShareLink(),canUnshareFile:t.canUnshareFile(),canUnshareFolder:t.canUnshareFolder(),canUpdateConfidentiality:t.canUpdateConfidentiality(),contactsError:t.contactsError(),contentInfo:t.contentInfo(),contentNameMessage:t.contentNameMessage(),contentNameMessageLevel:t.contentNameMessageLevel(),filePolicy:t.filePolicy(),folderPolicy:t.folderPolicy(),guestMembers:w(i),groupSeenStateInfo:o,hasDisplayableMembers:t.hasDisplayableMembers(),hasNonOwnerMembers:t.hasNonOwnerMembers(),hasParentSharedFolder:t.hasParentSharedFolder(),initialRecipientRawInput:t.initialRecipientRawInput(),initialRecipientTokens:t.initialRecipientTokens(),isAddMessageAsCommentChecked:t.isAddMessageAsCommentChecked(),isAddMessageAsCommentHelpShown:t.isAddMessageAsCommentHelpShown(),isConfidentialFolder:t.isConfidentialFolder(),isContentNameFocused:t.isContentNameFocused(),isFolderInsideTeamFolderTree:t.isFolderInsideTeamFolderTree(),isLinkMetadataLoaded:t.isLinkMetadataLoaded(),isMetadataLoaded:t.isMetadataLoaded(),isNoCommentEnabledForFolders:t.isNoCommentEnabledForFolders(),isNoCommentEnabledForLinks:t.isNoCommentEnabledForLinks(),isOwner:t.isOwner(),isTeamPolicyLoaded:t.isTeamPolicyLoaded(),isTeamSharedFolder:t.isTeamSharedFolder(),isTokenizerEmpty:t.isTokenizerEmpty(),isUserOnOwnerTeam:t.isUserOnOwnerTeam(),linkMetadata:t.linkMetadata(),linkOnlyReason:t.linkOnlyReason(),memberCounts:t.memberCounts(),memberCountWithRecipients:t.memberCountWithRecipients(),members:t.members(),metadata:t.metadata(),ownerTeam:t.ownerTeam(),passFetchingStatus:a,pendingMemberAction:t.pendingMemberAction(),permissions:t.permissions(),presentAccountIds:s.Set(i),recipientAccess:t.recipientAccess(),recipientMessage:t.recipientMessage(),recipientTokens:t.recipientTokens(),shareFolderPromise:t.shareFolderPromise(),shouldBlockMemberListOnPassLoad:t.shouldBlockMemberListOnPassLoad(),teamPolicy:t.teamPolicy(),uiMode:t.uiMode(),expSubgrowthProOverquotaCreateSharedLink:t.expSubgrowthProOverquotaCreateSharedLink()};return n.__assign({},t.getInitialProps(),l)},M=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleSettingsClick=function(){n.props.contentInfo.isFolder()?n.handleFolderSettingsClick():n.handleFileSettingsClick()},n.handleSetConfidentialClick=function(){var e=function(e){e&&(n.props.actionHandler.handleGetMetadataSuccess(e),n.props.actionHandler.listMembers(e.shared_folder_id)),n.props.actionHandler.openShareModal()};l.Modal.showInstance(r.createElement(S.SetInheritedMembersUIConfidentialModal,{actionHandler:n.props.actionHandler,initialIsConfidentialFolder:n.props.isConfidentialFolder,contentInfo:n.props.contentInfo,teamName:n.props.ownerTeam.name,onCancel:e,onUpdateConfidentiality:e}))},n.client=n.props.client,n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.getTokenizer();this.props.actionHandler.onShareModalUnmount(e)},t.prototype.render=function(){var e=c.passStore.getPassPermissions(this.props.contentInfo.id),t=e&&e.canReadPresence,s=!!(this.props.contentInfo.isFile()?this.props.filePolicy&&this.props.filePolicy.viewer_info_policy:this.props.folderPolicy&&this.props.folderPolicy.viewer_info_policy),o={headerId:"unified-share-modal-title",areCheckboxSettingsLoaded:this.props.areSharingPrefsLoaded,isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:t,isInContentManager:this.props.isInContentManager,onSettingsClick:this.handleSettingsClick,onSetConfidentialClick:this.handleSetConfidentialClick,mode:this.props.uiMode,ref:"content",showContentManagerBridge:this.shouldRenderContentManagerBridge(),showPassFileSettings:s,suppressLinkUI:this.shouldSuppressLinkUI()};return o=n.__assign({},this.props,o),r.createElement(l.Modal,{style:"bare",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",ref:"modal"},I(v.ShareModalContent,o))},t.prototype.shouldSuppressLinkUI=function(){return this.props.isInContentManager&&!b.TRUELINK.TRUELINK_UI[this.props.user.id]},t.prototype.refreshSharedWithColumnLinkData=function(){o.dispatch({type:a.SharedWithActionTypes.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},t.prototype.handleFolderPolicySuccess=function(e,t){o.dispatch({type:f.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,metadata:t,folderPolicy:e})},t.prototype.getTokenizer=function(){return this.refs.content&&this.refs.content.getWrappedComponent()&&this.refs.content.getWrappedComponent().refs.tokenizer},t.prototype.handleFileSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?h.getCombinedPolicy(this.props.filePolicy,this.props.linkMetadata):this.props.filePolicy,n=function(n){null!=n&&e.props.actionHandler.handleUpdateFilePolicy(n,t),e.props.actionHandler.openShareModal()};l.Modal.showInstance(r.createElement(m.FileSettingsModal,{fileName:this.props.contentInfo.name(),contentId:this.props.contentInfo.id,canChangeOptions:this.props.canChangeOptions,canUnshareFile:this.props.canUnshareFile,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialPolicy:t,linkMetadata:this.props.linkMetadata,onCancel:n,onPolicySet:n,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,user:this.props.user})),y.logTiburonEvent(this.props.contentInfo,this.props.user.id,"OPEN_FILE_SETTINGS_MODAL")},t.prototype.handleFolderSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?h.getCombinedPolicy(this.props.folderPolicy,this.props.linkMetadata):this.props.folderPolicy,n=function(t,n){null!=n&&(e.props.actionHandler.handleUpdateSharingSettings(n),e.handleFolderPolicySuccess(t,n),e.props.onSuccessSharing&&e.props.onSuccessSharing(),n.policy.shared_link_policy!==e.props.folderPolicy.shared_link_policy&&(e.props.actionHandler.fetchLinkMetadata(),e.refreshSharedWithColumnLinkData())),e.props.actionHandler.openShareModal()},s=null,o=null;this.props.contentInfo.extras&&this.props.contentInfo.extras.nsId&&(s=this.props.contentInfo.extras.nsId,o=this.props.contentInfo.extras.nsPath),l.Modal.showInstance(r.createElement(_.SharedFolderSettingsModal,{actionHandler:this.props.actionHandler,folderName:this.props.contentInfo.name(),folderId:this.props.metadata.shared_folder_id,folderPath:this.props.contentInfo.displayPath(),nsId:s,nsPath:o,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.props.hasParentSharedFolder,initialHasParentSharedFolder:this.props.hasParentSharedFolder,initialMetadata:this.props.metadata,initialOwnerTeam:this.props.ownerTeam,initialPermissions:this.props.permissions,initialPolicy:t,isInContentManager:this.props.isInContentManager,isSharedFolder:this.props.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isLimitedTeam:this.props.viewer.team_is_limited,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onCancel:n,onPolicySet:n,showContentManagerBridge:this.shouldRenderContentManagerBridge(!0),teamPolicy:this.props.teamPolicy,updateLinkSettings:this.props.actionHandler.updateLinkSettings,user:this.props.user}))},t.prototype.shouldRenderContentManagerBridge=function(e){return void 0===e&&(e=!1),!this.props.isInContentManager&&(!!y.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(e||!this.props.canInviteEditor)))},t.displayName="ShareModal",t.defaultProps={viewer:E.get_viewer()},t})(r.Component);t.ShareModal=i.listenToStores(M,{sharingInfoStore:g.sharingInfoStore,passStore:c.passStore},A)}),define("modules/clean/sharing/share_modal_icon_spectrum",["require","exports","tslib","external/react","external/spectrum/icon_content","modules/clean/filetypes","modules/clean/react/icon/file_icon","modules/clean/react/icon/icon_helper"],function(e,t,n,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return this.props.isFolder?this.renderFolder():this.renderFile()},t.prototype.renderFile=function(){var e={file:{type:o.FileTypes.FILE,fq_path:this.props.filename},className:this.props.className,variant:"small"};return s.createElement(i.FileIcon,n.__assign({},e))},t.prototype.renderFolder=function(){var e=o.FileTypes.FOLDER;this.props.pathExists&&(this.props.isTeamSharedFolder?e=o.FileTypes.TEAM_SHARED_FOLDER:this.props.isSharedFolder&&(e=o.FileTypes.SHARED_FOLDER));var t=a.spectrum_folder_icon({fileType:e,isViewOnly:this.props.isViewOnly,isInTeamFolderTree:this.props.isFolderInsideTeamFolderTree,size:a.ICON_SIZES.LARGE});return s.createElement(r.IconContent,{name:t,alt:this.props.alt,className:this.props.className})},t})(s.Component);t.ShareModalIcon=l}),define("modules/clean/sharing/share_modal_util",["require","exports","tslib","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/teams/modals/limited_team_folder_settings_modal","modules/clean/react/teams/modals/limited_team_share_folder_modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/viewer"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateModalSessionId=function(){return Math.random().toString()},t.getSharingInfo=function(e,s,r){void 0===r&&(r={});var o=null;"number"==typeof e&&(e=v.get_viewer().get_user_by_id(e)),null==r.userHomeNs&&(r.userHomeNs=e.home_ns_id);var i=t.getShareModalInfo(s),a=null;if(null!=i){i=n.__assign({},i,r),i.modalSessionId&&(i.modalSessionId=t.generateModalSessionId()),l.logViewShareModel({uid:e.id,modal_session_id:i.modalSessionId||""});try{o=_.ContentInfo.createFromParams(i)}catch(e){o=null}a=s instanceof c.BrowseContext?s:i.browseContext}return{browseContext:a,contentInfo:o,shareModalInfo:i,user:e}},t.showShareModal=function(e,n,o){void 0===o&&(o={});var i,a,l;if(b=t.getSharingInfo(e,n,o),i=b.browseContext,a=b.contentInfo,l=b.shareModalInfo,e=b.user,null==a||null==l)return!1;if(S.logTiburonEvent(a,e.id,"BEGIN_SHARE_FLOW"),l&&t.showFastrakShareModalIfAllowed(e,l,i))return!0;if(!l.skipPublicFolderCheck&&a&&i){var c=f.makePublicFolderLink(e.id,i.config,a.displayPath(),a.isFolder());if(c)return f.showPublicFolderLinkModal(c),!0}var u=(null!=i?i.isNonUserRelativeContext:void 0)||l.isNonUserRelativeContext,d=r.SHMODAL;if("PREVIEW_PAGE"===l.origin&&(d=r.SHARE_FILEVIEWER),u||s.EmailVerification.get_for_user(e).verified_or_show(d)){var h=a.isFolder()?m.FolderShareApiClient:m.FileShareApiClient,_=new h({userId:e.id,isNonUserRelativeContext:u}),y=new p.ShareModalActionHandler(_,e,g.ShareModal),v=l.inLinksPage,E=l.prefillContacts;y.initializeShareModal({contentInfo:a,initialRecipientTokens:E,inLinksPage:v},{client:_,user:e,onDeleteLink:l.onDeleteLink,teamGroupInfo:a.teamGroupInfo(),isInContentManager:u,onSuccessSharing:l.onSuccessSharing,shareAsConfidential:l.shareAsConfidential,initialContentName:l.initialContentName}),y.openShareModal()}else S.logTiburonEvent(a,e.id,"SHARE_MODAL_EMAIL_UNVERIFIED");return!0;var b},t.showFastrakShareModalIfAllowed=function(e,t,n){return!(!t.isTeamSharedFolder||!v.get_viewer().team_is_limited)&&(n&&e.is_team_admin&&t.origin&&t.targetNsId&&["BROWSE_SHARED_FOLDER_BANNER","BROWSE_GLOBAL_ACTIONS"].indexOf(t.origin)>-1?u.showWithProps({folderId:t.targetNsId.toString(),folderName:n.getNameOfTargetFolder(),user:e}):d.showModalInstance({fqPath:t.fqPath}),!0)},t.getShareModalInfo=function(e){if(e instanceof c.File){var t=[a.FileTypes.FILE,a.FileTypes.PACKAGE].indexOf(e.type)>-1;return{beaconContext:e.beacon_context,exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===a.FileTypes.TEAM_SHARED_FOLDER,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}}return e instanceof c.BrowseContext?E(e):e};var E=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}};t.showNewFolderShareModal=function(e,n,s,r,o,i){void 0===n&&(n=null),void 0===s&&(s=null),void 0===r&&(r=null),void 0===o&&(o=!1),void 0===i&&(i=!1),n||(n=t.generateModalSessionId());var a=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=1;n<=100;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return S.getNewFolderPathFromContentName(e,s||"")},l={fqPath:a(),isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:n,isNonUserRelativeContext:i,isTeamSharedFolder:!1,initialContentName:r,shareAsConfidential:o};return t.showShareModal(e,l)},t.showSharedContentLinkSyncModal=function(e,t){var n=new h.SharingApi(e),s=function(n){var s=JSON.parse(n.responseText);return y.showSharedContentSyncModal(e.id,s,t)};return n.get_sync_vars_for_ns_id(t.ns_id,t.ns_path,s)},t.showPrefilledShareModal=function(e){var n,s,r=e.user,a=e.sharePrefillEmail,l=e.content;return a?(n="GRANT_ACCESS",s=[new o.Contact({type:i.EMAIL,email:a,name:""})]):(n="DESKTOP_CLIENT",s=[]),t.showShareModal(r,l,{origin:n,prefillContacts:s})}}),function(){define("modules/clean/sharing/share_page/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-page",{INITIALIZE:"initialize-store",EMAIL_UNVERIFIED:"email-unverified",SWITCH_TAB:"switch-tab",SWITCH_ROLE:"switch-role",SWITCH_USER:"switch-user",LOAD_FOLDER_DATA_REQUEST:"load-folder-data-request",LOAD_FOLDER_DATA_SUCCESS:"load-folder-data-success",LOAD_FOLDER_DATA_ERROR:"load-folder-data-error",LOAD_FILE_DATA_REQUEST:"load-file-data-request",LOAD_FILE_DATA_SUCCESS:"load-file-data-success",LOAD_FILE_DATA_ERROR:"load-file-data-error",MOUNT_FOLDER_REQUEST:"mount-folder-request",MOUNT_FOLDER_SUCCESS:"mount-folder-success",MOUNT_FOLDER_ERROR:"mount-folder-error",UNMOUNT_FOLDER_REQUEST:"unmount-folder-request",UNMOUNT_FOLDER_SUCCESS:"unmount-folder-success",UNMOUNT_FOLDER_ERROR:"unmount-folder-error",UNSHARE_FOLDER_REQUEST:"unshare-folder-request",UNSHARE_FOLDER_SUCCESS:"unshare-folder-success",UNSHARE_FOLDER_ERROR:"unshare-folder-error",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_TEAM_POLICY_ERROR:"fetch-team-policy-error",FETCH_FOLDER_POLICY_SUCCESS:"fetch-folder-policy-success",FETCH_METADATA_SUCCESS:"fetch-metadata-success",RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:"relinquish-folder-membership-request",RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:"relinquish-folder-membership-success",RELINQUISH_FOLDER_MEMBERSHIP_ERROR:"relinquish-folder-membership-error",RELINQUISH_FILE_MEMBERSHIP_REQUEST:"relinquish-file-membership-request",RELINQUISH_FILE_MEMBERSHIP_SUCCESS:"relinquish-file-membership-success",RELINQUISH_FILE_MEMBERSHIP_ERROR:"relinquish-file-membership-error"}),{SharePageActionTypes:t}})}.call(this),define("modules/clean/sharing/shared_content_link_sync_modal",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/avatar/triple_avatars","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/loggers/growth_features_events_logger","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=b.i18n_default_project("sharing")._,T=(function(t){function b(n){var s=t.call(this,n)||this;return s.ASK="ask",s.ASKING="asking",s._closeSyncModal=function(){if(s.props.outOfQuotaQP){var e=void 0;s.props.canRequestToJoin?(e={is_limited:s.state.ownerTeam&&s.state.ownerTeam.is_limited,ns_id:s.props.syncNSId,requested_team_id:s.state.ownerTeam?s.state.ownerTeam.id:void 0},u.logMagnetEvent("request_modal_OQ_dismissed",e)):s.props.magnetControlLogging&&(e={ns_id:s.props.syncNSId},u.logMagnetEvent("modal_OQ_dismissed"))}c.remove_query_param("sm"),s.refs.modal.close()},s._renderTopPanelIcon=function(){return s.props.targetFile?r.createElement(h,{alt:"",group:"web",name:s.props.targetFile.icon}):r.createElement(h,{alt:"",group:"web",name:"folder_user_32"})},s._renderTopPanelTitle=function(){return s.props.targetFile?a.em_snippet(l.filename(s.props.targetFile.fq_path),15):a.em_snippet(s.props.folderName,15)},s._renderTopPanelSubtitle=function(){return s.props.targetFile?s.props.ownerName?I("Owned by %(name)s").format({name:s.props.ownerName}):I("Not currently owned"):s.props.folderSize},s._renderAccessText=function(){return s.props.outOfQuotaQP?s.props.canRequestToJoin?s.state.ownerTeam?r.createElement("div",null,r.createElement("div",{className:"content-link-sync-modal__access-text u-mar-top-m"},r.createElement(i.TripleAvatars,{contacts:s.state.ownerTeam.contacts,count:s.state.ownerTeam.count})),r.createElement("div",{className:"content-link-sync-modal__access-text"},I("Your Dropbox is full—join the %(team_name)s Dropbox?").format({team_name:s.state.ownerTeam.name}))):r.createElement("div",null):r.createElement("div",{className:"content-link-sync-modal__access-text"},I("Not enough space")):r.createElement("div",{className:"content-link-sync-modal__access-text"},s.props.senderName?"can_view"===s.props.accessLevel?s.user.is_cdm_member?I("%(name)s invited you to view this folder").format({name:s.props.senderName}):I("%(name)s gave you access to view this folder").format({name:s.props.senderName}):s.user.is_cdm_member?I("%(name)s invited you to edit this folder").format({name:s.props.senderName}):I("%(name)s gave you access to edit this folder").format({name:s.props.senderName}):I("can_view"===s.props.accessLevel?"You have access to view this folder":"You have access to edit this folder"))},s._renderSharedFolderInfo=function(){return r.createElement("div",{className:"content-link-sync-modal__shared-folder-info"},r.createElement("div",{className:"content-link-sync-modal__shared-folder-text"},I((s.props.targetFile?s.props.targetFile.is_dir:void 0)?"This folder is part of a shared folder:":"This file is part of a shared folder:")),r.createElement("div",null,r.createElement(h,{alt:"",group:"web",name:"folder_user_32"})),r.createElement("p",{className:"u-font-meta"},s.props.folderName,r.createElement("br",null),s.props.folderSize))},s._renderTipBody=function(e){return s.props.outOfQuotaQP?s.props.canRequestToJoin?s.state.ownerTeam?s.state.ownerTeam.contacts.length>0?I("Join %(name)s and your coworkers and get more space to work together.").format({name:s.state.ownerTeam.contacts[0].display_name}):null:r.createElement("img",{className:"content-link-sync-modal__loader",src:g.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:I("Loading")}):s.props.usageRemaining?I("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:s.props.usageRemaining,needed:s.props.usageNeeded}):I("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have no space left.").format({needed:s.props.usageNeeded}):s.state.state===s.ASKING?r.createElement("img",{src:g.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:I("Loading")}):!s.props.targetFile&&s.user.is_cdm_member?m.reactFormat(I("To get started, add this to <strong>%(cdm_tmf_name)s</strong> (your member folder). <a>Learn more</a>"),{cdm_tmf_name:e,strong:r.createElement("span",{className:"u-font-strong"}),a:r.createElement("a",{href:"/help/business/team-space-overview#acceptfolder",target:"_blank",rel:"noopener noreferrer"})}):I("can_view"===s.props.accessLevel?s.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":s.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first.")},s._renderPreviewLink=function(){return"can_view"===s.props.accessLevel?r.createElement("div",null,r.createElement("span",{className:"content-link-sync-modal__or"},I("Or")),r.createElement("button",{className:"content-link-sync-modal__not-now-label button-as-link",onClick:s.onPreviewButtonClicked},I(!s.props.targetFile||s.props.targetFile.is_dir?"preview this folder":"preview this file"))):null},s.renderControl=function(e){return r.createElement("div",{className:"content-link-sync-modal__content u-mar-bottom-xs"},r.createElement("div",{className:"content-link-sync-modal__top-panel u-pad-s"},r.createElement("div",{className:"content-link-sync-modal__icon u-pad-top-xs"},s._renderTopPanelIcon()),r.createElement("div",{className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},r.createElement("h3",{className:"u-font-strong"},s._renderTopPanelTitle()),r.createElement("h4",{className:"u-trim-margin u-font-meta"},s._renderTopPanelSubtitle())),r.createElement("div",{className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},r.createElement(f,{onClick:s._closeSyncModal}))),r.createElement("div",{className:"content-link-sync-modal__tip-panel"},s.props.targetFile?s._renderSharedFolderInfo():s._renderAccessText(),r.createElement("div",{className:"content-link-sync-modal__tip-body"},s._renderTipBody(e))))},s.renderVariant=function(){var e;return e=s.props.usageRemaining&&s.props.usageRemaining>"0"?m.reactFormat(I("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have <span>%(remaining)s</span> of space left."),{strong:r.createElement("strong",null),span:r.createElement("span",{className:"content-link-sync-modal__alert"}),remaining:s.props.usageRemaining,needed:s.props.usageNeeded}):m.reactFormat(I("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have no space left."),{strong:r.createElement("strong",null),needed:s.props.usageNeeded}),r.createElement("div",{className:"content-link-sync-modal--pro-variant__content u-mar-bottom-xs"},r.createElement("div",{className:"content-link-sync-modal--pro-variant__close u-pad-xs u-font-right"},r.createElement(f,{onClick:s._closeSyncModal})),r.createElement("div",{className:"content-link-sync-modal--pro-variant__container"},r.createElement("div",{
className:"content-link-sync-modal--pro-variant__left-container"},r.createElement("div",{className:"content-link-sync-modal--pro-variant__content"},r.createElement("div",{className:"content-link-sync-modal--pro-variant__folder-name"},a.em_snippet(s.props.folderName,_.SNIPPET_SIZES.OUT_OF_QUOTA_FOLDER_NAME)))),r.createElement("div",{className:"content-link-sync-modal--pro-variant__right-container"},r.createElement("div",{className:"content-link-sync-modal--pro-variant__tip-title"},I("Not enough space")),r.createElement("div",{className:"content-link-sync-modal--pro-variant__tip-body"},e))))},s.renderButtons=function(e){return s.props.canRequestToJoin&&s.props.outOfQuotaQP?s.state.ownerTeam?r.createElement("div",{className:"content-link-sync-modal__buttons u-mar-bottom-s"},s.props.outOfQuotaQP?r.createElement("div",null,s.state.ownerTeam.is_limited?void 0:r.createElement(d.button,{importance:"primary",className:"content-link-sync-modal__request-to-join-button",disabled:s.state.state===s.ASKING,onClick:s.onRequestButtonClicked},I("Request to join")),r.createElement(d.button,{importance:s.state.ownerTeam.is_limited?"primary":"tertiary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:s.state.state===s.ASKING,onClick:s.onSyncButtonClicked},I("Upgrade to add folder")),"can_view"===s.props.accessLevel?s._renderPreviewLink():void 0):void 0):r.createElement("div",null):r.createElement("div",{className:"content-link-sync-modal__buttons u-mar-bottom-s"},r.createElement(d.button,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:s.state.state===s.ASKING,onClick:s.onSyncButtonClicked},s.props.outOfQuotaQP?I("Upgrade to add folder"):s.props.targetFile?s.user.is_cdm_member?s.getButtonTextForCDM(e):I("Add folder to Dropbox"):s.user.is_cdm_member?s.getButtonTextForCDM(e):I("Add to Dropbox")),"can_view"===s.props.accessLevel?s._renderPreviewLink():void 0)},s.getButtonTextForCDM=function(e){return s.props.targetFile?e.length>9?I("Add folder to my member folder"):m.reactFormat(I("Add folder to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:e,strong:r.createElement("strong",{style:{fontWeight:800}})}):e.length>12?I("Add to my member folder"):m.reactFormat(I("Add to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:e,strong:r.createElement("strong",{style:{fontWeight:800}})})},s.renderButtonsVariant=function(){return r.createElement("div",{className:"content-link-sync-modal--pro-variant__buttons"},r.createElement(d.button,{importance:"primary",className:"content-link-sync-modal--pro-variant__add-to-dropbox-button",disabled:s.state.state===s.ASKING,onClick:s.onSyncButtonClicked},I("Upgrade to add folder")))},s.requestCallback=function(){if(s.props.outOfQuotaQP){var e=void 0;s.props.canRequestToJoin?(e={is_limited:s.state.ownerTeam?s.state.ownerTeam.is_limited:void 0,ns_id:s.props.syncNSId,requested_team_id:s.state.ownerTeam?s.state.ownerTeam.id:void 0},u.logMagnetEvent("request_modal_OQ_click_upgrade",e)):s.props.magnetControlLogging&&(e={ns_id:s.props.syncNSId},u.logMagnetEvent("modal_OQ_CTA_click",e));var t=v.BUY_URL,n=new C({path:t}).updateQuery({oqa:s.props.outOfQuotaQP});E.redirect(n.toString())}else s.props.targetFile&&o.ShareTibEventLogger.log(s.props.activeUserId,"UNMOUNTED_SEARCH_SYNC","SYNC_MODAL",{ns_id:s.props.syncNSId}),s.props.onMountSharedFolder(),s.setState({state:s.ASK})},s.onSyncButtonClicked=function(){s.setState({state:s.ASKING}),s.props.canRequestToJoin&&!s.props.outOfQuotaQP?s.activateRequestModal():s.requestCallback()},s.onPreviewButtonClicked=function(){if(s.props.previewCallback)o.ShareTibEventLogger.log(s.props.activeUserId,"UNMOUNTED_SEARCH_PREVIEW","SYNC_MODAL",{ns_id:s.props.syncNSId}),s.props.previewCallback();else{var e=s.props.previewUrl?C.parse(s.props.previewUrl):E.get_uri().removeQuery("sm");e.updateQuery({from_sync_modal:!0}),E.redirect(e)}},s.onRequestButtonClicked=function(){s.setState({state:s.ASKING}),e(["modules/clean/teams/membership_discovery_util"],function(e){(0,e.sendTeamRequest)(s.state.ownerTeam.id,function(){return p.Modal.close()})});var t=y.get_viewer().personal_user,n=t&&t.paid?"plus":"basic",r={folder_size:s.props.usageNeeded,is_limited:s.state.ownerTeam?s.state.ownerTeam.is_limited:void 0,ns_id:s.props.syncNSId,receiver_plan_type:n,receiver_quota_remaining:s.props.usageRemaining,requested_team_id:s.state.ownerTeam?s.state.ownerTeam.id:void 0};u.logMagnetEvent("request_modal_OQ_CTA_click",r)},s.activateRequestModal=function(){s.props.canRequestToJoin&&e(["modules/clean/teams/membership_request_modal"],function(e){var t=e.MembershipRequestModal;p.Modal.showInstance(r.createElement(t,{folderName:a.em_snippet(s.props.folderName,15),nsId:s.props.syncNSId,overQuotaQP:null!=s.props.outOfQuotaQP,quotaNeeded:s.props.usageNeeded,quotaRemaining:s.props.usageRemaining,requestCallback:s.requestCallback,senderName:s.props.senderName,team:s.state.ownerTeam}))})},s.state={state:s.ASK},s}return n.__extends(b,t),b.showInstance=function(e){p.Modal.showInstance(e)},b.prototype.componentWillMount=function(){var e=S.start_time(),t=(new Date).getTime();this.user=y.get_viewer().get_user_by_id(this.props.activeUserId);var n=_.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL,s=this.props.targetFile?"UNMOUNTED_SEARCH_MODAL_RENDER":"SYNC_MODAL_RENDER";o.ShareTibEventLogger.log(this.props.activeUserId,s,n,{timing:t-e,ns_id:this.props.syncNSId})},b.prototype.render=function(){var e,t,n,o=s({"content-link-sync-modal":!0,"can-request-to-join-team":this.props.canRequestToJoin});return this.user.is_cdm_member&&(n=l.filename(this.user.cdm_tmf_path)),t=this.renderControl(n),e=this.renderButtons(n),r.createElement(p.Modal,{autoClose:!1,buttonComponent:e,className:o,clickOutToClose:!1,ref:"modal",showX:!1,title:""},t)},b.prototype.componentDidMount=function(){var t,n=this;S.mark_time_to_interactive();var s=y.get_viewer().personal_user,r=s&&s.paid?"plus":"basic";this.props.canRequestToJoin&&(e(["modules/clean/teams/membership_discovery_util"],function(e){var t=e.getDiscoverableTeamForFolder;n.setState({state:n.ASKING}),t(n.props.syncNSId,function(e){n.setState({state:n.ASK,ownerTeam:e})})}),this.props.outOfQuotaQP&&(t={folder_size:this.props.usageNeeded,is_limited:this.state.ownerTeam?this.state.ownerTeam.is_limited:void 0,ns_id:this.props.syncNSId,receiver_plan_type:r,receiver_quota_remaining:this.props.usageRemaining,requested_team_id:this.state.ownerTeam?this.state.ownerTeam.id:void 0},u.logMagnetEvent("request_modal_OQ_open",t))),this.props.magnetControlLogging&&this.props.outOfQuotaQP&&(t={folder_size:this.props.usageNeeded,ns_id:this.props.syncNSId,receiver_plan_type:r,receiver_quota_remaining:this.props.usageRemaining},u.logMagnetEvent("modal_OQ_open",t))},b.displayName="SharedContentLinkSyncModal",b.defaultProps={canRequestToJoin:!1,magnetControlLogging:!1},b})(r.Component);t.SharedContentLinkSyncModal=T}),define("modules/clean/sharing/shared_content_link_sync_utils",["require","exports","external/react","modules/clean/browse_interface","modules/clean/multiaccount_login","modules/clean/sharing/api/mount_client","modules/clean/sharing/role_selector_modal","modules/clean/sharing/shared_content_link_sync_modal","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p){"use strict";function h(e,t,n,a,p){void 0===a&&(a=!1),void 0===p&&(p=null);var m;if(t)c.get_viewer().is_role_signed_in(t)||r.show_modal({role:t,on_success:function(){h(e,t,n)}});else if(c.get_viewer().is_paired){var f=function(t){n="PREVIEW_PAGE",h(e,t,n)};new i.RoleSelectorModal(f).show()}var g=c.get_viewer();if(t){var y=g.get_uid_by_role(t);d.assert(!!y,"selected role should have corresponding uid"),m=y?y:-1}else d.assert(!g.is_paired,"role can not be unspecified for paired viewer"),m=g.get_user_ids()[0];var S=_("Adding to your Dropbox...");g.is_paired&&(g.get_user_by_id(m).is_team?(S=_("Adding to your %(team_name)s Dropbox..."),S=S.format({team_name:g.team_name})):S=_("Adding to your personal Dropbox...")),l.sharingNotificationSuccess(S);var v=function(e){var t=e;p&&(t+=p.ns_path);var n=c.get_viewer().get_user_by_id(m),r=s.browse_uri_for_fq_path(n,t),o=a?"1":"0";r.updateQuery({from_scl_sync_modal:o}),u.redirect(r.toString())};new o.MountFolderApiClient({userId:m}).mount({contentId:e}).then(function(e){return v(e.path_lower)}).catch(function(e){e&&e.error&&"insufficient_quota"===e.error[".tag"]?l.sharingNotificationError(_("Can’t add folder. Your Dropbox account is full.")):l.sharingNotificationError(_("We were unable to complete your request."))})}function m(e,t,s){if(void 0===s&&(s=null),t&&t.sync_ns_id){var r=t.sync_owner_name||t.ownerName,o=function(){return h(t.sync_ns_id,t.sync_role,"SYNC_MODAL",!0,s)};a.SharedContentLinkSyncModal.showInstance(n.createElement(a.SharedContentLinkSyncModal,{activeUserId:e,accessLevel:t.access_level,canRequestToJoin:t.can_request_to_join,folderName:t.sync_folder_name,folderSize:t.sync_folder_size,magnetControlLogging:t.magnet_control,outOfQuotaQP:t.sync_out_of_quota_qp,usageRemaining:t.sync_usage_remaining,usageNeeded:t.sync_usage_needed,senderName:t.sync_sender_name,ownerName:r,targetFile:s,previewCallback:null!=s?u.redirect.bind(u,t.sync_preview_url):void 0,previewUrl:t.sync_preview_url,onMountSharedFolder:o,syncNSId:t.sync_ns_id,ownerProfilePhotoUrl:t.ownerProfilePhotoUrl}))}}Object.defineProperty(t,"__esModule",{value:!0});var _=p.i18n_default_project("sharing")._;t.mountSharedFolder=h,t.showSharedContentSyncModal=m}),define("modules/clean/sharing/sharing_settings_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MEMBER_POLICY="member_policy",t.DOWNLOAD_POLICY="download_policy",t.VIEWER_INFO_POLICY="viewer_info_policy",t.AUDIENCE_POLICY="audience",t.ACCESS_LEVEL_POLICY="access_level",t.FOLDER_LINK_AUDIENCE_POLICY="shared_link_policy",t.PASSWORD_POLICY="password",t.EXPIRY_POLICY="expiry",t.ACL_UPDATE_POLICY="acl_update_policy",t.DROPDOWN="dropdown",t.TOGGLE="toggle",t.PASSWORD_INPUT="password_input",t.EXPIRY_INPUT="expiry_input",t.FILE_SETTINGS="file_settings",t.FOLDER_SETTINGS="folder_settings",t.LINK_SETTINGS="link_settings"}),define("modules/clean/sharing/sharing_settings_dropdown",["require","exports","external/spectrum/dropdown_button","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,n,s,r,o){"use strict";function i(e){var t=e.customButton||s.createElement(n.DropdownButton,{className:"sharing-settings-dropdown__button"},s.createElement("span",{className:"sharing-settings-dropdown__button-label"},e.optionsDict[e.currentValue].label)),i=e.valuesList.map(function(t){var n=s.createElement("span",null);return t===e.currentValue&&(n=s.createElement(o,{alt:"",group:"web",name:"check_gray"})),s.createElement(r.BubbleMenuItem,{checked:t===e.currentValue,key:t,onClick:function(){return e.onValueSelected(t)}},s.createElement("div",{className:"sharing-settings-dropdown-item"},s.createElement("div",{className:"sharing-settings-dropdown-item__left-margin"},n),s.createElement("div",{className:"sharing-settings-dropdown-item__label"},s.createElement("div",{className:"sharing-settings-dropdown-item__title"},e.optionsDict[t].label),s.createElement("div",{className:"sharing-settings-dropdown-item__description u-font-meta"},e.optionsDict[t].description))))});return s.createElement(r.BubbleMenu,{targetButton:t,targetFixed:!0,position:e.openUp?r.BubbleMenu.POSITIONS.TOP_ALIGN_RIGHT:r.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-settings-dropdown",items:i,shouldShowArrow:!1})}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingDropdown=i}),define("modules/clean/sharing/sharing_settings_modal",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/calendar","modules/clean/react_format","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/tabs/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/sharing/components/button_group","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/ui_util","modules/core/i18n","modules/clean/sharing/api/types/metadata","modules/clean/sharing/settings_modal/views/link_settings_tab","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/sharing_settings_util"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=S.i18n_default_project("sharing")._,w=r.createElement,A=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleTogglePasswordPolicy=function(e){n.props.onOptionChange(C.PASSWORD_POLICY,{status:e}),n.setState({passwordInputDisabled:"on"===n.props.currentPolicy.get(C.PASSWORD_POLICY).status})},n.handleChangePasswordClick=function(){n.setState({passwordInputDisabled:!1}),n.props.onOptionChange(C.PASSWORD_POLICY,{status:"on",value:""})},n.state={passwordInputDisabled:!0},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=o.extend({},this.props);return t=o.extend(t,{currentTab:this.state.currentTab,onChangePasswordClick:this.handleChangePasswordClick,onTabSelected:function(t){e.setState({currentTab:t})},onTogglePasswordPolicy:this.handleTogglePasswordPolicy,passwordInputDisabled:this.state.passwordInputDisabled}),w(N,t)},t})(r.Component);t.SharingSettingsModal=A;var M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getDefaultProps=function(){return{hasDisplayableMembers:!1,hasNonOwnerMembers:!1}},t.prototype.componentDidUpdate=function(e){!this.props.passwordInputDisabled&&e.passwordInputDisabled&&this.refs.passwordInputRef&&this.refs.passwordInputRef.focus()},t.prototype.render=function(){var e;return e=this.props.isLoading?r.createElement("div",{className:"sharing-settings-modal__loading-text"},T("Loading...")):r.createElement("div",{className:"sharing-settings-modal"},this.renderHeader(),this.renderTabs(),this.renderTabContent(),r.createElement("div",{className:"sharing-settings-modal__footer"},this.renderButtons())),r.createElement(p.Modal,{altAction:this.props.altAction,style:"bare"},e)},t.prototype.renderHeader=function(){var e,t={folder_name:a.em_snippet(this.props.folderName,f.SNIPPET_SIZES.FILENAME)};return e=T("Settings for “%(folder_name)s”").format(t),r.createElement("div",{className:"sharing-settings-modal__header"},r.createElement("div",{className:"sharing-settings-modal__title-row"},r.createElement("div",{className:"u-l-b"},e)))},t.prototype.renderTabs=function(){return r.createElement(h,{tabs:this.getTabs(),onChange:this.props.onTabSelected,defaultSelectedIndex:0,variant:m.variants.UNDERLINE})},t.prototype.getTabs=function(){var e=this,t={value:C.FILE_SETTINGS,label:T("File settings")},n={value:C.FOLDER_SETTINGS,label:T("Folder settings")},s={value:C.LINK_SETTINGS,label:T("Link settings")},r=this.props.isFolder?[n]:[t];return!this.props.isTeamSharedFolder&&this.props.linkMetadata&&r.push(s),r.filter(function(t){return e.getTabInfo(t.value).policies.length>0})},t.prototype.getCurrentTab=function(){return this.props.currentTab||this.getTabs()[0].value},t.prototype.renderTabContent=function(){var e=this,t=this.getTabInfo(this.getCurrentTab());return r.createElement("div",null,t.banner,r.createElement("div",{className:"sharing-settings-modal__tab-content"},r.createElement("div",{className:"tab-content-header"},r.createElement("div",{className:"tab-content-header__description u-font-meta"},t.description)),r.createElement("div",null,t.policies.map(function(t){var n=e.getPolicyDict(t);return e.renderPolicy(t,n)}))))},t.prototype.getFolderSettingsBanner=function(){if(!this.props.shouldHideHeader&&this.props.isFolder){var e,t=T("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName});if(this.props.isInContentManager)e=t;else if(this.props.showContentManagerBridge){var n=l.parent_dir(this.props.folderPath),s=y.genContentManagerBridgeUri({containingFolder:n,isLimitedTeam:this.props.isLimitedTeam,filenameToSelect:this.props.folderName,isCDM:void 0});e=r.createElement("div",null,t,r.createElement("div",null,T("You can change these settings in the Admin Console.")+" ",r.createElement("a",{href:s.toString(),target:"_blank"},T("Open in new tab."))))}else if(this.isTeamFolderTree())e=r.createElement("div",null,t,r.createElement("div",null,r.createElement("a",{href:"/team",target:"_blank"},T("To edit, ask your admin."))));else{if(this.props.permissions.change_options.allow)return;e=T("You don’t have permission to change the settings on this folder.")}return r.createElement("div",{className:"sharing-settings-modal__banner u-font-center"},e)}},t.prototype.isTeamFolderTree=function(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree},t.prototype.getMemberPolicyQuestion=function(){return T(this.isTeamFolderTree()?"Who can be added to folders?":"Who can be invited to this folder?")},t.prototype.getAclUpdatePolicyQuestion=function(){return T(this.isTeamFolderTree()?"Who can invite new members and create a link to folders?":"Who can invite new members and create a link to this folder?")},t.prototype.getDownloadsPolicyDescription=function(){return T(this.isTeamFolderTree()?"Lets people download the folders. People with edit access can always download.":this.props.isFolder?"Lets people download this folder. People with edit access can always download.":"Lets people download this file. People with edit access can always download.")},t.prototype.getViewerInfoPolicyDescription=function(){if(this.props.ownerTeam){var e=void 0;return e=T(this.props.isFolder?"Shows who viewed the files. Only members of %(team_name)s and people who can edit can see this info.":"Shows who viewed the file. Only members of %(team_name)s and people who can edit can see this info."),e.format({team_name:this.props.ownerTeam.name})}return T(this.props.isFolder?"Shows who viewed the files.":"Shows who viewed the file.")},t.prototype.getFolderSettingPolicies=function(){var e=[];return Boolean(this.props.ownerTeam)&&(e.push(C.FOLDER_LINK_AUDIENCE_POLICY),e.push(C.MEMBER_POLICY)),e.push(C.ACL_UPDATE_POLICY),this.canChangePolicy(C.DOWNLOAD_POLICY)&&e.push(C.DOWNLOAD_POLICY),null!=this.props.currentPolicy.viewer_info_policy&&e.push(C.VIEWER_INFO_POLICY),e},t.prototype.getFileSettingPolicies=function(){var e=[];return this.canChangePolicy(C.DOWNLOAD_POLICY)&&e.push(C.DOWNLOAD_POLICY),null!=this.props.currentPolicy.viewer_info_policy&&e.push(C.VIEWER_INFO_POLICY),e},t.prototype.canChangePolicy=function(e){return this.props.getEffectivePolicyValue(e,this.props.policyUpdate)[1]},t.prototype.getMemberPolicyTeamLabel=function(){return T("Only members of %(team_name)s").format({team_name:a.em_snippet(this.props.ownerTeam.name,3,1)})},t.prototype.getAclUpdatePolicyEditorsLabel=function(){return this.props.ownerTeam?T("Members on %(team_name)s with edit access").format({team_name:a.em_snippet(this.props.ownerTeam.name,12)}):T("Members with edit access")},t.prototype.getAclUpdatePolicyEditorsDescription=function(){return this.props.ownerTeam?T("Any member of %(team_name)s with edit access to this folder.").format({team_name:a.em_snippet(this.props.ownerTeam.name,12)}):T("Anyone with edit access to this folder.")},t.prototype.getPolicyDict=function(e){var t=this;switch(e){case C.MEMBER_POLICY:return{title:T("Membership"),description:this.getMemberPolicyQuestion(),optionsDict:{team:{label:this.getMemberPolicyTeamLabel()},anyone:{label:T("Anyone")}},optionsList:["anyone","team"],type:C.DROPDOWN};case C.ACL_UPDATE_POLICY:return{title:T("Management"),description:this.getAclUpdatePolicyQuestion(),optionsDict:{owner:{label:T(this.isTeamFolderTree()?"Only Team Admins":"Only the owner"),description:T(this.isTeamFolderTree()?"Only Team Admins.":"Only the owner of this folder.")},editors:{label:this.getAclUpdatePolicyEditorsLabel(),description:this.getAclUpdatePolicyEditorsDescription()}},optionsList:["editors","owner"],type:C.DROPDOWN};case C.DOWNLOAD_POLICY:return{title:T("Downloads"),description:this.getDownloadsPolicyDescription(),optionsDict:{allow:{label:T("On")},disallow:{label:T("Off")}},optionsList:["allow","disallow"],type:C.TOGGLE};case C.VIEWER_INFO_POLICY:return{title:T("Viewer info"),description:this.getViewerInfoPolicyDescription(),optionsDict:{enabled:{label:T("On")},disabled:{label:T("Off")}},optionsList:["enabled","disabled"],type:C.TOGGLE};case C.AUDIENCE_POLICY:return{title:T("Link access"),description:T("Who can open the shared link?"),optionsDict:I.getAudienceOptionsDict(this.props.isFolder,this.props.ownerTeam&&this.props.ownerTeam.name,this.props.hasNonOwnerMembers,this.props.hasDisplayableMembers),optionsList:this.props.linkMetadata.audience_options.valueSeq().toArray(),type:C.DROPDOWN,extras:function(e){return t.renderAudiencePolicyExtras(e)}};case C.ACCESS_LEVEL_POLICY:return{title:T("Link permission"),description:T("What can users with links do?"),optionsDict:{viewer:{label:T("Can comment"),description:T("Lets them view and comment, but not edit.")},viewer_no_comment:{label:T("Can view"),description:T("Lets them view only. They can’t see comments.")}},optionsList:["viewer","viewer_no_comment"],type:C.DROPDOWN};case C.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return{title:T("Link restrictions"),description:T("Limits who can access this folder via a link."),optionsDict:{anyone:{label:T("No restrictions"),description:T("Show all access options for links.")},team:{label:T("Team and invite-only"),description:T("Show “Only people at %(team_name)s” and “Only                               invited members.”").format({team_name:a.em_snippet(this.props.ownerTeam.name,12)})},members:{label:T("Invite-only"),description:T("Show “Only invited members” only.")}},optionsList:["anyone","team","members"],type:C.DROPDOWN};case C.PASSWORD_POLICY:return{title:T("Password protection"),description:T("Add a password to the shared link"),optionsDict:{on:{label:T("On")},off:{label:T("Off")}},optionsList:["on","off"],type:C.PASSWORD_INPUT};case C.EXPIRY_POLICY:return{title:T("Expiration"),description:T("Disables the shared link on a specific date"),optionsDict:{on:{label:T("On")},off:{label:T("Off")}},optionsList:["on","off"],type:C.EXPIRY_INPUT};default:throw new Error("Policy name not found")}},t.prototype.getFolderSettingsDescription=function(){return T(this.isTeamFolderTree()?"Only team admins can change these settings":this.canChangePolicy(C.ACL_UPDATE_POLICY)?"Only you (the owner) can change these settings.":"Only the owner can change these settings.")},t.prototype.getTabInfo=function(e){switch(e){case C.FILE_SETTINGS:return{title:T("File settings"),banner:void 0,description:"",policies:this.getFileSettingPolicies()};case C.FOLDER_SETTINGS:return{title:T("Folder settings"),banner:this.getFolderSettingsBanner(),description:this.getFolderSettingsDescription(),policies:this.getFolderSettingPolicies()};case C.LINK_SETTINGS:var t="owner"===this.props.currentPolicy.get(C.ACL_UPDATE_POLICY)&&this.canChangePolicy(C.AUDIENCE_POLICY);return{title:E.TabName(),banner:r.createElement(E.Banner,{linkMetadata:this.props.linkMetadata,user:this.props.user}),description:r.createElement(E.Description,{aclUpdatePolicy:this.props.currentPolicy.get(C.ACL_UPDATE_POLICY),isTeamFolderTree:this.isTeamFolderTree(),ownerTeam:this.props.ownerTeam,userIsOwner:t}),policies:E.getPolicies(this.props.user)};default:throw new Error("tabName not found")}},t.prototype.renderPolicy=function(e,t){var n,o,i=this,a=t.title,l=t.description,c=t.optionsDict,u=t.optionsList,d=t.type,p=t.extras,h=void 0===p?null:p;g=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),n=g[0],o=g[1];var m;if(d===C.DROPDOWN)m=r.createElement(b.SettingDropdown,{currentValue:n,valuesList:u,optionsDict:c,onValueSelected:function(t){return i.props.onOptionChange(e,t)}});else if(d===C.TOGGLE)m=r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(u,c),value:n,onSelectValue:function(t){return i.props.onOptionChange(e,t)}});else if(d===C.PASSWORD_INPUT)m=this.renderPasswordInput(e,n,c,u);else{if(d!==C.EXPIRY_INPUT)throw new Error("Selector type not found");m=this.renderExpiryInput(e,n,c,u)}var f=r.createElement("div",null);return h&&(f=h(n)),r.createElement("div",{className:s({policy:!0,"policy--no-permissions":!o})},r.createElement("div",{className:"policy__left"},r.createElement("div",{className:"policy__title"},a),r.createElement("div",{className:"policy__description u-font-meta"},l)),r.createElement("div",{className:"policy__selector"},m),r.createElement("div",{className:"policy__extras"},f));var g},t.prototype.renderAudiencePolicyExtras=function(e){var t=this.props.linkMetadata,n=r.createElement("div",null);if(t.audience_restricting_shared_folder&&t.audience_restricting_shared_folder.audience===e){var s=void 0,o=t.audience_restricting_shared_folder.name;s=1===t.audience_options.size?u.reactFormat(T("This setting is applied via a parent folder.              To change access, go to <strong>%(folder_name)s</strong> link settings."),{folder_name:o,strong:r.createElement("strong",null)}):u.reactFormat(T("This setting is limited via a parent folder.              To see more options, go to <strong>%(folder_name)s</strong> link settings."),{folder_name:o,strong:r.createElement("strong",null)}),n=r.createElement("div",{className:"policy__graybox"},s)}else this.props.isFolder&&e!==v.LinkAudience.members&&(n=r.createElement("div",{className:"policy__audience-extras"},T("Applies to all items in this folder")));return n},t.prototype.renderPasswordInput=function(e,t,n,s){var o=this,i=t,a=r.createElement("div",null);if("on"===i.status){var l=r.createElement("div",null);this.props.passwordInputDisabled&&this.props.linkMetadata.link_permissions.set_password.allow&&(l=r.createElement("button",{className:"password-input__change-button button-as-link",onClick:this.props.onChangePasswordClick},"Change")),a=r.createElement("div",{className:"password-input u-pad-top-s"},r.createElement("label",{htmlFor:"password-input"},"Password:"),r.createElement("br",null),r.createElement("input",{autoFocus:!0,className:"c-input password-input__input",disabled:this.props.passwordInputDisabled,id:"password-input",onChange:function(t){o.props.onOptionChange(e,{status:"on",value:t.target.value})},placeholder:T("Enter a new password"),ref:"passwordInputRef",type:"password",value:this.props.passwordInputDisabled?123456:i.value||""}),l)}return r.createElement("div",null,r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(s,n),value:i.status,onSelectValue:this.props.onTogglePasswordPolicy}),a)},t.prototype.renderExpiryInput=function(e,t,n,s){var o=this,a=t,l=r.createElement("div",null),u=i.daysAfterToday(30);return"on"===a.status&&(l=r.createElement("div",{className:"u-pad-top-s"},r.createElement("div",null,T("Link deactivates on:")),r.createElement(c.Calendar,{alignAtLeft:!1,disabled:!this.props.linkMetadata.link_permissions.set_expiry.allow,firstDay:i.daysAfterToday(1),initDate:a.value?new Date(a.value):u,lastDay:i.daysAfterToday(365),onDateChange:function(t){return o.props.onOptionChange(e,{status:"on",value:t})}}))),r.createElement("div",null,r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(s,n),value:a.status,onSelectValue:function(t){o.props.onOptionChange(e,{status:t,value:a.value||u})}}),l)},t.prototype.getButtonGroupOptions=function(e,t){return e.map(function(e){return{value:e,label:t[e].label}})},t.prototype.allowSaveSettings=function(){return!(!this.props.policyUpdate||0===o.keys(this.props.policyUpdate).length)&&!(this.props.policyUpdate.password&&"on"===this.props.policyUpdate.password.status&&!this.props.passwordInputDisabled&&(!this.props.policyUpdate.password.value||""===this.props.policyUpdate.password.value))},t.prototype.renderButtons=function(){var e;if(this.props.permissions.unshare.allow&&(this.props.isSharedFolder||!this.props.isFolder)){var t=void 0;t=T(this.props.isFolder?this.props.isFolderInsideTeamFolderTree?"Reset membership":"Unshare folder":"Unshare file"),e=r.createElement("div",{className:"u-l-fl"},r.createElement("button",{className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},t))}return r.createElement("div",{className:"clearfix sharing-settings-modal__buttons"},e,r.createElement(g.SettingsModalButtons,{disableSave:!this.allowSaveSettings(),isAccepting:this.props.isSubmitting,onAccept:this.props.onSaveSettings,onDismiss:this.props.onDismiss}))},t})(r.Component);t.SharingSettingsModalContentsView=M;var N=d(M,["/static/css/sharing/share_modal-vflhe7tSD.css"])}),define("modules/clean/sharing/sharing_settings_util",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/sharing_settings_constants","modules/core/i18n"],function(e,t,n,s,r,o,i){"use strict";function a(e,t,n,s,r,i){switch(e){case o.AUDIENCE_POLICY:return s&&s.link_permissions.change_audience.allow&&s.audience_options.size>1;case o.PASSWORD_POLICY:return s&&"members"!==n.get(o.AUDIENCE_POLICY)&&(s.link_permissions.set_password.allow||s.link_permissions.remove_password.allow&&"off"!==t.get(o.PASSWORD_POLICY).status);case o.EXPIRY_POLICY:return s&&"members"!==n.get(o.AUDIENCE_POLICY)&&(s.link_permissions.set_expiry.allow||s.link_permissions.remove_expiry.allow&&"off"!==t.get(o.EXPIRY_POLICY).status);case o.DOWNLOAD_POLICY:return!(!r||i)&&("allow"===t.get(o.DOWNLOAD_POLICY)?r.set_download_policy&&r.set_download_policy.allow:r.remove_download_policy&&r.remove_download_policy.allow);case o.VIEWER_INFO_POLICY:return!(!r||i)&&("enabled"===t.get(o.VIEWER_INFO_POLICY)?r.disable_viewer_info&&r.disable_viewer_info.allow:r.enable_viewer_info&&r.enable_viewer_info.allow);default:throw new Error("Link policy not found")}}function l(e){switch(e){case"restricted_by_parent_folder":return p("This setting is turned off for all files in this folder.");case"restricted_by_team":return p("Your admin has disabled this setting.");default:return}}function c(e,t){return"enabled"===e.get(o.VIEWER_INFO_POLICY)?t.disable_viewer_info?l(t.disable_viewer_info.reason):void 0:t.enable_viewer_info?l(t.enable_viewer_info.reason):void 0}function u(e){return[o.AUDIENCE_POLICY,o.DOWNLOAD_POLICY,o.EXPIRY_POLICY,o.VIEWER_INFO_POLICY,o.PASSWORD_POLICY].indexOf(e)!==-1}function d(e,t,o,i){var a,l,c=i&&!o;return c?(a=p("Only you"),l=p(e?"Only you can access this folder.":"Only you can access this file.")):(a=p("Invited members"),l=e?r.reactFormat(p("<strong>Most secure.</strong> Only those specifically invited can access this folder."),{strong:n.DOM.strong()}):r.reactFormat(p("<strong>Most secure.</strong> Only those specifically invited can access this file."),{strong:n.DOM.strong()})),{public:{label:p("Anyone with the link"),description:p(e?"Anyone who has the link can access this folder.":"Anyone who has the link can access this file.")},team:{label:p("Members of %(team_name)s").format({team_name:s.em_snippet(t||"",6,1)}),description:e?p("Only members of %(team_name)s and invited members can access this folder.").format({team_name:t}):p("Only members of %(team_name)s and invited members can access this file.").format({team_name:t})},members:{label:a,description:l}}}Object.defineProperty(t,"__esModule",{value:!0});var p=i.i18n_default_project("sharing")._;t.canChangePolicy=a,t.denyReasonToDenyString=l,t.getPassDenyReason=c,t.isCommonSharingSettingsPolicy=u,t.getAudienceOptionsDict=d}),
define("modules/clean/sharing/stores/sharing_info",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/types/metadata","modules/clean/sharing/access_level","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/core/exception"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=function(e,t){return t=String(t),t.startsWith("id:")||(t=t.toLowerCase()),e+"::"+t},_=(function(e){function t(){var t=e.call(this)||this;return t.sharingInfoMap={},t}return n.__extends(t,e),t.prototype.getSharingInfo=function(e,t){return t?this.sharingInfoMap[m(e,t)]:null},t.prototype.mapContentIdsToSharingInfo=function(e,t,n){for(var s=0,r=t;s<r.length;s++){var o=r[s];o&&(this.sharingInfoMap[m(e,o)]=n)}},t.prototype._new_payload=function(e){var t=this;if(e&&e.action&&e.action.type)switch(e.action.type){case i.SharingActionTypes.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS:var n=e.action.user;e.action.data.forEach(function(e){t._new_payload_for_single_content(i.ShareModalActionTypes.FETCH_METADATA_SUCCESS,n,c.getContentIdsForMetadata(e),{metadata:e})}),this.emit_change();break;default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}},t.prototype._new_payload_for_single_content=function(e,t,n,s){h.assert(Boolean(t.id),"valid user needed"),h.assert(n.length>0,"contentIds cannot be empty");for(var r=null,o=0,i=n;o<i.length;o++){var a=i[o],l=m(t.id,a);if(l in this.sharingInfoMap){r=this.sharingInfoMap[l];break}}return r||(r=new f(t)),this.mapContentIdsToSharingInfo(t.id,n,r),r._new_payload(e,s)},t})(o);t.sharingInfoStore=new _;var f=(function(){function e(e){this._areMembersFullyLoaded=!1,this._areSharingPrefsLoaded=!1,this._hasDisplayableMembers=!1,this._isLinkMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._isUpdatingLinkAudience=!1,this._sharingPrefs=new a.SharingPrefs,this._shouldBlockMemberListOnPassLoad=!0,this._user=e}return e.prototype._new_payload=function(e,n){switch(e){case i.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST:var s=this._metadata;this._linkMetadata||(s=s.set("link_metadata",new a.SharedContentLinkMetadata)),s=s.setIn(["link_metadata","current_audience"],n.newAudience),this.setMetadata(s),this._isUpdatingLinkAudience=!0;break;case i.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE:this._isUpdatingLinkAudience=!1,this.setMetadata(this._metadata.setIn(["link_metadata","current_audience"],n.prevAudience));break;case i.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS:this._modalInfo.hasChangedLinkAudience=!0,this._isUpdatingLinkAudience=!1,this.setMetadata(n.metadata);break;case i.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE:var o=n.member;this._members=this._members.setIn([o.type(),o.memberKey(),"access_type"],n.prevAccess);break;case i.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST:var o=n.member;this._members=this._members.setIn([o.type(),o.memberKey(),"access_type"],n.newAccess);break;case i.ShareModalActionTypes.CHANGE_RECIPIENTS:this._modalInfo.recipientTokens=n.recipientTokens,this._modalInfo.recipientRawInput=n.recipientRawInput;var l=void 0;n.recipientTokens.length>0||n.recipientRawInput.length>0?this.uiMode()===d.MODES.MEMBERSHIP&&(l=d.MODES.SHARE):this.uiMode()===d.MODES.SHARE&&(l=d.MODES.MEMBERSHIP),l&&(this._modalInfo.uiMode=l);break;case i.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS:this._modalInfo.recipientAccess=n.newAccess;break;case i.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE:this._modalInfo.recipientMessage=n.message;break;case i.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:this._members=this._members.update("users",function(e){return e.map(function(e){return e.set("time_last_seen",null)})});break;case i.ShareModalActionTypes.CREATE_LINK_SUCCESS:this._linkMetadata=n.linkMetadata;break;case i.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=n.memberCounts;break;case i.ShareModalActionTypes.FETCH_METADATA_FAILURE:this._fetchingMetadataPromise=void 0,this._modalInfo&&(this._modalInfo.uiMode=d.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason!==d.LINK_ONLY_REASON.LINKS_PAGE&&(this._modalInfo.linkOnlyReason=n.reason));break;case i.ShareModalActionTypes.FETCH_METADATA_REQUEST:this._fetchingMetadataPromise=n.promise;break;case i.ShareModalActionTypes.FETCH_METADATA_SUCCESS:this._fetchingMetadataPromise=void 0,this.setMetadata(n.metadata);break;case i.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST:this._areSharingPrefsLoaded=!1;break;case i.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS:this._areSharingPrefsLoaded=!0,this._sharingPrefs=n.sharingPrefs;break;case i.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE:this._isLinkMetadataLoaded=!0,this._linkMetadata=void 0;break;case i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS:this._isLinkMetadataLoaded=!0,this._linkMetadata=n.linkMetadata;break;case i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST:this._fetchingMembersRequest={limitNonNull:n.limitNonNull,promise:n.promise,requestId:n.requestId};break;case i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;if(this._hasDisplayableMembers&&this._fetchingMembersRequest&&this._fetchingMembersRequest.limitNonNull<this._members.getMemberCount())return;this._hasDisplayableMembers=!0,n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=n.members;break;case i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=this._members.mergeDeep(n.members);break;case i.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST:this._isTeamPolicyLoaded=!1;break;case i.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS:this._isTeamPolicyLoaded=!0,this._teamPolicy=n.teamPolicy;case i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS:this._memberCounts=new a.MemberCounts({total_unique_users:n.count,users_outside_team:0,exceeds_count:n.exceeds_limit});break;case i.ShareModalActionTypes.FETCH_UPSELL_EXPERIMENT_VARIANT:n.variant&&(this._expSubgrowthProOverquotaCreateSharedLink=n.variant);case i.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE:""===n.name?(this._modalInfo.contentNameMessage=d.CONTENT_NAME_EMPTY_TOOLTIP,this._modalInfo.contentNameMessageLevel=d.CONTENT_NAME_MESSAGE_LEVELS.INFO):(this._modalInfo.contentNameMessage=void 0,this._modalInfo.contentNameMessageLevel=d.CONTENT_NAME_MESSAGE_LEVELS.INFO);break;case i.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo.isContentNameFocused=n.focus;break;case i.ShareModalActionTypes.MEMBER_ACTION_COMPLETE:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(n.member.memberKey());break;case i.ShareModalActionTypes.MEMBER_ACTION_PENDING:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.add(n.member.memberKey());break;case i.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:var o=n.member;this._members=this._members.setIn([o.type(),o.memberKey(),"access_type"],n.access),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(o.memberKey());break;case i.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:var o=n.member;this._members=this._members.deleteIn([o.type(),o.memberKey()]),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(o.memberKey());break;case i.ShareModalActionTypes.SEND_SHARE_FAILURE:this._modalInfo.uiMode=d.MODES.SHARE;break;case i.ShareModalActionTypes.SEND_SHARE_REQUEST:this._modalInfo.uiMode=d.MODES.SHARE_SENDING;break;case i.ShareModalActionTypes.SEND_SHARE_SUCCESS:this._modalInfo.uiMode=d.MODES.SHARE;break;case i.ShareModalActionTypes.SET_COMMENT_CHECKBOX_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_checked",n.checked);break;case i.ShareModalActionTypes.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_help_shown",!1);break;case i.ShareModalActionTypes.SHARE_FOLDER_FAILURE:this._shareFolderPromise=void 0;break;case i.ShareModalActionTypes.SHARE_FOLDER_REQUEST:this._shareFolderPromise=n.promise;break;case i.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:this.setMetadata(n.metadata),this._shareFolderPromise=void 0;break;case i.ShareModalActionTypes.SHARE_MODAL_CLOSE:this._modalInfo.initialRecipientTokens=n.tokens||[],this._modalInfo.initialRecipientRawInput=n.value||"";break;case i.ShareModalActionTypes.SHARE_MODAL_OPEN:this.handleShareModalOpen(n);break;case i.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS:this._metadata=void 0,this._isLinkMetadataLoaded=!1,this._hasDisplayableMembers=!1;break;case i.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:this._shouldBlockMemberListOnPassLoad=!1;break;case i.ShareModalActionTypes.UPDATE_BANNER:this._modalInfo.banner=n.banner;break;case i.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS:this._modalInfo&&(this._modalInfo.hasChangedSharingSettings=!0),this.setMetadata(n.metadata);break;case i.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo.contentNameMessage=n.errorMsg,this._modalInfo.contentNameMessageLevel=d.CONTENT_NAME_MESSAGE_LEVELS.ERROR;break;case i.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS:var c=r.parent_dir(this.fqPath()),p=u.getNewFolderPathFromContentName(n.contentName,c);this._modalInfo.contentInfo=this._modalInfo.contentInfo.setFQPath(p),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,[p],this)}},e.prototype.handleShareModalOpen=function(e){this._modalInfo=new g(e.shareModalInfo.contentInfo),this._modalInfo.initialRecipientTokens=e.shareModalInfo.initialRecipientTokens||[],this._initialProps=e.initialProps,e.shareModalInfo.inLinksPage&&(this._modalInfo.uiMode=d.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason=d.LINK_ONLY_REASON.LINKS_PAGE),this._areMembersFullyLoaded=!1,!e.shareModalInfo.contentInfo.pathExists()&&!e.initialProps.initialContentName&&(this._modalInfo.isContentNameFocused=!0,this._modalInfo.contentNameMessage=d.CONTENT_NAME_EMPTY_TOOLTIP)},e.prototype.setMetadata=function(e){p.TRUELINK.TRUELINK_UI[this._user.id]&&(this._isUpdatingLinkAudience&&(e=e.setIn(["link_metadata","current_audience"],this._linkMetadata.current_audience)),this._isLinkMetadataLoaded=!0,e.link_metadata&&(this._linkMetadata=e.link_metadata));var n=e.permissions||this._metadata&&this._metadata.permissions;this._metadata=e.set("permissions",n),this._modalInfo&&e.shared_folder_id&&(this._modalInfo.contentInfo=this._modalInfo.contentInfo.setNsId(e.shared_folder_id)),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,c.getContentIdsForMetadata(e),this)},e.prototype.isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.hasNonOwnerMembers=function(){var e=this._members&&this._members.getMemberCount();if(!e)return!1;if(1===e&&1===this._members.users.count()){return this._members.users.first().account_id!==this._user.account_id}return!0},e.prototype.memberCountWithRecipients=function(){return(this.memberCounts()&&this.memberCounts().total_unique_users||this.members()&&this.members().getMemberCount()||0)+u.getMemberCountForTokens(this.recipientTokens())},e.prototype.getInitialProps=function(){return this._initialProps},e.prototype.areMembersFullyLoaded=function(){return this._areMembersFullyLoaded},e.prototype.areSharingPrefsLoaded=function(){return this._areSharingPrefsLoaded},e.prototype.banner=function(){return this._modalInfo.banner},e.prototype.canChangeOptions=function(){return Boolean(this._metadata&&this._metadata.permissions.change_options&&this._metadata.permissions.change_options.allow)},e.prototype.canEdit=function(){return Boolean(this._metadata&&this._metadata.permissions.edit_contents&&this._metadata.permissions.edit_contents.allow)},e.prototype.canInviteEditor=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_editor&&this._metadata.permissions.invite_editor.allow)},e.prototype.canInviteViewer=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer&&this._metadata.permissions.invite_viewer.allow)},e.prototype.canInviteViewerNoComment=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer_no_comment&&this._metadata.permissions.invite_viewer_no_comment.allow)},e.prototype.canMakeViewerNoComment=function(){return this.isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){return Boolean(this._metadata&&this._metadata.permissions.relinquish_membership&&this._metadata.permissions.relinquish_membership.allow)},e.prototype.canShareLink=function(){return!this.isTeamSharedFolder()&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()},e.prototype.canUnshareFile=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUnshareFolder=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUpdateConfidentiality=function(){return Boolean(this._metadata&&this._metadata.permissions.update_confidentiality&&this._metadata.permissions.update_confidentiality.allow)},e.prototype.contactsError=function(){return u.validateContacts(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients())},e.prototype.contentId=function(){return this._modalInfo.contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo.contentInfo},e.prototype.contentNameMessage=function(){return this._modalInfo.contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo.contentNameMessageLevel},e.prototype.expSubgrowthProOverquotaCreateSharedLink=function(){return this._expSubgrowthProOverquotaCreateSharedLink},e.prototype.fetchingMembersRequest=function(){return this._fetchingMembersRequest},e.prototype.fetchingMetadataPromise=function(){return this._fetchingMetadataPromise},e.prototype.filePolicy=function(){return this._metadata&&this._metadata.file_policy},e.prototype.folderPolicy=function(){return this._metadata&&this._metadata.policy},e.prototype.fqPath=function(){return this._modalInfo.contentInfo.displayPath()},e.prototype.hasChangedLinkAudience=function(){return this._modalInfo&&this._modalInfo.hasChangedLinkAudience},e.prototype.hasChangedSharingSettings=function(){return this._modalInfo&&this._modalInfo.hasChangedSharingSettings},e.prototype.hasDisplayableMembers=function(){return this._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.initialRecipientRawInput=function(){return this._modalInfo.initialRecipientRawInput},e.prototype.initialRecipientTokens=function(){return this._modalInfo.initialRecipientTokens},e.prototype.isAddMessageAsCommentChecked=function(){return Boolean(this._sharingPrefs.add_message_as_comment_checked)},e.prototype.isAddMessageAsCommentHelpShown=function(){return Boolean(this._sharingPrefs.add_message_as_comment_help_shown)},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isNonUserRelativeContext=function(){return this.getInitialProps().isInContentManager},e.prototype.isFolder=function(){return this._modalInfo.contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){return Boolean(this._metadata&&this._metadata.is_confidential)},e.prototype.isContentNameFocused=function(){return this._modalInfo.isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.isInsideSharedFolder=function(){return Boolean(this._metadata&&this._metadata.parent_shared_folder_id||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return Boolean(this._metadata)},e.prototype.isOwner=function(){return Boolean(this._metadata&&this._metadata.access_type===l.ACCESS_LEVEL.OWNER)},e.prototype.isUserOnOwnerTeam=function(){return Boolean(this._metadata&&this._metadata.owner_team&&this._metadata.owner_team.id===this._user.team_dbtid)},e.prototype.isTeamPolicyLoaded=function(){return this._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){return Boolean(this._metadata&&this._metadata.is_team_folder||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isUpdatingLinkAudience=function(){return this._isUpdatingLinkAudience},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo.linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){return this._metadata&&this._metadata.owner_team},e.prototype.parentSharedFolderId=function(){return this._metadata&&this._metadata.parent_shared_folder_id},e.prototype.pendingMemberAction=function(){return this._modalInfo.pendingMemberAction},e.prototype.permissions=function(){return this._metadata&&this._metadata.permissions},e.prototype.recipientAccess=function(){return this._modalInfo.recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo.recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo.recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo.recipientTokens},e.prototype.shareAsConfidential=function(){return Boolean(this.getInitialProps().shareAsConfidential)},e.prototype.shareFolderPromise=function(){return this._shareFolderPromise},e.prototype.shouldBlockMemberListOnPassLoad=function(){return this._shouldBlockMemberListOnPassLoad},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo.uiMode},e})();t.SharingInfo=f;var g=(function(){function e(e){this.banner=d.BANNERS.NO_MEMBERS,this.canRelinquishMembership=!1,this.contentNameMessageLevel=d.CONTENT_NAME_MESSAGE_LEVELS.INFO,this.hasChangedLinkAudience=!1,this.hasChangedSharingSettings=!1,this.initialRecipientRawInput="",this.initialRecipientTokens=[],this.isContentNameFocused=!1,this.pendingMemberAction=s.Set(),this.recipientAccess=l.ACCESS_LEVEL.READER,this.recipientMessage="",this.recipientRawInput="",this.recipientTokens=[],this.shareAsConfidential=!1,this.uiMode=d.MODES.MEMBERSHIP,this.contentInfo=e,e.isFolder()&&(this.recipientAccess=l.ACCESS_LEVEL.WRITER)}return e})();t.SharingModalInfo=g}),define("modules/clean/sharing/stores/sharing_info_util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContentIdsForMetadata=function(e){return[e.shared_folder_id,e.id,e.path_lower].filter(Boolean)},t.getContentIdsForContentInfo=function(e){var t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push("ns:"+e.nsId()+e.nsPath())),e.displayPath()&&t.push(e.displayPath()),t}}),define("modules/clean/sharing/strings",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r.i18n_default_project("sharing")._,i=(p={},p[n.ACCESS_LEVEL.OWNER]=o("Owner"),p[n.ACCESS_LEVEL.WRITER]=o("Can edit"),p[n.ACCESS_LEVEL.READER]=o("Can view"),p[n.ACCESS_LEVEL.READER_NO_COMMENT]=o("View-only"),p);t.ACCESS_NAME=i;var a=(h={},h[n.ACCESS_LEVEL.OWNER]=o("Owner"),h[n.ACCESS_LEVEL.WRITER]=o("Can edit"),h[n.ACCESS_LEVEL.READER]=o("Can comment"),h[n.ACCESS_LEVEL.READER_NO_COMMENT]=o("Can view"),h);t.ACCESS_NAME_NO_COMMENT=a;var l=(m={},m[s.MEMBER_ACTION.MAKE_EDITOR]=o("People can edit, delete, comment, and add the file to their Dropbox"),m[s.MEMBER_ACTION.MAKE_VIEWER]=o("People can view, download, and comment"),m[s.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=o("People can only view and download the files"),m);t.MEMBER_ACTION_FOLDER=l;var c=(_={},_[s.MEMBER_ACTION.MAKE_EDITOR]=o("People can edit, delete, comment, and add the files to their Dropbox"),_[s.MEMBER_ACTION.MAKE_VIEWER]=o("People can view, download, and comment"),_[s.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=o("People can only view and download the file"),_);t.MEMBER_ACTION_FILE=c;var u=(f={},f[s.MEMBER_ACTION.MAKE_EDITOR]=o("Lets them view, comment, and edit."),f[s.MEMBER_ACTION.MAKE_VIEWER]=o("Lets them view and comment, but not edit."),f[s.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=o("Lets them view only. They can’t see comments."),f);t.MEMBER_ACTION_FOLDER_NO_COMMENT=u;var d=(g={},g[s.MEMBER_ACTION.MAKE_EDITOR]=o("Lets them view, comment, and edit."),g[s.MEMBER_ACTION.MAKE_VIEWER]=o("Lets them view and comment, but not edit."),g[s.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=o("Lets them view only. They can’t see comments."),g);t.MEMBER_ACTION_FILE_NO_COMMENT=d;var p,h,m,_,f,g}),define("modules/clean/sharing/ui_notifications_util",["require","exports","modules/core/notify","modules/clean/react/snackbar","modules/constants/sharing"],function(e,t,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.SHARING_UNSHARING.SNACKBAR_MESSAGES?s.Snackbar.fail(e):n.error(e)};t.sharingNotificationError=o;var i=function(e){return r.SHARING_UNSHARING.SNACKBAR_MESSAGES?s.Snackbar.generic(e):n.info(e)};t.sharingNotificationInfo=i;var a=function(e){return r.SHARING_UNSHARING.SNACKBAR_MESSAGES?s.Snackbar.complete(e):n.success(e)};t.sharingNotificationSuccess=a}),define("modules/clean/sharing/ui_util",["require","exports","external/react","external/underscore","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/contact_token_state","modules/clean/contacts/types","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/icon/icon_helper","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/gating_util","modules/constants/trademark","modules/core/i18n","modules/core/uri","modules/core/user_i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenGate=h.GoldenGate;var y=_.i18n_default_project("sharing"),S=y._,v=y.ungettext,E={};t.SharingExperiments=E;var b={strong:n.createElement("strong",null),em:n.createElement("em",null)},C={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",PUBLIC:"public",NO_SHARE:"no-share"};t.SHARE_UI_TYPE=C;var I={SINGLE_INVALID:S("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:S("This person isn’t on your Dropbox team"),SINGLE_TOO_MANY_MEMBERS:S("Can’t share with this many people"),GENERAL_INVALID:S("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:S("One or more invitees are outside your Dropbox team."),GENERAL_TOO_MANY_MEMBERS:d.reactFormat(S("This will put the folder over its %(member_limit)s-member limit. <a>Learn more.</a>",{comment:"member_limit will be a number greater than 200"}),{member_limit:h.GoldenGate.SHARING_TOTAL_LIMIT,a:n.createElement("a",{href:"/help/9292",target:"_blank",key:"help_center_article"})}),NONGROUP_INVITEE:S("Only groups can be added to team folders.")};t.CONTACT_ERROR_MESSAGES=I;var T={ERROR:"error",WARN:"warn"};t.CONTACT_ERROR_LEVEL=T;var w=function(e,t){return(t.displayName()||"").toLowerCase()},A=Math.pow(2,53)-1,M=function(e){return function(t,n){var s=n.memberId()===t,r=n instanceof p.GroupMembershipInfo?"0":"1",o=(n.displayName()||"").toLowerCase(),i=function(e){var t=String(A-Number(e)),n=String(A).length;return t.length<n&&(t=""+Array(n-t.length+1).join("0")+t),t},a=null!=n.account_id&&e.has(n.account_id);return r+(a&&s?"a":a?"b":null!=n.time_last_seen?"c"+i(n.time_last_seen):"d")+o}},N=function(e,t,n){var s=n?M(t):w;return function(t,n){var r=s(e.account_id,t),o=s(e.account_id,n);return r<o?-1:r===o?0:1}};t.makeMemberSortCmp=N;var k=function(e,t,n){return!e.is_cdm_member&&(t||n)};t.shouldEnforceMemberLimits=k;var P=function(e,t,n,s,r,o,a){var l={state:i.ContactTokenState.ok,msg:""};if(r&&!e.group_id)return{state:i.ContactTokenState.invalid,msg:I.NONGROUP_INVITEE};if(k(t,r,o)&&a>h.GoldenGate.SHARING_TOTAL_LIMIT)return{state:i.ContactTokenState.invalid,msg:I.SINGLE_TOO_MANY_MEMBERS};if(e.invalid)l={state:i.ContactTokenState.invalid,msg:I.SINGLE_INVALID};else{if(e.email===t.email)return l;if(null!=n&&t.is_team&&e.dbx_team_id!==n.id&&!e.group_id){var c=I.SINGLE_OUT_OF_TEAM,u=void 0;u="team"===(null!=s?s.member_policy:void 0)||"team"===(null!=s?s.resolved_member_policy:void 0)?i.ContactTokenState.invalid:i.ContactTokenState.warn,l={msg:c,state:u}}}return l};t.validateContact=P;var R=function(e,t,n,s,r,o,a){for(var l=null,c=null,u=0,d=0,p=e;d<p.length;d++){var m=p[d],_=P(m,t,n,s,r,o,0),f=_.state,g=_.msg;if(f===i.ContactTokenState.invalid){if(l=T.ERROR,g===I.SINGLE_INVALID){c=I.GENERAL_INVALID;break}g===I.SINGLE_OUT_OF_TEAM&&(c=I.GENERAL_OUT_OF_TEAM),g===I.NONGROUP_INVITEE&&(c=I.NONGROUP_INVITEE)}f===i.ContactTokenState.warn&&g===I.SINGLE_OUT_OF_TEAM&&(l||(l=T.WARN,c=I.GENERAL_OUT_OF_TEAM)),u+=null!=m.group_size?m.group_size:1}return k(t,r,o)&&e.length>0&&l!==T.ERROR&&a>h.GoldenGate.SHARING_TOTAL_LIMIT&&(l=T.ERROR,c=I.GENERAL_TOO_MANY_MEMBERS),{level:l,message:c}};t.validateContacts=R;var L=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},F=function(e){var t=e.displayName()||"";return{access_type:L(e.access_type),display_name:t,initials:null!=e.initials?e.initials:g.getInitials(t),photo_url:null!=e.account?e.account.profile_photo_url:void 0,user_id:e.memberId()}};t.apiUserMemberToAvatarInfo=F;var O=function(e){return{access_type:L(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}};t.apiGroupMemberToAvatarInfo=O;var x=function(e){return{access_type:L(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}};t.apiInviteeMemberToAvatarInfo=x;var D=function(e,t,n,o){void 0===o&&(o={}),r.ShareTibEventLogger.log(t,n,e.extras.origin||"",s.extend(o,{file_id:e.extras.fileId,fq_path:e.displayPath(),ns_id:e.isSharedFolder()?e.sharedFolderId():void 0,modal_session_id:e.extras.modalSessionId}))};t.logTiburonEvent=D;var U={access_error:S("You don’t have access to this content."),email_unverified:S("You haven’t verified your email. Check your email and try again."),bad_member:S("You entered an invalid name or email address."),cant_share_outside_team:S("Your team settings don’t allow sharing outside your team."),too_many_members:S("You’re sharing with too many people."),too_many_pending_invites:S("You’re sharing with too many people."),rate_limit:S("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:S("You need a Dropbox %(trademark_plus)s or Business account to do this.").format({trademark_plus:m.TRADEMARK_PLUS}),team_folder:S("You can’t add members to a team folder. Contact your team admin."),no_permission:S("You don’t have permission to do this. Contact the owner.")},B=function(e){return e.message?e.message:e instanceof o.AppError&&e.error&&e.error[".tag"]&&U[e.error[".tag"]]?U[e.error[".tag"]]:S("There was a problem completing this request.")};t.genAddMemberErrorMessage=B;var H=function(e,t,n,s){var r=e.filter(function(e){return[a.EMAIL,a.DBX_ID].indexOf(e.type)>-1}),o=e.filter(function(e){return e.type===a.NEW_STYLE_GROUP}),i={content_name:t,group_name:null!=o[0]?o[0].name:void 0,num_groups:o.length,num_people:r.length,recipient:null!=r[0]?r[0].email:void 0};if(r.length>0&&0===o.length)return n?v("Added %(recipient)s to “%(content_name)s”.","Added %(num_people)s people to “%(content_name)s”.",r.length).format(i):s?v("Securely added %(recipient)s to “%(content_name)s”.","Securely added %(num_people)s people to “%(content_name)s”.",r.length).format(i):v("Securely shared “%(content_name)s” with %(recipient)s.","Securely shared “%(content_name)s” with %(num_people)s people.",r.length).format(i);if(0===r.length&&o.length>0)return n?v("Added %(group_name)s to “%(content_name)s”.","Added  %(num_groups)s groups to “%(content_name)s”.",o.length).format(i):s?v("Securely added %(group_name)s to “%(content_name)s”.","Securely added  %(num_groups)s groups to “%(content_name)s”.",o.length).format(i):v("Securely shared “%(content_name)s” with %(group_name)s.","Securely shared “%(content_name)s” with %(num_groups)s groups.",o.length).format(i);if(1===r.length&&o.length>0)return n?v("Added %(recipient)s and 1 group to “%(content_name)s”.","Added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",o.length).format(i):s?v("Securely added %(recipient)s and 1 group to “%(content_name)s”.","Securely added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",o.length).format(i):v("Securely shared “%(content_name)s” with %(recipient)s and 1 group.","Securely shared “%(content_name)s” with %(recipient)s and %(num_groups)s groups.",o.length).format(i);if(r.length>1&&o.length>0)return n?S("Shared “%(content_name)s.”").format(i):S("Securely shared “%(content_name)s.”").format(i);throw"Logic error: There should be at least 1 recipient"};t.genShareSuccessMessage=H;var q=function(e){var t=null!=e.parent_shared_folder_id,n=!1;return e.permissions&&e.permissions.edit_contents&&(n=!e.permissions.edit_contents.allow),u.folder_icon({isShared:e.isSharedFolder(),isDeleted:null==e.path_lower,isInTeamFolderTree:t,isTeamFolder:e.is_team_folder,isViewOnly:n})};t.folderIconForMetadata=q;var V=function(e){var t=null!=e.parent_shared_folder_id,n=!1;e.permissions&&e.permissions.edit_contents&&(n=!e.permissions.edit_contents.allow);var s=c.FileTypes.FOLDER;return e.isSharedFolder()?s=c.FileTypes.SHARED_FOLDER:e.is_team_folder&&(s=c.FileTypes.TEAM_SHARED_FOLDER),u.spectrum_folder_icon({fileType:s,isInTeamFolderTree:t,isViewOnly:n})};t.spectrumFolderIconForMetadata=V;var G=function(e){return u.file_icon(e.name,{size:u.ICON_SIZES.LARGE})};t.fileIconForMetadata=G;var W=function(e){var t=e.isLimitedTeam,n=e.containingFolder,s=e.filenameToSelect,r=e.isCDM;if(t)return new f({path:"/preview_admin_console"});var o=void 0,i=r?"content":"team_folders";return n=l.normalize(n)||"",s&&(o=[n,s].join("/")),new f({path:"/team/admin/"+i+"/home"+n,query:o?{select:o}:void 0})};t.genContentManagerBridgeUri=W;var j=function(e,t){return[l.normalize(t),e].join("/")};t.getNewFolderPathFromContentName=j;var K=function(e){return null==e?0:e.map(function(e){return e.group_size||1}).reduce(function(e,t){return e+t},0)};t.getMemberCountForTokens=K;var Y=function(e){return e.toHTML?d.reactFormat(e.toHTML(),b):e};t.convertIfHTML=Y}),function(){define("modules/clean/sharing/views/comments_help",["external/classnames","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,s,r,o,i){var a,l,c,u,d;return d=o.static_url,l=i._,c=t.createElement,u=t.DOM,a=t.createClass({
displayName:"ShareModalCommentsHelp",mixins:[t.addons.PureRenderMixin],propTypes:{onClose:t.PropTypes.func.isRequired,onButtonClick:t.PropTypes.func.isRequired,isFeedbackRequest:t.PropTypes.bool},renderText:function(){return this.props.isFeedbackRequest?[u.h1({key:"heading"},l("Get feedback on your work")),u.p({key:"content"},l("This will ask recipients to leave comments on your file and post your message as a comment."))]:u.p({},l("New! You can now post your message as a comment on the file. Anyone who views this file can see this comment."))},render:function(){return u.div({className:e(["bubble-dropdown","right-bottom","u-font-center","u-pad-m","u-l-b","comments-help-dialog"])},u.div({className:"close-button u-font-right"},c(r,{onClick:this.props.onClose})),c(s,{src:d("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:d("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),this.renderText(),u.button({className:"c-btn c-btn--primary",onClick:this.props.onButtonClick},l("Try it out")),u.div({className:"bubble-arrow-border"}),u.div({className:"bubble-arrow"}))}}),a=n(a,["/static/css/legacy_packages/components-vflfWNhxV.css"])})}.call(this),define("modules/clean/sharing/views/constants",["require","exports","external/underscore","modules/core/i18n"],function(e,t,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s.i18n_default_project("sharing")._;t.MODES={LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"};var o;(function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"})(o=t.BANNERS||(t.BANNERS={}));var i;(function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"})(i=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={})),t.LINK_ONLY_REASON={INSIDE_SHARED_FOLDER:"inside_shared_folder",CONTAINS_SHARED_FOLDER:"contains_shared_folder",LINKS_PAGE:"links_page"},t.CONTENT_NAME_EMPTY_TOOLTIP=r("Name your shared folder"),t.MODE_VALUES=n.values(t.MODES),t.BANNER_VALUES=n.values(o),t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=n.values(i)}),define("modules/clean/sharing/views/exp_share_link_upsell",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react_format","modules/clean/static_urls","modules/constants/trademark","modules/constants/payments"],function(e,t,n,s,r,o,i,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=u.OUT_OF_SPACE_URL+"?oqa=sf_sloq";return s.createElement("div",{className:"share-link-upgrade__content"},s.createElement(o,{className:"unified-share-modal__illo",src:l.static_url("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:l.static_url("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),s.createElement("div",{className:"share-link-upgrade__footer"},s.createElement("div",{className:"share-link-upgrade__footer-content"},s.createElement("p",{className:"u-mar-top-s share-link-upgrade__copy"},a.reactFormat(i._("Get %(trademark_plus)s to add more shared content to your Dropbox."),{trademark_plus:c.TRADEMARK_PLUS})),s.createElement("a",{className:"c-btn c-btn--primary subgrowth_pro_overquota_create_shared_link",href:e},i._("Upgrade")))))},t})(s.Component);t.ExpShareLinkUpsellV1=r(d,["/static/css/sharing/exp_oq_shared_link_upsellV1-vflBUzAf2.css"]),t.ExpShareLinkUpsellV2=r(d,["/static/css/sharing/exp_oq_shared_link_upsellV2-vflI1ituq.css"])}),define("modules/clean/sharing/views/inherited_members",["require","exports","tslib","external/classnames","external/react","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/undo","modules/core/i18n","modules/core/notify"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r.createElement,g=(function(e){function t(t){var n=e.call(this,t)||this;return n.onToggleShowMemberList=function(){0!==n.props.members.length&&n.setState({areMembersExpanded:!n.state.areMembersExpanded})},n.state={areMembersExpanded:!1},n}return n.__extends(t,e),t.prototype.renderMembersList=function(){return this.state.areMembersExpanded?r.createElement("div",null,r.createElement("div",{className:"u-mar-top-xs u-mar-horizontal-xs u-pad-top-xs inherited-member-list__divider"}),r.createElement("div",null,r.createElement("ul",{className:"u-pad-horizontal-s u-pad-vertical-xs inherited-member-list__member"},this.props.children))):void 0},t.prototype.renderRemoveButton=function(){return this.props.canUpdateConfidentiality?r.createElement("button",{className:"inherited-member-list__remove-button button-as-link",onClick:this.props.onSetConfidentialClick},m._("Remove",{comment:"Shown on button that can be clicked to remove access to subfolder"})):void 0},t.prototype.renderTriangle=function(){return 0===this.props.members.length?r.createElement("div",{className:"u-pad-horizontal-xs"}):r.createElement("a",{href:"#",className:"u-pad-horizontal-xxs o-flag__fix inherited-member-list__triangle",onClick:this.onToggleShowMemberList},f(c,{alt:m._("Toggle whether inherited members are displayed or hidden"),group:"web",name:this.state.areMembersExpanded?"triangle_open_1x":"triangle_closed_1x"}))},t.prototype.render=function(){var e,t=a.parent_dir(this.props.contentInfo.displayPath());if("/"===t)e=m._("Members of %(team_name)s shared workspace").format({team_name:i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME)});else{var n=a.filename(t);e=m._("Members of “%(folder_name)s” folder").format({folder_name:i.em_snippet(n,p.SNIPPET_SIZES.FILENAME)})}var o=0;this.props.members.forEach(function(e){e instanceof d.GroupMembershipInfo?o+=e.member_count:o++});var l=m.ungettext("%(members_count)s member","%(members_count)s members",o).format({members_count:o}),u=s([{"u-mar-bottom-xs":!0,"inherited-member-list__outer-expanded":this.state.areMembersExpanded,"inherited-member-list__outer-closed":!this.state.areMembersExpanded}]),h=s([{"inherited-member-list__inner":!this.state.areMembersExpanded}]);return r.createElement("div",{className:u},r.createElement("div",{className:h},r.createElement("div",{className:"o-flag inherited-member-list__toggle-show-member",onClick:this.onToggleShowMemberList},this.renderTriangle(),r.createElement("div",{className:"o-flag__flex u-pad-vertical-xs u-pad-right-s"},r.createElement("div",{className:"o-flag"},r.createElement("div",{className:"o-flag__fix"},f(c,{alt:"",className:"unified-share-modal__title-icon",group:"web",name:"folder_user_32"})),r.createElement("div",{className:"o-flag__flex u-pad-left-s"},r.createElement("div",{className:"inherited-member-list__member-str u-font-strong"},e),r.createElement("div",{className:"inherited-member-list__member-count-str u-font-meta"},l)),r.createElement("div",{className:"o-flag__fix u-pad-right-xxs"},this.renderRemoveButton())))),r.createElement("div",null,this.renderMembersList())))},t})(r.Component);t.InheritedMembers=g;var y=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={isAccepting:!1},n}return n.__extends(t,e),t.prototype.renderContent=function(e,t,n){var s;return s=this.props.initialIsConfidentialFolder?e?u.reactFormat(m._("<strong>%(folder_name)s</strong> won’t be shared privately any more.\n             Everyone at %(team_name)s will have access to this folder.").format({team_name:i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME),folder_name:i.em_snippet(n,15)}),{strong:r.createElement("strong",{style:{fontWeight:500}})}):u.reactFormat(m._("Everyone who can access <strong>%(parent_folder_name)s</strong> will be able to access this folder.").format({parent_folder_name:i.em_snippet(t,15)}),{strong:r.createElement("strong",{style:{fontWeight:500}})}):e?u.reactFormat(m._("Members of %(team_name)s won’t be able to access <strong>%(folder_name)s</strong>.").format({team_name:i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME),folder_name:i.em_snippet(n,15)}),{strong:r.createElement("strong",{style:{fontWeight:500}})}):u.reactFormat(m._("Members of <strong>%(parent_folder_name)s</strong> folder won’t be able to access\n             <strong>%(folder_name)s</strong>.").format({parent_folder_name:i.em_snippet(t,15),folder_name:i.em_snippet(n,15)}),{strong:r.createElement("strong",{style:{fontWeight:500}})}),r.createElement("div",null,r.createElement("div",{className:"confirmation-modal__content"},s),r.createElement("br",null))},t.prototype.renderButtons=function(e,t,n){var s=this,o=i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME),a=e?m._("Share with %(team_name)s").format({team_name:o}):m._("Share"),l=this.props.initialIsConfidentialFolder?a:m._("Remove");return r.createElement("div",{className:"u-l-fr"},r.createElement("button",{className:"c-btn c-btn--primary confirmation-modal__action",disabled:this.state.isAccepting,onClick:function(){return s._onToggleConfidentialFolder(!0,e,t,n)}},l),r.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs confirmation-modal__cancel",onClick:this.props.onCancel},m._("Cancel")))},t.prototype._onToggleConfidentialFolder=function(e,t,n,s){var r=this;return e&&this.setState({isAccepting:!0}),this.props.actionHandler.handleSetConfidential(!this.props.initialIsConfidentialFolder).then(function(o){if(r.props.onUpdateConfidentiality(o),e){var a=void 0;a=r.props.initialIsConfidentialFolder?t?m._("“%(folder_name)s” shared with %(team_name)s.").format({folder_name:i.em_snippet(s,15),team_name:i.em_snippet(r.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME)}):m._("“%(folder_name)s” shared with members of “%(parent_folder_name)s”.").format({folder_name:i.em_snippet(s,15),parent_folder_name:i.em_snippet(n,15)}):t?m._("Members of %(team_name)s removed from “%(folder_name)s”.").format({team_name:i.em_snippet(r.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME),folder_name:i.em_snippet(s,15)}):m._("Members of “%(parent_folder_name)s” folder removed from “%(folder_name)s”.").format({parent_folder_name:i.em_snippet(n,15),folder_name:i.em_snippet(s,15)}),h.notifyWithUndo(a,{confidential:r.props.initialIsConfidentialFolder},function(){return r._onToggleConfidentialFolder(!1)},10,m._("Undo"))}}).catch(o.catchApiError(function(e){return e.message?(_.error(e.message),e instanceof o.ServerError?r.setState({isAccepting:!1}):l.Modal.close()):l.Modal.close(),e}))},t.prototype.render=function(){var e,t,n,s=this.props.contentInfo.displayPath(),o=a.parent_dir(s),c=a.filename(s);return"/"===o?t=!0:(t=!1,n=a.filename(o)),e=this.props.initialIsConfidentialFolder?t?m._("Share “%(folder_name)s” with everyone at %(team_name)s?").format({folder_name:i.em_snippet(c,15),team_name:i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME)}):m._("Share “%(folder_name)s” with everyone who can access “%(parent_folder_name)s”?").format({folder_name:i.em_snippet(c,15),parent_folder_name:i.em_snippet(n,15)}):t?m._("Remove members of %(team_name)s?").format({team_name:i.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME)}):m._("Remove members of “%(folder_name)s” folder?").format({folder_name:i.em_snippet(n,15)}),r.createElement(l.Modal,{autoClose:!1,buttonComponent:r.createElement("span",null),onDismissCompleted:this.props.onCancel,title:e},this.renderContent(t,n,c),this.renderButtons(t,n,c))},t})(r.Component);t.SetInheritedMembersUIConfidentialModal=y}),define("modules/clean/sharing/views/member_list",["require","exports","tslib","external/immutable","external/react","modules/clean/sharing/api/types/metadata","modules/clean/sharing/views/inherited_members","modules/clean/sharing/views/member_list_item","modules/clean/sharing/views/viewer_info","modules/clean/sharing/ui_util","modules/clean/viewer","modules/core/i18n","modules/clean/sharing/views/wrapped_group_viewers_maker","modules/clean/react/pass/store"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=d.i18n_default_project("sharing")._,_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderMembersListItem=function(e){var n=e.memberKey(),s=t.props.groupSeenStateInfo[e.memberId()]?t.renderWrappedGroupViewersElement(e):void 0;return r.createElement(a.SharingMemberListItem,{actionHandler:t.props.actionHandler,canInviteMembers:t.props.canInviteMembers,canMakeViewerNoComment:t.props.canMakeViewerNoComment,canRelinquishMembership:t.props.canRelinquishMembership,contentInfo:t.props.contentInfo,disabled:t.props.disabled,wrappedGroupViewersElement:s,isMemberActionPending:t.props.pendingMemberAction.has(n),isPresent:t.props.shouldShowPassUI&&t.isMemberCurrentlyViewing(e),key:n,member:e,user:t.props.user})},t}return n.__extends(t,e),t.prototype.render=function(){var e=c.makeMemberSortCmp(this.props.user,this.props.presentAccountIds||s.Set(),this.shouldSortUsingPassRules()),t=this.membersByInheritance(),n=t.get(!1);n&&(n=n.sort(e));var o=t.get(!0);o&&(o=o.sort(e));var i=null;return this.props.areMembersFullyLoaded||(i=r.createElement("div",{className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},m("Loading more members..."))),r.createElement("div",{className:"sharing-member-list"},this.renderInheritedUI(n,o),i)},t.prototype.shouldSortUsingPassRules=function(){var e=h.passStore.getPassPermissions(this.props.contentInfo.id);return null!=e&&(e.canReadPresence||e.canReadSeenState)},t.prototype.renderInheritedUI=function(e,t){var n=null;this.props.user.is_cdm_member&&!this.props.isConfidentialFolder&&this.props.isFolderInsideTeamFolderTree&&(n=r.createElement(i.InheritedMembers,{canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,members:t?t.toArray():[],onSetConfidentialClick:this.props.onSetConfidentialClick,teamName:this.props.teamName},t?t.map(this.renderMembersListItem):null));var s=null;return e&&e.count()>0&&(s=r.createElement("div",{className:"u-pad-horizontal-s"},e.map(this.renderMembersListItem).toArray())),r.createElement("ul",{className:"o-list-ui u-trim-margin u-pad-horizontal-xs"},n,s)},t.prototype.isMemberCurrentlyViewing=function(e){return!this.memberIsAssumed(e)&&(e instanceof o.UserMembershipInfo&&this.props.presentAccountIds&&this.props.presentAccountIds.has(e.account_id))},t.prototype.memberIsAssumed=function(e){return e instanceof o.UserMembershipInfo&&e.account_id===this.props.user.account_id&&u.get_viewer().is_assume_user_session},t.prototype.membersByInheritance=function(){var e=this,t=function(t){return e.shouldSortByInherited()&&t.is_inherited};return this.props.membership?this.props.membership.groups.valueSeq().concat(this.props.membership.invitees.valueSeq(),this.props.membership.users.valueSeq(),this.props.guestMembers).groupBy(t):this.props.guestMembers.length>0?s.List(this.props.guestMembers).groupBy(t):s.Map()},t.prototype.shouldSortByInherited=function(){return this.props.user.is_cdm_member&&!!this.props.isFolderInsideTeamFolderTree},t.prototype.extractGroupSeenStateAndViewers=function(e){var t=this,n=this.props.groupSeenStateInfo[e.memberId()],s=[];return this.props.presentAccountIds&&(s=n.map(function(e){return new l.ViewerInfo(e)}).filter(function(e){return null!=e.time_last_seen||t.props.presentAccountIds.has(e.account_id)})),{singleGroupSeenStateInfo:n,viewers:s}},t.prototype.renderWrappedGroupViewersElement=function(e){var t=this.extractGroupSeenStateAndViewers(e).viewers;return t.length?p.WrappedGroupViewersMaker.make(t,this.props.presentAccountIds):{element:null,elementText:""}},t.displayName="SharingMemberList",t.defaultProps={disabled:!1,groupSeenStateInfo:{}},t})(r.Component);t.SharingMemberList=_}),define("modules/clean/sharing/views/member_list_item",["require","exports","tslib","external/classnames","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/datetime","modules/clean/em_string","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/sharing/views/viewer_info","modules/clean/static_urls","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=g.i18n_default_project("sharing"),v=S._,E=S.ungettext,b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.shouldLinkToGroup=function(){return this.props.member instanceof p.GroupMembershipInfo&&(!!this.props.member.same_team&&(!!this.props.user.is_team_admin||!!this.props.member.is_member&&this.props.member.group_management_type!==p.GroupManagementType.system_managed))},t.prototype.linkToGroup=function(e,t,n){var o="/team#groups/%(id)s".format({id:e.group_id}),i=s({"u-font-meta":!n,"sharing-member-info__group-name-link":!0,"sharing-member-info__display-name-title":n});return r.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:i,title:e.group_name},t)},t.prototype.renderAvatar=function(e,t){var n,s=this.props.member.displayName()||"";this.props.member instanceof _.ViewerInfo||(n=this.props.member.initials),n=n||y.getInitials(s);var l=t?"SQUARE":"CIRCLE",c=u.AnonymousViewerUtils.isAnonymousUserId(this.props.member.memberId())?this.props.member.memberId():s;return r.createElement("div",{className:"o-flag__fix"},r.createElement(o,{dimension:a.AVATAR_DIMENSION_BY_SIZE.MEDIUM,photoUrl:e,shape:l,defaultAvatar:r.createElement(i,{dimension:a.AVATAR_DIMENSION_BY_SIZE.MEDIUM,shape:l,initials:n,name:c})}))},t.prototype.renderNameTitleAndText=function(e,t,n){return e?this.shouldLinkToGroup()&&!this.shouldRenderGroupCount()?this.linkToGroup(this.props.member,n,!0):r.createElement("span",{className:"sharing-member-info__display-name-title",title:t},n):null},t.prototype.renderDisabledMessage=function(e){return e?[r.createElement("span",{className:"u-font-meta dot"},"·"),r.createElement("span",{className:"u-font-danger"}," ",e)]:null},t.prototype.renderSeenState=function(e){if(e){var t=s({"u-font-meta":!0,"sharing-member-info__last-seen-text":!0,"sharing-member-info__last-seen-text--not-present":!this.props.isPresent});return[r.createElement("span",{className:"u-font-meta dot"},"·"),r.createElement("span",{className:t},e)]}return null},t.prototype.renderOffTeamMessage=function(e){return e?r.createElement("span",{className:"u-font-meta"},e):null},t.prototype.renderDisplayName=function(e,t){var n=this.props.member.displayName(),o="",i=null;if(this.props.wrappedGroupViewersElement)o=this.props.wrappedGroupViewersElement.elementText,i=this.props.wrappedGroupViewersElement.element;else if(this.props.isPresent)o=i=v("Viewing now");else if(t){o=v("Viewed %(time_str)s").format({time_str:l.ago(t,!1,!0,!0)});var a=t.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}),u=t.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"});i=r.createElement(d,{content:r.createElement("div",null,a,r.createElement("br",null),u),className:"timestamp-tooltip",children:r.createElement("span",null,o),position:d.POSITIONS.BOTTOM,isTargetPositionFixed:!0})}var p="";e&&e.disabled&&(p=v("Deleted"));var m=0,_=0;if(n){o&&(m=new c("  ·  %s".format(o)).length),p&&(_=new c("  ·  %s".format(p)).length);var f=h.SNIPPET_SIZES.DISPLAY_NAME-m-_,g=c.em_snippet(n,f),y="";g!==n&&(y=n);var S=s({"u-font-meta":this.props.isMemberActionPending,"u-font-strong":!0,"u-ellip":!0,"sharing-member-info__display-name":!0});return r.createElement("div",{className:S},this.renderNameTitleAndText(n,y,g),this.renderDisabledMessage(p),this.renderSeenState(i))}},t.prototype.renderMemberDetails=function(e,t){var n="",s=0,o=t&&!t.email;!this.props.user.is_team||this.props.member.same_team||o||(n=v("Outside your Dropbox team"),s=new c("  ·  %s".format(n)).length);var i;if(e)i=this.shouldLinkToGroup()?this.linkToGroup(this.props.member,e,!1):e;else if(t&&t.email&&t.email_verified){var a=h.SNIPPET_SIZES.EMAIL-s,l=c.em_snippet(t.email,a),u="";l!==t.email&&(u=t.email),i=r.createElement("span",{title:u},l)}var d;return n&&i&&(d=r.createElement("span",{className:"u-font-meta dot"},"·")),r.createElement("div",{className:"u-font-meta u-ellip sharing-member-info__details"},i,d,this.renderOffTeamMessage(n))},t.prototype.renderSharingBubbleMenu=function(){var e,t=this;if(this.props.isMemberActionPending)e=r.createElement("img",{src:f.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:v("Changing access")});else if(this.props.isViewOnly||this.props.member instanceof _.ViewerInfo)e=r.createElement("span",null);else{var n=this.props.member.permissions.get("make_viewer_no_comment"),s=n&&n.allow&&this.props.canMakeViewerNoComment,o=this.props.member.permissions.set("make_viewer_no_comment",new p.PermissionSetting({allow:s})),i=this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership,a=function(e){if(!(t.props.member instanceof _.ViewerInfo))return t.props.actionHandler&&t.props.actionHandler.handleMemberAccessChange(t.props.member,e)};e=r.createElement(m.SharingBubbleMenu,{allowRelinquishMembership:i,canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:s,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,disabled:this.props.disabled,isInherited:this.props.member.is_inherited,memberPermissions:o,onAccessChange:a,pendingAccessChange:this.props.pendingAccessChange})}return r.createElement("div",{className:"o-flag__fix"},e)},t.prototype.shouldRenderGroupCount=function(){return this.props.member instanceof p.GroupMembershipInfo&&this.props.member.member_count},t.prototype.render=function(){var e,t=void 0,n=!1,o=null,i=void 0,a=this.props.member;if(a instanceof p.UserMembershipInfo){if(t=a.account,!t)return null;o=t.profile_photo_url||null,e=a.time_last_seen}else a instanceof p.GroupMembershipInfo?(n=!0,"team"===a.group_type&&(o=f.static_url("/static/images/icons/team_24@2x-vflR8kGKs.png")),this.shouldRenderGroupCount()&&(i=E("%(member_num)s member","%(member_num)s members",a.member_count).format({member_num:a.member_count}))):a instanceof _.ViewerInfo&&(t={email:a.email,email_verified:!!a.email},o=a.photo_circle_url,e=a.time_last_seen);var l=s({"sharing-member-info":!0,"o-flag":!0,"u-pad-right-m":!this.props.isViewOnly});return r.createElement("li",{className:"sharing-member-list__item o-flag"},r.createElement("div",{className:"o-flag__flex"},r.createElement("div",{className:l},this.renderAvatar(o,n),r.createElement("div",{className:"sharing-member-info__contact o-flag__flex"},this.renderDisplayName(t,e),this.renderMemberDetails(i,t)))),this.renderSharingBubbleMenu())},t.displayName="SharingMemberListItem",t.defaultProps={canInviteMembers:!1,canMakeViewerNoComment:!1,canRelinquishMembership:!1,disabled:!1,isPresent:!1,isViewOnly:!1,wrappedGroupViewersElement:void 0},t})(r.Component);t.SharingMemberListItem=b}),function(){define("modules/clean/sharing/views/modal_content",["external/classnames","external/immutable","external/react","external/react-dom","external/underscore","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/image","modules/clean/react/pass/constants","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/bubble","modules/clean/react/tooltip","modules/clean/react_format","modules/clean/sharing/access_level","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_icon","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/comments_help","modules/clean/sharing/views/exp_share_link_upsell","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/web_timing_logger","modules/clean/static_urls","modules/clean/user","modules/constants/rebrand","modules/constants/sharing","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b,C,I,T,w,A,M,N,k,P,R,L,F,O,x,D,U){var B,H,q,V,G,W,j,K,Y,z,Q,X,J,Z,$,ee,te,ne,se,re,oe,ie,ae,le,ce,ue,de,pe,he,me,_e,fe,ge,ye,Se,ve,Ee,be,Ce,Ie,Te,we,Ae,Me,Ne,ke,Pe;return K=o.ContactsTokenizer,h.PASS_FETCHING_STATUS,Ie=h.fetchingStatusIsSuccessful,Ce=h.fetchingStatusIsComplete,_e=m.Snackbar,ge=g.Tooltip,ye=g.TooltipPosition,we=y.reactFormat,B=S.ACCESS_VALUES,le=v.ShareModalActionHandler,X=E.FolderPolicy,$=E.LinkMetadata,ne=E.MemberCounts,se=E.MemberPermissions,oe=E.PermissionSetting,de=E.SharedContentLinkMetadata,me=E.SharingMembership,b.COMMENTING,ae=b.SNIPPET_SIZES,Y=C.ContentInfo,ue=I.ShareModalIcon,G=T.CONTACT_ERROR_LEVEL,Te=T.genContentManagerBridgeUri,J=T.GoldenGate,Me=T.shouldEnforceMemberLimits,Pe=T.validateContact,ee=w.MODES,te=w.MODE_VALUES,H=w.BANNERS,q=w.BANNER_VALUES,W=w.CONTENT_NAME_MESSAGE_LEVELS,j=w.CONTENT_NAME_MESSAGE_LEVEL_VALUES,Z=w.LINK_ONLY_REASON,z=M.ExpShareLinkUpsellV1,Q=M.ExpShareLinkUpsellV2,he=k.SharingMemberList,re=P.ModalLinkInfo,pe=R.SharingBubbleMenu,Ne=F.static_url,ie=x.REBRAND_M1_IS_ON,V=D.COMMENTS_INBAND_SHARING,fe=D.TRUELINK,Ee=n.createElement,be=n.DOM,Ae=U.i18n_default_project("sharing"),Se=Ae._,ke=Ae.ungettext,ve=n.createClass({displayName:"ShareModalContent",statics:{MODES:ee},propTypes:{actionHandler:n.PropTypes.instanceOf(le).isRequired,areMembersFullyLoaded:n.PropTypes.bool,banner:n.PropTypes.oneOf(q),canEdit:n.PropTypes.bool.isRequired,canInviteEditor:n.PropTypes.bool.isRequired,canInviteViewer:n.PropTypes.bool.isRequired,canInviteViewerNoComment:n.PropTypes.bool.isRequired,canMakeViewerNoComment:n.PropTypes.bool.isRequired,canRelinquishMembership:n.PropTypes.bool,canShareLink:n.PropTypes.bool.isRequired,canUpdateConfidentiality:n.PropTypes.bool,contactsError:n.PropTypes.shape({level:n.PropTypes.string,message:n.PropTypes.oneOfType([n.PropTypes.string,n.PropTypes.array])}),contentInfo:n.PropTypes.instanceOf(Y).isRequired,contentNameMessage:n.PropTypes.string,contentNameMessageLevel:n.PropTypes.oneOf(j),displayContentNameTooltip:n.PropTypes.bool,displayContentNameBanner:n.PropTypes.bool,folderPolicy:n.PropTypes.instanceOf(X),guestMembers:n.PropTypes.array.isRequired,groupSeenStateInfo:n.PropTypes.object,hasDisplayableMembers:n.PropTypes.bool.isRequired,hasNonOwnerMembers:n.PropTypes.bool.isRequired,headerId:n.PropTypes.string,initialContentName:n.PropTypes.string,initialRecipientRawInput:n.PropTypes.string,initialRecipientTokens:n.PropTypes.array,isAddMessageAsCommentChecked:n.PropTypes.bool,isAddMessageAsCommentHelpShown:n.PropTypes.bool,isConfidentialFolder:n.PropTypes.bool,isContentNameFocused:n.PropTypes.bool,isFolderInsideTeamFolderTree:n.PropTypes.bool,isInContentManager:n.PropTypes.bool,isLimitedTeam:n.PropTypes.bool,isLinkMetadataLoaded:n.PropTypes.bool.isRequired,isMetadataLoaded:n.PropTypes.bool.isRequired,isPassEnabled:n.PropTypes.bool,isTeamSharedFolder:n.PropTypes.bool,isTokenizerEmpty:n.PropTypes.bool.isRequired,linkMetadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf($),n.PropTypes.instanceOf(de)]),linkOnlyReason:n.PropTypes.oneOf(r.values(Z)),memberCounts:n.PropTypes.instanceOf(ne),memberCountWithRecipients:n.PropTypes.number,members:n.PropTypes.instanceOf(me),mode:n.PropTypes.oneOf(te),name:n.PropTypes.string,onSettingsClick:n.PropTypes.func,onSetConfidentialClick:n.PropTypes.func,ownerTeam:n.PropTypes.shape({id:n.PropTypes.string.isRequired,name:n.PropTypes.string.isRequired}),passFetchingStatus:n.PropTypes.number,pendingMemberAction:n.PropTypes.instanceOf(t.Set).isRequired,presentAccountIds:n.PropTypes.instanceOf(t.Set),recipientAccess:n.PropTypes.oneOf(B).isRequired,recipientMessage:n.PropTypes.string.isRequired,recipientTokens:n.PropTypes.array,shareFolderPromise:n.PropTypes.instanceOf(Promise),shouldBlockMemberListOnPassLoad:n.PropTypes.bool,showContentManagerBridge:n.PropTypes.bool,showPassFileSettings:n.PropTypes.bool,suppressLinkUI:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),user:n.PropTypes.instanceOf(O).isRequired,expSubgrowthProOverquotaCreateSharedLink:n.PropTypes.string},getDefaultProps:function(){return{contactsError:{level:null,message:null},headerId:"unified-share-modal-title",linkMetadata:null,members:null,initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:ee.MEMBERSHIP,onFolderSettingsClick:null}},componentDidMount:function(){if(this.logTTI(),this.refs.contentNameInput)return s.findDOMNode(this.refs.contentNameInput).focus()},componentDidUpdate:function(e,t){return this.logTTI()},logTTI:function(){return"GRANT_ACCESS"===this.props.contentInfo.extras.origin&&this.props.isMetadataLoaded&&L.mark_time_to_interactive(),this.props.mode===ee.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore("VIEW_LINK_ONLY_MODAL"):this.props.isMetadataLoaded&&(this.props.actionHandler.logIfHaventBefore("VIEW_SHARE_MODAL"),!this._shouldRenderMainLoading())?this.props.actionHandler.logIfHaventBefore("MEMBER_LIST_LOADED",{member_count:this._getMemberNum()}):void 0},render:function(){return be.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderFooterSection())},_renderHeaderSection:function(){var t,n,s,r,o;return n=this._getMemberNum(),s=this.props.user.is_team&&(null!=(r=this.props.memberCounts)?r.users_outside_team:void 0)>0&&null!=this.props.ownerTeam?ke("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,t=n?s?ke("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",n,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):ke("%(member_num)s member","%(member_num)s members",n):"",t=t.format({member_num:n+((null!=(o=this.props.memberCounts)?o.exceeds_count:void 0)?"+":""),outside_team_string:s}),be.div({className:"unified-share-modal__section unified-share-modal__section--header"},Ee(ue,{alt:"",className:"unified-share-modal__title-icon",isTeamSharedFolder:this.props.isTeamSharedFolder,isFolder:this.props.contentInfo.isFolder(),isSharedFolder:this.props.contentInfo.isSharedFolder(),pathExists:this.props.contentInfo.pathExists(),filename:this.props.contentInfo.name(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit}),be.div({className:e("unified-share-modal__title",n?"unified-share-modal__title--member-count":void 0)},this.props.contentInfo.pathExists()?be.h3({className:"u-font-strong",id:this.props.headerId},l.em_snippet(this.props.contentInfo.name(),ae.FILENAME)):this._renderContentNameInput(),n?be.h4({className:"u-trim-margin u-font-meta"},t):void 0),fe.TRUELINK_UI[this.props.user.id]?this._renderContentSettings():void 0,be.div({className:"unified-share-modal__close"},Ee(N,{className:"u-mar-left-s",onClick:(function(e){return function(){return e.props.actionHandler.onClickX(e.refs.tokenizer)}})(this)})))},_renderContentNameInput:function(){return be.div({className:"unified-share-modal__content-name"
},null==this.props.contentNameMessage||!this.props.isContentNameFocused&&this.props.contentNameMessageLevel!==W.ERROR?void 0:Ee(f,{arrow:f.ARROW.TOP,className:e({"unified-share-modal__content-name__tooltip":!0,"unified-share-modal__content-name__tooltip-error":this.props.contentNameMessageLevel===W.ERROR,"u-font-strong":!0})},be.div({className:e(["u-pad-top-xxs","u-pad-bottom-xxs","u-pad-left-xs","u-pad-right-xs"])},this.props.contentNameMessage)),be.input({className:e(["u-trim-padding","u-trim-margin","u-l-ib","u-font-strong"]),id:this.props.headerId,ref:"contentNameInput",onChange:(function(e){return function(t){return e.props.actionHandler.handleContentNameChange(t.target.value)}})(this),onFocus:(function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!0)}})(this),onBlur:(function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!1)}})(this),onKeyUp:(function(e){return function(t){var n,r;if((null!=(n=e.refs.tokenizer)&&null!=(r=n.refs.tokenizer)?r.refs.input:void 0)&&13===t.keyCode)return s.findDOMNode(e.refs.tokenizer.refs.tokenizer.refs.input).focus()}})(this),placeholder:this.props.isContentNameFocused?void 0:Se("Folder name"),defaultValue:this.props.initialContentName}))},_renderToSection:function(){var t,n;return this.props.linkOnlyReason===Z.LINKS_PAGE?null:this.props.mode===ee.LINK_ONLY?this._renderNoPermissionSection():this.props.isMetadataLoaded?this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.canInviteEditor||this.props.canInviteViewer?Me(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=(t=this.props.memberCounts)?t.total_unique_users:void 0)>=J.SHARING_TOTAL_LIMIT?this._renderOverLimitSection():(n=this.props.contentInfo.isFile()&&!this.props.canInviteEditor&&!this.props.canInviteViewerNoComment,be.div({className:"unified-share-modal__section unified-share-modal__section--to"},be.div({className:"o-flag"},be.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},this.props.isTeamSharedFolder?Se("Add groups:",{comment:"Label for with whom to share"}):Se("To:",{comment:"Label for with whom to share"})),be.div({className:"unified-share-modal__to-input-box o-flag__flex"},Ee(K,{ref:"tokenizer",context:"tiburon",excludeDomainContacts:!1,customContactFilter:this.props.isTeamSharedFolder?function(e){return e.type!==i.FB&&e.group_id}:this.props.isInContentManager?function(e){return e.type!==i.FB}:(function(e){return function(t){return t.type!==i.FB&&t.email!==e.props.user.email}})(this),focusOnMount:this.props.contentInfo.pathExists(),id:"unified-share-modal-contacts-tokenizer",onContentsChange:this.props.actionHandler.recipientsChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:(function(e){return function(t){return Pe(t,e.props.user,e.props.ownerTeam,e.props.folderPolicy,e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree,e.props.memberCountWithRecipients)}})(this),placeholder:Se(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name"),shouldLogContactSearch:!0,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:null,user:this.props.user})),be.div({className:e({"o-flag__fix":!0})},n?Ee(ge,{position:ye.BOTTOM,tooltip_contents:Se("Only folders can be shared with edit access"),tooltip_classname:"sharing-access-menu__tooltip"},be.span({className:"ax-visually-hidden"},Se("Only folders can be shared with edit access")),this._renderToSectionAccessDropdown()):this._renderToSectionAccessDropdown())))):this._renderNoPermissionSection():be.div({className:"unified-share-modal__section unified-share-modal__section--to"},be.div({className:"unified-share-modal__to-placeholder"}," "))},_renderToSectionAccessDropdown:function(){return Ee(pe,{asButton:!0,canMakeViewerNoComment:this.props.canMakeViewerNoComment,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,disabled:this.props.showContentManagerBridge,memberPermissions:new se({make_editor:new oe({allow:this.props.canInviteEditor}),make_viewer:new oe({allow:this.props.canInviteViewer}),make_viewer_no_comment:new oe({allow:this.props.canInviteViewerNoComment})}),onAccessChange:this.props.actionHandler.changeRecipientAccess})},_shouldRenderContentSettingsShareButton:function(){var e;return this.props.isMetadataLoaded&&this.props.mode!==ee.LINK_ONLY&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||(e=this.props.mode)===ee.SHARE||e===ee.SHARE_SENDING)},_shouldRenderFooterSection:function(){return this._renderLinkRowInFooter()?this._shouldRenderLinkRow():this._shouldRenderContentSettingsShareButton()},_renderFooterSection:function(){if(this._shouldRenderFooterSection())return be.div({className:"unified-share-modal__section unified-share-modal__section--footer clearfix"},this._renderLinkRowInFooter()?this._renderLinkRowContent():this._renderContentSettingsShareButton())},_renderContentSettingsShareButton:function(){if(this._shouldRenderContentSettingsShareButton())return be.div({},fe.TRUELINK_UI[this.props.user.id]?void 0:be.div({className:"u-l-fl"},this._renderContentSettings()),be.div({className:"u-l-fr"},function(){switch(this.props.mode){case ee.SHARE:case ee.SHARE_SENDING:return be.button({className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:this.props.mode===ee.SHARE_SENDING||this.props.isTokenizerEmpty||this.props.contactsError.level===G.ERROR||null!=this.props.contentNameMessage,onClick:(function(e){return function(){return e.props.actionHandler.handleShareClick(e.refs.tokenizer,e.refs.contentNameInput)}})(this)},Se(this.props.mode===ee.SHARE_SENDING?this.props.isTeamSharedFolder?"Adding...":"Sharing...":this.props.isTeamSharedFolder?"Add":"Share"));default:return null}}.call(this)))},_renderContentSettings:function(){var e;if(this.props.isMetadataLoaded)return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings?be.button({"aria-label":Se("Settings"),className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===ee.SHARE_SENDING,onClick:(function(e){return function(){return e.props.onSettingsClick()}})(this)},Ee(_,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),fe.TRUELINK_UI[this.props.user.id]?void 0:Se(this.props.contentInfo.isFile()?"File settings":"Folder settings")):!this.props.contentInfo.isFolder()&&(this._canSendFeedbackRequest()||(null!=(e=this.props.recipientMessage)?e.length:void 0)>0)?this._renderFeedbackCheckbox():void 0},_renderErrorMessageSection:function(){return this.props.contactsError.message?be.div({className:e(["unified-share-modal__section","unified-share-modal__error-message","u-font-center",this.props.contactsError.level===G.WARN?"unified-share-modal__warn":void 0,this.props.contactsError.level===G.ERROR?"unified-share-modal__error":void 0])},this.props.contactsError.message):null},_shouldRenderMainLoading:function(){var e,t,n,s;return n=this.props.isMetadataLoaded,t=this.props.hasNonOwnerMembers||this.props.areMembersFullyLoaded,s=!this.props.isPassEnabled||this._isPassInfoLoaded(),e=this.props.shouldBlockMemberListOnPassLoad&&!s,!n||!t||e},_renderMainSection:function(){if(this.props.mode===ee.LINK_ONLY)return this._renderMainLinkOnly();if(this._shouldRenderMainLoading())return this._renderMainLoading();switch(this.props.mode){case ee.MEMBERSHIP:return this._renderMainMembership();case ee.SHARE:case ee.SHARE_SENDING:return this._renderMainShare();default:return null}},_renderNoPermissionSection:function(){var e;return be.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},this.props.mode===ee.LINK_ONLY?this.props.contentInfo.isOSXPackage()?Se(fe.TRUELINK_UI[this.props.user.id]?"Package files can’t be shared.":"This package file can only be shared as a link."):this.props.linkOnlyReason===Z.INSIDE_SHARED_FOLDER?fe.TRUELINK_UI[this.props.user.id]?Se("You don’t have permission to share this folder."):be.span({},Se("This folder can only be shared as a link because it’s in a shared folder.")+" ",be.a({href:"/help/1931",target:"_blank"},Se("Learn more"))):fe.TRUELINK_UI[this.props.user.id]?Se("This folder can’t be shared"):this.props.linkOnlyReason===Z.CONTAINS_SHARED_FOLDER?be.span({},Se("This folder can only be shared as a link because it contains a shared folder.")+" ",be.a({href:"/help/1931",target:"_blank"},Se("Learn more"))):Se("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?Se("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?we(Se("Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."),{admin_link:be.a({href:"/team?_tk=left_nav_team",target:"_blank"}),group_link:be.a({href:"/help/7232#transfer",target:"_blank"})}):Se(this.props.contentInfo.isFolder()?fe.TRUELINK_UI[this.props.user.id]&&(null!=(e=this.props.permissions)?e.change_options.allow:void 0)?"To add new members, you’ll need to add them to the parent folder.":"You don’t have permission to manage membership of this folder":"You don’t have permission to manage membership of this file"))},_renderConfidentialFolderSection:function(){if(this.props.isConfidentialFolder&&this.props.canUpdateConfidentiality)return be.div({className:"unified-share-modal__section unified-share-modal__confidential-folder u-font-center"},be.span({},we(Se("<b>Invite only.</b> Members of parent folders can’t access."),{b:be.b()}),this.props.contentInfo.pathExists()?[" ",be.a({onClick:this.props.onSetConfidentialClick},Se("Restore access"))]:void 0))},_renderContentManagerBridge:function(){var e,t,n;return e=c.parent_dir(this.props.contentInfo.displayPath()),t=this.props.contentInfo.name(),n=Te({containingFolder:e,filenameToSelect:t,isLimitedTeam:this.props.isLimitedTeam}),be.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},be.span({},Se("You can manage folder membership in the Admin Console. "),be.a({href:n.toString(),target:"_blank"},Se("Open in new tab."))))},_renderOverLimitSection:function(){return be.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},be.div({},Se("This folder is over its %(member_limit)s-member limit.",{comment:"member limit is a number greater than 200"}).format({member_limit:J.SHARING_TOTAL_LIMIT})),be.div({},Se("Please remove some members.")," ",be.a({href:"/help/9292",target:"_blank"},Se("Learn more."))))},_shouldRenderTeamFolderNoPermissionMessage:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){var n,s;return"team"===e.group_type&&(null!=(n=e.permissions.make_editor)?n.allow:void 0)&&(null!=(s=e.permissions.make_viewer)?s.allow:void 0)})},_isOwnerOfAtLeastOneGroup:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},_renderMainLoading:function(){return be.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),be.div({className:"u-font-center u-font-meta u-pad-top-xl"},be.div({className:"c-loader"},Se("Loading..."))))},_renderMainLinkOnly:function(){return fe.TRUELINK_UI[this.props.user.id]&&this.props.linkOnlyReason!==Z.LINKS_PAGE?null:be.div({className:e(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow())},_renderMainMembership:function(){var t,n,s;return be.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow(),s=this.props.user.is_cdm_member&&(this.props.members.users.size>0&&this.props.isFolderInsideTeamFolderTree||!this.props.isConfidentialFolder),this.props.hasNonOwnerMembers||s||this.props.guestMembers.length>0?Ee(he,{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,guestMembers:this.props.guestMembers,groupSeenStateInfo:this.props.groupSeenStateInfo,isConfidentialFolder:this.props.isConfidentialFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,membership:this.props.members,onSetConfidentialClick:this.props.onSetConfidentialClick,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&Ie(this.props.passFetchingStatus),teamName:null!=(n=this.props.ownerTeam)?n.name:void 0,user:this.props.user,viewer:this.props.viewer}):this.props.banner===H.INPUT_CONTENT_NAME?be.div({className:e(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},Ee(p,{src:Ne("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:Ne("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),be.h3({className:e(["u-font-strong","u-mar-top-xs"])},Se("Name your shared folder")),be.p({className:e(["u-pad-left-xxl","u-pad-right-xxl"])},Se("Shared folders are for collaborting on projects, client works, and organizing departments"))):be.div({className:e(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},this.props.isTeamSharedFolder?null!=this.props.teamGroupInfo?[be.p({className:"u-mar-top-xxl"},be.a({onClick:this._addEveryoneGroup},Se("Add everyone at %(team_name)s").format({team_name:this.props.ownerTeam.name}))),be.p({},Se("Or, add groups to this team folder.")+" ",be.a({href:"/team#groups/newgroup"},Se("Create a group")))]:be.p({className:"u-mar-top-xxl"},Se("Add groups to this team folder.")+" ",be.a({href:"/team#groups/newgroup"},Se("Create a group"))):(t=fe.TRUELINK_UI[this.props.user.id],t||"V1"!==this.props.expSubgrowthProOverquotaCreateSharedLink?t||"V2"!==this.props.expSubgrowthProOverquotaCreateSharedLink?ie&&!t?be.div({}):be.div({},Ee(p,{className:"unified-share-modal__illo",src:Ne("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:Ne("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),be.p({className:"u-mar-top-s"},Se("Add people you want to share with"))):Ee(Q):Ee(z))))},_renderMainShare:function(){return be.div({className:"unified-share-modal__main unified-share-modal__section u-pad-horizontal-m"},this.props.isTeamSharedFolder?void 0:be.textarea({placeholder:Se("Add a message (optional)"),onChange:(function(e){return function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)}})(this),value:this.props.recipientMessage}))},_renderLinkRow:function(){if(!this._renderLinkRowInFooter())return this._renderLinkRowContent()},_renderLinkRowContent:function(){var e,t;if(this._shouldRenderLinkRow())return t=!this.props.contentInfo.isMounted()&&this.props.isPassEnabled&&this._isPassInfoLoaded()&&this.props.isMetadataLoaded,t||this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===ee.LINK_ONLY)?be.div({className:"unified-share-modal__link-info"},Ee(re,{actionHandler:this.props.actionHandler,canShareLink:this.props.canShareLink||this.props.mode===ee.LINK_ONLY,contentInfo:this.props.contentInfo,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isLimitedTeam:this.props.isLimitedTeam,linkMetadata:this.props.linkMetadata,mode:this.props.mode,shareFolderPromise:this.props.shareFolderPromise,teamName:null!=(e=this.props.ownerTeam)?e.name:void 0,presentAccountIds:this.props.presentAccountIds,user:this.props.user})):this.props.mode===ee.LINK_ONLY?be.div({className:"unified-share-modal__link-info--loading"},be.div({className:"c-loader c-loader--spinner--blue u-l-b u-mar-horizontal-auto"},Se("Loading…"))):this.props.contentInfo.isTeamSharedFolder()?void 0:be.div({className:"unified-share-modal__link-info--filler"})},_renderFeedbackCheckbox:function(){var e,t;if(!V.HIDE_FEEDBACK_CHECKBOX)return t=this._canSendFeedbackRequest(),e=Se(t?"I want feedback on this file":"Post this message as a comment"),be.div({className:"u-pad-top-xs"},be.div({className:"unified-share-modal__add-message-as-comment-checkbox-container"},be.input({type:"checkbox",id:"add_message_as_comment",name:"add_message_as_comment",checked:this.props.isAddMessageAsCommentChecked,onChange:this._handleAddMessageAsCommentChange}),this.props.isAddMessageAsCommentHelpShown?Ee(A,{onClose:this._commentsHelpClosed,onButtonClick:this._commentsHelpButtonClicked,isFeedbackRequest:t}):void 0),be.label({htmlFor:"add_message_as_comment"},e))},_getMemberNum:function(){var e;return null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:null!=(e=this.props.members)?e.getMemberCount():void 0},_isPassInfoLoaded:function(){return Ce(this.props.passFetchingStatus)},_handleAddMessageAsCommentChange:function(e){return this.props.actionHandler.setAddMessageAsCommentChecked(e.target.checked)},_commentsHelpClosed:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed()},_commentsHelpButtonClicked:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed(),this.props.actionHandler.setAddMessageAsCommentChecked(!0)},_canSendFeedbackRequest:function(){return!this._renderLinkRowInFooter()},_addEveryoneGroup:function(){var e;return null!=(e=this.refs.tokenizer)?e.addExternalContacts([a.teamGroupInfoToContact(this.props.teamGroupInfo)]):void 0},_renderLinkRowInFooter:function(){return this.props.mode!==ee.LINK_ONLY&&(this.props.mode!==ee.SHARE&&this.props.mode!==ee.SHARE_SENDING&&(!!this.props.isMetadataLoaded&&fe.TRUELINK_UI[this.props.user.id]))},_shouldRenderLinkRow:function(){return!(fe.TRUELINK_UI[this.props.user.id]&&this.props.isLinkMetadataLoaded&&!this.props.linkMetadata)&&(!this.props.suppressLinkUI&&this.props.canShareLink)}}),ce=d(ve,["/static/css/react/contacts_tokenizer-vflaf7P-F.css","/static/css/scooter/scooter-scoped-vflhQ6850.css","/static/css/sharing/share_modal-vflhe7tSD.css"],[u,_e]),{ShareModalContent:ce,MODES:ee}})}.call(this),define("modules/clean/sharing/views/modal_link_info",["require","exports","tslib","jquery","external/classnames","external/react","modules/clean/clipboard_v2","modules/clean/em_string","modules/clean/react_format","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/link_description","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u,d,p,h,m,_,f,g,y,S,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=v.i18n_default_project("sharing")._,b=(function(e){function t(t,n){var s=e.call(this,t,n)||this;return s.handleCreateLinkClicked=function(){if(s.isSharedContentLink())throw Error("Should not display this for shared content link");if(s.props.actionHandler)return s.props.actionHandler.createSharedLink()},s.handleCopyLinkClicked=function(){if(!s.state.showingUrl){var e={};s.props.linkMetadata instanceof p.SharedContentLinkMetadata?(e.type="scl",e.password_protected=s.props.linkMetadata.password_protected,e.audience=s.props.linkMetadata.current_audience,e.expiration=s.props.linkMetadata.expiry):s.props.linkMetadata instanceof p.LinkMetadata?(e.type="shmodel",e.visibility=s.props.linkMetadata.link_permissions.resolved_visibility,e.expiration=s.props.linkMetadata.expires):s.isSharedContentLink()&&(e.type="scl"),s.props.contentInfo&&f.logTiburonEvent(s.props.contentInfo,s.props.user.id,"CLICK_TIB_COPY_LINK",e),s.props.actionHandler&&s.props.actionHandler.turnLinkOnIfQualified()}return d.setStatePromise(s,{showingUrl:!s.state.showingUrl}).then(function(){if(s.urlField){var e=s.urlField;e.focus(),e.select(),s.clipboard.do_copy()}})},s.state={showingUrl:!1},s.clipboard=null,s}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.clipboard=new i(this.props.linkMetadata&&this.props.linkMetadata.url,function(){return g.sharingNotificationSuccess(E("Link copied to clipboard"))},function(){g.sharingNotificationError(E("Unable to copy the link, please copy manually"))},this.handleCopyLinkClicked)},t.prototype.componentDidMount=function(){this.setupCopy()},t.prototype.componentDidUpdate=function(){this.setupCopy()},t.prototype.setupCopy=function(){var e=s(".copy-link-button");e.length&&this.clipboard.setupCopy(e,s(".copy-link-container"))},t.prototype.render=function(){return this.props.linkMetadata||this.isSharedContentLink()?this.renderLink():this.props.canShareLink?this.renderNoLink():null},t.prototype.renderLink=function(){var e=this;if(!this.props.linkMetadata)return null;var t=null;this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&(t=this.renderSharedContentLinkInfo());var n;if(this.state.showingUrl)n=o.createElement("span",null,t,o.createElement("span",null,o.createElement("label",{className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},E("Shared link URL")),o.createElement("input",{className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this.handleUrlClick,readOnly:!0,ref:function(t){return e.urlField=t},type:"text",value:this.props.linkMetadata.url})));else{var s=null;this.props.linkMetadata instanceof p.LinkMetadata?s=h.formatLinkDescription(this.props.linkMetadata):this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&(s=this.renderSharedContentLinkInfo());var i=null;null!==s&&(i=o.createElement("span",{className:r({"unified-share-modal-link-info__description":!0,"unified-share-modal-link-info__description--content-link":this.isSharedContentLink()})},s)),n=o.createElement("span",null,i)}var a=null;return this.isSharedContentLink()?this.props.linkMetadata&&this.props.linkMetadata.url?a=this.renderCopyLink():this.isSharingFolder()||(a=this.renderGetLink()):a=o.createElement("span",null,this.renderLinkSettings(),this.renderDivider(),this.renderCopyLink()),o.createElement("div",{className:"unified-share-modal-link-info o-flag"},o.createElement("div",{className:"o-flag__fix"},this.renderLinkIcon()),o.createElement("div",{className:this.detailsClassName()},n),o.createElement("ul",{className:"unified-share-modal-link-info__actions o-flag__fix"},a))},t.prototype.renderLinkSettings=function(){return!this.state.showingUrl&&this.props.actionHandler?o.createElement("li",{className:"u-l-ib"},o.createElement("button",{className:"button-as-link",onClick:this.props.actionHandler.handleLinkSettingsClick},E("Link settings"))):null},t.prototype.renderDivider=function(){return this.state.showingUrl?null:o.createElement("span",{className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")},t.prototype.renderCopyLink=function(){var e;return e=this.state.showingUrl?E("Hide link"):i.is_supported()?o.createElement("span",{className:"copy-link-button"},E("Copy link")):E("Show link"),o.createElement("li",{className:"u-l-ib"},o.createElement("button",{className:"button-as-link copy-link-container",onClick:this.handleCopyLinkClicked},e))},t.prototype.renderGetLink=function(){var e=this,t=function(){if(e.props.actionHandler){var t=Date.now();e.props.actionHandler.turnLinkOnIfQualified().then(function(){if(e.props.actionHandler){var n=void 0;n=e.props.contentInfo?l.reactFormat(E("Creating shared link for <st>%(folder_name)s</st>..."),{st:o.createElement("strong",null),folder_name:e.props.contentInfo.name()}):E("Creating shared link..."),e.props.actionHandler.shareIfFileFolder(n).then(function(){if(S.SHARING_UNSHARING.SNACKBAR_MESSAGES){var t=void 0;t=e.props.contentInfo?l.reactFormat(E("Created shared link for <st>%(folder_name)s</st>."),{st:o.createElement("strong",null),folder_name:e.props.contentInfo.name()}):E("Created shared link."),c.Snackbar.complete(t)}}).catch(function(n){S.SHARING_UNSHARING.SNACKBAR_MESSAGES&&e.props.actionHandler&&e.props.actionHandler.reportShareFailure(n,t)})}})}};return o.createElement("li",{className:"u-l-ib"},o.createElement("button",{className:"button-as-link",onClick:t},E("Get link")))},t.prototype.detailsClassName=function(){return"unified-share-modal-link-info__details o-flag__flex"},t.prototype.renderNoLink=function(){return o.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--no-link o-flag"},o.createElement("div",{className:"o-flag__fix"},o.createElement("div",{className:"unified-share-modal-link-info__icon"},o.createElement(u,{alt:"",group:"web",name:"shared_link_gray"}))),o.createElement("div",{className:this.detailsClassName()},E("No link created yet")),o.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},o.createElement("button",{className:"button-as-link",onClick:this.handleCreateLinkClicked},E("Create a link"))))},t.prototype.handleUrlClick=function(e){e.target.select()},t.prototype.isSharedContentLink=function(){return S.TRUELINK.TRUELINK_UI[this.props.user.id]},t.prototype.renderLinkIcon=function(){return o.createElement("div",{className:"unified-share-modal-link-info__icon"},o.createElement(u,{alt:"",group:"web",name:"shared_link_white"}))},t.prototype.isSharingFolder=function(){return Boolean(this.props.shareFolderPromise)},t.prototype.renderSharedContentLinkInfo=function(){if(!(this.props.actionHandler&&this.props.linkMetadata&&this.props.linkMetadata instanceof p.SharedContentLinkMetadata))return null;if(this.isSharingFolder()||this.props.linkMetadata instanceof p.SharedContentLinkMetadata&&this.props.linkMetadata.current_audience===p.LinkAudience.default_on)return o.createElement("div",null,E("Updating link"),o.createElement("div",{className:"c-loader"}));var e,t=this.props.linkMetadata.audience_options.size>1;this.props.linkMetadata.current_audience===p.LinkAudience.members?e=this.props.hasDisplayableMembers&&!this.props.hasNonOwnerMembers?l.reactFormat(E("<strong>Only you</strong> can use the link"),{strong:o.DOM.strong()}):l.reactFormat(E("<strong>Invited members</strong> with the link can view"),{strong:o.DOM.strong()}):this.props.linkMetadata.current_audience===p.LinkAudience.team?e=l.reactFormat(E("<strong>Members of %(team_name)s</strong> with the link can view"),{strong:o.DOM.strong(),team_name:a.em_snippet(this.props.teamName||"",10)}):this.props.linkMetadata.current_audience===p.LinkAudience.public&&(e=l.reactFormat(E("<strong>Anyone</strong> with the link can view"),{strong:o.DOM.strong()}));var n;if(t){var s=o.createElement("button",{className:"c-borderless-button change-audience-button"},e,o.createElement(u,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"}));n=o.createElement(m.SettingDropdown,{currentValue:this.props.linkMetadata.current_audience,valuesList:this.props.linkMetadata.audience_options.valueSeq().toArray(),optionsDict:_.getAudienceOptionsDict(this.props.contentInfo&&this.props.contentInfo.isFolder()||!1,this.props.teamName||"",this.props.hasNonOwnerMembers||!1,this.props.hasDisplayableMembers||!1),onValueSelected:this.props.actionHandler.handleSelectLinkAudience,customButton:s,openUp:this.props.mode!==y.MODES.LINK_ONLY})}else n=e;var r=[];this.props.linkMetadata.expiry&&r.push(h.formatSharedContentLinkExpiry(this.props.linkMetadata,!0)),this.props.linkMetadata.password_protected&&this.props.linkMetadata.expiry&&r.push(this.renderDivider()),this.props.linkMetadata.password_protected&&r.push(E("Password protected"));var i;if(this.props.linkMetadata.audience_restricting_shared_folder&&this.props.linkMetadata.audience_restricting_shared_folder.audience===this.props.linkMetadata.current_audience){var c=this.props.linkMetadata.audience_restricting_shared_folder.name;i=l.reactFormat(E("Applied via <strong>%(folder_name)s</strong>"),{strong:o.DOM.strong(),folder_name:c})}else this.props.contentInfo&&this.props.contentInfo.isFolder()&&this.props.linkMetadata.current_audience!==p.LinkAudience.members&&(i=E("Applies to all items in this folder"));return o.createElement("div",null,o.createElement("div",null,n),o.createElement("div",null,r),i)},t.displayName="ModalLinkInfo",t})(o.Component);t.ModalLinkInfo=b}),define("modules/clean/sharing/views/sharing_bubble_menu",["require","exports","tslib","external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,s,r,o,i,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=u.i18n_default_project("sharing")._,p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberActionInfo=function(){var e=c.ACCESS_NAME;this.props.canMakeViewerNoComment&&(e=c.ACCESS_NAME_NO_COMMENT);var t=c.MEMBER_ACTION_FOLDER;this.props.canMakeViewerNoComment&&(t=c.MEMBER_ACTION_FOLDER_NO_COMMENT);var n=c.MEMBER_ACTION_FILE;this.props.canMakeViewerNoComment&&(n=c.MEMBER_ACTION_FILE_NO_COMMENT);var s=d("Remove");return this.props.allowRelinquishMembership&&(s=d("Remove my access")),[[l.MEMBER_ACTION.MAKE_EDITOR,{value:a.ACCESS_LEVEL.WRITER,title:e[a.ACCESS_LEVEL.WRITER],folder_description:t[l.MEMBER_ACTION.MAKE_EDITOR],file_description:n[l.MEMBER_ACTION.MAKE_EDITOR]}],[l.MEMBER_ACTION.MAKE_VIEWER,{value:a.ACCESS_LEVEL.READER,title:e[a.ACCESS_LEVEL.READER],folder_description:t[l.MEMBER_ACTION.MAKE_VIEWER],file_description:n[l.MEMBER_ACTION.MAKE_VIEWER]}],[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,{value:a.ACCESS_LEVEL.READER_NO_COMMENT,title:e[a.ACCESS_LEVEL.READER_NO_COMMENT],folder_description:t[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT],file_description:n[l.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]}],[l.MEMBER_ACTION.MAKE_OWNER,{value:a.ACCESS_LEVEL.OWNER,title:d("Make owner")}],[l.MEMBER_ACTION.REMOVE,{value:"remove",title:r.createElement("div",{className:"u-font-danger"},s)}]]},t.prototype.renderMenuItem=function(e){var t=this,n=e.value,s=e.title,a=e.file_description,l=e.folder_description,c=null;c=this.props.contentInfo&&this.props.contentInfo.isFolder()?l:a;var u=null;n!==this.props.currentAccess&&(u=function(){return t.props.onAccessChange(n)});var d=null;return n===this.props.currentAccess&&(d=r.createElement(i,{alt:"",group:"web",name:"check_gray"})),r.createElement(o.BubbleMenuItem,{className:"sharing-access-menu-item",key:n,onClick:u},r.createElement("div",{className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},d),r.createElement("div",{className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},r.createElement("div",{className:"u-font-nowrap u-font-black sharing-access-menu-item__title"},s),r.createElement("div",{className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},c)))},t.prototype.renderCurrentAccessText=function(e){var t=s({"sharing-access-menu__current-access":!0,"u-font-nowrap":!0,"c-btn--disabled":e,"sharing-access-menu__current-access--button":this.props.asButton,"c-btn":this.props.asButton,
"c-btn--secondary":this.props.asButton,"u-trim-margin":this.props.asButton,"c-borderless-button":!this.props.asButton,"change-access-button":!this.props.asButton&&!e}),n=c.ACCESS_NAME[this.props.currentAccess];this.props.canMakeViewerNoComment&&(n=c.ACCESS_NAME_NO_COMMENT[this.props.currentAccess]);var o=null;return e||(o=[r.createElement("div",{className:"gray-arrow",key:"gray"},r.createElement(i,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),r.createElement("div",{className:"blue-arrow",key:"blue"},r.createElement(i,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))]),r.createElement("button",{className:t},n,o)},t.prototype.render=function(){for(var e=[],t=0,n=this.getMemberActionInfo();t<n.length;t++){var s=n[t],i=s[0],a=s[1];(a.value===this.props.currentAccess||this.props.memberPermissions&&this.props.memberPermissions.get(i)&&this.props.memberPermissions.get(i).allow||a.value===l.MEMBER_ACTION.REMOVE&&this.props.allowRelinquishMembership)&&e.push(this.renderMenuItem(a))}if(e.length<=1||this.props.pendingAccessChange)return this.renderCurrentAccessText(!0);var c=0;return this.props.asButton&&(c=-5),r.createElement(o.BubbleMenu,{targetButton:this.renderCurrentAccessText(this.props.disabled||!1),targetFixed:!0,position:o.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:e,shouldShowArrow:!1,disabled:this.props.disabled,verticalDisplacement:c})},t.displayName="SharingBubbleMenu",t.defaultProps={allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,canMakeViewerNoComment:!1,disabled:!1,pendingAccessChange:void 0},t})(r.Component);t.SharingBubbleMenu=p}),define("modules/clean/sharing/views/viewer_info",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));var t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}return e.prototype.displayName=function(){return this.display_name},e.prototype.memberId=function(){return this.account_id},e})();t.ViewerInfo=n}),define("modules/clean/sharing/views/wrapped_group_viewers_maker",["require","exports","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/title_bubble","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a.i18n_default_project("sharing"),c=l._,u=l.ungettext;(function(e){function t(e,t){for(var s=u("%(num_viewers)d viewer","%(num_viewers)d viewers",e.length).format({num_viewers:e.length}),r=e.length<=10,i=r?e.length:9,l=a(e[0],t),c=1;c<i;c++)l=l.concat(a(e[c],t));if(!r){var d=e.length-i,p=u("and %(num_others)d other","and %(num_others)d others",d).format({num_others:d});l=l.concat(n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},p)))}return{element:n.createElement(o,{content:n.createElement("table",{className:"group-tooltip__viewers-table"},n.createElement("tbody",null,l)),className:"group-tooltip",children:n.createElement("span",{className:"u-font-meta sharing-member-info__viewer-count-text"},s),position:o.POSITIONS.BOTTOM,isTargetPositionFixed:!0}),elementText:s}}function a(e,t){var o=t.has(e.account_id)?c("Viewing now"):s.ago(e.time_last_seen,!1,!0);return[n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},r.em_snippet(e.displayName(),i.SNIPPET_SIZES.DISPLAY_NAME)),n.createElement("td",{className:"group-tooltip__viewers-table-cell dot"},"·"),n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__seen-string"},o))]}e.make=t})(t.WrappedGroupViewersMaker||(t.WrappedGroupViewersMaker={}))}),define("modules/clean/teams/admin/api/admin_console_api_client",["require","exports","tslib","modules/clean/api_v2/client","modules/clean/filepath","modules/clean/sharing/api/util/types","modules/clean/viewer"],function(e,t,n,s,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){void 0===e&&(e=!1);var t=i.get_viewer();t.work_user&&(this.teamMemberId=t.work_user.team_member_id),this.userId=t.get_uid_by_role("work"),this.rpcClient=new s.TeamActionsClient,this.isCMForCDM=e}return e.prototype._adminHeaders=function(){return{"Dropbox-API-Select-Admin":this.teamMemberId}},e.prototype.rpcCall=function(e,t,n){return void 0===n&&(n=!1),n?this.rpcClient.rpc(this.userId,e,t,this._adminHeaders()):this.rpcClient.rpc(this.userId,e,t)},e.prototype.setPermanentDeletePolicy=function(e){return this.rpcCall("team/set_permanent_delete_policy",{permanent_delete_enabled:e})},e.prototype.setMultipleAccountsPolicy=function(e){return this.rpcCall("team/set_multiple_accounts_policy",{multiple_accounts_enabled:e})},e.prototype.setFileRequestPolicy=function(e){return this.rpcCall("team/sharing/set_file_request_policy",{file_request_enabled:e})},e.prototype.setOfficeAddInPolicy=function(e){return this.rpcCall("team/set_office_addin_policy",{office_addin_enabled:e})},e.prototype.setSharedLinkPolicy=function(e,t){var n={sharing_outside_enabled:e};return e&&(n.default_visibility=t),this.rpcCall("team/sharing/set_shared_link_policy",n)},e.prototype.setSharedFolderSharingPolicy=function(e){return this.rpcCall("team/sharing/set_shared_folder_sharing_policy",{sharing_outside_enabled:e})},e.prototype.setSharedFolderJoiningPolicy=function(e){return this.rpcCall("team/sharing/set_shared_folder_joining_policy",{joining_outside_enabled:e})},e.prototype.setCommentingPolicy=function(e){return this.rpcCall("team/sharing/set_commenting_policy",{commenting_enabled:e})},e.prototype.setPasswordStrength=function(e,t){var n="enabled"===e?t:"minimal_requirements";return this.rpcCall("team/set_password_requirements",{password_strength_policy:n})},e.prototype.resetAllPasswords=function(){return this.rpcCall("team/reset_all_passwords")},e.prototype.setViewerInfoSetting=function(e){return this.rpcCall("team/set_viewer_info_policy",{viewer_info_policy:e})},e.prototype.setPaperPolicy=function(e,t,n,s){var r={paper_deployment_type:n,enabled_members_update:{users_to_add:this.make_user_selector_list(s.users_to_add),users_to_remove:this.make_user_selector_list(s.users_to_remove)}},o={paper_enabled:e,paper_deployment_mode:r};return t&&(o.dropbox_terms="agree"),this.rpcCall("team/paper/set_paper_policy",o)},e.prototype.setPaperSharingPolicy=function(e,t){return void 0===e&&(e=!0),this.rpcCall("team/paper/set_paper_sharing_policy",{external_sharing_allowed:void 0===e||e,default_visibility:t})},e.prototype.setRequestMembershipPolicy=function(e){return this.rpcCall("team/set_request_membership_policy",{request_membership:e})},e.prototype.setSuggestMembersPolicy=function(e){return this.rpcCall("team/set_suggest_members_policy",{suggest_members_enabled:e})},e.prototype.deviceManagementGetExcludedUsers=function(){return this.rpcCall("team/device_management/get_excluded_users",null)},e.prototype.deviceManagementUpdateExcludedUsers=function(e,t){return this.rpcCall("team/device_management/update_excluded_users",{users_to_add:e,users_to_remove:t})},e.prototype.deviceManagementConfigureSettings=function(e){return this.rpcCall("team/device_management/configure_settings",e)},e.mapValueToRolloutMethod=function(e){return 0===e?"unlink_all":1===e?"unlink_most_inactive":"add_member_to_exceptions"},e.prototype.deviceManagementConfigureSettingsForAcf=function(t,n,s,r,o){var i={is_enabled:!0,can_user_remove_device:n,rollout_method:{".tag":e.mapValueToRolloutMethod(o)},users_to_add:t.users_to_add,users_to_remove:t.users_to_remove,desktop_devices_limit:s===-1?{".tag":"unlimited"}:{limited:Number(s),".tag":"limited"},mobile_devices_limit:r===-1?{".tag":"unlimited"}:{limited:Number(r),".tag":"limited"}};return this.rpcCall("team/device_management/configure_settings",i)},e.prototype.deviceManagementExclusionList=function(e){return this.rpcCall("team/device_management/update_excluded_users",e)},e.prototype.deviceManagementConfigureSettingsDisable=function(){return this.rpcCall("team/device_management/configure_settings",{is_enabled:!1})},e.prototype.deviceManagementRemoveDevice=function(e,t,n){return this.rpcCall("team/device_management/remove_device",{user_id:e,device_id:t,delete_data:n})},e.prototype.deviceManagementRemoveClient=function(e,t,n,s){return this.rpcCall("team/device_management/remove_client",{user_id:e,device_id:t,client_unique_identifier:n,delete_data:s})},e.prototype.webSessionManagementConfigureSettings=function(e,t){return this.rpcCall("team/web_session_management/configure_settings",{remember_session_expires:e,idle_session_timeout:t})},e.prototype.teamFolderArchive=function(e,t){return void 0===t&&(t=!1),this.rpcCall("team/team_folder/archive",{team_folder_id:String(e),force_async_off:!t})},e.prototype.teamFolderUnarchive=function(e){return this.rpcCall("team/team_folder/activate",{team_folder_id:String(e)})},e.prototype.teamFolderCreate=function(e){return this.rpcCall("team/team_folder/create",{name:e})},e.prototype.teamFoldersList=function(e){return void 0===e&&(e=1e3),this.rpcCall("team/team_folder/list",{limit:e})},e.prototype.teamFolderRename=function(e,t){return this.rpcCall("team/team_folder/rename",{team_folder_id:String(e),name:t})},e.prototype.teamFolderPermanentlyDelete=function(e){return this.rpcCall("team/team_folder/permanently_delete",{team_folder_id:String(e)})},e.prototype.setGroupsCreationPolicy=function(e){return this.rpcCall("team/groups/set_creation_policy",{group_creation:e})},e.prototype.setNTSBlockTrafficPolicy=function(e){return this.rpcCall("team/nts/set_block_traffic_policy",{block_traffic_enabled:e})},e.prototype.configureSso=function(e,t,n,s,r){return this.rpcCall("team/configure_sso",{sso_policy:e,saml_cert:t,sign_in_url:n,sign_out_url:s,nameid_format:r})},e.prototype.configureGoogleLoginPolicy=function(e){return this.rpcCall("team/configure_google_login_policy",{google_login_enabled:e})},e.prototype.setResellerSupportSetting=function(e){return this.rpcCall("team/change_reseller_support",{reseller_support_enabled:e})},e.prototype.folderCreate=function(e,t,n){"/"!==t&&(t+="/");var s="ns:"+e+t+n;return this.rpcCall("files/create_folder",{path:s},!0)},e.prototype.bulkFileDelete=function(e){for(var t=[],n=null,s=0,r=e.length;s<r;s++)n=e[s],t.push({path:"ns:"+n.ns_id+n.ns_path});return this.rpcCall("files/delete_batch_with_changeset_sync",{entries:t},!0)},e.prototype.fileRename=function(e,t,n){var s="ns:"+e+t,r=t.substring(0,t.lastIndexOf("/"))+"/"+n,o="ns:"+e+r;return this.rpcCall("files/move",{from_path:s,to_path:o,autorename:!0},!0)},e.prototype.shareFolder=function(e,t,s,r){void 0===s&&(s=null),void 0===r&&(r=!1);var i="ns:"+e+t,a=n.__assign({},o.combinedPolicyDiffToApi(s),{confidentiality:r?"confidential":"not_confidential",path:i});return this.rpcCall("sharing/alpha/share_folder",a,!0)},e.prototype.validateFolderPath=function(e,t,n,s){var r="ns:"+e+t;return this.rpcCall("sharing/validate_folder_path",{path:r,actions:n,list_members_arg:s},!0)},e.prototype.restoreFile=function(e,t,n){var s="ns:"+e+t;return this.rpcCall("files/restore",{path:s,rev:n},!0)},e.prototype.restorePaths=function(e){for(var t,n=[],s=0,r=e;s<r.length;s++){var o=r[s];t="ns:"+o.ns_id+o.ns_path,n.push(t)}return this.rpcCall("files/restore_path_batch_sync",{entries:n},!0)},e.prototype.permanentDeleteFile=function(e,t){var n="ns:"+e+t;return this.rpcCall("files/permanently_delete",{path:n},!0)},e.prototype.listRevisions=function(e,t){var n="ns:"+e+t;return this.rpcCall("files/list_revisions",{path:n},!0)},e.prototype.setTSDWritePolicy=function(e){return this.rpcCall("team/team_folder/set_tsd_writable_setting",{is_writable:e})},e.prototype.setInfinitePolicy=function(e){return this.rpcCall("team/set_infinite_policy",{setting:e})},e.prototype.setSmartSyncDesktopPolicy=function(e){return this.rpcCall("team/set_smart_sync_desktop_policy",{setting:e})},e.prototype.getTeamFolderNsPathForFile=function(e){return this.isCMForCDM?e.fq_path:"/"+e.fq_path.split("/").slice(2).join("/")},e.prototype.bulkFileMove=function(e,t,n){for(var s,o,i=[],a=0,l=t;a<l.length;a++){var c=l[a];o=this.getTeamFolderNsPathForFile(c),s=r.filename(c.fq_path),i.push({from_path:"ns:"+e+o,to_path:"ns:"+e+n+"/"+s})}return this.rpcCall("files/move_batch_sync",{entries:i,autorename:!0},!0)},e.prototype.bulkFileCopy=function(e,t,n,s){void 0===s&&(s=null);for(var o,i,a=[],l=0,c=t;l<c.length;l++){var u=c[l];i=this.getTeamFolderNsPathForFile(u),o=r.filename(u.fq_path),a.push({from_path:"ns:"+e+i,to_path:"ns:"+e+n+"/"+o})}return this.rpcCall("files/copy_batch_sync",{entries:a,autorename:!0,allow_shared_folder:!0,fsw_request:s},!0)},e.prototype.setMemberSpaceLimits=function(e){return this.rpcCall("team/member_space_limits/set_default_limit",{limit_level:e})},e.prototype.setMslCapsType=function(e){return this.rpcCall("team/member_space_limits/set_caps_type",{caps_type:e})},e.prototype.setCustomQuota=function(e,t){return this.rpcCall("team/member_space_limits/set_custom_quota",{users_and_quotas:[{user:this._create_user_selector_json(e),quota_gb:t}]})},e.prototype.removeCustomQuota=function(e){return this.rpcCall("team/member_space_limits/remove_custom_quota",{users:[this._create_user_selector_json(e)]})},e.prototype._create_user_selector_json=function(e){return{".tag":"email",email:e}},e.prototype.make_user_selector_list=function(e){return void 0===e&&(e=[]),e.map(this._create_user_selector_json)},e.prototype.memberSpaceLimitsUpdateExclusionList=function(e){var t=this.make_user_selector_list(e.users_to_add),n=this.make_user_selector_list(e.users_to_remove);return this.rpcCall("team/member_space_limits/update_excluded_users",{users_to_add:t,users_to_remove:n})},e.prototype.listAllMembers=function(e,t){void 0===t&&(t=null);var n={shared_folder_id:String(e)};return t&&(n.path=t),this.rpcCall("sharing/list_all_members",n,!0)},e.prototype.teamFolderGetAccessPoints=function(e,t,n){return this.rpcCall("team/team_folder/get_access_points",{dropbox_id:e,team_folder_id:String(t),path:n})},e.prototype.teamFolderGetFileMetadata=function(e,t){var n={team_folder_id:String(e)};return t&&(n.path=t),this.rpcCall("team/team_folder/get_file_metadata",n)},e.prototype.getUserInfos=function(e){return this.rpcCall("users/get_account_batch",{account_ids:e},!0)},e.prototype.emmConfigureSettings=function(e,t){var n={users_to_add:this.make_user_selector_list(t.users_to_add),users_to_remove:this.make_user_selector_list(t.users_to_remove)};return this.rpcCall("team/emm/configure_settings",{emm_policy:{".tag":e},exclusion_list:n})},e.prototype.emmRefreshToken=function(){return this.rpcCall("team/emm/refresh_token")},e.prototype.emmGenerateUsageReport=function(){return this.rpcCall("team/emm/generate_report",{report_type:"mobile_app_usage"})},e})();t.AdminConsoleApiClient=a,t.default=a}),function(){define("modules/clean/teams/membership_discovery_util",["modules/clean/ajax","modules/clean/loggers/growth_features_events_logger","modules/clean/react/modal","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,s,r,o,i,a){var l,c,u,d,p,h,m,_,f;return l=s.TRADEMARK_BUSINESS,c=o._,f=o.ungettext,d=function(t,n){return e.WebRequest({url:"/team/discover/get_discoverable_team_for_folder",type:"POST",data:{ns_id:t},success:function(e){return e=JSON.parse(e),n(null!=e?e.team:void 0)},error:function(){return n()}})},m=function(t,n){return e.WebRequest({url:"/team/discover/join_ajax",data:{team_id:t,cont:"#"},success:function(e){switch(e=JSON.parse(e),null!=e?e.result:void 0){case"request_sent":i.success(c("Request to join sent."));break;case"can_join":r.redirect(e.url);break;case"max_team_size_achieved":i.error(c("This team has reached the maximum size. Please ask the admins of this team to upgrade to %(trademark_business)s, which allows teams to add as many members as possible.").format({trademark_business:l}));break;case"pending_approval":i.success(c("Your request to join is pending."));break;default:i.error(c("Invalid request"))}return"function"==typeof n?n(e):void 0},error:function(){return i.error(c("Error sending request.")),"function"==typeof n?n():void 0}})},h=function(t,n,s){return e.WebRequest({url:"/account/team/add_users",subject_user:n,data:{emails:t,team_id:s},success:function(e){var t;if(e=JSON.parse(e),e.num_invited)return t=f("Invitation sent.","Invitations sent.",e.num_invited),i.success(t)},error:function(){var e;return e=f("Error sending invitation.","Error sending invitations.",t.length),i.error(e)}})},p=function(s,o,l,u){return e.WebRequest({url:"/account/team/add_users",subject_user:o,data:{emails:s,team_id:l},success:function(e){var n,r;if(n={subject_user_id:o.id,team_id:l,num_suggested_users:s.length},t.logMagnetEvent("send_admin_invite_ajax_success",n),e=JSON.parse(e),e.num_invited)return r=f("Invitation sent.","Invitations sent.",e.num_invited),i.success(r)},error:function(e){var i;return i={subject_user_id:o.id,team_id:l,num_suggested_users:s.length,response_text:e.responseText},t.logMagnetEvent("send_admin_invite_ajax_fail",i),e.responseText.includes("You need an additional license to invite this user.")?n.SimpleModal.show({title_text:c("No available licenses"),body_html:c("You don’t have enough available licenses to invite additional members. Please visit the admin console to purchase more licenses."),confirm_text:c("Go to admin console"),confirm_callback:function(){return i={team_id:l,ui_object:"not_enough_licenses_modal"},t.logMagnetEvent("go_to_admin_console_clicked",i),r.redirect(new a({path:"/team/admin/members"}))},cancel_text:c("Not now"),cancel_callback:function(){return i={team_id:l,ui_object:"not_enough_licenses_modal"},t.logMagnetEvent("not_now_clicked",i)}}):_(s,u,function(){return r.redirect(new a({path:"/team/admin/requests",query:{invite_emails:s}}))})}})},_=function(t,n,s,r){return e.WebRequest({url:"/team/discover/suggest_ajax",data:{emails:JSON.stringify(t),ns_id:JSON.stringify(n)},success:function(e){var n;return n=f("Suggestion sent.","Suggestions sent.",t.length),i.success(n),"function"==typeof s?s(e):void 0},error:function(){var e;return e=f("Error sending suggestion.","Error sending suggestions.",t.length),i.error(e),"function"==typeof r?r():void 0}})},u=function(t,n,s){return e.WebRequest({url:"/team/discover/filter_suggestable_ajax",type:"POST",data:{emails:JSON.stringify(t)},success:function(e){return e=JSON.parse(e),"function"==typeof n?n(e):void 0},error:function(){return"function"==typeof s?s():void 0}})},{getDiscoverableTeamForFolder:d,sendAdminTeamInvitations:p,sendTeamRequest:m,sendLimitedTeamInvitations:h,sendTeamSuggestions:_,filterSuggestableUsers:u}})}.call(this),define("modules/clean/teams/modals/create_team_prompt_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/react/button","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,s,r,o,i,a,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h;(function(e){e[e.CLICK_CREATE=0]="CLICK_CREATE",e[e.DISMISS=1]="DISMISS",e[e.CLICK_NEXT_TIME=2]="CLICK_NEXT_TIME"})(h||(h={}));var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCreate=function(){var e=t.props.invitedMembers.map(function(e){return e.email}).filter(function(e){return"string"==typeof e&&""!==e}),n=new p({path:"/team",query:{tk:"tib_upsell",invite_members:e.join(",")}});u.redirect(n.toString()),t.logClick(h.CLICK_CREATE)},t.onClickNextTime=function(){l.Modal.close(),t.logClick(h.CLICK_NEXT_TIME)},t.onDismiss=function(){r.WebRequest({url:"/team/stop_show_create_team_modal"}),t.logClick(h.DISMISS)},t}return n.__extends(t,e),t.prototype.logClick=function(e){o.TeamsWebActionsLogger.log("share_crt_team_modal",{num_shared:this.props.invitedMembers.length,clicked_create:e===h.CLICK_CREATE,clicked_nxt_time:e===h.CLICK_NEXT_TIME,dismissed:e===h.DISMISS})},t.prototype.renderButtons=function(){return s.createElement("div",{className:"db-modal-buttons"},s.createElement(i.Button,{className:"dbmodal-button",importance:"primary",onClick:this.onClickCreate},d._("Create free work Dropbox")),s.createElement(i.Button,{className:"dbmodal-button",importance:"tertiary",onClick:this.onClickNextTime},d._("Ask me next time")))},t.prototype.render=function(){for(var e=[],t=0,n=this.props.invitedMembers;t<n.length;t++){var r=n[t];r.name&&r.name!==r.email&&e.push(r.name)}var o=d._("Work with these people often?");return 2===e.length&&2===this.props.invitedMembers.length?o=d._("Work with %(firstname_1)s and %(firstname_2)s often?").format({firstname_1:e[0],firstname_2:e[1]}):3===e.length&&3===this.props.invitedMembers.length&&(o=d._("Work with %(firstname_1)s, %(firstname_2)s, and %(firstname_3)s often?").format({firstname_1:e[0],firstname_2:e[1],firstname_3:e[2]})),s.createElement(l.Modal,{style:"clean",className:"create-team-modal-after-sharing",buttonComponent:this.renderButtons(),onDismiss:this.onDismiss,clickOutToClose:!1,showX:!0,width:500},s.createElement("div",null,s.createElement(a,{className:"create-team-modal__team-illo u-mar-top-l",alt:d._("Work together"),src:c.static_url("/static/images/teams/modals/illo_how-create-vfl99WbqQ.png"),srcHiRes:c.static_url("/static/images/teams/modals/illo_how-create@2x-vflvsB25f.png")}),s.createElement("h1",{className:"create-team-modal__header u-mar-top-m u-mar-bottom-s"},o),s.createElement("div",{className:"create-team-modal__subheader"},d._("Get a free 2 GB work Dropbox to organize projects in one place,               collaborate from anywhere, and stay in sync."))))},t})(s.Component);t.CreateTeamPromptModal=m}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/classnames","external/react","external/react-dom","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(t,n,s,r,o,i,a){var l,c,u,d,p;return l=i.KeyCode,d=a.TypeaheadSelector,p=n.DOM,c=n.createClass({displayName:"Token",propTypes:{className:n.PropTypes.string,data:n.PropTypes.any,onRemove:n.PropTypes.func},render:function(){var e;return e={"tokenizer-token":!0},e[this.props.className]=!0,p.a(r.extend({tabIndex:-1},this.props,{className:t(e)}),String(this.props.data),this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?p.span({className:"tokenizer-token-close",onClick:(function(e){return function(){return e.props.onRemove(),!1}})(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),u=n.createClass({displayName:"Tokenizer",propTypes:{customClass:n.PropTypes.string,dataSource:n.PropTypes.object.isRequired,initialInputText:n.PropTypes.string,logSearchBegin:n.PropTypes.func,logSearchComplete:n.PropTypes.func,logTokenChangeEvent:n.PropTypes.func,onContentsChange:n.PropTypes.func,onTokensAdd:n.PropTypes.func,onTokenRemove:n.PropTypes.func,placeholderText:n.PropTypes.string,populatedTokenData:n.PropTypes.array,renderToken:n.PropTypes.func.isRequired,renderTokenHover:n.PropTypes.func,renderInput:n.PropTypes.func.isRequired,renderSelector:n.PropTypes.func.isRequired,stringTokenizer:n.PropTypes.func.isRequired,tokenSpacing:n.PropTypes.number,focusOnMount:n.PropTypes.bool,tabIndex:n.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return p.input()},renderSelector:function(){return n.createElement(d,null)},renderToken:function(e){return n.createElement(c,{data:e})},stringTokenizer:function(e,t){var n,s;return n=e.split(","),s=t?"":n.pop(),{tokens:n,value:s}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null}},getInitialState:function(){return this.tokenData=[],this.queryResults=null,{queryResults:this.queryResults,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){var e,t;if(setTimeout(this._resizeTokenizerInput,0),s.findDOMNode(this.refs.input).value=this.props.initialInputText,r(s.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&s.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props.dataSource).registerForUpdates&&e.registerForUpdates(this._dataUpdatedCallback),(null!=(t=this.props.populatedTokenData)?t.length:void 0)>0)return this._addTokens(this.props.populatedTokenData,!1,null)},componentWillUnmount:function(){return r(s.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(e,t){var n,s;return(null!=(n=this.props.populatedTokenData)?n.length:void 0)!==(null!=(s=e.populatedTokenData)?s.length:void 0)&&this._addTokens(this.props.populatedTokenData,!1,null),this._resizeTokenizerInput()},render:function(){var e,n;return e={"react-tokenizer":!0},null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass),n={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},this.state.numLines>3&&(n.overflowY="auto",n.overflowX="visible"),p.div({onClick:this._handleMyClick,className:t(e)},p.div({className:"tokenizer-input",ref:"tokenizer_input",style:n},p.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:s.findDOMNode(this.refs.input).value}},tokenizeAll:function(){var e,t;return e=s.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},_getCurrentValue:function(){var e,t,n;return e=s.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value),t.tokens,n=t.value,n},queryDataSource:function(t){var n,s,r;return s=(function(n){return function(s){var r,i;return t||(s=null),r=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},i=o.map(n.tokenData,r),s=null!=s?s.filter(function(t){var n;return n=r(t),e.call(i,n)<0}):null}})(this),r=(function(e){return function(n){var r;return n=s(n),e.queryResults=n,e.setState({queryResults:e.queryResults}),"function"==typeof(r=e.props).logSearchComplete?r.logSearchComplete(t,(null!=n?n.length:void 0)||0,!0):void 0}})(this),n=(function(e){return function(n){var r;return t===e._getCurrentValue()&&(n=s(n),n&&n.length&&(e.queryResults=e.queryResults?e.queryResults.concat(n):n,e.setState({queryResults:e.queryResults}))),"function"==typeof(r=e.props).logSearchComplete?r.logSearchComplete(t,(null!=n?n.length:void 0)||0,!1):void 0}})(this),this.props.dataSource.query(t,r,n)},_dataUpdatedCallback:function(){var e,t;if(this.isMounted())return e=Boolean(this.state.queryResults),null!=(t=this.refs.selector)&&"function"==typeof t.reset&&t.reset(),e&&s.findDOMNode(this.refs.input).focus(),this.queryDataSource(s.findDOMNode(this.refs.input).value)},_addTokens:function(t,n,r){var i,a,l,c,u,d,p,h,m,_,f,g,y,S,v,E,b;for(null==n&&(n=!1),null==r&&(r=null),u=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},b=o.map(this.tokenData,u),f=[],d=0,m=t.length;d<m;d++)E=t[d],h=u(E),e.call(b,h)<0&&(f.push(E),b.push(h));for(this.tokenData=this.tokenData.concat(f),this.setState({tokenData:this.tokenData}),"function"==typeof(i=this.props).onTokensAdd&&i.onTokensAdd(f,this),"function"==typeof(a=this.props).onContentsChange&&a.onContentsChange(this.tokenData,null!=(g=s.findDOMNode(this.refs.input))?g.value:void 0),c=n?{search_expr:r,selected_pos:(null!=(y=this.refs.selector)?y.state.selectionIndex:void 0)||0,num_query_results:null!=(S=this.state.queryResults)?S.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1},v=[],p=0,_=f.length;p<_;p++)E=f[p],v.push("function"==typeof(l=this.props).logTokenChangeEvent?l.logTokenChangeEvent(E,!1,c):void 0);return v},_addToken:function(e,t,n){return null==t&&(t=!1),null==n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){var t,n,r,o,i,a,l,c,u,d,p,h,m,_;for(_=this.state.selectedTokenIndex,m=[],a=0,u=e.length;a<u;a++)o=e[a],h=this.tokenData.indexOf(o),h!==-1&&(_===h?_=null:_>h&&(_-=1),this.tokenData.splice(h,1),m.push(o));for(i=s.findDOMNode(this.refs.input),i.focus(),this._setSelectedToken(_),this.queryResults=null,this.setState({tokenData:this.tokenData,queryResults:this.queryResults}),l=0,d=m.length;l<d;l++)o=m[l],"function"==typeof(t=this.props).onTokenRemove&&t.onTokenRemove(o);for(c=0,p=m.length;c<p;c++)o=m[c],"function"==typeof(n=this.props).logTokenChangeEvent&&n.logTokenChangeEvent(o,!0);return"function"==typeof(r=this.props).onContentsChange?r.onContentsChange(this.tokenData,i.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t,n,r,i;if(r=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=function(e){var t,n;return t=e[0],n=e[1],r(t)===r(n)},e.length!==this.tokenData.length||!o.every(o.zip(this.tokenData,e),n))return this.tokenData=e,this.setState({tokenData:e}),"function"==typeof(t=this.props).onContentsChange?t.onContentsChange(this.tokenData,null!=(i=s.findDOMNode(this.refs.input))?i.value:void 0):void 0},_renderTokens:function(){var e,s,r,o,i,a,l,c,u,d,p,h;for(d=[],l=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},u=this.state.tokenData,i=a=0,c=u.length;a<c;i=++a)r=u[i],h=this.props.renderToken(r),p=this.state.selectedTokenIndex===i,o="function"==typeof(e=this.props).renderTokenHover?e.renderTokenHover(r):void 0,s=[{selected:p,"c-title-bubble":null!=o,"c-title-bubble--s":null!=o}],d.push(n.cloneElement(h,{ref:"token"+i,key:"token"+l(r),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:t(s,h.props.className),"data-title":o,onClick:this._setSelectedToken.bind(this,i),onRemove:this.removeToken.bind(this,r),tokenSpacing:this.props.tokenSpacing}));return d},_renderSelector:function(){return n.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e;return e=this.state.tokenData.length?"":this.props.placeholderText,n.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e;return function(){var t,n,s;for(s=[],e=t=0,n=this.state.tokenData.length;0<=n?t<n:t>n;e=0<=n?++t:--t)s.push(this.refs["token"+e]);return s}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(s.findDOMNode(this.refs["token"+e]).focus(),this.refs.selector.close()):s.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e,t,n,r,o,i,a,l,c,u,d,p,h,m;if(r=function(e){var t;return null!=(t=s.findDOMNode(e))?t.clientWidth:void 0},t=80,p=this._getTokenizerInput(),h=r(p),null!=h){for(n=this.props.tokenSpacing+2,e=this.props.tokenSpacing,l=0,m=this._getTokenComponents(),c=1,i=0,a=m.length;i<a;i++)u=m[i],d=r(u)+n,l+d+e>h&&(c+=1,l=0),l+=d;return o=h-l-e-2,o<t&&(c+=1,o=h-e),
o!==this.state.inputWidth&&this.setState({inputWidth:o}),c!==this.state.numLines?this.setState({numLines:c}):void 0}},_onSelect:function(e){var t;return t=s.findDOMNode(this.refs.input),t.focus(),this._addToken(e,!0,t.value),t.value="",this.queryResults=null,this.setState({queryResults:this.queryResults})},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){var t;if(this._shouldListenForTokenNavigation())switch(t=this.state.selectedTokenIndex,e.keyCode){case l.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case l.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case l.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case l.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}if(this.refs.selector.onKeyDown(e),!e.isDefaultPrevented())return e.keyCode===l.TAB&&""!==s.findDOMNode(this.refs.input).value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){var e;return!!this.state.tokenData.length&&(e=s.findDOMNode(this.refs.input),0===e.selectionStart&&0===e.selectionEnd)},_textUpdated:function(){var e,t,n,r,o,i,a;return n=s.findDOMNode(this.refs.input),r=n.value,o=this.props.stringTokenizer(r),i=o.tokens,a=o.value,"function"==typeof(e=this.props).logSearchBegin&&e.logSearchBegin(a),a!==r&&(n.value=a,a||this.refs.selector.close()),i.length>0?this._addTokens(i,!1):"function"==typeof(t=this.props).onContentsChange&&t.onContentsChange(this.tokenData,a),this.queryDataSource(a)},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})}}),{Token:c,Tokenizer:u}})}.call(this),function(){define("modules/clean/typeahead",["external/classnames","external/react","external/react-dom","external/underscore","modules/clean/fuzzy","modules/clean/keycode","require"],function(e,t,n,s,r,o,i){var a,l,c,u,d,p;return c=o.KeyCode,p=t.DOM,l=(function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.filterAndSort=function(e){return r.filter(e,this.local)},e.prototype.query=function(e,t){var n;return n=s.map(this.filterAndSort(e),function(e){return e.original}),t(n)},e})(),d={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var n,s,r,o,i,a,l,c,u;for(u=[],c=this.getOptions(),i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},o=r=0,a=c.length;r<a;o=++r)s=c[o],n={selected:this.state.selectionIndex===o,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(s),u.push(t.cloneElement(l,{className:e(n,l.props.className),key:"option"+i(s),onMouseEnter:this._hover.bind(this,o),onClick:this.onSelect.bind(this,s)}));return u},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case c.UP:return this._navigate(-1),e.preventDefault();case c.DOWN:return this._navigate(1),e.preventDefault();case c.ENTER:return this._selectSelectionIndex(e);case c.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case c.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t,n;if(n=this.getOptions(),n.length&&(t=this.state.selectionIndex,t!==-1))return this.onSelect(n[t]),e.preventDefault()},reset:function(){return this._changeSelectionIndex(0)},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t,n,s;if(n=this.getOptions().length)return t=this.state.selectionIndex+e,s=n+1,t<-1?t+=s:t>=n&&(t-=s),this._changeSelectionIndex(t)},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}},a=t.createClass({displayName:"Autocomplete",propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,dataSource:t.PropTypes.object.isRequired,onBlur:t.PropTypes.func,onSelect:t.PropTypes.func,onChange:t.PropTypes.func,placeholder:t.PropTypes.string,renderCompletionText:t.PropTypes.func.isRequired,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,value:t.PropTypes.string,name:t.PropTypes.string,disabled:t.PropTypes.bool},getDefaultProps:function(){return{value:"",maxVisible:7,onBlur:function(){},onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return p.input()},renderSelector:function(){return t.createElement(u)},disabled:!1}},getInitialState:function(){return{queryResults:null,value:this.props.value,focus:!1}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,p.div({className:e(t),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())},_onMouseOver:function(){return this.setState({focus:!0})},_onMouseLeave:function(){return this.setState({focus:!1})},_onBlur:function(){if(this.props.onBlur(),!this.state.focus)return this._clearResults()},_onFocus:function(){return this._queryDataSource(this.state.value),this.refs.selector.reset()},_renderInput:function(){var e;return e=this.props.renderInput(),t.cloneElement(e,{ref:"input",onChange:(function(t){return function(n){return null!=e.props.onChange&&e.props.onChange(n),t._inputChanged(n)}})(this),onKeyDown:(function(t){return function(n){return null!=e.props.onKeyDown&&e.props.onKeyDown(n),t._proxyKeys(n)}})(this),onBlur:(function(t){return function(n){return null!=e.props.onBlur&&e.props.onBlur(n),t._onBlur(n)}})(this),onFocus:(function(t){return function(n){return null!=e.props.onFocus&&e.props.onFocus(n),t._onFocus(n)}})(this),placeholder:this.props.placeholder,value:this.state.value,name:this.props.name,autoComplete:"off",disabled:this.props.disabled})},_renderSelector:function(){return t.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults,maxVisible:this.props.maxVisible})},_inputChanged:function(e){var t;return t=e.target.value,this.setState({value:e.target.value}),this.props.onChange(t),this._queryDataSource(t),this.refs.selector.reset()},_getCurrentValue:function(){return n.findDOMNode(this.refs.input).value},_queryDataSource:function(e){var t,n;return n=(function(e){return function(t){return e.queryResults=t,e.setState({queryResults:e.queryResults})}})(this),t=(function(t){return function(s){var r;if(e===t._getCurrentValue()&&s&&s.length)return r=t.queryResults?t.queryResults.concat(s):s,n(r)}})(this),this.props.dataSource.query(e,n,t)},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=n.findDOMNode(this.refs.input),t.focus(),e=this.props.renderCompletionText(e),this.setState({value:e}),this.props.onSelect(e),this._clearResults()},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})},componentWillReceiveProps:function(e){return this.setState({value:e.value})}}),u=t.createClass({displayName:"TypeaheadSelector",mixins:[d],propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,onClose:t.PropTypes.func.isRequired,onSelect:t.PropTypes.func.isRequired,queryOptions:t.PropTypes.array,renderQueryOption:t.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return p.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,p.ul({className:e(t)},this.renderOptions())):p.div({})}}),{Autocomplete:a,DataSource:l,TypeaheadSelector:u,TypeaheadSelectorMixin:d}})}.call(this),function(){define("modules/clean/zendesk_feedback",["jquery","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/ajax","modules/clean/react/modal","modules/clean/react/image","modules/clean/static_urls","modules/clean/react/css","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/notify"],function(e,t,n,s,r,o,i,a,l,c,u,d,p){var h,m,_,f,g,y,S,v,E,b,C,I,T,w,A,M,N,k;return m=i.Modal,N=l.static_url,f=u.input,g=u.option,T=n.DOM,C=n.createElement,k=n.addons.update,S=r.i18n_default_project("sharing")._,E=n.createClass({displayName:"OpenFeedbackForm",propTypes:{defaultCategory:n.PropTypes.string},getInitialState:function(){return{}},componentDidMount:function(){return s.findDOMNode(this.refs.textbox).focus()},render:function(){return C(m,{className:"zendesk-feedback-form",title:S("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:S("Send feedback"),autoClose:!1,dismissButtonText:S("Cancel"),onAccept:(function(e){return function(){var t,n,s;return e.setState({isSending:!0}),s="truelink",e.refs.category.getValue(),t={categoryTag:e.state.message},n=s+"_feedback",w(n,t,function(){return e.setState({isSending:!1})})}})(this)},T.label({htmlFor:"feedback-category"},S("Category")),C(f,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:this.props.defaultCategory},C(g,{value:"sender"},S("I have feedback about sharing links with others")),C(g,{value:"receiver"},S("I have feedback about accessing links shared with me")),C(g,{value:"settings"},S("I have feedback about changing sharing settings")),C(g,{value:"general"},S("I have general feedback")),C(g,{value:"bug"},S("I found a bug"))),T.label({htmlFor:"feedback-content"},S("What is your feedback?")),T.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:(function(e){return function(t){return e.setState({message:t.target.value})}})(this),ref:"textbox"}))}}),b=n.createClass({displayName:"ZendeskQuantitativeForm",SCORES:{PASS:[{NAME:"seen_feature_score",PROMPT:S("Have you seen this feature at the top of Dropbox file previews?"),TYPE:"YESNO",HAS_IMAGE:!0,IMAGE_SRC:N("/static/images/pass/pass_feedback_feature_example-vflVrEgNf.png"),IMAGE_SRC_HI_RES:N("/static/images/pass/pass_feedback_feature_example@2x-vflEAv7uE.png"),IMAGE_ALT:S("An image of the presence and seen state feature")},{NAME:"knowledge_about_feature_score",PROMPT:S("Do you know that this feature has information about who has viewed this file?"),TYPE:"YESNO",HAS_IMAGE:!1},{NAME:"value_of_feature_score",PROMPT:S("How valuable has this feature been?"),ONE_LABEL:S("Not at all"),FIVE_LABEL:S("Very"),HIDDEN_ONE_LABEL:S("1 means not at all valuable"),HIDDEN_FIVE_LABEL:S("5 means very valuable"),TYPE:"SCALE"}]},propTypes:{title:n.PropTypes.string.isRequired,feedbackTag:n.PropTypes.string.isRequired,formType:n.PropTypes.string.isRequired},getInitialState:function(){return{message:"",scores:{}}},_renderScaleQuestion:function(e){var n;return T.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},T.label({},e.PROMPT),function(){var s,r;for(r=[],n=s=1;s<6;n=++s)r.push(T.button({"aria-checked":this.state.scores[e.NAME]===n.toString(),onClick:(function(e){return function(t,n){return function(){var s;return s={},s[n.NAME]={$set:t.toString()},e.setState({scores:k(e.state.scores,s)})}}})(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.toString()})},n));return r}.call(this),T.div({},T.span({className:"zendesk-feedback-form__score-label"},e.ONE_LABEL),T.span({className:"ax-visually-hidden"},e.HIDDEN_ONE_LABEL),T.span({className:"zendesk-feedback-form__score-label"},e.FIVE_LABEL),T.span({className:"ax-visually-hidden"},e.HIDDEN_FIVE_LABEL)))},_renderYesNoQuestion:function(e){var n,s;return s=e.HAS_IMAGE?T.div({},C(a,{className:"zendesk-feedback-form__question-image",src:e.IMAGE_SRC,srcHiRes:e.IMAGE_SRC_HI_RES,alt:e.IMAGE_ALT})):void 0,T.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},T.label({},e.PROMPT),s,function(){var s,r,o,i;for(o=[{key:"YES",answer_text:S("Yes")},{key:"NO",answer_text:S("No")}],i=[],s=0,r=o.length;s<r;s++)n=o[s],i.push(T.button({"aria-checked":this.state.scores[e.NAME]===n.key,onClick:(function(e){return function(t,n){return function(){var s;return s={},s[n.NAME]={$set:t.key},e.setState({scores:k(e.state.scores,s)})}}})(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.key})},n.answer_text));return i}.call(this))},_renderFreeResponseQuestion:function(){var e;return e=S("PASS"===this.props.formType?"Please describe one way that this feature has helped or hurt your productivity:":"What’s the main reason for your scores?"),T.div({},T.label({htmlFor:"feedback--main-reason"},e),T.textarea({className:"zendesk-feedback-form__textbox",id:"feedback--main-reason",onChange:(function(e){return function(t){return e.setState({message:t.target.value})}})(this)}))},render:function(){var t;return C(m,{className:"zendesk-feedback-form",title:this.props.title,acceptButtonDisabled:this.state.isSending||this.SCORES[this.props.formType].reduce((function(e){return function(t,n){return!e.state.scores[n.NAME]||t}})(this),!1),acceptButtonText:S("Send feedback"),autoClose:!1,dismissButtonText:S("Cancel"),onAccept:(function(t){return function(){var n;return t.setState({isSending:!0}),n=e.extend({},t.state.scores),n.free_response=t.state.message,w(t.props.feedbackTag,n,function(){return t.setState({isSending:!1})})}})(this)},function(){var e,n,s,r;for(s=this.SCORES[this.props.formType],r=[],e=0,n=s.length;e<n;e++)t=s[e],"SCALE"===t.TYPE?r.push(this._renderScaleQuestion(t)):"YESNO"===t.TYPE?r.push(this._renderYesNoQuestion(t)):r.push(void 0);return r}.call(this),this._renderFreeResponseQuestion())}}),v=n.createClass({displayName:"FeedbackFlyout",propTypes:{defaultCategory:n.PropTypes.string,onCloseClick:n.PropTypes.func},componentDidMount:function(){return s.findDOMNode(this.refs.mainButton).focus()},render:function(){return T.div({className:"zendesk-flyout"},T.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},S("Have a moment?"),C(d,{className:"zendesk-flyout__x u-mar-right-m",onClick:(function(e){return function(){var t;return"function"==typeof(t=e.props).onCloseClick&&t.onCloseClick(),I()}})(this)})),T.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},S("Help us make your Dropbox experience even better by sending us your feedback."),T.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:(function(e){return function(){return I(),m.showInstance(C(_,e.props))}})(this),ref:"mainButton"},S("Give feedback"))))}}),h=c(v,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),_=c(E,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),y=c(b,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),M=function(){return m.showInstance(C(y,{title:S("Send us your feedback"),feedbackTag:"pass_feedback",formType:"PASS"}))},A=function(t){var n;return n=function(){return o.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})},o.WebRequest({url:"/sharing/show_feedback_flyout",success:function(r){var o;if(JSON.parse(r))return o=e("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0],s.render(C(h,{onCloseClick:n,defaultCategory:t}),o)}})},I=function(){return e(".zendesk-flyout-container").remove()},w=function(e,t,n){return o.WebRequest({url:"/log/file_collab_feedback",data:{feedback_tag:e,user_feedback:JSON.stringify(t)},success:function(){return p.success(S("Thanks for helping make Dropbox better!")),m.close()},error:n})},{showPASSFeedbackForm:M,showFeedbackFlyoutIfAllowed:A}})}.call(this);
//# sourceMappingURL=pkg-sharing.min.js-vflFTJLoL.map