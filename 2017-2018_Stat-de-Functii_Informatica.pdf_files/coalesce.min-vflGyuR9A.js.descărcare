define(["require","exports","tslib","modules/clean/datetime","external/underscore","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set"],function(e,t,i,r,u,n){"use strict";function o(e,t){var i=t.isGroup?t.groupActivities:t;e.groupActivities=new n.ActivitySortedSet(e.groupActivities.concat(i)).toArray(),e.id=e.groupActivities[0].id,e.timestamp=e.groupActivities[0].timestamp,e.user=e.groupActivities[0].user,e.grouping=e.groupActivities[0].grouping}function s(e){return e.isGroup?e:i.__assign({},e,{isGroup:!0,groupActivities:[e]})}function a(e,t){if(e.length<=1)return e.slice();for(var i=[e[0]],r=1;r<e.length;++r){var u=i[i.length-1]||null,n=e[r],a=t(n,u);if("group"===a){var p=s(u);o(p,n),i[i.length-1]=p}else"remove"===a||("remove-last"===a?(i.pop(),--r):i.push(n))}return i}function p(e,t){if(null!==t&&t.timestamp.getTime()-e.timestamp.getTime()<18e5){if("edit"===t.type&&"view"===e.type)return"group";if("view"===t.type&&"edit"===e.type)return"remove-last"}}function g(e,t){return e.grouping.isLastDay&&t.grouping.isLastDay||e.grouping.ago===t.grouping.ago}function c(e,t){if(null!==t&&"view"===t.type&&"view"===e.type){if(t.user.id===e.user.id&&t.grouping.minute===e.grouping.minute)return"remove";if(g(e,t))return"group"}}function m(e,t){if(null!==t&&t.user.id===e.user.id&&"edit"===t.type&&"edit"===e.type&&g(e,t))return"group"}function l(e){for(var t=new Date,o=new n.ActivitySortedSet(e.map(function(e){return i.__assign({},e,{grouping:{ago:r.agoFromDate(e.timestamp,t),minute:e.timestamp.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),isLastDay:t.getTime()-e.timestamp.getTime()<864e5}})})).toArray(),s=u.groupBy(o,function(e){return e.user.id}),g=0,l=Object.keys(s);g<l.length;g++){var v=l[g];s[v]=a(s[v],p)}return o=new n.ActivitySortedSet((f=Array()).concat.apply(f,u.values(s))).toArray(),o=a(o,c),o=a(o,m);var f}Object.defineProperty(t,"__esModule",{value:!0});t.coalesce=l});
//# sourceMappingURL=coalesce.min.js-vflQeBJdo.map