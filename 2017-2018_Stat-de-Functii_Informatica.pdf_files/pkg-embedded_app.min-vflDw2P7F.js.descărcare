define("modules/clean/appshell/pagelet_init_hooks",["require","exports","modules/core/notify","modules/clean/web_user_action_logger","modules/core/i18n"],function(e,t,r,s,a){"use strict";function n(){window.ensemble&&window.ensemble.switchedAccounts&&(r.success(a._("You have switched to your %(account_name)s account.").format({account_name:window.ensemble.viewer.getActiveUser().displayName.toLocaleLowerCase()})),s.WebUserActionLog.log(window.ensemble.viewer.getActiveUser().userId,s.WebUserActionLogEvents.SWITCH_ACCOUNT,{}))}Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_module=n}),define("modules/clean/browse_interface",["require","exports","tslib","modules/clean/history","modules/clean/viewer","modules/core/i18n","modules/core/uri"],function(e,t,r,s,a,n,o){"use strict";function i(e){return a.get_viewer().is_paired?"personal"===e.role?E+t.PERSONAL_ROOT:E+t.WORK_ROOT:E+t.HOME_ROOT}function c(e){return a.get_viewer().is_paired?a.get_root_name(e):n._("Files")}function _(){return a.get_viewer().get_users().map(function(e){return{name:c(e),path:i(e)}})}function h(e,t){return new o({scheme:"https",authority:"www.dropbox.com",path:""+i(e)+t})}function l(e,t){return"/"!==t.charAt(0)&&(t="/"+t),new o({scheme:"https",authority:"www.dropbox.com",path:E+"/preview"+t,query:{role:e.role}})}function u(e){E=e}function p(e,t){var s=e.fqPath,a=e.userId,n=r.__assign({},null==t?{}:t,(i={undelete:"1"},i._subject_uid=String(a),i));s=s.replace(/^[\/]/,"");return new o({path:"/history/"+s}).updateQuery(n).toString();var i}function d(e){var t=e.fqPath,r=e.userId,a=(n={prev:o.parse(s.get_url()).setFragment("").toString()},n._subject_uid=String(r),n);return t=t.replace(/^[\/]/,""),new o({path:"/restore/"+t}).updateQuery(a).toString();var n}Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_ROOT="/home",t.WORK_ROOT="/work",t.PERSONAL_ROOT="/personal";var E="";t.get_browse_root=i,t.get_browse_root_name=c,t.get_all_browse_roots=_,t.browse_uri_for_fq_path=h,t.preview_uri_for_fq_path=l,t.set_base_prefix=u,t.getFileHistoryUrl=p,t.getRestoreFileUrl=d}),define("modules/clean/filetypes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.FILE=1]="FILE",e[e.FOLDER=2]="FOLDER",e[e.PACKAGE=3]="PACKAGE",e[e.SHARED_FOLDER=4]="SHARED_FOLDER",e[e.SANDBOX=5]="SANDBOX",e[e.TEAM_SHARED_FOLDER=6]="TEAM_SHARED_FOLDER",e[e.TEAM_MEMBER_FOLDER=7]="TEAM_MEMBER_FOLDER"})(t.FileTypes||(t.FileTypes={}))}),define("modules/clean/immutability_helper",["require","exports","external/deep-freeze"],function(e,t,r){"use strict";function s(e){if(null==e)throw new TypeError("Cannot thaw null/undefined object");if(Array.isArray(e))return E.call(e);for(var t=Object.create(Object.getPrototypeOf(e)),r=Object.getOwnPropertyNames(e),s=0,a=r;s<a.length;s++){var n=a[s],o=Object.getOwnPropertyDescriptor(e,n);o&&(o.get||o.set)?(o.configurable=!0,Object.defineProperty(t,n,o)):t[n]=e[n]}return t}function a(e,t){var a=s(e);return t(a),r(a)}function n(e,t){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));return t.reduce(function(e,t){return null==e?null:e[t]},e)}function o(e,t,a){if(null==e)throw new TypeError("Object to `set` cannot be null");if(e[t]===a)return e;var n=s(e);return n[t]=a,r(n)}function i(e,t,r){return o(e,t,r(e[t]))}function c(e,t,r){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var s=t[0];return 1===t.length?i(e,s,r):o(e,s,c(e[s],t.slice(1),r))}function _(e,t,r){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var s=t[0];switch(t.length){case 1:return o(e,s,r);default:return o(e,s,_(e[s]||{},t.slice(1),r))}}function h(e,t){if(null==e||null==t)throw new TypeError("Both target and source cannot be null");var a=Object.keys(t).reduce(function(r,s){return t[s]!==e[s]&&r.push(s),r},[]);if(a.length){for(var n=s(e),o=0,i=a;o<i.length;o++){var c=i[o];Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(t,c))}return r(n)}return e}function l(e,t,r){if(null==e||null==r)throw new TypeError("Both target and source cannot be null");return c(e,t,function(e){return h(e,r)})}function u(e,t,s){for(var a=[],n=3;n<arguments.length;n++)a[n-3]=arguments[n];var o=E.call(e);return o.splice.apply(o,[t,s].concat(a)),r(o)}function p(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];var a=E.call(e);return a.unshift.apply(a,t),r(a)}function d(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];var a=E.call(e);return a.push.apply(a,t),r(a)}Object.defineProperty(t,"__esModule",{value:!0});var E=Array.prototype.slice;t.thaw=s,t.withMutations=a,t.getIn=n,t.set=o,t.update=i,t.updateIn=c,t.setIn=_,t.merge=h,t.mergeIn=l,t.splice=u,t.unshift=p,t.push=d}),define("modules/clean/react/browse/constants",["require","exports","modules/core/i18n"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.NotReady=0]="NotReady",e[e.NotLive=1]="NotLive",e[e.Live=2]="Live"})(t.BrowseBoltClientStatus||(t.BrowseBoltClientStatus={}));(function(e){e.INITIALIZE_EVERYTHING="INITIALIZE_EVERYTHING",e.LOAD_PATH="LOAD_PATH",e.ADD_FILES="ADD_FILES",e.ADD_FILES_AND_SET_LOADING_STATE="ADD_FILES_AND_SET_LOADING_STATE",e.SET_PATH="SET_PATH",e.SET_USER="SET_USER",e.SET_URL_PREFIX="SET_URL_PREFIX",e.SET_LOADING_STATE="SET_LOADING_STATE",e.SET_MOUNT_POINTS="SET_MOUNT_POINTS",e.SET_TEAM_FOLDERS="SET_TEAM_FOLDERS",e.CHANGE_FILES="CHANGE_FILES",e.SET_SELECTION="SET_SELECTION",e.SELECT_FILES_AFTER_UPLOAD="SELECT_FILES_AFTER_UPLOAD",e.SELECT_FILES_BY_FQ_PATH="SELECT_FILES_BY_FQ_PATH",e.SET_SHOULD_SHOW_DELETED_FILES="SET_SHOULD_SHOW_DELETED_FILES",e.SET_DROP_TARGET="SET_DROP_TARGET",e.SORT_FILES="SORT_FILES",e.SET_VIEW_TYPE="SET_VIEW_TYPE",e.SET_COPY_MODE="SET_COPY_MODE",e.COPY_FILES_TO_CLIPBOARD="COPY_FILES_TO_CLIPBOARD",e.REQUEST_NEW_FILE_NAME="REQUEST_NEW_FILE_NAME",e.CANCEL_FILE_RENAME="CANCEL_FILE_RENAME",e.SET_FILE_RENAME_PENDING="SET_FILE_RENAME_PENDING",e.SET_FILE_RENAME_COMPLETE="SET_FILE_RENAME_COMPLETE",e.REQUEST_FOLDER_NAME="REQUEST_FOLDER_NAME",e.CREATE_FOLDER_PENDING="CREATE_FOLDER_PENDING",e.CREATE_FOLDER_COMPLETE="CREATE_FOLDER_COMPLETE",e.CANCEL_CREATE_FOLDER="CANCEL_CREATE_FOLDER",e.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE="SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE",e.TEAM_FOLDER_DOWNGRADE="TEAM_FOLDER_DOWNGRADE",e.ADD_COMMENT_STATUS_BATCH="ADD_COMMENT_STATUS_BATCH",e.ADD_FILE_JUMP_KEY_CODE="ADD_FILE_JUMP_KEY_CODE",e.RESET_FILE_JUMP="RESET_FILE_JUMP",e.SET_ACTIVE_TAB="SET_ACTIVE_TAB",e.REQUEST_FETCH_FOLDER_SIZES="REQUEST_FETCH_FOLDER_SIZES",e.FETCHED_FOLDER_SIZES="FETCHED_FOLDER_SIZES",e.COMPLETE_FETCH_FOLDER_SIZES="COMPLETE_FETCH_FOLDER_SIZES",e.SET_VISIBLE_COLUMNS="SET_VISIBLE_COLUMNS",e.SET_VIEW_TYPE_COLUMNS="SET_VIEW_TYPE_COLUMNS"})(t.BrowseActionTypes||(t.BrowseActionTypes={})),t.NewFolderCreationStates={CREATE_FOLDER_INACTIVE:"CREATE_FOLDER_INACTIVE",PENDING_INPUT:"PENDING_INPUT",SAVING_INPUT:"SAVING_INPUT"},t.LoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_REMAINING_PAGES:"LOADING_REMAINING_PAGES"},t.Direction={UP:"UP",DOWN:"DOWN"},t.BROWSE_FILE_VIEWER_ELEMENT_ID="browse-react-file-viewer-container",t.ELEMENTS_BEHIND_FILE_VIEWER=[".maestro-chrome","#maestro-nav","#page-footer","#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),t.BrowseSortFields={FILENAME:"FILENAME",MODIFIED:"MODIFIED",CATEGORY:"CATEGORY",EXTENSION:"EXTENSION",SIZE:"SIZE",SHARED_WITH:"SHARED_WITH"},t.SortDirections={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},t.DropTargetHighlightMode={NONE:"NONE",ALL_FOLDERS:"ALL_FOLDERS",NONSELECTED_FOLDERS:"NONSELECTED_FOLDERS",NONSELECTED_NONSHARED_FOLDERS:"NONSELECTED_NONSHARED_FOLDERS",NONSELECTED_NONSHARED_NONTEAM_FOLDERS:"NONSELECTED_NONSHARED_NONTEAM_FOLDERS"};var s={IMAGE:["bmp","cr2","gif","ico","jpeg","jpg","nef","png","psd","tif","tiff","svg","svgz"],VIDEO:["3gp","3gpp","3gpp2","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpeg","mpg","mts","ts","vob","wmv"],AUDIO:["aif","flac","m4a","m4p","mp3","ogg","wav","wma"],DOCUMENT:["ai","cdr","csv","doc","docx","docm","eps","fla","indd","keynote","numbers","otf","pages","pdf","ppt","pptx","pptm","pps","ppsx","ppsm","ps","rtf","swf","txt","wpd","xls","xlsx","xlsm"],COMPRESSED_FILE:["7z","bz2","gz","gzip","rar","tar","zip"],CODE:["as","as3","asm","aspx","bat","c","cc","cmake","coffee","cpp","cs","css","cxx","diff","erb","erl","groovy","gry","h","haml","hh","hpp","html","htm","hxx","java","js","json","jsx","less","lst","m","make","mk","ml","mm","msg","out","patch","php","pl","pm","plist","properties","py","rb","sass","scala","scm","script","scss","sh","sml","sql","vb","vi","vim","xhtml","xml","xsd","xsl","y","yaml","yml","yxx"],DISK_IMAGE:["dmg","iso"],EXECUTABLE:["exe"],SHORTCUT:["lnk"],LINK:["url","webloc"],FONT:["ttf"]};t.BrowseTileGridConstants={NUM_THRESHOLD_ROWS:10,SCROLL_DELTA_THRESHOLD:1},t.CulledListConstants={ITEM_ROW_HEIGHT_PX:46,MAESTRO_ITEM_ROW_HEIGHT_PX:57,SEARCH_ROW_HEIGHT_PX:53,MAESTRO_SEARCH_ROW_HEIGHT_PX:66,DEFAULT_HEADER_HEIGHT_PX:142,ITEM_BUFFER_SIZE:5},t.ItemTypes={CREATE_FOLDER_UI:"CreateFolderUI",LOADING_INDICATOR:"LoadingIndicator"},t.FileTypeCategoryTranslations={FILE:r._("File"),FOLDER:r._("Folder"),SHARED_FOLDER:r._("Shared folder"),TEAM_SHARED_FOLDER:r._("Team folder"),TEAM_MEMBER_FOLDER:r._("Member folder"),PUBLIC_FOLDER:r._("Folder"),IMAGE:r._("Image"),VIDEO:r._("Video"),AUDIO:r._("Audio"),DOCUMENT:r._("Document"),COMPRESSED_FILE:r._("Archive"),CODE:r._("Code"),DISK_IMAGE:r._("Disk image"),EXECUTABLE:r._("Executable"),SHORTCUT:r._("Shortcut"),LINK:r._("Link"),FONT:r._("Font"),SANDBOX:r._("App folder")},t.FileTypeCapitalizedCategoryTranslations={FILE:r._("FILE"),FOLDER:r._("FOLDER"),SHARED_FOLDER:r._("SHARED FOLDER"),TEAM_SHARED_FOLDER:r._("TEAM FOLDER"),TEAM_MEMBER_FOLDER:r._("MEMBER FOLDER"),PUBLIC_FOLDER:r._("FOLDER"),IMAGE:r._("IMAGE"),VIDEO:r._("VIDEO"),AUDIO:r._("AUDIO"),DOCUMENT:r._("DOCUMENT"),COMPRESSED_FILE:r._("ARCHIVE"),CODE:r._("CODE"),DISK_IMAGE:r._("DISK IMAGE"),EXECUTABLE:r._("EXECUTABLE"),SHORTCUT:r._("SHORTCUT"),LINK:r._("LINK"),FONT:r._("FONT"),SANDBOX:r._("APP FOLDER")},t.DeletedFileTypeCategoryTranslations={FILE:r._("Deleted file"),FOLDER:r._("Deleted folder"),SHARED_FOLDER:r._("Deleted shared folder"),TEAM_SHARED_FOLDER:r._("Deleted team folder"),TEAM_MEMBER_FOLDER:r._("Deleted member folder"),PUBLIC_FOLDER:r._("Deleted folder"),IMAGE:r._("Deleted image"),VIDEO:r._("Deleted video"),AUDIO:r._("Deleted audio"),DOCUMENT:r._("Deleted document"),COMPRESSED_FILE:r._("Deleted archive"),CODE:r._("Deleted code"),DISK_IMAGE:r._("Deleted disk image"),EXECUTABLE:r._("Deleted executable"),SHORTCUT:r._("Deleted shortcut"),LINK:r._("Deleted link"),FONT:r._("Deleted font"),SANDBOX:r._("Deleted app folder")},t.DeletedFileTypeCapitalizedCategoryTranslations={FILE:r._("DELETED FILE"),FOLDER:r._("DELETED FOLDER"),SHARED_FOLDER:r._("DELETED SHARED FOLDER"),TEAM_SHARED_FOLDER:r._("DELETED TEAM FOLDER"),TEAM_MEMBER_FOLDER:r._("DELETED MEMBER FOLDER"),PUBLIC_FOLDER:r._("DELETED FOLDER"),IMAGE:r._("DELETED IMAGE"),VIDEO:r._("DELETED VIDEO"),AUDIO:r._("DELETED AUDIO"),DOCUMENT:r._("DELETED DOCUMENT"),COMPRESSED_FILE:r._("DELETED ARCHIVE"),CODE:r._("DELETED CODE"),DISK_IMAGE:r._("DELETED DISK IMAGE"),EXECUTABLE:r._("DELETED EXECUTABLE"),SHORTCUT:r._("DELETED SHORTCUT"),LINK:r._("DELETED LINK"),FONT:r._("DELETED FONT"),SANDBOX:r._("DELETED APP FOLDER")},t.ExtensionCategories={};for(var a=0,n=Object.keys(s);a<n.length;a++)for(var o=n[a],i=s[o],c=0,_=i;c<_.length;c++){var h=_[c];t.ExtensionCategories[h]=o}t.RenameStates={PENDING_INPUT:"pending-input",SAVING_INPUT:"saving-input"};(function(e){e[e.NONE=-1]="NONE",e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT"})(t.MouseEventButton||(t.MouseEventButton={}));(function(e){e[e.ShareExisting=1]="ShareExisting",e[e.EditShared=2]="EditShared",e[e.EditSharedSubFolder=3]="EditSharedSubFolder"})(t.ShareFolderModalTypes||(t.ShareFolderModalTypes={}));(function(e){e.SET_SHARED_FOLDER_DATA="SET_SHARED_FOLDER_DATA",e.SET_MEMBER_COUNTS_FOR_NS="SET_MEMBER_COUNTS_FOR_NS",e.SET_SHARED_LINK_DATA="SET_SHARED_LINK_DATA",e.SET_SHARED_FILE_DATA="SET_SHARED_FILE_DATA",e.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE="SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE",e.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE="SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE",e.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE="SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE",e.CLEAR_SHARED_FOLDER_DATA_FOR_NS="CLEAR_SHARED_FOLDER_DATA_FOR_NS",e.REMOVE_SHARED_LINK_DATA="REMOVE_SHARED_LINK_DATA"})(t.SharedWithActionTypes||(t.SharedWithActionTypes={})),t.SEARCH_PREFIX="/search",t.ViewTypes={Grid:"GRID_VIEW",List:"LIST_VIEW"},t.FetchFolderSizeStates={LOADING:"LOADING",COMPLETE:"COMPLETE",NO_ACCESS:"NO_ACCESS",ERROR:"ERROR"},t.MAX_FOLDERS_PER_CALL=100,t.MAX_FOLDER_SIZE_QUEUE_SIZE=50,t.MAX_FOLDER_SIZE_ITERATIONS=1e3,t.CloudContentDocuments={GOOGLE_DOC:"gdoc",GOOGLE_SHEET:"gsheet",GOOGLE_SLIDE:"gslide",PAPER:"paper"},t.VIEW_TYPE_COOKIE_NAME="browse_view_type",t.COLUMNS_STORAGE_KEY="browse_columns",t.CURRENT_SORT_STORAGE_KEY="browse_current_sort"}),define("modules/clean/react/browse/models",["require","exports","tslib","modules/clean/immutability_helper","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/constants","modules/clean/sharing/access_level","modules/constants/legacy","modules/clean/display_format"],function(e,t,r,s,a,n,o,i,c,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(){function e(e){this.ago=e.ago,this.beacon_context=e.beacon_context,this.bytes=e.bytes,this.comment_count=e.comment_count,this.direct_blockserver_link=e.direct_blockserver_link,this.event_type=e.event_type,this.ext=e.ext,this.feedback_off=e.feedback_off,this.file_id=e.file_id,this.filename_highlights=e.filename_highlights,this.fq_path=e.fq_path,this.href=e.href,this.htmlified_link=e.htmlified_link,this.icon=e.icon,this.is_camera_uploads=e.is_camera_uploads,this.is_confidential_folder=e.is_confidential_folder,this.is_cloud_content=e.is_cloud_content,this.is_dir=e.is_dir,this.is_in_team_folder_tree=e.is_in_team_folder_tree,this.is_public_folder=e.is_public_folder,this.is_unmounted=e.is_unmounted,this.last_modified_fname=e.last_modified_fname,this.last_modified_name=e.last_modified_name,this.latest_rev=e.latest_rev,this.linkfile_data=e.linkfile_data,this.match_type=e.match_type,this._mount_access_perms=e._mount_access_perms,this.ns_id=e.ns_id,this.ns_path=e.ns_path,this.preview_type=e.preview_type,this.preview_url=e.preview_url,this.preview_thumbnail_url=e.preview_thumbnail_url,this.read_only=!!e.read_only,this.request_id=e.request_id,this.revision_id=e.revision_id,this.size=e.size,this.sjid=e.sjid,this.sort_key=e.sort_key,this.sort_rank=e.sort_rank,this.target_ns=e.target_ns,this.team_folder_status=e.team_folder_status,this.thumbnail_url_tmpl=e.thumbnail_url_tmpl,this.ts=e.ts,this.type=e.type,this.unresolved_comment_count=e.unresolved_comment_count,this.video_metadata_url=e.video_metadata_url,this.video_container=e.video_container,this.video_transcode_url=e.video_transcode_url,this.preview_ssr_text_url_tmpl=e.preview_ssr_text_url_tmpl,this.preview_ssr_image_url_tmpl=e.preview_ssr_image_url_tmpl,this.preview_ssr_refresh_url=e.preview_ssr_refresh_url,this.isDeleted=!!e.isDeleted,this.fetchFolderSizesStatus=e.fetchFolderSizesStatus}return e.fromServerObject=function(t){return new e(r.__assign({},t,{_mount_access_perms:t.mount_access_perms,isDeleted:t.bytes===-1}))},e.prototype.set=function(e,t){return s.set(this,e,t)},e.prototype.merge=function(e){return s.merge(this,e)},e.prototype.toJS=function(){return Object.assign({},this)},e.getExtension=function(e){return e.is_dir?"":a.file_extension(a.filename(e.fq_path))},e.getCategoryDescription=function(t,r){void 0===r&&(r=!1);var s;if(t.is_dir)switch(s="FOLDER",t.type){case n.FileTypes.TEAM_SHARED_FOLDER:s="TEAM_SHARED_FOLDER";break;case n.FileTypes.SHARED_FOLDER:s="SHARED_FOLDER";break;case n.FileTypes.SANDBOX:s="SANDBOX";break;case n.FileTypes.TEAM_MEMBER_FOLDER:s="TEAM_MEMBER_FOLDER";break;default:t.target_ns&&(s="SHARED_FOLDER")}else s=o.ExtensionCategories[e.getExtension(t)]||"FILE";return t.isDeleted?r?o.DeletedFileTypeCapitalizedCategoryTranslations[s]:o.DeletedFileTypeCategoryTranslations[s]:r?o.FileTypeCapitalizedCategoryTranslations[s]:o.FileTypeCategoryTranslations[s]},e.isTeamSharedFolder=function(e){return e.type===n.FileTypes.TEAM_SHARED_FOLDER},e.isTeamMemberFolder=function(e){return e.type===n.FileTypes.TEAM_MEMBER_FOLDER},e.isReadOnlySharedFolder=function(e){var t=e._mount_access_perms;return null!=t&&!t.includes("can_edit")},e.isNoAccessSharedFolder=function(e){var t=e._mount_access_perms;return null!=t&&!t.includes("can_view")},e.canViewFileMembers=function(e,t){var r=e._mount_access_perms;return!(r&&r.indexOf("can_view_members")<0)&&(!(t&&!t.canViewContainingNSMembers)||!!(r&&r.indexOf("can_view_members")>=0))},e.areEqual=function(e,t){return e.ns_id===t.ns_id&&e.sjid===t.sjid},e.revisionKey=function(e){return e.ns_id+":"+e.sjid},e.prototype.updateSize=function(e,t){return this.merge({bytes:e,size:_.format_bytes(e),fetchFolderSizesStatus:t})},e})();t.File=h;var l=(function(){function e(e){void 0===e&&(e={}),this.isPublicFolderEnabled=!!e.isPublicFolderEnabled,this.publicFolderFqPath=e.publicFolderFqPath,this.publicAppToken=e.publicAppToken,Object.freeze(this)}return e.fromServerObject=function(t){return new e({isPublicFolderEnabled:t.public_folder_enabled,publicFolderFqPath:t.public_folder_fq_path,publicAppToken:t.public_app_token})},e.prototype.set=function(e,t){return s.set(this,e,t)},e.prototype.toJSON=function(){return Object.assign({},this)},e.prototype.toJS=function(){return this.toJSON()},e})();t.Config=l;var u=(function(){function e(e){var t=void 0===e?{}:e,r=t.canViewContainingNSMembers,s=t.currentNSID,a=t.currentFQPath,n=t.currentMountPoint,o=t.currentNSPath,_=t.currentSharedFolderPermissionRole,h=t.currentNSAllowsNesting,u=t.inactiveNSIDByFQPath,p=t.permanentDeletionDisabledStateByNSID,d=t.isInFolderMode,E=t.isCurrentlyInRoot,S=t.isInsideSharedFolder,m=t.isInsideTeamFolderRoot,f=t.isInsideArchivedTeamFolder,T=t.isInsideTeamFolderTree,R=t.isInsideDeletedFolder,A=t.isInsideDeletedSharedFolder,O=t.isInsideDeletedNestedSharedFolder,C=t.isNonUserRelativeContext,I=t.pathRoot,g=t.rootNSID,D=t.showSharedFolderCreateTeamPromo,y=t.showPinnedTeamFolder,L=t.teamFolderOwnerTeamApiId,N=t.blockHash,v=t.config;this.canViewContainingNSMembers=null==r||r,this.currentNSID=s||c.root_ns_id,this.currentFQPath=a||"",this.currentMountPoint=n,this.currentNSPath=o,this.currentSharedFolderPermissionRole=null!=_?_:i.NameSpaceAccess.ACCESS_NO_ACCESS,this.currentNSAllowsNesting=!!h,this.inactiveNSIDByFQPath=u||{},this.permanentDeletionDisabledStateByNSID=p||{},this.isInFolderMode=null==d||d,this.isCurrentlyInRoot=!!E,this.isInsideSharedFolder=!!S,this.isInsideTeamFolderRoot=!!m,this.isInsideArchivedTeamFolder=!!f,this.isInsideTeamFolderTree=!!T,this.isInsideDeletedFolder=!!R,this.isInsideDeletedSharedFolder=!!A,this.isInsideDeletedNestedSharedFolder=!!O,this.isNonUserRelativeContext=!!C,this.pathRoot=I,this.rootNSID=g,this.showSharedFolderCreateTeamPromo=!!D,this.showPinnedTeamFolder=!!y,this.teamFolderOwnerTeamApiId=L,this.blockHash=N,this.config=v||new l}return e.fromServerObject=function(t){var r=t.containing_fq_path||"";r.startsWith("/")||(r="/"+r);var s;t.inside_shared_folder&&(s=i.NameSpaceAccess.ACCESS_READER);var a,n=t.containing_ns_permissions||[],o=n.includes("mount_shared_folders");return t.inside_shared_folder&&(n.includes("edit_contents")&&(s=i.NameSpaceAccess.ACCESS_WRITER),n.includes("change_folder_options")&&(s=i.NameSpaceAccess.ACCESS_OWNER),n.includes("view_members")||(a=!1)),new e({blockHash:t.block_hash,canViewContainingNSMembers:a,config:l.fromServerObject(t),currentFQPath:r,currentMountPoint:t.containing_mount_point,currentNSAllowsNesting:o,currentNSID:t.containing_ns_id,currentNSPath:t.containing_ns_path,currentSharedFolderPermissionRole:s,inactiveNSIDByFQPath:t.old_path_to_ns_id,isCurrentlyInRoot:t.in_root_dir,isInFolderMode:t.inside_dir,isInsideArchivedTeamFolder:t.inside_archived_team_folder,isInsideTeamFolderRoot:t.inside_team_folder_root,isInsideDeletedFolder:t.inside_deleted_dir,isInsideDeletedNestedSharedFolder:t.inside_deleted_nested_shared_folder,isInsideDeletedSharedFolder:t.inside_deleted_shared_folder,isInsideSharedFolder:t.inside_shared_folder,isInsideTeamFolderTree:t.inside_team_folder_tree,isNonUserRelativeContext:t.is_non_user_relative_context,pathRoot:t.path_root,permanentDeletionDisabledStateByNSID:t.permanent_delete_is_disabled_by_ns_id,rootNSID:t.root_ns_id,showPinnedTeamFolder:t.show_pinned_team_folder,showSharedFolderCreateTeamPromo:t.show_shared_folder_create_team_promo,teamFolderOwnerTeamApiId:t.team_folder_owner_team_dbtid})},e.prototype.set=function(e,t){return s.set(this,e,t)},e.prototype.toJSON=function(){return Object.assign({},this)},e.prototype.toJS=function(){return this.toJSON()},e.prototype.isCurrentPathWriteable=function(){var e=this,t=e.currentSharedFolderPermissionRole;return!e.isInsideSharedFolder||t===i.NameSpaceAccess.ACCESS_WRITER||t===i.NameSpaceAccess.ACCESS_OWNER},e.prototype.getNameOfTargetFolder=function(){return a.filename(this.currentFQPath)},e})();t.BrowseContext=u;var p=(function(){function e(e){this.title=e.title,this.pad_id=e.pad_id,this.url=e.url,this.title_highlights=e.title_highlights,this.highlight_spans=e.highlight_spans,this.creator_name=e.creator_name,this.last_modified_date=e.last_modified_date,this.request_id=e.request_id,this.sort_rank=e.sort_rank}return e.fromServerObject=function(t){return new e(t)},e})();t.Paper=p}),define("modules/clean/react/maestro/a11y_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.TITLE=0]="TITLE",e[e.SEARCH_BAR=1]="SEARCH_BAR",e[e.NOTIFICATION_BELL=2]="NOTIFICATION_BELL",e[e.CALENDAR_FLYOUT=3]="CALENDAR_FLYOUT",e[e.ACCOUNT_MENU=4]="ACCOUNT_MENU",e[e.MAIN_CONTENT=5]="MAIN_CONTENT",e[e.SIDE_BAR=6]="SIDE_BAR"})(t.LAYOUT_TAB_ORDER||(t.LAYOUT_TAB_ORDER={}))}),define("modules/clean/react/maestro/header",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/maestro/top_menu_container","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/maestro/a11y_constants","modules/clean/react/maestro/responsive","external/classnames"],function(e,t,r,s,a,n,o,i,c,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return s.createElement("header",{className:"maestro-header page-header__shadow"},s.createElement(c.VerticallyFixedWrapper,{className:"page-header",responsive:this.props.responsive},s.createElement("div",{className:_("page-header__title",this.props.titleClass),tabIndex:i.LAYOUT_TAB_ORDER.TITLE},this.props.title),s.createElement(n.TopMenuContainer,r.__assign({},this.props))))},t.defaultProps={showSearchBar:!0,isSearchBarExpanded:!1},t})(s.Component),l=function(e){var t=e.children;return s.createElement("h1",{className:"page-header__heading"},t)};t.MaestroHeaderTitle=l;var u=function(){return s.createElement("a",{href:"/",className:"page-header__logo"},s.createElement(o.DropboxLogo,{alt:"Dropbox"}))};t.MaestroHeaderLogo=u;var p=a(h,["/static/css/maestro_layout-vflG_TI8J.css"]);t.PageletMaestroHeader=p}),define("modules/clean/react/maestro/layout",["require","exports","tslib","external/react","external/spectrum/match","modules/clean/react/maestro/header","modules/clean/react/maestro/secondary_sidebar","modules/clean/react/maestro/a11y_constants","modules/clean/react/maestro/responsive"],function(e,t,r,s,a,n,o,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var r=e.call(this,t)||this;r.isPageResponsive=function(){return!(!document||!document.documentElement)&&document.documentElement.classList.contains(c.RESPONSIVE_CLASS)},r.handleMatchMedium=function(){r.setState({isMatchedMedium:!0})},r.handleUnmatchMedium=function(){r.setState({isMatchedMedium:!1})},r.handleMatchLarge=function(){r.setState({isMatchedLarge:!0})},r.handleUnmatchLarge=function(){r.setState({isMatchedLarge:!1})};var s=r.isPageResponsive();return r.state={isResponsive:s,isMatchedMedium:!s,isMatchedLarge:!s},r}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,_=e.titleRegion,h=e.titleClass,l=e.embeddedAppRegion,u=e.actionSidebarRegion,p=e.searchBarProps,d=r.__assign({},this.state),E=null;return null!=u&&(E=s.createElement("div",{className:"maestro-secondary-sidebar__shadow",tabIndex:i.LAYOUT_TAB_ORDER.SIDE_BAR},s.createElement(o.MaestroSecondarySidebar,{responsive:d},"function"==typeof u?u(d):u))),s.createElement("div",{className:"maestro-chrome"},d&&d.isResponsive&&s.createElement(a.Match,{media:c.BREAKPOINT_LARGE,onMatch:this.handleMatchLarge,onUnmatch:this.handleUnmatchLarge}),d&&d.isResponsive&&s.createElement(a.Match,{media:c.BREAKPOINT_MEDIUM,onMatch:this.handleMatchMedium,onUnmatch:this.handleUnmatchMedium}),s.createElement(n.PageletMaestroHeader,r.__assign({user:t,title:_,titleClass:h,responsive:d},p||{})),s.createElement("main",{className:"maestro-app"},s.createElement("div",{className:"maestro-app-content",tabIndex:i.LAYOUT_TAB_ORDER.MAIN_CONTENT},"function"==typeof l?l(d):l),E))},t})(s.PureComponent);t.MaestroChrome=_}),define("modules/clean/react/maestro/responsive",["require","exports","tslib","external/react","external/spectrum/vertically_fixed"],function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSIVE_CLASS="maestro--responsive",t.BREAKPOINT_MEDIUM="(min-width: 736px)",t.BREAKPOINT_LARGE="(min-width: 1025px)";var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.responsive,n=r.__rest(e,["responsive"]),o=t&&t.isResponsive?"div":a.VerticallyFixed;return s.createElement(o,n)},t.displayName="VerticallyFixedWrapper",t})(s.Component);t.VerticallyFixedWrapper=n}),define("modules/clean/react/maestro/secondary_sidebar",["require","exports","tslib","external/react","modules/clean/react/maestro/responsive","modules/clean/react/prompt/legacy_ha_wrapper"],function(e,t,r,s,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return s.createElement(a.VerticallyFixedWrapper,{responsive:this.props.responsive,className:"maestro-secondary-sidebar"},this.props.children,s.createElement(n.LegacyHAWrapper,null))},t})(s.Component);t.MaestroSecondarySidebar=o}),define("modules/clean/react/maestro/top_menu_container",["require","exports","tslib","external/react","modules/clean/browse_interface","modules/clean/filepath","modules/clean/react/browse/models","modules/core/browser","modules/clean/search/search_bar/controller","modules/clean/search/search_helpers","modules/core/uri","modules/clean/react/css"],function(e,t,r,s,a,n,o,i,c,_,h,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSearch=function(e,r,s){var a=new h({path:"/search/"+t.props.user.role});e&&i.redirect(a.updateQuery({path:t.props.currentPath,query:e,qsid:s,search_token:r}).toString())},t.onSearchResultOpen=function(e){if(e instanceof o.File)if(_.logSearchAction({result:e,user:t.props.user,action_type:e.is_dir?"folder_open":"file_view",viewport:"top-menu-dropdown-view"}),e.is_dir)i.open_tab(e.href);else{var r=e.fq_path.substring(1),s=new h({path:"/"+t.props.user.role}).updateQuery({preview:r});i.open_tab(s.toString())}else e instanceof o.Paper&&(_.logSearchAction({result:e,user:t.props.user,action_type:"paper_open",viewport:"top-menu-dropdown-view"}),i.open_tab(e.url))},t.onResultObjectPathClick=function(e){_.logSearchAction({result:e,user:t.props.user,action_type:"click_path_link",viewport:"dropdown-view"});var r=n.parent_dir(e.fq_path),s=a.browse_uri_for_fq_path(t.props.user,r||"").toString();i.open_tab(s)},t}return r.__extends(t,e),t.prototype.renderSearchBar=function(){return this.props.showSearchBar?s.createElement(c.SearchBarController,{user:this.props.user,currentPath:this.props.currentPath,isExpanded:this.props.isSearchBarExpanded,onSearch:this.props.onSearch||this.onSearch,onCancelSearch:this.props.onCancelSearch,onSearchResultOpen:this.props.onSearchResultOpen||this.onSearchResultOpen,onResultObjectPathClick:this.props.onResultObjectPathClick||this.onResultObjectPathClick,searchBarExperiments:this.props.searchBarExperiments||{}}):null},t.prototype.renderRightContent=function(){return this.props.rightContent?this.props.rightContent:s.createElement("div",{className:"top-menu-container--search-bar-empty-space"})},t.prototype.render=function(){return s.createElement("div",{className:"top-menu-container "+this.props.classNames},this.renderSearchBar(),this.renderRightContent())},t.defaultProps={showSearchBar:!0,isSearchBarExpanded:!1,classNames:"",currentPath:"/"},t})(s.Component);t.TopMenuContainer=l(u,["/static/css/pagelet-vflBp79rc.css"],[c.SearchBarController])}),define("modules/clean/react/prompt/legacy_ha_wrapper",["require","exports","tslib","external/react","modules/clean/upsell/prompt_event_emitter"],function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.emitUpdateEvent=function(){a.Emitter.emit(a.Events.REACT_HA_DID_UPDATE)},t.prototype.componentDidMount=function(){t.emitUpdateEvent()},t.prototype.componentDidUpdate=function(){t.emitUpdateEvent()},t.prototype.render=function(){return s.createElement("div",null)},t.displayName="LegacyHAWrapper",t})(s.Component);t.LegacyHAWrapper=n}),define("modules/clean/search/api_helpers",["require","exports"],function(e,t){"use strict";function r(){return(new Date).getTimezoneOffset()}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTimezoneOffset=r}),define("modules/clean/search/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},t.FOCUS_SEARCH_BAR_ACTION="search__FOCUS_SEARCH_BAR",t.BLUR_SEARCH_BAR_ACTION="search__BLUR_SEARCH_BAR",t.SET_SEARCH_QUERY_ACTION="search__SET_SEARCH_QUERY",t.SET_SEARCH_SUGGESTIONS_ACTION="search__SET_SEARCH_SUGGESTIONS",t.SET_HAS_MORE_RESULTS_ACTION="search__SET_HAS_MORE_RESULTS",t.SET_SLIM_SEARCH_SUGGESTIONS_ACTION="search__SET_SLIM_SEARCH_SUGGESTIONS",t.SET_HIGHLIGHTED_ROW_ACTION="search__SET_HIGHLIGHTED_ROW",t.HIGHLIGHT_PREVIOUS_ROW_ACTION="search__HIGHLIGHT_PREVIOUS_ROW",t.HIGHLIGHT_NEXT_ROW_ACTION="search__HIGHLIGHT_NEXT_ROW",t.CLEAR_SEARCH_BAR_ACTION="search__CLEAR_SEARCH_BAR",t.SEARCH_SUCCESSFUL_ACTION="search__SEARCH_SUCCESSFUL",t.SET_USER_ACTION="search__SET_USER",t.START_SEARCH_ACTION="search__START_SEARCH",t.SET_SEARCH_RESULTS_ACTION="search__SET_SEARCH_RESULTS",t.CONTINUE_SEARCH_ACTION="search__CONTINUE_SEARCH",t.APPEND_SEARCH_RESULTS_ACTION="search__APPEND_SEARCH_RESULTS",t.CLEAR_SEARCH_ACTION="search__CLEAR_SEARCH",t.SET_SEARCH_SELECTION_ACTION="search__SET_SEARCH_SELECTION",t.CHANGE_FILES_ACTION="search__CHANGE_SEARCH_FILES",t.SET_SCOPE_CHIP_ACTION="search__SET_SCOPE_CHIP_ACTION",t.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},t.SEARCH_RECENT_HISTORY_CAPACITY=5,
t.SEARCH_RECENT_HISTORY_STORAGE_KEY="search_recent_history"}),define("modules/clean/search/logger",["require","exports","tslib","modules/clean/analytics","modules/clean/search/api_helpers"],function(e,t,r,s,a){"use strict";function n(e){var t=e.searchSessionId,n=e.result,c=e.user,_=e.action_type,h=e.viewport,l=void 0===h?"full-view":h,u=e.view_type,p=a.getCurrentTimezoneOffset(),d={viewport:l,action_type:_,search_session_id:t,view_type:u,position:n.sort_rank,request_id:n.request_id,timezone_offset:p};if(o(n)){var E=n;d=r.__assign({},d,{file_nsid:E.ns_id,file_sjid:E.sjid,match_type:E.match_type})}else if(i(n)){var S=n;d=r.__assign({},d,{paper_pad_id:S.pad_id,position:S.sort_rank,request_id:S.request_id})}s.SearchClientActivityLogger.log("result_action",c.id,d)}function o(e){return void 0!==e.ns_id}function i(e){return void 0!==e.pad_id}function c(e){var t=e.searchSessionId,r=e.user,n=e.history,o=a.getCurrentTimezoneOffset(),i=n.map(function(e){return e.rawQuery}).reduce(function(e,t,r){return e[r]=t,e},{}),c={search_session_id:t,recent_history_map:JSON.stringify(i),timezone_offset:o};s.SearchClientActivityLogger.log("recent_history_displayed",r.id,c)}function _(e){var t=e.searchSessionId,r=e.query,n=e.user,o=e.rank,i=a.getCurrentTimezoneOffset(),c={search_session_id:t,query_string:r.rawQuery,position:o,timezone_offset:i};s.SearchClientActivityLogger.log("recent_query_selected",n.id,c)}function h(e){var t=e.searchSessionId,r=e.query,n=e.user,o=e.previousPosition,i=a.getCurrentTimezoneOffset(),c={search_session_id:t,query_string:r.rawQuery,position:o,timezone_offset:i};s.SearchClientActivityLogger.log("recent_query_stored",n.id,c)}Object.defineProperty(t,"__esModule",{value:!0}),t.logSearchAction=n,t.logRecentHistoryDisplayed=c,t.logRecentQuerySelected=_,t.logRecentQueryStored=h}),define("modules/clean/search/models",["require","exports","external/deep-freeze","modules/clean/react/browse/models"],function(e,t,r,s){"use strict";function a(e){return new s.BrowseContext({isInFolderMode:e.inside_dir,inactiveNSIDByFQPath:e.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:e.permanent_delete_is_disabled_by_ns_id,blockHash:e.block_hash})}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.fq_path=e.fq_path,this.is_unmounted=e.is_unmounted,this.icon=e.icon,this.filename_highlights=e.filename_highlights,this.highlight_spans=e.highlight_spans,this.ns_id=e.ns_id,this.sjid=e.sjid,this.is_dir=e.is_dir,this.type=e.type,this.match_type=e.match_type,this._mount_access_perms=e.mount_access_perms,this.request_id=e.request_id,this.sort_rank=e.sort_rank,r(this)}return e.fromServerObject=function(t){return new e(t)},e})();t.SlimFileSearchResult=n,t.extractBrowseContext=a}),define("modules/clean/search/search_bar/actions",["require","exports","modules/clean/search/constants","modules/clean/search/search_bar/dispatcher","modules/clean/search/search_bar/store"],function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){void 0===e&&(e=a.searchBarStore),this._searchBarStore=e}return e.prototype.focusSearchBar=function(e){s.SearchBarDispatcher.dispatch({type:r.FOCUS_SEARCH_BAR_ACTION,data:{user:e}})},e.prototype.blurSearchBar=function(){s.SearchBarDispatcher.dispatch({type:r.BLUR_SEARCH_BAR_ACTION})},e.prototype.setSearchQuery=function(e){var t=e.query,a=e.qsid,n=e.keepHighlightedRow;s.SearchBarDispatcher.dispatch({type:r.SET_SEARCH_QUERY_ACTION,data:{query:t,qsid:a,keepHighlightedRow:n}})},e.prototype.setSearchSuggestions=function(e){var t=e.searchResults;s.SearchBarDispatcher.dispatch({type:r.SET_SEARCH_SUGGESTIONS_ACTION,data:{searchResults:t}})},e.prototype.setHasMoreResults=function(e){var t=e.hasMoreResults;s.SearchBarDispatcher.dispatch({type:r.SET_HAS_MORE_RESULTS_ACTION,data:{hasMoreResults:t}})},e.prototype.setSlimSearchSuggestions=function(e){var t=e.searchResults;s.SearchBarDispatcher.dispatch({type:r.SET_SLIM_SEARCH_SUGGESTIONS_ACTION,data:{searchResults:t}})},e.prototype.setHighlightedRow=function(e){var t=e.index;s.SearchBarDispatcher.dispatch({type:r.SET_HIGHLIGHTED_ROW_ACTION,data:{index:t}})},e.prototype.highlightPreviousRow=function(){s.SearchBarDispatcher.dispatch({type:r.HIGHLIGHT_PREVIOUS_ROW_ACTION})},e.prototype.highlightNextRow=function(){s.SearchBarDispatcher.dispatch({type:r.HIGHLIGHT_NEXT_ROW_ACTION})},e.prototype.clearSearch=function(){s.SearchBarDispatcher.dispatch({type:r.CLEAR_SEARCH_BAR_ACTION})},e.prototype.searchSuccessful=function(e,t){s.SearchBarDispatcher.dispatch({type:r.SEARCH_SUCCESSFUL_ACTION,data:{user:e,query:t}})},e.prototype.setScopeChip=function(e,t){s.SearchBarDispatcher.dispatch({type:r.SET_SCOPE_CHIP_ACTION,data:{scope:t,canScope:e}})},e})();t.SearchBarActions=n,t.searchBarActions=new n}),define("modules/clean/search/search_bar/api",["require","exports","tslib","modules/clean/ajax","modules/clean/filepath","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers"],function(e,t,r,s,a,n,o,i,c,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(){function e(){this._searchApiUrl="/search/dropdown_search",this._activeRequest=null}return e.prototype.getSearchApiUrl=function(){return this._searchApiUrl},e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype._extractSlimSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var a=s[r];switch(a.search_result_type){case i.SearchResultTypes.FILE:t.push(c.SlimFileSearchResult.fromServerObject(a));break;case i.SearchResultTypes.PAPER:t.push(o.Paper.fromServerObject(a))}}return t},e.prototype.loadSlimResults=function(e){var t=e.user,r=e.path,s=e.query,a=e.searchSessionID,n=e.webTimer,o=e.onSuccess,i=e.onError,c=_.getCurrentTimezoneOffset(),h={query:s,fq_path:r,timezone_offset:c};this._fetchSlimResults(h,t,a,o,i,n)},e.prototype.fetchAdditionalFileMetadata=function(e){var t=this,r=e.searchResults,a=e.user,n=e.onSuccess,o=e.onError,i=r.filter(function(e){return e instanceof c.SlimFileSearchResult}),_=i.map(function(e){return[e.ns_id,e.sjid]});_.length>0?s.WebRequest({url:"/search/search_metadata",data:{nsid_sjid_pairs:JSON.stringify(_)},dataType:"json",subject_user:a,success:function(e,s,a){n(t._mergeFullResultsIntoSlimResults(e.search_results,r))},error:function(e,t,r){"abort"!==t&&"function"==typeof o&&o(r)}}):n(r)},e.prototype._mergeFullResultsIntoSlimResults=function(e,t){for(var s=[],n=function(t){if(t instanceof c.SlimFileSearchResult){var n=e.find(function(e){return e.search_result_type===i.SearchResultTypes.FILE&&a.paths_are_equal(e.fq_path,t.fq_path)});n&&s.push(o.File.fromServerObject(r.__assign({},n,{request_id:t.request_id,sort_rank:t.sort_rank,match_type:t.match_type})))}else t instanceof o.Paper&&s.push(t)},_=0,h=t;_<h.length;_++){n(h[_])}return s},e.prototype._fetchSlimResults=function(e,t,r,a,o,i){var _,h=this;null!=this._activeRequest&&this._activeRequest.abort();var l={path_scoped:"/"!==e.fq_path,search_type:"dropdown",query_string:e.query,search_session_id:r,timezone_offset:e.timezone_offset};n.SearchClientActivityLogger.log("query_started",t.id,l);var u=(new Date).getTime();this._activeRequest=s.WebRequest({url:this._searchApiUrl,data:e,dataType:"json",subject_user:t,success:function(s,o,_){for(var p=c.extractBrowseContext(s),d=s.search_results,E=_.getResponseHeader("x-dropbox-request-id"),S=0,m=0,f=d;m<f.length;m++){var T=f[m];T.request_id=E,T.sort_rank=S++}var R=h._extractSlimSearchResultsList(d);a({context:p,searchResults:R,deleted:!1});var A=n.SearchClientActivityLogger.create_completion_log_dict(l,!1,E,u,e.query,R.length,null,r);n.SearchClientActivityLogger.log("query_completed",t.id,A),i&&i.end(E?E:void 0)},error:function(s,a,c){"abort"!==a&&"function"==typeof o&&o(c),_=s.getResponseHeader("x-dropbox-request-id");var h=n.SearchClientActivityLogger.create_completion_log_dict(l,null,_,u,e.query,null,a,r);n.SearchClientActivityLogger.log("query_failed",t.id,h),i&&i.abort()},complete:function(){this._activeRequest=null}})},e})();t.SearchBarApiClient=h,t.searchBarApiClient=new h}),define("modules/clean/search/search_bar/api_actions",["require","exports","modules/clean/search/search_bar/store","modules/clean/search/search_bar/actions","modules/clean/search/search_bar/api"],function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){void 0===e&&(e=a.searchBarApiClient),void 0===t&&(t=r.searchBarStore),void 0===n&&(n=s.searchBarActions),this._searchBarApiClient=e,this._searchBarStore=t,this._searchBarActions=n}return e.prototype.setSearchQuery=function(e){var t=this,r=e.user,s=e.path,a=e.query,n=e.webTimer,o=e.qsid,i=e.forceUpdate,c=e.retainHighlight,_=this._searchBarStore;if(i||a!==_.rawQuery()){var h=!!c;this._searchBarActions.setSearchQuery({query:a,qsid:o,keepHighlightedRow:h}),_.isSearchBarLoading()&&this._searchBarApiClient.loadSlimResults({user:r,path:s,query:_.normalizedQuery(),searchSessionID:_.searchSessionID(),webTimer:n,onSuccess:function(e){var s=e.searchResults;a===_.rawQuery()&&(t._searchBarActions.setSlimSearchSuggestions({searchResults:s}),t._searchBarApiClient.fetchAdditionalFileMetadata({searchResults:s,user:r,onSuccess:function(e){a===_.rawQuery()&&t._searchBarActions.setSearchSuggestions({searchResults:e})}}))}})}},e})();t.SearchBarApiActions=n,t.searchBarApiActions=new n}),define("modules/clean/search/search_bar/chips",["require","exports","modules/clean/search/search_bar/actions","modules/clean/search/types","modules/clean/search/search_bar/store","modules/clean/filepath"],function(e,t,r,s,a,n){"use strict";function o(e){return!!e&&!n.paths_are_equal(n.normalize(e),"/")}function i(e){return e.expSearchChips===s.SearchChipsVariants.CHIP_IN}function c(e){return e.expSearchChips===s.SearchChipsVariants.CHIP_OUT}function _(e){return h(e)&&o(a.searchBarStore.browseScope())}function h(e){return c(e)||i(e)}function l(e){h(e)&&r.searchBarActions.setScopeChip(!0,a.searchBarStore.browseScope())}function u(e){h(e)&&r.searchBarActions.setScopeChip(!0)}function p(e,t){if(h(t)){var s=o(e);o(e)&&i(t)?r.searchBarActions.setScopeChip(s,e):r.searchBarActions.setScopeChip(s)}}function d(e){if(o(e))return n.filename(e)}function E(e){return e&&h(e)?a.searchBarStore.scopeChip():a.searchBarStore.browseScope()}Object.defineProperty(t,"__esModule",{value:!0}),t.isValidPathForChip=o,t.canScopeCurrentPath=_,t.chipsEnabled=h,t.setScopeChip=l,t.removeScopeChip=u,t.handleScopeChange=p,t.formatScopeChip=d,t.getSearchPathForChips=E}),define("modules/clean/search/search_bar/controller",["require","exports","tslib","external/react","modules/clean/react/browse/models","modules/clean/keycode","modules/clean/search/search_bar/api_actions","modules/clean/search/search_bar/actions","modules/clean/search/search_bar/api","modules/clean/search/search_helpers","modules/clean/search/types","modules/clean/search/search_bar/store","modules/core/notify","modules/clean/search/search_bar/view","modules/clean/react/css","modules/clean/web_timing_logger","modules/clean/storage","modules/clean/viewer","modules/clean/search/search_bar/chips","modules/clean/search/logger"],function(e,t,r,s,a,n,o,i,c,_,h,l,u,p,d,E,S,m,f,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R=(function(e){function t(t){var r=e.call(this,t)||this;return r._searchBarWebTimer=null,r._onSearchStoreChanged=function(){r.setState(r._getStateFromStore())},r._handleRecentSearchQuerySelected=function(e,t){T.logRecentQuerySelected({searchSessionId:r.state.searchSessionID,query:e,user:r.props.user,rank:t-l.searchBarStore.headerItems().length}),r._setSearchQuery(e.rawQuery)},r._handleInputChange=function(e){r._setSearchQuery(e.currentTarget.value)},r._handleCancelSearch=function(){r._setSearchQuery("")},r._updateSearchOnScopeChange=function(e){void 0===e&&(e=!1),r._setSearchQuery(l.searchBarStore.rawQuery(),!0,e)},r._handleScopeChipChange=function(e){var t=r.props.searchBarExperiments;f.chipsEnabled(t)&&(e?f.setScopeChip(t):f.removeScopeChip(t),r._updateSearchOnScopeChange(!0))},r._onBrowseScopeChange=function(e){f.handleScopeChange(e,r.props.searchBarExperiments),r._updateSearchOnScopeChange()},r._handleInputKeydown=function(e){if(e.keyCode===n.KeyCode.ESC)return r._handleCancelSearch(),void r.props.onCancelSearch();e.stopPropagation(),e.keyCode===n.KeyCode.UP?(e.preventDefault(),i.searchBarActions.highlightPreviousRow()):e.keyCode===n.KeyCode.DOWN&&(e.preventDefault(),i.searchBarActions.highlightNextRow())},r._navToSearch=function(){r.props.onSearch(r.state.normalizedQuery)},r._navToSelection=function(e,t){var s=l.searchBarStore.searchSuggestions()[e-t];s?r._openSearchResult(s):r._handleSearchResultOpen(l.searchBarStore.slimSearchSuggestions()[e-t])},r._handleInputSubmit=function(e,t){e.preventDefault();var s=l.searchBarStore.headerItems();if(t<s.length)switch(s[t]){case h.SearchBarDropdownHeaderItemType.SEARCH_ALL:r._navToSearch();break;case h.SearchBarDropdownHeaderItemType.SCOPE_CHIPS:var a=!f.isValidPathForChip(r.state.scopeChip);r._handleScopeChipChange(a)}else r._navToSelection(t,s.length)},r._handleContextMenuCapture=function(e){var t=r.props.user;_.fetchFullSearchResult({searchBarApiClient:c.searchBarApiClient,searchResult:e,user:t,onSuccess:function(e){T.logSearchAction({searchSessionId:l.searchBarStore.searchSessionID(),result:e,user:t,action_type:e instanceof a.File?"context_menu":"paper_context_menu"})}})},r._handleSearchResultOpen=function(e){_.fetchFullSearchResult({searchBarApiClient:c.searchBarApiClient,searchResult:e,user:r.props.user,onSuccess:function(e){r._openSearchResult(e)},onError:function(e){u.error(e)}})},r._handleResultObjectPathClick=function(e){r._resultObjectClick(e)},r._handleHighlightDropdownItem=function(e){i.searchBarActions.setHighlightedRow({index:e})},r._handleSearchBarFocus=function(){i.searchBarActions.focusSearchBar(r.props.user)},r._dispatchSearchSuccessful=function(){if(r.props.searchBarExperiments.expSearchRecentHistory){var e=r.state,t=e.rawQuery,s=e.normalizedQuery;i.searchBarActions.searchSuccessful(r.props.user,{rawQuery:t,normalizedQuery:s})}},r._logSearchBarTTI=function(){r._searchBarWebTimer&&r._searchBarWebTimer.markTimeToInteractive()},r._setSearchBarRef=function(e){return r._searchBarView=e},setTimeout(function(){f.handleScopeChange(r.props.currentPath,r.props.searchBarExperiments)},0),r.state=r._getStateFromStore(),r}return r.__extends(t,e),t.prototype.componentWillMount=function(){if(this.props.searchBarExperiments.expSearchRecentHistory){var e=m.get_viewer().get_users().map(function(e){return e.id});S.UserLocalStorage.clearOtherUsers(e)}},t.prototype.componentDidMount=function(){l.searchBarStore.add_change_listener(this._onSearchStoreChanged)},t.prototype.componentWillUnmount=function(){l.searchBarStore.remove_change_listener(this._onSearchStoreChanged)},t.prototype.componentWillReceiveProps=function(e){var t=this;this.props.currentPath!==e.currentPath&&setTimeout(function(){t._onBrowseScopeChange(e.currentPath)},0)},t.prototype._getStateFromStore=function(){return{isFocused:l.searchBarStore.isSearchBarFocused(),isActive:l.searchBarStore.isSearchBarActive(),rawQuery:l.searchBarStore.rawQuery(),normalizedQuery:l.searchBarStore.normalizedQuery(),suggestions:l.searchBarStore.slimSearchSuggestions(),searchBarLoading:l.searchBarStore.isSearchBarLoading(),searchSessionID:l.searchBarStore.searchSessionID(),highlightedRow:l.searchBarStore.highlightedSearchRow(),searchHistory:l.searchBarStore.searchHistory(),scopeChip:l.searchBarStore.scopeChip(),searchPath:f.getSearchPathForChips(this.props.searchBarExperiments),dropdownHeaderItems:l.searchBarStore.headerItems()}},t.prototype.getSearchBarView=function(){return this._searchBarView},t.prototype._setSearchQuery=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var s=this.props.user;o.searchBarApiActions.setSearchQuery({user:s,query:e,path:f.getSearchPathForChips(this.props.searchBarExperiments),webTimer:this._startSearchBarTimer(),forceUpdate:t,retainHighlight:r})},t.prototype._openSearchResult=function(e){this._dispatchSearchSuccessful(),this.props.onSearchResultOpen(e)},t.prototype._resultObjectClick=function(e){this._dispatchSearchSuccessful(),this.props.onResultObjectPathClick&&this.props.onResultObjectPathClick(e)},t.prototype._startSearchBarTimer=function(){return this._searchBarWebTimer?this._searchBarWebTimer.restart():(this._searchBarWebTimer=E.get_timer("search_bar"),this._searchBarWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:c.searchBarApiClient.getSearchApiUrl()})),this._searchBarWebTimer},t.prototype.render=function(){return s.createElement(p.SearchBarView,r.__assign({},this.props,this.state,{onRecentSearchQuerySelected:this._handleRecentSearchQuerySelected,onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchResultOpen:this._handleSearchResultOpen,onContextMenuCapture:this._handleContextMenuCapture,onResultObjectPathClick:this._handleResultObjectPathClick,onSearchBarFocus:this._handleSearchBarFocus,onSearchBarBlur:i.searchBarActions.blurSearchBar,onHighlightDropdownItem:this._handleHighlightDropdownItem,onSearchChipInteraction:this._handleScopeChipChange,onDropdownTTI:this._logSearchBarTTI,ref:this._setSearchBarRef}))},t.defaultProps={onCancelSearch:function(){}},t})(s.Component);t.SearchBarControllerElement=R,t.SearchBarController=d(R,["/static/css/search/search_bar_react-vflV_4WRT.css"])}),define("modules/clean/search/search_bar/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchBarDispatcher=r}),define("modules/clean/search/search_bar/history",["require","exports","external/underscore","modules/clean/search/constants","modules/clean/storage","modules/clean/search/logger"],function(e,t,r,s,a,n){"use strict";function o(e){return a.UserLocalStorage.get(e.id,s.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[]}function i(e,t,i){void 0===i&&(i="");var c=o(e),_=function(e,t){return e.normalizedQuery===t.normalizedQuery},h=r.findIndex(c,function(e){return _(e,t)});return n.logRecentQueryStored({searchSessionId:i,query:t,user:e,previousPosition:h}),c=c.filter(function(e){return!_(e,t)}),c=[t].concat(c).slice(0,s.SEARCH_RECENT_HISTORY_CAPACITY),a.UserLocalStorage.set(e.id,s.SEARCH_RECENT_HISTORY_STORAGE_KEY,c),c}function c(){a.UserLocalStorage.clearOtherUsers([])}function _(){a.UserLocalStorage.clearOtherUsers([])}Object.defineProperty(t,"__esModule",{value:!0}),t.getHistory=o,t.addQuery=i,t.testMockSetup=c,t.testMockTeardown=_}),define("modules/clean/search/search_bar/store",["require","exports","tslib","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/search/types","modules/clean/search/constants","modules/clean/search/store_helpers","modules/clean/react/browse/models","modules/clean/react/browse/constants","modules/clean/search/search_bar/history"],function(e,t,r,s,a,n,o,i,c,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchBar(),r._scopeChip="/",r._browseScope="/",r}return r.__extends(t,e),t.prototype._resetSearchBar=function(){this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSessionID=i.generateRandomID(),this._searchSuggestions=[],this._hasMoreResults=!1,this._slimSearchSuggestions=[],this._highlightedSearchRow=0,this._headerItems=[]},t.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},t.prototype.isSearchBarActive=function(){return!!this._rawQuery},t.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.normalizedQuery=function(){return i.normalize(this._rawQuery)},t.prototype.searchHistory=function(){return this._searchHistory||[]},t.prototype.searchSuggestions=function(){return this._searchSuggestions},t.prototype.hasMoreResults=function(){return this._hasMoreResults},t.prototype.slimSearchSuggestions=function(){return this._slimSearchSuggestions},t.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},t.prototype.browseScope=function(){return this._browseScope},t.prototype.scopeChip=function(){return this._scopeChip},t.prototype.searchSessionID=function(){return this._searchSessionID},t.prototype.findSearchFileSuggestion=function(e){var t=e.fq_path;return this._searchSuggestions.find(function(e){return e instanceof c.File&&s.paths_are_equal(e.fq_path,t)})},t.prototype.headerItems=function(){return this._headerItems},t.prototype._focusSearchBar=function(e){var t=e.user;this._searchHistory=h.getHistory(t),this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},t.prototype._blurSearchBar=function(){this._isSearchBarFocused=!1,this._highlightedSearchRow=0,this.emit_change()},t.prototype._setRawQuery=function(e,t){t?this._searchSessionID=t:i.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionID=i.generateRandomID()),this._rawQuery=e;var r=n.SearchBarDropdownHeaderItemType.SEARCH_ALL;this._headerItems.indexOf(r)===-1&&(this._headerItems=[r].concat(this._headerItems))},t.prototype._setSearchQuery=function(e){var t=e.query,r=e.qsid,s=e.keepHighlightedRow;this._setRawQuery(t,r),this._searchSuggestions=[],this._hasMoreResults=!1,this._slimSearchSuggestions=[],s||(this._highlightedSearchRow=0),this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},t.prototype._setSearchSuggestions=function(e){var t=e.searchResults;this._isSearchBarLoading=!1,this._searchSuggestions=t,this.emit_change()},t.prototype._setHasMoreResults=function(e){var t=e.hasMoreResults;this._hasMoreResults=t,this.emit_change()},t.prototype._setSlimSearchSuggestions=function(e){var t=e.searchResults;this._isSearchBarLoading=!1,this._slimSearchSuggestions=t,this.emit_change()},t.prototype._setHighlightedSearchRow=function(e){var t=e.index;this._highlightedSearchRow=t,this.emit_change()},t.prototype._highlightPreviousSearchRow=function(){this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},t.prototype._highlightNextSearchRow=function(){var e=this._slimSearchSuggestions.length||this._searchSuggestions.length||this._searchHistory.length,t=this._headerItems.length;this._highlightedSearchRow=Math.min(e+t-1,this._highlightedSearchRow+1),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchBar(),this.emit_change()},t.prototype._searchSuccessful=function(e){var t=e.user,r=e.query;this._searchHistory=h.addQuery(t,r,this._searchSessionID),this.emit_change()},t.prototype._trackBrowseScope=function(e){var t=e.path;this._browseScope=t,this.emit_change()},t.prototype._setScopeChip=function(e){var t=e.canScope,r=e.scope;if(this._scopeChip=r||"/",t){var s=n.SearchBarDropdownHeaderItemType.SCOPE_CHIPS;this._headerItems.indexOf(s)===-1&&(this._headerItems=this._headerItems.concat([s]))}this.emit_change()},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case o.FOCUS_SEARCH_BAR_ACTION:this._focusSearchBar(t.data);break;case o.BLUR_SEARCH_BAR_ACTION:this._blurSearchBar();break;case o.SET_SEARCH_QUERY_ACTION:this._setSearchQuery(t.data);break;case o.SET_SEARCH_SUGGESTIONS_ACTION:this._setSearchSuggestions(t.data);break;case o.SET_HAS_MORE_RESULTS_ACTION:this._setHasMoreResults(t.data);break;case o.SET_SLIM_SEARCH_SUGGESTIONS_ACTION:this._setSlimSearchSuggestions(t.data);break;case o.SET_HIGHLIGHTED_ROW_ACTION:this._setHighlightedSearchRow(t.data);break;case o.HIGHLIGHT_PREVIOUS_ROW_ACTION:this._highlightPreviousSearchRow();break;case o.HIGHLIGHT_NEXT_ROW_ACTION:this._highlightNextSearchRow();break;case o.CLEAR_SEARCH_BAR_ACTION:this._clearSearch();break;case o.SEARCH_SUCCESSFUL_ACTION:this._searchSuccessful(t.data);break;case _.BrowseActionTypes.SET_URL_PREFIX:this._clearSearch();break;case _.BrowseActionTypes.SET_PATH:case _.BrowseActionTypes.INITIALIZE_EVERYTHING:this._trackBrowseScope(t.data);break;case o.SET_SCOPE_CHIP_ACTION:this._setScopeChip(t.data)}},t})(a);t.SearchBarStore=l,t.searchBarStore=new l}),define("modules/clean/search/search_bar/view",["require","exports","tslib","external/classnames","external/spectrum/icon_global","external/react","jquery","modules/clean/keycode","modules/clean/react/maestro/a11y_constants","modules/core/i18n","modules/clean/web_timing_logger","modules/clean/search/search_bar/chips"],function(e,t,r,s,a,n,o,i,c,_,h,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderDropdown=function(){},e._handleNavigation=function(){e._searchBarInput.blurSearchBarTextInput()},e._onRecentSearchQuerySelected=function(t,r){e._searchBarInput.getSearchBarTextInput().value=t.rawQuery,e.props.onRecentSearchQuerySelected&&e.props.onRecentSearchQuerySelected(t,r)},e._onSearchResultOpen=function(t){e.props.onSearchResultOpen(t),e._handleNavigation()},e._onResultObjectPathClick=function(t){e.props.onResultObjectPathClick&&(e.props.onResultObjectPathClick(t),e._handleNavigation())},e._onSearch=function(t,r){var s=e.props.onSearch;s&&s(t,r),e._handleNavigation()},e._setSearchBarInputRef=function(t){return e._searchBarInput=t},e._setSearchBarDropdownRef=function(t){e._searchBarDropdown=t},e}return r.__extends(a,t),a.prototype.getSearchBarInput=function(){return this._searchBarInput},a.prototype.getSearchBarDropdown=function(){return this._searchBarDropdown},a.prototype._shouldRenderDropdown=function(){return!!(this.props.searchBarExperiments.expSearchRecentHistory&&this.props.searchHistory&&this.props.searchHistory.length||this.props.normalizedQuery&&this.props.normalizedQuery.length)},a.prototype.componentDidMount=function(){var t=this;h.waitForTTI().then(function(){e(["modules/clean/search/search_bar/dropdown"],function(e){var s=e.SearchBarDropdown;t._renderDropdown=function(){return t._shouldRenderDropdown()?n.createElement(s,r.__assign({},t.props,{searchHistory:t.props.searchHistory||[],onRecentSearchQuerySelected:t._onRecentSearchQuerySelected,onSearchResultOpen:t._onSearchResultOpen,onResultObjectPathClick:t._onResultObjectPathClick,onSearch:t._onSearch,isOpen:t.props.isFocused,ref:t._setSearchBarDropdownRef,searchBarExperiments:t.props.searchBarExperiments,dropdownHeaderItems:t.props.dropdownHeaderItems||[]})):null},t._shouldRenderDropdown()&&t.forceUpdate()})})},a.prototype.render=function(){var e=this.props,t=e.isActive,a=e.isExpanded,o=e.isFocused,i={"is-active":t,"is-collapsed":!(a||o),"is-expanded":a,"is-focused":o,"search-bar":!0};return n.createElement("div",{className:"search-bar--container u-l-fr"},n.createElement("div",{className:s(i)},n.createElement(p,r.__assign({},this.props,{ref:this._setSearchBarInputRef})),this._renderDropdown()))},a.defaultProps={rawQuery:"",normalizedQuery:"",showLinkToResultsPage:!0},a})(n.Component);t.SearchBarView=u;var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onKeydown=function(e){e.keyCode===i.KeyCode.ESC&&(t.blurSearchBarTextInput(),o(t._searchBarTextInput).val("")),t.props.onInputKeydown(e)},t._onSubmit=function(e){var r=t.props.highlightedRow,s=t.props.searchHistory||[];if(!t.props.normalizedQuery&&s.length>0&&r>0){e.preventDefault();var a=r-1,n=s[a];return t._searchBarTextInput.value=n.rawQuery,void(t.props.onRecentSearchQuerySelected&&t.props.onRecentSearchQuerySelected(n,a))}return t.blurSearchBarTextInput(),t.props.onInputSubmit(e,r)},t._setSearchBarTextInputRef=function(e){return t._searchBarTextInput=e},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){o(this._searchBarTextInput).on("keydown.SearchBarInput",this._onKeydown),o(this._searchBarTextInput).on("focusout.SearchBarInput",this.props.onSearchBarBlur)},t.prototype.componentWillUnmount=function(){o(this._searchBarTextInput).off(".SearchBarInput")},t.prototype.getSearchBarTextInput=function(){return this._searchBarTextInput},t.prototype.blurSearchBarTextInput=function(){this._searchBarTextInput.blur(),this.props.onSearchBarBlur()},t.prototype.render=function(){var e=this.props,t=e.onInputChange,r=e.onSearchBarFocus,s=e.onSearchBarBlur,o=e.placeholder,i=e.isFocused,h=e.isActive,l=e.highlightedRow,u=e.rawQuery;return n.createElement("form",{className:"search-bar__input",onSubmit:this._onSubmit},n.createElement("button",{"aria-label":_._("Search"),className:"search-bar__button",type:"submit"},n.createElement(a.IconGlobal,{name:"search-small"})),n.createElement(d,{searchBarExperiments:this.props.searchBarExperiments,scopeChip:this.props.scopeChip}),n.createElement("input",{"aria-activedescendant":"search-dropdown-suggestion"+l,"aria-autocomplete":"list","aria-expanded":i&&h,"aria-label":_._("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:t,onFocus:r,onBlur:s,placeholder:o?o:_._("Search"),ref:this._setSearchBarTextInputRef,role:"combobox",defaultValue:u,tabIndex:c.LAYOUT_TAB_ORDER.SEARCH_BAR}))},t})(n.Component),d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){if(!this.props.scopeChip)return null;if(!l.chipsEnabled(this.props.searchBarExperiments))return null;var e=l.formatScopeChip(this.props.scopeChip);return e?n.createElement("ul",{className:"search_bar__chip_list"},this._renderChip(e)):null},t.prototype._renderChip=function(e){var t="in:"+e;return n.createElement("li",{className:"search_bar__chip",title:t},n.createElement("span",null,t))},t})(n.Component)}),define("modules/clean/search/search_helpers",["require","exports","external/sjcl","modules/clean/search/search_bar/store","modules/clean/react/browse/models","modules/clean/search/models","modules/core/i18n","modules/core/uri","modules/clean/browse_interface","modules/core/cookies","modules/clean/search/logger"],function(e,t,r,s,a,n,o,i,c,_,h){"use strict";function l(e){var t=e.user,r=e.searchPath,s=e.normalizedQuery,a=e.searchSessionID;return new i({path:"/search/"+t.role,query:{path:r,query:s,qsid:a,search_token:S()}})}function u(e,t){return e instanceof n.SlimFileSearchResult?c.browse_uri_for_fq_path(t,e.fq_path).toString():e.url}function p(e){var t=e.searchBarApiClient,r=e.searchResult,i=e.user,c=e.onSuccess,_=e.onError;if(r instanceof n.SlimFileSearchResult){var h=s.searchBarStore.findSearchFileSuggestion(r);h?c(h):t.fetchAdditionalFileMetadata({searchResults:[r],user:i,onSuccess:function(e){if(e.length>0)c(e[0]);else if(_){var t=o._("There was a problem completing this request.");_(t)}},onError:_})}else r instanceof a.Paper&&c(r)}function d(e){return 0===e.button&&!e.altKey&&!e.ctrlKey&&!e.metaKey}function E(e){var t=e.result,r=e.user,a=e.action_type,n=e.viewport,o=void 0===n?"full-view":n,i=e.view_type;h.logSearchAction({searchSessionId:s.searchBarStore.searchSessionID(),result:t,user:r,action_type:a,viewport:o,view_type:i})}function S(){var e=r.codec.utf8String.toBits(_.read("__Host-js_csrf")),t=r.codec.utf8String.toBits("search"),s=new r.misc.hmac(e);return r.codec.base64.fromBits(s.encrypt(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.buildSearchURL=l,t.resultObjectToUrl=u,t.fetchFullSearchResult=p,t.shouldHandleClick=d,t.logSearchAction=E,t.getSearchCsrfToken=S}),define("modules/clean/search/store_helpers",["require","exports"],function(e,t){"use strict";function r(e){return e.trim().replace(/\ +/g," ")}function s(e){return!r(e)}function a(e,t){return!(s(e)||!s(t))||e.length>=3&&1===t.length}function n(){for(var e="",t=0;t<32;t++){var r=Math.floor(10*Math.random());e+=String(r)}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=r,t.isBlank=s,t.shouldStartNewSearchSession=a,t.generateRandomID=n}),define("modules/clean/search/types",["require","exports"],function(e,t){"use strict"
;Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultTypes={FILE:"FILE",PAPER:"PAPER"};(function(e){e.CHIP_IN="CHIP_IN",e.CHIP_OUT="CHIP_OUT",e.OFF="OFF",e.CONTROL="CONTROL"})(t.SearchChipsVariants||(t.SearchChipsVariants={}));(function(e){e.SEARCH_ALL="SEARCH_ALL",e.SCOPE_CHIPS="SCOPE_CHIPS"})(t.SearchBarDropdownHeaderItemType||(t.SearchBarDropdownHeaderItemType={}))}),define("modules/clean/sharing/access_level",["require","exports","external/underscore"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.ACCESS_NO_ACCESS=0]="ACCESS_NO_ACCESS",e[e.ACCESS_READER_NO_COMMENT=-10]="ACCESS_READER_NO_COMMENT",e[e.ACCESS_READER=1]="ACCESS_READER",e[e.ACCESS_WRITER=2]="ACCESS_WRITER",e[e.ACCESS_OWNER=3]="ACCESS_OWNER"})(t.NameSpaceAccess||(t.NameSpaceAccess={})),t.ACCESS_LEVEL={OWNER:"owner",WRITER:"writer",READER:"reader",READER_NO_COMMENT:"reader_no_comment"},t.ACCESS_VALUES=r.values(t.ACCESS_LEVEL)}),function(){define("modules/clean/web_user_action_logger",["modules/clean/ajax"],function(e){var t,r,s,a;return a={DOWNLOAD:"download",MOVE:"move",OPEN_MOVE_MODAL:"open_move_modal",RENAME:"rename",ADD_COMMENT:"add_comment",OPEN_COPY_MODAL:"open_copy_modal",COPY:"copy",DELETE:"delete",PERMANENT_DELETE:"permanent_delete",VERSIONS:"versions",SORT_RECORDS:"sort_records",SELECT_ROW:"select_row",OPEN_ROW:"open_row",UPLOAD_FILE:"upload_file",CREATE_FOLDER:"create_folder",VIEW_SHARE_MODEL:"view_share_model",TOGGLE_DELETED_FILES:"toggle_deleted_files",NAV_NEW_PAGE:"nav_new_page",SWITCH_ACCOUNT:"switch_account",SWITCH_VIEW_TYPE:"switch_view_type",OPEN_ADD_TO_COLLECTION_MODAL:"open_add_to_collection_modal",OPEN_DELETE_USER_MODAL:"open_delete_user_modal",CLICK_REVIEW_SUMMARY_DELETE_USER:"click_review_summary_delete_user",CLICK_LEARN_MORE_ACCOUNT_CONVERSION:"click_learn_more_account_conversion",CLICK_CONVERT_INDIVIDUAL_ACCOUNT:"click_convert_individual_account"},r=3,t=6e5,s=(function(){function s(){}return s.prototype.error_count=0,s.prototype.last_error=Date.now(),s.prototype.should_report=!0,s.prototype.log=function(s,a,n){if(this.should_report&&(this.error_count<r||Date.now()-this.last_error>t))return e.SilentBackgroundRequest({url:"/log/web_user_action",data:{_subject_uid:s,event_type:a,extra_params:JSON.stringify(n)},error:(function(e){return function(t){return 429===t.status?e.error_count=r:e.error_count+=1,e.last_error=Date.now()}})(this),success:(function(e){return function(t){var r,s;try{return r=JSON.parse(t),(null!=r?r.continue_sending:void 0)||(e.should_report=!1),e.error_count=0}catch(t){throw s=t,e.error_count+=1,e.last_error=Date.now(),s}}})(this)})},s})(),{WebUserActionLog:new s,WebUserActionLogEvents:a,WebUserActionLogClass:s,MAX_ERRORS:r}})}.call(this);
//# sourceMappingURL=pkg-embedded_app.min.js-vfl3ZyiN2.map